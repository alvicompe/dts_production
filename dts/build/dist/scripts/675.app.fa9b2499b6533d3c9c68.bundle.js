"use strict";(self.webpackChunkdts_hytera=self.webpackChunkdts_hytera||[]).push([[675],{8101:(t,e,o)=>{o.d(e,{Z:()=>l});var i=o(5893),n=o(7294),r=o(4880);const a=o(6158);a.accessToken=r.c3;const l=({dragRotate:t,map:e,pitch:o,bearing:r,mapContainer:l,lng:s,lat:c,zoom:d,setLoad:u,style:p,height:g})=>((0,n.useEffect)((()=>{console.log("map.current",e.current,r),e.current||(l&&(e.current=new a.Map({container:l.current,style:p,center:[s,c],pitch:o,bearing:r,zoom:d,maxBounds:[[-78.2747922,-7.6626779],[-78.1305246,-7.5534415]],antialias:!0,dragRotate:t})),console.log("inianco"))}),[e,l]),(0,n.useEffect)((()=>{e.current&&(e.current.addControl(new a.FullscreenControl,"bottom-left"),e.current.addControl(new a.NavigationControl,"bottom-left"),e.current.on("move",(()=>{})),e.current.on("load",(()=>{e.current&&u(!0)})))}),[e]),(0,n.useEffect)((()=>{e.current&&e.current.setBearing(r)}),[r]),(0,i.jsx)("div",{ref:l,style:{flex:1,height:g||"100vh",width:"100%"},className:"map-container"},void 0))},6259:(t,e,o)=>{o.r(e),o.d(e,{default:()=>j});var i,n=o(5893),r=o(7294),a=o(8101),l=o(4880),s=o(3855),c=o(8693),d=o(2198);!function(t){t.truck="truck",t.excavator="excavator"}(i||(i={}));const u=t=>t<=0||t<l.X9?0:t-l.X9,p=({load:t,tb:e,model:o})=>{const[a,p]=(0,r.useState)([]),{truckInfoList:g}=(0,s.C)(c.ej),{excavatorInfoList:h}=(0,s.C)(d.kW),f=g.concat(h);return(0,r.useEffect)((()=>{f.length&&f.forEach((t=>{const n=!!t&&!t.deviceAlias.includes("EX-"),r=a.findIndex((e=>e.id===t.deviceId)),s=`${l.$e}/public/obj/gltf/${n?"truck":"excavator"}.gltf`;if(-1===r){let r=null;r=n?o.truck?o.truck:null:o.excavator?o.excavator:null;const{sensor:l}=t;if(r&&l&&l.longitude&&l.latitude){const o=r.duplicate(),c={id:t.deviceId,model:o,unit:t,origin:[l.longitude,l.latitude,u(l.altitude)],path:s,type:n?i.truck:i.excavator};p((t=>-1===t.findIndex((t=>t.id===c.id))?(e.add(o),[...a,c]):t))}}}))}),[f,t,e,o]),(0,r.useEffect)((()=>{f.forEach((t=>{if(t){const e=a.find((e=>e.id===t.deviceId));if(e){const{sensor:o}=t;e.model.setRotation({z:-o.direction}),e.model.setCoords([o.longitude,o.latitude,u(o.altitude)])}}}))}),[a,f]),(0,n.jsx)(n.Fragment,{},void 0)};var g=o(4150),h=o(5573);const f=(t,e,o)=>{let i=t.length;i%2!=0&&(t.push(t[i-1]),i++);const n=[];for(let r=0;r<i-1;r++){const i=[t[r],t[r+1]],a=t[r][3],s=o?0:a-l.X9-1,c=(0,g.f3b)((0,g.TuJ)(i,{building:"roof","building:height":"400",name:"Petrobras","building:levels":"","building:roof":"","building:use":"",base_height:s,color:e,height:o?a-l.X9-10:s,"building:min_level":"",min_height:"","roof:levels":""}),5,{units:"meters"});n.push(c)}return{type:"FeatureCollection",features:n}},y=({map:t,polygons_actives:e,loadMap:o})=>((0,r.useEffect)((()=>{if(t&&o&&e.length>0){const o={type:"FeatureCollection",features:e.map((t=>({type:"Feature",properties:{building:"roof","building:height":"400",name:"Petrobras","building:levels":"","building:roof":"","building:use":"",base_height:t.altitude-l.X9,height_proyection:t.altitude-l.X9-.5,color:h.O[t.color].hex,height:t.altitude-l.X9+l.Cn,opacity:1,"building:min_level":"",min_height:"","roof:levels":""},geometry:{type:"Polygon",coordinates:[t.pointList.map((t=>[t.longitude,t.latitude,t.altitude]))]}})))};t.addSource("polygons_3d_source",{type:"geojson",data:o}),t.addLayer({id:"polygons_3d_layer",type:"fill-extrusion",source:"polygons_3d_source",paint:{"fill-extrusion-color":{type:"identity",property:"color"},"fill-extrusion-height":{type:"identity",property:"height"},"fill-extrusion-opacity":1,"fill-extrusion-base":{type:"identity",property:"base_height"},"fill-extrusion-height-transition":{duration:1e4,delay:0},"fill-extrusion-vertical-gradient":!1}}),t.addLayer({id:"polygons_base_3d",type:"fill-extrusion",filter:["has","height"],source:"polygons_3d_source",paint:{"fill-extrusion-color":"rgb(189,94,0)","fill-extrusion-height":["get","height_proyection"],"fill-extrusion-opacity":.05,"fill-extrusion-vertical-gradient":!1}})}}),[t,e,o]),(0,n.jsx)(n.Fragment,{},void 0)),b=({map:t,id:e,color:o,points:i,opacity:a,loadMap:l,level:s,heigth:c,fromBase:d})=>((0,r.useEffect)((()=>{t&&l&&(t.addSource(e+"",{type:"geojson",data:f(i,s,c)}),t.addLayer({id:e+"",type:"fill-extrusion",filter:["has","height"],source:e,paint:{"fill-extrusion-color":{type:"identity",property:"color"},"fill-extrusion-height":{type:"identity",property:"height"},"fill-extrusion-opacity":a,"fill-extrusion-base":{type:"identity",property:"base_height"},"fill-extrusion-vertical-gradient":!0}}))}),[t,l]),(0,n.jsx)(n.Fragment,{},void 0));var m=o(3054);let x=[];const v=()=>{const t=(0,r.useRef)(null),e=(0,r.useRef)(null),[o,i]=(0,r.useState)(-78.2045567035675),[c,d]=(0,r.useState)(-7.617878602920846),[u,g]=(0,r.useState)(15),[f,v]=(0,r.useState)(),[w,j]=(0,r.useState)(!1),[L,_]=(0,r.useState)({truck:null,excavator:null}),{routeList:k,dmeCellList:C,padCellList:E,polygonList:z,stockCellList:F}=(0,s.C)(m.WD);return(0,r.useEffect)((()=>{if(w&&!e.current.getLayer("objects3D")&&!f){console.log("cargandoLAYRER"),window.tb=new window.Threebox(e.current,e.current.getCanvas().getContext("webgl"),{defaultLights:!0});const t=new window.THREE.DirectionalLight("#000",1,100);t.position.set(0,0,100).normalize(),t.castShadow=!0,v(window.tb),e.current.addLayer({id:"objects3D",type:"custom",renderingMode:"3d",onAdd:function(t,e){return o=this,i=void 0,r=function*(){const t={obj:`${l.$e}/public/obj/gltf/truck02.gltf`,type:"gltf",scale:2,units:"meters",anchor:"center",adjustment:{x:0,y:0,z:0},rotation:{x:90,y:-90,z:0}},e={obj:`${l.$e}/public/obj/gltf/excavator.gltf`,type:"gltf",scale:2.5,units:"meters",anchor:"center",adjustment:{x:0,y:0,z:0},rotation:{x:90,y:80,z:0}};window.tb.loadObj(t,(function(t){window.tb.loadObj(e,(function(e){_({truck:t,excavator:e})}))}))},new((n=void 0)||(n=Promise))((function(t,e){function a(t){try{s(r.next(t))}catch(t){e(t)}}function l(t){try{s(r.throw(t))}catch(t){e(t)}}function s(e){var o;e.done?t(e.value):(o=e.value,o instanceof n?o:new n((function(t){t(o)}))).then(a,l)}s((r=r.apply(o,i||[])).next())}));var o,i,n,r},render:function(t,e){window.tb.update()}})}}),[w,f]),(0,r.useEffect)((()=>{e.current&&f&&k.length>0&&k.map((t=>{const e=f.line({width:12,color:h.O[t.color].hex,opacity:1,geometry:t.pointList.map((t=>[t.longitude,t.latitude,t.altitude-l.X9]))});window.tb.add(e),x.push(e)}))}),[e,k,f]),(0,r.useEffect)((()=>{let t=0;t=u>13&&u<14?u/3:u>=14&&u<15?u/2:u>=15&&u<16?u:u>=16&&u<17?3*u:4*u,x.length>0&&x.length===k.length&&(console.log("actualizando"),x.forEach((t=>{window.tb.remove(t)})),x=[],t=Math.pow(2,u-12),k.map((e=>{const o=window.tb.line({width:t,color:e.color,opacity:1,geometry:e.pointList.map((t=>[t.longitude,t.latitude,t.altitude]))});window.tb.add(o),x.push(o)})))}),[u]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.Z,Object.assign({map:e,dragRotate:!0,style:"mapbox://styles/dispatchgat/ckqqsfc2y46bo17sf1y29zwnj",mapContainer:t,bearing:0,pitch:25},{lat:c,lng:o,zoom:u,setLat:d,setLng:i,setZoom:g,setLoad:j}),void 0),(0,n.jsx)(y,{map:e.current,polygons_actives:z,loadMap:w},void 0),k.map(((t,o)=>(0,n.jsx)(r.Fragment,{children:t.pointList&&t.pointList.length>0&&(0,n.jsx)(b,{points:t.pointList.map((t=>[t.latitude,t.longitude,t.altitude])),color:h.O[t.color].hex,id:`base_route${o}`,loadMap:w,map:e.current,opacity:.1,level:0,fromBase:!0,heigth:t.pointList.map((t=>[t.latitude,t.longitude,t.altitude]))[0][2]-l.X9-10},void 0)},o))),L.truck&&(0,n.jsx)(p,{keyLayer:"layerTrucks",map:e.current,load:w,scale:.5,tb:window.tb,model:L},void 0),L.truck&&(0,n.jsx)(p,{keyLayer:"layerExcavator",map:e.current,load:w,scale:.5,tb:window.tb,model:L},void 0)]},void 0)},w=()=>(0,n.jsx)("div",Object.assign({style:{display:"flex",justifyContent:"space-between",height:"100vh"}},{children:(0,n.jsx)(v,{},void 0)}),void 0),j=()=>(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(w,{},void 0)},void 0)}}]);