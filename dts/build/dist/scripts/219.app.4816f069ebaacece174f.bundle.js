(self.webpackChunkdts_hytera=self.webpackChunkdts_hytera||[]).push([[219],{63663:(e,t,i)=>{"use strict";i.d(t,{F2:()=>a,xu:()=>u.I,zx:()=>c,iz:()=>p,T5:()=>h,P4:()=>m,hU:()=>v,Mi:()=>b,IB:()=>r.C});var s=i(85893),n=i(8286),o=i(96588);const a=e=>(0,s.jsx)(o.ZP,Object.assign({},Object.assign({},e.propsAutocomplete),{renderInput:e=>(0,s.jsx)(n.Z,Object.assign({},e,{label:"Seleccione una opción",variant:"outlined"}),void 0)}),void 0);var r=i(45287),l=i(282);const c=e=>(0,s.jsx)(l.Z,Object.assign({},Object.assign({},e.propsButton),{children:e.label}),void 0);var d=i(17812);const v=e=>(0,s.jsx)(d.Z,Object.assign({},Object.assign({},e),{children:e.children}),void 0);var u=i(47463),g=i(41749);const h=e=>(0,s.jsx)(g.Z,Object.assign({},Object.assign({},e),{container:!0},{children:e.children}),void 0),m=e=>(0,s.jsx)(g.Z,Object.assign({},Object.assign({},e),{item:!0},{children:e.children}),void 0);var j=i(55517);const p=e=>(0,s.jsx)(j.Z,Object.assign({},Object.assign({},e)),void 0);var x=i(82285);const b=e=>(0,s.jsx)(x.Z,Object.assign({},Object.assign({},e),{children:(0,s.jsx)(g.Z,{children:e.children},void 0)}),void 0)},45287:(e,t,i)=>{"use strict";i.d(t,{C:()=>a});var s=i(85893),n=i(64436),o=i(8286);const a=e=>{const{propsTextField:t,propsForm:i}=e;return(0,s.jsx)(n.Z,Object.assign({},Object.assign({},i),{children:(0,s.jsx)(o.Z,Object.assign({},Object.assign({},t)),void 0)}),void 0)}},47463:(e,t,i)=>{"use strict";i.d(t,{I:()=>o});var s=i(85893),n=i(10046);const o=({children:e,height:t,width:i})=>(0,s.jsx)(n.Z,Object.assign({height:t,width:i},{children:e}),void 0)},61242:(e,t,i)=>{"use strict";i.d(t,{a:()=>u});var s=i(85893),n=i(41120),o=i(52663),a=i(66083),r=i(29525),l=i(66856),c=i(95477),d=i(282);const v=(0,n.Z)({disabledPadding:{padding:0,textAlign:"center"}}),u=({open:e,handleClose:t,handleConfirm:i,title:n,children:u,maxWidth:g="lg",disabled:h=!1,loading:m})=>{const j=v();return(0,s.jsxs)(o.Z,Object.assign({open:e,onClose:t,maxWidth:g},{children:[(0,s.jsx)(a.Z,Object.assign({className:j.disabledPadding},{children:n}),void 0),(0,s.jsx)(r.Z,{children:u},void 0),(0,s.jsx)(l.Z,{children:m?(0,s.jsx)(c.Z,{style:{width:"30px",height:"30px"}},void 0):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Z,Object.assign({size:"small",color:"primary",onClick:t},{children:"Cancelar"}),void 0),i&&(0,s.jsx)(d.Z,Object.assign({disabled:h,variant:"outlined",size:"small",color:"secondary",onClick:i,autoFocus:!0},{children:"Confirmar"}),void 0)]},void 0)},void 0)]}),void 0)}},11818:(e,t,i)=>{"use strict";i.d(t,{y:()=>o});var s=i(67294),n=i(49032);const o=e=>{const[t,i]=(0,s.useState)(!0),[o,a]=(0,s.useState)(!0),[r,l]=(0,s.useState)(!0),[c,d]=(0,s.useState)(!0);return(0,s.useEffect)((()=>{const t=()=>0!==(null==e?void 0:e.length)&&(null==e?void 0:e.every((e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.initialEventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===n.EnumEvent.NO_OPERATIONAL}))),s=()=>0!==(null==e?void 0:e.length)&&(null==e?void 0:e.every((e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.initialEventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===n.EnumEvent.OPERATIONAL}))),o=()=>0!==(null==e?void 0:e.length)&&(null==e?void 0:e.every((e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.initialEventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===n.EnumEvent.OPERATIONAL_DELAY}))),r=()=>0!==(null==e?void 0:e.length)&&(null==e?void 0:e.every((e=>{var t,i;return(null===(i=null===(t=null==e?void 0:e.initialEventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===n.EnumEvent.MAINTENANCE}))),c=()=>0!==(null==e?void 0:e.length)&&(null==e?void 0:e.every((e=>{var t,i;return void 0===(null===(i=null===(t=null==e?void 0:e.initialEventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)})));i(!0),a(!0),l(!0),d(!0),s()&&(i(!1),a(!0),l(!1),d(!1)),c()&&(i(!1),a(!1),l(!1)),t()&&(i(!0),a(!1),l(!1)),o()&&(i(!1),a(!1),l(!0)),r()&&(i(!1),a(!1),l(!0),d(!0)),0==c()&&0==t()&&0==o()&&0==s()&&0==r()&&(i(!0),a(!0),l(!0),d(!0))}),[e]),[t,o,r,c]}},15635:(e,t,i)=>{"use strict";i.d(t,{r:()=>o});var s=i(67294),n=i(95090);const o=e=>{const[t,i]=(0,s.useState)(!1);return(0,s.useEffect)((()=>(console.log("state",e),e===n.JD.DONE||e===n.JD.UNKNOWN||e===n.JD.ERROR?i(!1):i(!0),()=>{i(!1)})),[e]),[t]}},31379:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>$t});var s=i(85893),n=i(41749),o=i(868),a=i(17812),r=i(73914),l=i(59240),c=i(95757),d=i(50998),v=i(71267),u=i(282),g=i(62822),h=i(79895),m=i(55517),j=i(10046),p=i(33681);const x=({loading:e})=>e?(0,s.jsx)(p.Z,{},void 0):(0,s.jsx)(s.Fragment,{},void 0),b="truck";var O=i(5200),f=i(93584),y=i(73855),E=i(73250),N=i(75647),L=i(44824),C=i(28231),S=i(715),k=i(95692),Z=i(41042),T=i(67294),I=i(78721),A=i(5814),w=i(49032),D=i(67774),R=i(52314),P=i(56731),z=i(7258),W=i(53559),F=function(e,t,i,s){return new(i||(i=Promise))((function(n,o){function a(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};const M=(0,r.Z)({rootFilter:{flex:"0 0",margin:2,border:"1px dashed #7b81836e",cursor:"move",float:"left",width:"98%",background:f.sb},rootItem:{margin:2,border:"1px dashed #7b81836e",cursor:"move",float:"left",width:"98%",flex:"0 0"},rootItemTemporal:{flex:"0 0",margin:2,border:"1px dashed green",cursor:"move",float:"left",width:"98%",background:"#34d0ff6e"},rootItemTemporalRemove:{flex:"0 0",margin:2,border:"1px dashed red",background:"#ff60604a",cursor:"move",float:"left",width:"98%"},titleTruck:{fontSize:"1em",cursor:"move"},contentTruck:{margin:2,padding:0,width:"100%",position:"relative",height:"100%"},contentCycle:{height:16,minWidth:16,display:"flex",borderRadius:"50%",background:"#efecec",justifyContent:"center",alignItems:"center",justifyItems:"center"},stateTruck:{position:"absolute",fontSize:"0.5rem",top:0,left:0},containerMoreTruck:{position:"absolute",top:-6,right:2,cursor:"pointer"},moreTruck:{fontSize:"0.8rem",cursor:"pointer"},actions:{minWidth:36},labelCycleNumber:{fontSize:11,color:"#5a5757"},labelExcavator:{marginTop:4,background:"#424141",color:"#fff"},labelDistance:{marginTop:4,background:`${f.J$}20`}}),_=({truck:e})=>{let t="",i=null;switch(e.state){case I.EnumEventState.UNKNOWN_STATE:i=(0,s.jsx)(N.Z,{style:{fontSize:"1rem"},fontSize:"small"},void 0),t=e.operationList&&e.operationList.length>0?"En camino":"Sin operación";break;case I.EnumEventState.DOWNLOAD:i=(0,s.jsx)(L.Z,{style:{fontSize:"1rem"},fontSize:"small"},void 0),t="Descargando";break;case I.EnumEventState.UPLOAD:i=(0,s.jsx)(C.Z,{style:{fontSize:"1rem"},fontSize:"small"},void 0),t="Cargando";break;case I.EnumEventState.TO_UPLOAD:i=(0,s.jsx)(S.Z,{style:{fontSize:"1rem",transform:"rotate(180deg)"},fontSize:"small"},void 0),t="A carga";break;case I.EnumEventState.TO_DOWNLOAD:i=(0,s.jsx)(S.Z,{style:{fontSize:"1rem"},fontSize:"small"},void 0),t="A descarga";break;default:i=(0,s.jsx)(k.Z,{style:{fontSize:"1rem"},fontSize:"small"},void 0),t=`Advertencia!!! en otro estado... Estado = ${I.EnumEventState[e.state]}`}return i&&(0,s.jsx)(o.ZP,Object.assign({title:t},{children:(0,s.jsx)(a.Z,Object.assign({style:{margin:0,padding:0},size:"small"},{children:i}),void 0)}),void 0)},$=({truck:e,temporal:t,operation:i,temporalRemove:a,eventFrom:r,isFilter:l=!1,distanceToExcavator:c,excavator:v,id:u})=>{var g;const{timeline:m}=(0,y.C)(A.h3),{user:{user:j}}=(0,y.C)(W.MR),p=(0,y.T)(),x=M(),[{isDragging:N},L]=(0,O.c)((()=>({type:b,item:{truck:e},end:(t,s)=>F(void 0,void 0,void 0,(function*(){const t=s.getDropResult();s.canDrag(),console.log("dropResult",t),null!==t&&(yield p((0,A.Qi)({truck:e,eventTo:null==t?void 0:t.eventTo,eventFrom:r})),yield p((0,D.CB)(null==t?void 0:t.eventTo)),yield p((0,A.h1)(e)),(null==t?void 0:t.operation)&&(yield p((0,E.UN)({operationId:t.operation.id,truck:e,operationOldId:i?i.id:""}))))})),collect:e=>({isDragging:e.isDragging(),handlerId:e.getHandlerId()})})),[a,i,e]),C=void 0!==e.sensor,S=(0,T.useCallback)((()=>{var t;const i=null===(t=e.deviceAlias)||void 0===t?void 0:t.split("-");return i&&i.length>1?i[1]:""}),[e.deviceAlias]);return(0,s.jsx)(h.Z,Object.assign({id:u||`truck-${e.deviceId}`,style:{opacity:N?.5:1},className:l&&!a?x.rootFilter:t?x.rootItemTemporal:a?x.rootItemTemporalRemove:x.rootItem,ref:L,elevation:4},{children:(0,s.jsxs)(d.Z,Object.assign({disableGutters:!0,className:x.contentTruck},{children:[(0,s.jsx)(Z.Z,{className:x.stateTruck,style:{color:C?f.FD:f.fQ},fontSize:"small"},void 0),(0,s.jsxs)(n.Z,Object.assign({container:!0,onMouseDown:()=>F(void 0,void 0,void 0,(function*(){const e={id:"",name:"",event:r},t={id:"",deviceId:"",deviceAlias:"",initialHourmeter:0,finalHourmeter:0,initialEventState:{id:"",name:"",eventState:I.EnumEventState.UNKNOWN_STATE,event:e},initialState:w.EnumEvent.UNKNOWN_STATE_EVENT,finalState:w.EnumEvent.UNKNOWN_STATE_EVENT,durationTime:0,shift:P.Shift.UNKNOWN_SHIFT,stateRegister:0,adjustment:0,status:!1,assetType:0,guard:z.EnumGuard.UNKNOWN_GUARD,userId:j.id};yield p((0,A.f0)(t))}))},{children:[(0,s.jsx)(n.Z,Object.assign({item:!0,style:{marginTop:4}},{children:(0,s.jsx)("label",Object.assign({className:x.titleTruck},{children:S()}),void 0)}),void 0),(0,s.jsxs)(n.Z,Object.assign({item:!0},{children:[(0,s.jsxs)(n.Z,Object.assign({container:!0,className:x.actions,alignItems:"center"},{children:[(0,s.jsx)(_,{truck:e},void 0),(0,s.jsx)("div",Object.assign({style:{display:"flex",flexDirection:"row",alignItems:"center"}},{children:(0,s.jsx)(o.ZP,Object.assign({title:(()=>{let t=!1;return null==i||i.truckList.find((i=>{i.deviceId===e.deviceId&&(t=!0)})),t})()?"Agregar Ciclo":"Número de ciclos"},{children:(0,s.jsx)("div",Object.assign({className:x.contentCycle},{children:(0,s.jsx)("label",Object.assign({className:x.labelCycleNumber,onClick:()=>{p((0,R.eh)(e))}},{children:void 0===e.cycleNumber?"0":e.cycleNumber}),void 0)}),void 0)}),void 0)}),void 0)]}),void 0),void 0!==c&&(0,s.jsx)(n.Z,Object.assign({item:!0,className:x.labelDistance},{children:(0,s.jsxs)("label",Object.assign({className:x.titleTruck},{children:[c.toFixed(2),"m"]}),void 0)}),void 0),void 0!==v&&(0,s.jsx)(n.Z,Object.assign({item:!0,className:x.labelExcavator},{children:(0,s.jsx)("label",Object.assign({className:x.titleTruck},{children:e.operationList&&e.operationList.length>0?null===(g=e.operationList[0].excavator)||void 0===g?void 0:g.deviceAlias:""}),void 0)}),void 0)]}),void 0)]}),void 0)]}),void 0)}),void 0)};var U=i(63663),H=i(48101),G=i(10980),J=i(6777),K=i(95090),V=i(89613),B=i(34344),X=i(92777),Y=i(66320);class q{constructor(e,t,i,s,n,o,a,r){this.circleList=e,this.map=t,this.idSource=i,this.radius=n,this.idLayer=s,this.fontSize=9,this.color=o,this.transparent=a,this.onClickElement=r}getInMap(){return this.map.getSource(this.idSource)}generateFeatures(){return this.circleList.map((e=>({type:"Feature",properties:{label:e.label},geometry:{type:"Point",coordinates:2===e.point.length?e.point:[0,0]}})))}addToMap(){var e,t;!this.getInMap()&&this.circleList.length>0&&(this.map.getSource(this.idSource)||this.map.addSource(this.idSource,{type:"geojson",data:{type:"FeatureCollection",features:this.generateFeatures()}}),this.map.getLayer(this.idLayer)||(this.map.addLayer({id:this.idLayer,type:"circle",source:this.idSource,paint:{"circle-radius":{stops:[[0,0],[20,(e=this.radius,t=this.circleList[0].point[1],e/.075/Math.cos(t*Math.PI/180))]],base:2},"circle-stroke-color":this.color,"circle-stroke-width":this.transparent?2:0,"circle-color":this.color,"circle-opacity":this.transparent?0:1}}),this.map.addLayer({id:this.idLayer+"LABEL",type:"symbol",source:this.idSource,layout:{"text-field":["get","label"],"text-variable-anchor":["top"],"text-radial-offset":.5,"text-justify":"auto","text-allow-overlap":!0}})),this.map.on("click",this.idLayer,(e=>{this.onClickElement&&this.onClickElement(e)})),this.map.on("mouseenter",this.idLayer,(()=>{this.map.getCanvas().style.cursor="pointer"})),this.map.on("mouseleave",this.idLayer,(()=>{this.map.getCanvas().style.cursor=""})))}updateInMap(){const e=this.getInMap();e?e.setData({type:"FeatureCollection",features:this.generateFeatures()}):this.addToMap()}removeOfMap(){this.getInMap()&&(this.map.removeLayer(this.idLayer),this.map.removeLayer(this.idLayer+"LABEL")),this.map.removeSource(this.idSource)}}var Q=i(78479),ee=i(45287),te=i(34880);const ie=(0,r.Z)({rootList:{flex:1,padding:2,margin:2,overflow:"auto"},rootMap:{borderRadius:16,position:"relative",right:0,left:0},mapBackground:{position:"absolute",right:0,left:0,top:0,bottom:0,zIndex:1}}),se=({operation:e})=>{const t=(0,T.useRef)(null),[i,o]=(0,Q._)(`RADIOSEX${e.excavatorList&&e.excavatorList.length>0?e.excavatorList[0].deviceAlias:""}`,35),a=ie(),r=(0,T.useRef)(null),{excavator:l,truckInRange:c,truckListInOperation:d}=(({operation:e,radio:t})=>{const[i,s]=(0,T.useState)(G.kM),[n,o]=(0,T.useState)([]),[a,r]=(0,T.useState)([]),{initial:l,truckStream:c}=(0,y.C)(B.dc),{initial:d,excavatorStream:v}=(0,y.C)(V.oT);return(0,T.useEffect)((()=>{if(l===J.Vj.INITIAL&&c.sensor&&c.sensor.latitude&&i.sensor&&i.sensor.latitude&&!n.some((e=>e.deviceId===c.deviceId))){const e=(0,X.xmu)([c.sensor.longitude,c.sensor.latitude]),s=(0,X.xmu)([i.sensor.longitude,i.sensor.latitude]),n=(0,X.TE$)(e,s),o=a.findIndex((e=>e.truck.deviceId===c.deviceId)),l=[...a];if(1e3*n<=t){const e={truck:c,distance:1e3*n};if(console.log("distanceBettween",n,o),-1===o){let t="";switch(i.deviceAlias.slice(0,2)){case"EX":t="excavadora";break;case"CF":t="cargador frontal"}const s=Number(c.deviceAlias.slice(-2));(0,Y.jQ)(`volquete ${s} en ${t} ${i.deviceAlias.slice(-2)}`),l.push(e)}else l[o]=e;r(l)}else-1!==o&&(l.splice(o,1),r(l))}}),[c,n,t]),(0,T.useEffect)((()=>{var e;i.deviceId&&d===K.JD.DONE&&v.deviceId===i.deviceId&&(!i.sensor&&v.sensor||v.sensor&&v.sensor.latitude!==(null===(e=i.sensor)||void 0===e?void 0:e.latitude))&&s(v)}),[v]),(0,T.useEffect)((()=>{e.excavatorList&&i.deviceId!=e.excavatorList[0].deviceId&&s(e.excavatorList[0]);let t=!1;const n=[...a];e.truckList.forEach((e=>{const i=a.findIndex((t=>t.truck.deviceId===e.deviceId));i>-1&&(n.splice(i,1),console.log("truckInRangeremommmmm",i),t=!0)})),t&&r(n),o(e.truckList)}),[e.truckList]),{truckListInOperation:n,truckInRange:a,excavator:i}})({operation:e,radio:i}),[v,u]=(0,T.useState)(!1);(0,T.useEffect)((()=>()=>{r.current=null,t.current=null}),[]),(0,T.useEffect)((()=>{let e,i;if(v&&l.deviceId&&l.sensor&&l.sensor.latitude){const s={point:[l.sensor.longitude,l.sensor.latitude],label:l.deviceAlias};e=new q([s],t.current,`ID_SOUCE_CIRCLE_${l.deviceAlias}`,`ID_LAYER_CIRCLE_${l.deviceAlias}`,te.Xb,f.J$,!0),e.addToMap(),i=new q([s],t.current,`ID_SOUCE_EXCAVATOR_${l.deviceAlias}`,`ID_SOUCE_EXCAVATOR_${l.deviceAlias}`,1,f.sb,!1),e.addToMap(),i.addToMap(),setTimeout((()=>{var e;null===(e=t.current)||void 0===e||e.setCenter(s.point)}),100)}return()=>{e&&(e.removeOfMap(),i.removeOfMap())}}),[v,l]),(0,T.useEffect)((()=>{let e;if(v&&l.deviceId&&d.length>0){const i=d.map((e=>e.sensor?{point:[e.sensor.longitude,e.sensor.latitude],label:`C${e.deviceAlias.slice(-2)} /${e.sensor.speed.toFixed(0)}kh`}:{point:[0,0],label:""}));e=new q(i,t.current,`ID_SOUCE_TRUCKOPE_${l.deviceAlias}`,`ID_SOUCE_TRUCKOPE_${l.deviceAlias}`,1,"green",!1),e.addToMap()}return()=>{e&&e.removeOfMap()}}),[v,d]),(0,T.useEffect)((()=>{let e;if(v&&l.deviceId&&c.length>0){const i=c.map((e=>{var t,i;return{point:[e.truck.sensor?e.truck.sensor.longitude:0,e.truck.sensor?e.truck.sensor.latitude:0],label:`C${e.truck.deviceAlias.slice(-2)} /${null===(i=null===(t=e.truck)||void 0===t?void 0:t.sensor)||void 0===i?void 0:i.speed.toFixed(0)}kh`}}));e=new q(i,t.current,`ID_SOUCE_TRUCKRANGE_${l.deviceAlias}`,`ID_LAYER_TRUCKRANGE_${l.deviceAlias}`,1,f.J$,!1),e.addToMap()}return()=>{e&&e.removeOfMap()}}),[v,c]);const g=(0,T.useMemo)((()=>(0,s.jsx)(U.T5,Object.assign({style:{position:"absolute",top:0,zIndex:2}},{children:(0,s.jsx)(U.T5,Object.assign({container:!0,direction:"row"},{children:c.map((e=>(0,s.jsx)($,{eventFrom:e.truck.operationList&&e.truck.operationList.length>0?w.EnumEvent.OPERATIONAL:w.EnumEvent.UNKNOWN_STATE_EVENT,truck:e.truck,distanceToExcavator:e.distance,excavator:l},e.truck.deviceId)))}),void 0)}),void 0)),[c,l.deviceAlias]),h=(0,T.useMemo)((()=>(0,s.jsx)(U.P4,Object.assign({item:!0},{children:(0,s.jsx)(ee.C,{propsForm:{},propsTextField:{variant:"outlined",size:"small",label:"Radio de proximidad",style:{marginTop:8},onChange:e=>{const t=parseInt(e.target.value);t&&o(t)},value:i}},void 0)}),void 0)),[i]);return(0,s.jsxs)(n.Z,Object.assign({className:a.rootList},{children:[h,(0,s.jsxs)(U.P4,Object.assign({item:!0,className:a.rootMap},{children:[g,(0,s.jsxs)(U.T5,{children:[(0,s.jsx)(U.P4,{className:a.mapBackground},void 0),(0,s.jsx)(H.Z,Object.assign({map:t,dragRotate:!1,style:"mapbox://styles/dispatchgat/ckqqsfc2y46bo17sf1y29zwnj",mapContainer:r,bearing:0,pitch:15},{lat:-7.6163,lng:-78.196,zoom:18,setLoad:u},{height:"300px",dragControls:!1}),"map2")]},void 0)]}),void 0)]}),void 0)};var ne=i(43829),oe=i(82200),ae=i(59544),re=i(7654),le=i(78965),ce=i(22318),de=i(64436),ve=i(67162),ue=i(30553),ge=i(40074),he=i(95477),me=i(52663),je=i(66856),pe=i(29525);function xe({open:e,setOpen:t,handleClickConfirm:i,children:n,loading:o,handleClose:a}){return(0,s.jsxs)(me.Z,Object.assign({fullWidth:!0,maxWidth:"lg",open:e,onClose:a||(()=>{t(!1)}),"aria-labelledby":"max-width-dialog-title"},{children:[(0,s.jsx)(pe.Z,{children:n},void 0),(0,s.jsx)(je.Z,{children:o?(0,s.jsx)(he.Z,{},void 0):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.Z,Object.assign({onClick:a,size:"small",color:"primary"},{children:"Cancel"}),void 0),(0,s.jsx)(u.Z,Object.assign({onClick:i,variant:"outlined",size:"small",color:"secondary"},{children:"Confirm"}),void 0)]},void 0)},void 0)]}),void 0)}var be=i(61242),Oe=i(76533),fe=i(99302),ye=i(52672),Ee=i(14125),Ne=i(41120),Le=i(10465),Ce=i(13258);const Se=(0,Ne.Z)((e=>({disabledSpacing:{margin:0,padding:0,width:"auto"},checkbox:{"& .MuiCheckbox-root":{margin:0,padding:0,paddingLeft:8}}}))),ke=T.memo((({truck:e,checked:t,trucksSelect:i,setTrucksSelect:n,disableWithOperation:o,handleonchangeTruck:a})=>{const r=Se(),l=e.state>=0?e.state===I.EnumEventState.UNKNOWN_STATE&&e.operationList&&e.operationList.length>0?"En camino":K.SS[e.state]:"Conexión perdida",v=e.operationList&&e.operationList.length>0&&e.operationList[0]&&e.operationList[0].excavator?e.operationList[0].excavator.deviceAlias:"";return(0,s.jsx)(d.Z,Object.assign({button:!0,dense:!0,className:r.disabledSpacing,disabled:!!o&&!!v},{children:(0,s.jsx)(ue.Z,{className:r.checkbox,onChange:()=>{const t=i.findIndex((t=>e.deviceId===t.deviceId));-1===t?i.push(e):i.splice(t,1),n(JSON.parse(JSON.stringify(i)))},control:(0,s.jsx)(Ce.Z,{onClick:()=>a(e),size:"small",checked:t,inputProps:{style:{padding:0}}},void 0),label:(0,s.jsx)(c.Z,{primary:`${e.deviceAlias} ${v?` ➜ ${v}`:""} (${l})`},void 0)},void 0)}),void 0)})),Ze=(0,Ne.Z)({root:{paddingLeft:4,maxHeight:"60vh",overflowY:"scroll",boxShadow:"inset 0px -2px 10px 0px rgb(17 16 10 / 56%)",borderRadius:4},searchContainer:{marginRight:8}}),Te=T.memo((({trucksSelect:e,setTrucksSelect:t,handleonchangeTruck:i,disableWithOperation:o})=>{const{truckInfoList:a}=(0,y.C)(fe.ej),r=Ze(),[l,c]=(0,T.useState)([]),[d,v]=(0,T.useState)("");(0,T.useEffect)((()=>{c(a.filter((e=>e.deviceAlias.toLowerCase().includes(d.toLowerCase()))))}),[a]);const u=(0,T.useCallback)((e=>{if(e){const t=e.target?e.target.value.toUpperCase():"";c(a.filter((e=>e.deviceAlias.toUpperCase().includes(t)))),v(t)}}),[a]),h=(0,T.useCallback)((()=>{c(a),v("")}),[a]);return(0,s.jsxs)(g.Z,Object.assign({dense:!0,disablePadding:!0,style:{margin:4,paddingTop:4}},{children:[(0,s.jsx)(Le.V,{functionFilter:u,functionCancel:h},void 0),(0,s.jsx)(n.Z,Object.assign({container:!0,className:r.root},{children:l.map((n=>{return(0,s.jsx)(T.Fragment,{children:(0,s.jsx)(ke,{handleonchangeTruck:i,disableWithOperation:o,checked:(a=n,!!e.find((e=>a.deviceId===e.deviceId))),trucksSelect:e,setTrucksSelect:t,truck:n},void 0)},n.deviceId);var a}))}),void 0)]}),void 0)}));var Ie=i(44562),Ae=i(61920);const we=(e,t,i,s)=>{return n=void 0,o=void 0,r=function*(){i(!0);const n=yield(0,Oe.e1)(e,t);i(!1),s((e=>!e));let o="";n.truckErrorList.length>0&&n.truckErrorList.forEach((e=>{const t=1===e.state?"CARGANDO":"A DESCARGA";o+=` ${e.truckError.deviceAlias}=> ${t},`})),""!==o&&alert(`Las siguientes unidades no han podido ser reasignadas: ${o}`)},new((a=void 0)||(a=Promise))((function(e,t){function i(e){try{l(r.next(e))}catch(e){t(e)}}function s(e){try{l(r.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(i,s)}l((r=r.apply(n,o||[])).next())}));var n,o,a,r},De=({open:e,setOpen:t,setRefresh:i,operations:a})=>{const r=(0,y.T)(),[l,v]=(0,T.useState)([]),[u,m]=(0,T.useState)(""),[j,p]=(0,T.useState)([]),[x,b]=(0,T.useState)(!1),[O,f]=T.useState(!1);(0,T.useEffect)((()=>{r(fe.RK),r(Ee.CE)}),[]);const E=e=>{m(e.target.value)};return(0,s.jsxs)(xe,Object.assign({},{loading:O},{open:e,handleClickConfirm:()=>{j.length<=0||u.length<=0?r((0,ye.L8)({open:!0,msg:"Debe seleccionar almenos una excavadora y un camión",severity:"warning"})):b(!0)},handleClose:()=>{t(!1),p([]),m("")}},{children:[(0,s.jsx)(n.Z,Object.assign({container:!0},{children:(0,s.jsx)(n.Z,Object.assign({item:!0,xs:12},{children:(0,s.jsx)(ce.Z,Object.assign({variant:"button",style:{paddingLeft:8,paddingTop:16}},{children:"Reasignación de camiones"}),void 0)}),void 0)}),void 0),(0,s.jsxs)(n.Z,Object.assign({container:!0,style:{paddingLeft:4}},{children:[(0,s.jsx)(n.Z,Object.assign({item:!0,xs:6},{children:(0,s.jsx)(h.Z,Object.assign({elevation:4},{children:(0,s.jsx)(Te,{handleonchangeTruck:()=>{},setTrucksSelect:p,trucksSelect:j},void 0)}),void 0)}),void 0),(0,s.jsx)(n.Z,Object.assign({item:!0,xs:6},{children:(0,s.jsx)(h.Z,Object.assign({style:{margin:10}},{children:(0,s.jsxs)(g.Z,{children:[(0,s.jsx)(d.Z,{children:(0,s.jsx)(c.Z,{secondary:"Excavadora de destino"},void 0)},void 0),(0,s.jsx)(d.Z,{children:(0,s.jsx)(c.Z,{children:(0,s.jsx)(de.Z,Object.assign({component:"fieldset"},{children:(0,s.jsx)(ve.Z,Object.assign({row:!0,"aria-label":"gender",name:"radio-buttons-group"},{children:a.map((e=>{var t;return(0,s.jsx)(o.ZP,Object.assign({title:e.state!==Ae.J8.Operando?"Excavadora sin operación":"Excavadora de destino"},{children:(0,s.jsx)(ue.Z,{value:e.id,disabled:e.state!==Ae.J8.Operando,control:(0,s.jsx)(ge.Z,{disabled:e.state!==Ae.J8.Operando},void 0),onChange:E,label:`  ${null===(t=e.excavatorList[0])||void 0===t?void 0:t.deviceAlias}`},void 0)}),e.id)}))}),void 0)}),void 0)},void 0)},void 0)]},void 0)}),void 0)}),void 0)]}),void 0),(0,s.jsx)(be.a,Object.assign({open:x,handleClose:()=>{b(!1)},handleConfirm:()=>{b(!1),t(!1),p([]),m(""),we(u,j,f,i)},title:"Area you sure?"},{children:(0,s.jsx)(Ie.Z,Object.assign({severity:"warning"},{children:"Intentaremos mover estos camiones, si ocurre algun error se le informará"}),void 0)}),void 0)]}),void 0)};var Re=i(30433),Pe=i(73727),ze=i(2780),We=i(66083),Fe=i(8286),Me=i(86072),_e=i(89601);const $e=({newOperation:e})=>{const t=(0,y.T)(),i=()=>{t((0,_e.mg)())},r=(0,T.useMemo)((()=>e.uploadList.map(((e,t)=>{const n=e.type===Ae.WW.TAJO?`\n      ${e.nameProject}-${e.name}-${e.material?e.material.type:""}\n      `:e.name;return(0,s.jsx)(v.Z,{color:"secondary",label:n,onDelete:i},t)}))),[e.uploadList]);return 0===e.uploadList.length?(0,s.jsx)(s.Fragment,{},void 0):(0,s.jsx)(n.Z,Object.assign({item:!0},{children:(0,s.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,s.jsx)(o.ZP,Object.assign({title:"Change Upload"},{children:(0,s.jsx)(a.Z,Object.assign({color:"primary",size:"small"},{children:(0,s.jsx)(Me.Z,{},void 0)}),void 0)}),void 0),r]}),void 0)}),void 0)},Ue=({newOperation:e})=>{const t=(0,y.T)(),i=(0,T.useMemo)((()=>e.downloadList.map(((e,i)=>(0,s.jsx)(v.Z,{color:"secondary",label:e.name,onDelete:()=>{return i=e.id,void t((0,_e.$g)({id:i}));var i}},i)))),[e.downloadList]);return 0===e.downloadList.length?(0,s.jsx)(s.Fragment,{},void 0):(0,s.jsx)(n.Z,Object.assign({item:!0},{children:(0,s.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,s.jsx)(o.ZP,Object.assign({title:"Change Download"},{children:(0,s.jsx)(a.Z,Object.assign({color:"primary",size:"small"},{children:(0,s.jsx)(Me.Z,{},void 0)}),void 0)}),void 0),i]}),void 0)}),void 0)},He=({newOperation:e})=>{const t=(0,y.T)(),i=()=>{t((0,_e.QW)())},r=(0,T.useMemo)((()=>e.excavatorList.map(((e,t)=>{const n=e.deviceAlias;return(0,s.jsx)(v.Z,{color:"secondary",label:n,onDelete:i},t)}))),[e.excavatorList]);return 0===e.excavatorList.length?(0,s.jsx)(s.Fragment,{},void 0):(0,s.jsx)(n.Z,Object.assign({item:!0},{children:(0,s.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,s.jsx)(o.ZP,Object.assign({title:"Change Excavator"},{children:(0,s.jsx)(a.Z,Object.assign({color:"primary",size:"small"},{children:(0,s.jsx)(Me.Z,{},void 0)}),void 0)}),void 0),r]}),void 0)}),void 0)};var Ge=i(96588),Je=i(97700),Ke=i(97111),Ve=i(50648);const Be=({open:e,operation:t,setOpen:i})=>{const[a,r]=(0,T.useState)([]),{excavatorInfoList:l}=(0,y.C)(Ee.kW),c=(0,T.useRef)(),{dmeCellList:d,padCellList:g,stockCellList:h,polygonList:p}=(0,y.C)(Je.WD),[x,b]=(0,T.useState)(Ke.f.CHANGE_NOTHING),[O,f]=(0,T.useState)(Ae.WW.DESCONOCIDO),[E,N]=(0,T.useState)(Ve.TypeDownload.UNKNOWN),L=(0,y.T)(),{newOperation:C}=(0,y.C)(Je.e5),S=(e,t,i)=>{const s=t.find((t=>t.id===e));s&&L((0,_e.qn)(Object.assign(Object.assign({},s),{type:i})))},k=(e,t,i)=>{const s=t.find((t=>t.id===e));s&&L((0,_e.Ru)(Object.assign(Object.assign({},s),{type:i})))},Z=(0,T.useCallback)((()=>(0,Ke.BF)(x,O,p,h,E,d,g,l)),[x,O,p,h,E,d,g,l]);return(0,s.jsxs)(me.Z,Object.assign({open:e,onClose:i,title:"Migrate Operation"},{children:[(0,s.jsx)(We.Z,Object.assign({style:{paddingTop:8,paddingBottom:0}},{children:"Update Operation Attributes"}),void 0),(0,s.jsx)(pe.Z,Object.assign({style:{minHeight:320}},{children:(0,s.jsxs)(n.Z,Object.assign({container:!0,direction:"column"},{children:[(0,s.jsx)(n.Z,Object.assign({item:!0},{children:(0,s.jsxs)(n.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,s.jsx)(ce.Z,{children:"Upload:"},void 0),(0,s.jsx)(Re.g7,{operation:t,lineThrough:C.uploadList.length>0},void 0),(0,s.jsx)($e,Object.assign({},{operation:t,newOperation:C}),void 0)]}),void 0)}),void 0),(0,s.jsx)(j.Z,{width:"100%",height:8},void 0),(0,s.jsxs)(n.Z,Object.assign({item:!0},{children:[(0,s.jsxs)(n.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,s.jsx)(ce.Z,{children:"Download: "},void 0),(0,s.jsx)(Re.DQ,{operation:t,lineThrough:C.downloadList.length>0},void 0),(0,s.jsx)(Ue,Object.assign({},{operation:t,newOperation:C}),void 0)]}),void 0),(0,s.jsx)(j.Z,{width:"100%",height:8},void 0),(0,s.jsx)(m.Z,{orientation:"horizontal"},void 0),(0,s.jsx)(o.ZP,Object.assign({title:"Puede agregar hasta 2 puntos de descarga"},{children:(0,s.jsx)(ce.Z,Object.assign({style:{fontSize:11}},{children:"*You can add up to 2 download points, example 1 DME and 1 PAD or 1 STOCK"}),void 0)}),void 0),(0,s.jsx)(m.Z,{orientation:"horizontal"},void 0)]}),void 0),(0,s.jsx)(j.Z,{width:"100%",height:8},void 0),(0,s.jsx)(n.Z,Object.assign({item:!0},{children:(0,s.jsxs)(n.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,s.jsx)(ce.Z,{children:"Excavator: "},void 0),(0,s.jsx)(Re.Ez,{operation:t,lineThrough:C.excavatorList.length>0},void 0),(0,s.jsx)(He,Object.assign({},{operation:t,newOperation:C}),void 0)]}),void 0)}),void 0),(0,s.jsx)(j.Z,{height:8},void 0),(1!==C.excavatorList.length||2!==C.downloadList.length||1!==C.uploadList.length)&&(0,s.jsx)(n.Z,Object.assign({item:!0,style:{marginTop:8}},{children:(0,s.jsx)(Ge.ZP,{size:"small",value:a,blurOnSelect:!0,onChange:(e,t)=>{switch(r(t),t.length){case 0:b(Ke.f.CHANGE_NOTHING),f(Ae.WW.DESCONOCIDO),N(Ve.TypeDownload.UNKNOWN);break;case 1:b(t[0].value),f(Ae.WW.DESCONOCIDO),N(Ve.TypeDownload.UNKNOWN);break;case 2:switch(x){case Ke.f.CHANGE_UPLOAD:f(Number(t[1].value));break;case Ke.f.CHANGE_DOWNLOAD:N(Number(t[1].value));break;case Ke.f.CHANGE_EXCAVATOR:((e,t)=>{const i=t.find((t=>t.id===e));i&&L((0,_e.Zh)(i))})(t[1].value,l),r([]),b(Ke.f.CHANGE_NOTHING)}break;case 3:switch(x){case Ke.f.CHANGE_UPLOAD:switch(O){case Ae.WW.TAJO:S(t[2].id,p,Ae.WW.TAJO);break;case Ae.WW.STOCK:S(t[2].id,h,Ae.WW.STOCK)}break;case Ke.f.CHANGE_DOWNLOAD:switch(E){case Ve.TypeDownload.DME:k(t[2].id,d,E);break;case Ve.TypeDownload.PAD:k(t[2].id,g,E);break;case Ve.TypeDownload.STOCK:k(t[2].id,h,E)}}f(Ae.WW.DESCONOCIDO),N(Ve.TypeDownload.UNKNOWN),b(Ke.f.CHANGE_NOTHING),r([])}setTimeout((()=>{var e,t;null===(e=c.current)||void 0===e||e.focus(),null===(t=c.current)||void 0===t||t.click()}),100)},options:Z(),multiple:!0,renderTags:(e,t)=>e.map(((e,i)=>(0,s.jsx)(v.Z,Object.assign({variant:"outlined",label:e.label},t({index:i})),void 0))),style:{minWidth:200},getOptionLabel:e=>e.label,openOnFocus:!0,disableClearable:!0,getOptionDisabled:e=>(0,Ke.HT)(e,C,E),filterSelectedOptions:!0,renderInput:e=>(0,s.jsx)(Fe.Z,Object.assign({},e,{autoFocus:!0,inputRef:c,label:"Cómo puedo ayudarte?",variant:"outlined",fullWidth:!0}),void 0)},void 0)}),void 0)]}),void 0)}),void 0),(0,s.jsx)(je.Z,{children:(0,s.jsxs)(n.Z,{children:[(0,s.jsx)(u.Z,Object.assign({onClick:i,size:"small",color:"primary"},{children:"Cancel"}),void 0),(0,s.jsx)(u.Z,Object.assign({variant:"outlined",size:"small",color:"secondary",onClick:()=>{L((0,_e.db)({oldOperation:t,newOperation:C}))}},{children:"Save"}),void 0)]},void 0)},void 0)]}),void 0)};var Xe=i(76796);const Ye=(0,r.Z)({rootList:{flex:1,padding:2,margin:2,overflow:"auto"},rootNoDropItem:{padding:2,margin:2,width:32,height:"92vh"},rootListOver:{flex:1,padding:2,margin:2,overflow:"auto",background:"#80808045"},rootNotDropList:{width:300,padding:2,margin:2,overflow:"auto",zIndex:1,transform:"translateX(-50%) translateY(130px) rotate(-90deg)",msTransform:"translateX(-50%) translateY(130px) rotate(-90deg)",mozTransform:"translateX(-50%) translateY(130px) rotate(-90deg)",OTransform:"translateX(-50%) translateY(130px) rotate(-90deg)",position:"absolute",left:"50%",top:"0%"},rootNotOperation:{width:36,padding:2,margin:2,background:`${f.J$}10`,borderColor:f.J$,borderWidth:2,borderStyle:"dotted"},disabledPadding:{padding:0,paddingBottom:2,flex:1},labelExcavator:{fontSize:21,borderRadius:8,borderStyle:"dotted",padding:4,margin:2,background:"#424141",color:"#fff"}}),qe=({operation:e})=>{const t=Ye(),i=e.excavatorList.length>0?e.excavatorList[0]:null;return(0,s.jsxs)(U.T5,Object.assign({container:!0,className:t.disabledPadding,alignItems:"center",justifyContent:e.id?"flex-start":"flex-end"},{children:[(0,s.jsx)(U.P4,Object.assign({item:!0},{children:(0,s.jsx)(c.Z,{secondary:(0,s.jsx)("strong",Object.assign({className:t.labelExcavator},{children:null==i?void 0:i.deviceAlias}),void 0)},void 0)}),void 0),!e.id&&(0,s.jsx)(Pe.rU,Object.assign({style:{textDecoration:"none"},to:`/operation/create/${i?i.deviceId:""}/${i?i.id:""}`},{children:(0,s.jsx)(o.ZP,Object.assign({title:`Asignar operación a ${i?i.deviceAlias:""}`},{children:(0,s.jsx)(a.Z,Object.assign({size:"small",color:"secondary"},{children:(0,s.jsx)(ne.Z,{fontSize:"small"},void 0)}),void 0)}),void 0)}),void 0)]}),void 0)},Qe=({operation:e,loading:t,setLoading:i,setRefresh:r})=>{const l=Ye(),[c,g]=(0,T.useState)(!1),[h,m]=(0,T.useState)(!1),j=()=>{m((e=>!e))},p=(0,y.T)(),{state:x}=(0,y.C)(Je.e5);(0,T.useEffect)((()=>{switch(x){case _e.m4.SAVING:i(!0);break;case _e.m4.ERROR:i(!1);break;case _e.m4.DONE:i(!1),m(!1)}}),[x]);const b=()=>g((e=>!e)),O=e.excavatorList.length>0?e.excavatorList[0]:null;return e.id?(0,s.jsxs)(d.Z,Object.assign({disableGutters:!0,className:l.disabledPadding},{children:[(0,s.jsx)(be.a,Object.assign({open:c,handleClose:b,handleConfirm:()=>{return t=void 0,s=void 0,o=function*(){i(!0);const t=yield(0,ze.wg)(e.id);p(t?(0,ye.L8)({open:!0,msg:t,severity:"error"}):(0,ye.Ui)()),i(!1),r((e=>!e)),g(!1)},new((n=void 0)||(n=Promise))((function(e,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function r(e){try{l(o.throw(e))}catch(e){i(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(a,r)}l((o=o.apply(t,s||[])).next())}));var t,s,n,o},title:"Esta seguro?"},{children:(0,s.jsxs)(Ie.Z,Object.assign({severity:"warning"},{children:["Esta intentando finalizar la operacion"," ",e.excavatorList[0].deviceAlias,", si ocurre algun error se le informará"]}),void 0)}),void 0),(0,s.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,s.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,s.jsx)(qe,Object.assign({},{operation:e}),void 0),(0,s.jsxs)(n.Z,{children:[(0,s.jsx)(o.ZP,Object.assign({title:"Cambiar Carga/Descarga/Cambiones/Excavadora"},{children:(0,s.jsx)(a.Z,Object.assign({color:"secondary",size:"small",onClick:j},{children:(0,s.jsx)(oe.Z,{fontSize:"small"},void 0)}),void 0)}),void 0),(0,s.jsx)(o.ZP,Object.assign({title:"Finalizar Operación"},{children:(0,s.jsx)(a.Z,Object.assign({color:"secondary",onClick:b,size:"small"},{children:(0,s.jsx)(ae.Z,{fontSize:"small"},void 0)}),void 0)}),void 0),(0,s.jsx)(o.ZP,Object.assign({title:"Detalle Operación"},{children:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(a.Z,Object.assign({color:"secondary",size:"small",onClick:()=>{p((0,Xe.l4)(O.deviceId)),p((0,R.m1)(O))}},{children:(0,s.jsx)(re.Z,{fontSize:"small"},void 0)}),void 0)},void 0)}),void 0)]},void 0)]}),void 0),(0,s.jsxs)(n.Z,Object.assign({item:!0,md:12},{children:[(0,s.jsx)(Re.g7,{operation:e},void 0),(0,s.jsx)(Re.DQ,{operation:e},void 0),e.truckList.length>0?(0,s.jsx)(v.Z,{size:"small",label:`${e.truckList.length} camiones`},void 0):(0,s.jsx)(s.Fragment,{},void 0)]}),void 0),(0,s.jsx)(n.Z,Object.assign({item:!0},{children:e.truckTemporalList&&e.truckTemporalList.length>0&&!t&&(0,s.jsx)(o.ZP,Object.assign({title:"Guardar cambios"},{children:(0,s.jsx)(u.Z,Object.assign({size:"small",variant:"outlined",color:"secondary",startIcon:(0,s.jsx)(le.Z,{color:"secondary",fontSize:"small"},void 0),onClick:()=>{p((0,E.hK)({operationId:e.id})),we(e.id,e.truckTemporalList,i,r)}},{children:"GUARDAR"}),void 0)}),void 0)}),void 0),(0,s.jsx)(Be,{open:h,operation:e,setOpen:j},void 0)]}),void 0)]}),void 0):(0,s.jsx)(qe,Object.assign({},{operation:e}),void 0)},et=({operation:e,filterList:t})=>{const i=(0,T.useMemo)((()=>{var i;return null===(i=e.truckTemporalList)||void 0===i?void 0:i.map(((i,n)=>(0,s.jsx)($,{operation:e,truck:i,eventFrom:w.EnumEvent.OPERATIONAL,temporal:!0,isFilter:t.some((e=>e.deviceId===i.deviceId))},n)))}),[e.truckTemporalList]);return(0,s.jsx)(s.Fragment,{children:i},void 0)},tt=({operation:e,filterList:t})=>{const[i,n]=(0,T.useState)(e.truckList);(0,T.useEffect)((()=>{n((t=>e.truckList&&e.truckList.length!==i.length||i.some((t=>e.truckList.some((e=>e.deviceId==t.deviceId&&(t.sensor&&e.sensor?t.cycleNumber!==e.cycleNumber||t.state!==e.state||t.eventState!==e.eventState||t.sensor.latitude!=e.sensor.latitude:t.cycleNumber!==e.cycleNumber||t.state!==e.state||t.eventState!==e.eventState)))))?e.truckList:t))}),[e.truckList]);const o=(0,T.useMemo)((()=>e.truckList.map(((i,n)=>{var o;return(0,s.jsx)($,{operation:e,isFilter:t.some((e=>e.deviceId===i.deviceId)),eventFrom:w.EnumEvent.OPERATIONAL,truck:i,temporalRemove:null===(o=e.truckTemporalRemoveList)||void 0===o?void 0:o.some((e=>e.deviceId===i.deviceId))},n)}))),[i,t]);return(0,s.jsx)(s.Fragment,{children:o},void 0)},it=({operation:e,setRefresh:t,filterList:i})=>{const[o,a]=(0,T.useState)(!1),[r,c]=(0,T.useState)(G.kM);(0,T.useEffect)((()=>{e&&e.truckList&&e.truckList.length>0?c((t=>r.deviceId!==e.excavatorList[0].deviceId?e.excavatorList[0]:t)):c(G.kM)}),[e]);const[{canDrop:d,isOver:v},u]=(0,l.L)((()=>({accept:b,drop:()=>({operation:e,eventTo:w.EnumEvent.OPERATIONAL}),collect:t=>({isOver:!!t.isOver(),canDrop:!!e.id})})),[e]),p=Ye(),O=(0,T.useCallback)((()=>v&&d?p.rootListOver:v&&!d?p.rootNotDropList:p.rootList),[v,d]),f=(0,T.useMemo)((()=>(0,s.jsx)(s.Fragment,{children:r&&(0,s.jsx)(se,{truckList:[],operation:e},void 0)},void 0)),[r,e]),y=(0,T.useMemo)((()=>(0,s.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,s.jsx)(tt,{operation:e,filterList:i},void 0),(0,s.jsx)(et,{operation:e,filterList:i},void 0)]}),void 0)),[e,i]);return d?(0,s.jsxs)(g.Z,Object.assign({ref:u,disablePadding:!0,component:h.Z,style:{display:"flex",flexDirection:"column"},className:O()},{children:[(0,s.jsxs)(U.P4,Object.assign({item:!0,style:{flex:1}},{children:[(0,s.jsx)(Qe,Object.assign({},{operation:e,setLoading:a,loading:o,setRefresh:t}),void 0),(0,s.jsx)(m.Z,{orientation:"horizontal"},void 0),(0,s.jsx)(x,{loading:o},void 0),(0,s.jsx)(j.Z,{height:4},void 0),y]}),void 0),f]}),void 0):(0,s.jsx)(g.Z,Object.assign({disablePadding:!0,component:h.Z,className:p.rootNotOperation},{children:(0,s.jsx)("div",Object.assign({className:p.rootNotDropList},{children:(0,s.jsx)(Qe,Object.assign({},{operation:e,setLoading:a,loading:o,setRefresh:t}),void 0)}),void 0)}),void 0)};var st=i(17698),nt=i(57865);const ot=e=>{if(!e)return"";const t=Ae.PW[e.type];switch(e.type){case 1:return e.pit&&e.pit.projectList&&e.pit.projectList.length>0&&e.pit.projectList[0].polygonList&&e.pit.projectList[0].polygonList.length>0?`${e.pit.projectList[0].name} - ${e.pit.projectList[0].polygonList[0].name}`:"";case 3:return e[t]&&e[t].cellList&&e[t].cellList.length>0?e[t].cellList[0].name:"";default:return""}},at=e=>{if(!e&&1!==e.type)return"";const t=Ae.PW[e.type];return`${"dme"===t?"Desm.":"stock"===t?"STK":"Mine."} ${e[t]&&e[t].cellList&&e[t].cellList.length>0?e[t].cellList[0].name:""}`},rt=()=>(0,s.jsx)(n.Z,Object.assign({container:!0,justifyContent:"center",alignItems:"center"},{children:(0,s.jsx)(n.Z,Object.assign({item:!0},{children:(0,s.jsx)(ce.Z,{children:"No data found"},void 0)}),void 0)}),void 0);var lt=i(58365);const ct=({height:e,width:t})=>(0,s.jsx)(n.Z,Object.assign({container:!0,justifyContent:"center",alignItems:"center"},{children:(0,s.jsx)(lt.Z,{height:e,width:t,variant:"rect"},void 0)}),void 0);var dt=i(14741),vt=i(17215),ut=i(59693);const gt=(0,Ne.Z)((e=>({search:{position:"relative",marginRight:2,borderRadius:e.shape.borderRadius,backgroundColor:(0,ut.Fq)(e.palette.common.white,.15),"&:hover":{backgroundColor:(0,ut.Fq)(e.palette.common.white,.25)},marginLeft:0,width:"100%",[e.breakpoints.up("sm")]:{width:"auto"}},searchIcon:{padding:e.spacing(0,0),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},cancelIcon:{padding:e.spacing(0,0),height:"100%",alignItems:"center",justifyContent:"center",display:"flex"},inputRoot:{color:"inherit"},inputInput:{padding:e.spacing(1,1,1,0),paddingLeft:`calc(1em + ${e.spacing(1)}px)`,paddingRight:`calc(1em + ${e.spacing(1)}px)`,transition:e.transitions.create("width"),width:"100%",[e.breakpoints.up("sm")]:{width:"40ch","&:focus":{width:"50ch"}}}}))),ht=({search:e,setSearch:t})=>{const i=gt(),o=(0,T.useRef)();(0,T.useEffect)((()=>{document.onkeydown=a}),[]);const a=(0,T.useCallback)((e=>{"Escape"===e.key&&(l(),setTimeout((()=>{var e;console.log("Escape",o.current),null===(e=o.current)||void 0===e||e.focus()}),300))}),[]),r=(0,T.useCallback)((e=>{t(e.target.value)}),[]),l=(0,T.useCallback)((()=>{t("")}),[]);return(0,s.jsx)(h.Z,Object.assign({style:{marginTop:2,marginRight:2}},{children:(0,s.jsx)(n.Z,Object.assign({container:!0,alignItems:"center"},{children:(0,s.jsxs)("div",Object.assign({className:i.search},{children:[(0,s.jsx)("div",Object.assign({className:i.searchIcon},{children:(0,s.jsx)(vt.Z,{color:"primary",fontSize:"small"},void 0)}),void 0),(0,s.jsx)(dt.Z,{color:"primary",value:e,autoFocus:!0,inputRef:o,onKeyDown:a,onChange:r,placeholder:"Buscar...",classes:{root:i.inputRoot,input:i.inputInput},inputProps:{"aria-label":"search"}},void 0)]}),void 0)}),void 0)}),void 0)};var mt=i(31125);i(73099);const jt=({enumEvent:e})=>{const{truck:t,eventTo:i}=(0,y.C)(A.h3);return e===i&&t&&""!=t.deviceId?(0,s.jsx)($,{eventFrom:w.EnumEvent.UNKNOWN_STATE_EVENT,id:`truck-hormeter-${t.deviceId}`,truck:t,isFilter:!1},t.deviceId):(0,s.jsx)(s.Fragment,{},void 0)};var pt=i(11818);const xt=(0,Ne.Z)({rootNoDropItem:{},rootListOver:{marginBottom:4,background:"#80808045"},root:{padding:2},rootList:{marginBottom:4},ListItem:{padding:0,margin:0},itemHeaderList:{flex:1,paddingLeft:2},textHeaderList:{margin:0},iconTextList:{padding:0,margin:0},chipText:{height:12,color:"#fff",fontWeight:"bold"}}),bt=({items:e,filterList:t,title:i,useVisibleList:n,keyState:o,isAviable:a})=>{(0,y.T)();const r=xt(),[{canDrop:u,isOver:m},j]=(0,l.L)((()=>({accept:b,drop:()=>({eventTo:o}),collect:e=>({isOver:e.isOver(),canDrop:!0})})),[]),p=(0,T.useCallback)((()=>m&&u?r.rootListOver:r.rootList),[m,u]),[x,O]=n,f=(0,T.useMemo)((()=>e.map((e=>(0,s.jsx)($,{eventFrom:o,truck:e,isFilter:t.some((t=>t.deviceId===e.deviceId))},e.deviceId)))),[e,t]),E=(0,T.useCallback)((()=>{const e=x.findIndex((e=>e.value===o));if(e>-1){const t=JSON.parse(JSON.stringify(x));t[e].visible=!t[e].visible,O(t)}}),[x]);return(0,s.jsxs)(g.Z,Object.assign({ref:!1===a?j:null,component:h.Z,disablePadding:!0,className:p()},{children:[(0,s.jsx)(d.Z,Object.assign({button:!0,disableGutters:!0,className:r.ListItem,onClick:E},{children:(0,s.jsxs)(U.T5,Object.assign({container:!0,justifyContent:"space-between",alignItems:"center"},{children:[(0,s.jsxs)(U.P4,Object.assign({className:r.itemHeaderList,container:!0,direction:"column",justifyContent:"center",alignContent:"flex-start"},{children:[(0,s.jsx)(c.Z,{className:r.textHeaderList,secondary:i},void 0),(0,s.jsx)(v.Z,{size:"small",className:r.chipText,color:"primary",label:`(${e.length}) camiones`},void 0)]}),void 0),e.length?(0,s.jsx)(U.hU,Object.assign({size:"small",className:r.iconTextList},{children:(0,s.jsx)(mt.Z,{fontSize:"small"},void 0)}),void 0):(0,s.jsx)(s.Fragment,{},void 0)]}),void 0)}),void 0),(0,s.jsx)(U.iz,{orientation:"horizontal"},void 0),(0,s.jsx)(U.Mi,Object.assign({direction:"left",in:!0,mountOnEnter:!0,unmountOnExit:!0},{children:(0,s.jsxs)(U.T5,Object.assign({container:!0,justifyContent:"center"},{children:[f,(0,s.jsx)(jt,{enumEvent:o},void 0)]}),void 0)}),void 0)]}),void 0)},Ot=({truckAvailable:e,filterList:t})=>{const{timelineObject:i}=(0,y.C)(A.h3),[n,o,a,r]=(0,pt.y)(i),{availableList:l,mantoList:c,DOperativeList:d,NOperativeList:v}=(e=>{const[t,i]=(0,T.useState)([]),[s,n]=(0,T.useState)([]),[o,a]=(0,T.useState)([]),[r,l]=(0,T.useState)([]);return(0,T.useEffect)((()=>{i((t=>{const i=e.filter((e=>{var t,i,s,n;return e.state===w.EnumEvent.UNKNOWN_STATE_EVENT&&e.eventState&&(null===(i=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===w.EnumEvent.UNKNOWN_STATE_EVENT||e.eventState&&(null===(n=null===(s=e.eventState)||void 0===s?void 0:s.event)||void 0===n?void 0:n.event)===w.EnumEvent.OPERATIONAL}));return t.length===i.length&&JSON.stringify(t.map((e=>e.deviceId)))===JSON.stringify(i.map((e=>e.deviceId)))?t:i})),n((t=>{const i=e.filter((e=>{var t,i;return e.eventState&&(null===(i=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===w.EnumEvent.MAINTENANCE}));return t.length===i.length&&JSON.stringify(t)===JSON.stringify(i)?t:i})),a((t=>{const i=e.filter((e=>{var t,i;return e.eventState&&(null===(i=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===w.EnumEvent.OPERATIONAL_DELAY}));return t.length===i.length&&JSON.stringify(t)===JSON.stringify(i)?t:i})),l((t=>{const i=e.filter((e=>{var t,i;return e.eventState&&(null===(i=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===w.EnumEvent.NO_OPERATIONAL}));return t.length===i.length&&JSON.stringify(t)===JSON.stringify(i)?t:i}))}),[e]),{availableList:t,mantoList:s,DOperativeList:o,NOperativeList:r}})(e),u=xt(),g=(0,Q._)("VISIBLE_STATES_TABS",Object.keys(w.EnumEvent).map(((e,t)=>({value:w.EnumEvent[e],label:e,visible:!1})))),h=(0,T.useMemo)((()=>(0,s.jsx)(U.T5,Object.assign({className:u.root},{children:(0,s.jsx)(bt,{items:l,filterList:t,title:"Disponibles",useVisibleList:g,keyState:w.EnumEvent.OPERATIONAL,isAviable:o},void 0)}),void 0)),[l,t,g]),m=(0,T.useMemo)((()=>(0,s.jsx)(U.T5,Object.assign({className:u.root},{children:(0,s.jsx)(bt,{items:c,filterList:t,title:"MANTO",useVisibleList:g,keyState:w.EnumEvent.MAINTENANCE,isAviable:r},void 0)}),void 0)),[c,t,g]),j=(0,T.useMemo)((()=>(0,s.jsx)(U.T5,Object.assign({className:u.root},{children:(0,s.jsx)(bt,{items:d,filterList:t,title:"DOPERATIVO",useVisibleList:g,keyState:w.EnumEvent.OPERATIONAL_DELAY,isAviable:a},void 0)}),void 0)),[d,t,g]),p=(0,T.useMemo)((()=>(0,s.jsx)(U.T5,Object.assign({className:u.root},{children:(0,s.jsx)(bt,{items:v,filterList:t,title:"NOPERATIVO",useVisibleList:g,keyState:w.EnumEvent.NO_OPERATIONAL,isAviable:n},void 0)}),void 0)),[v,t,g]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(U.T5,Object.assign({className:u.root},{children:[h,m,j,p]}),void 0)},void 0)};var ft=i(96617),yt=i(47463),Et=i(57163),Nt=i(1754);const Lt=(0,Ne.Z)({paddingContainer:{padding:8}}),Ct=({timeline:e,truck:t,eventSelect:i,setRefresh:o})=>{var a,r,l;const{user:{user:c}}=(0,y.C)(W.MR),d=Lt(),v=(0,T.useRef)(),g=(0,T.useRef)(),m=(0,T.useRef)(),j=(0,y.T)(),{stateCreateTimeline:p}=(0,y.C)(Nt.yV),{eventStateList:x}=(0,y.C)(Je.eG),[b,O]=(0,T.useState)([]),[f,E]=(0,T.useState)(Number(e.initialHourmeter.toFixed(1))),[N,L]=(0,T.useState)(null),[C,S]=(0,T.useState)(null),{hours:k,minutes:Z}=(()=>{const e=new Date;return{hours:e.getHours(),minutes:e.getMinutes()}})(),D=`${`00${k}`.slice(-2)}:${`00${Z}`.slice(-2)}`,[R,P]=(0,T.useState)(D);(0,T.useEffect)((()=>{x.length>0&&(O(x),L(x[0]))}),[x,i]),(0,T.useEffect)((()=>{v&&v.current&&(v.current.focus(),v.current.setSelectionRange(v.current.value.length-2,v.current.value.length))}),[v]);const F=e=>{if(console.log("enumEventState Value: ",N),console.log("enumEventStateHig Value: ",C),"Scape"===e.key)return L(null),void setTimeout((()=>{var e;S(null),null===(e=m.current)||void 0===e||e.focus()}),100);if(("Enter"===e.key||"Tab"===e.key)&&x.length>0){if(console.log("enumEventHigthlight",C),C)return L(C),void setTimeout((()=>{var e;S(null),null===(e=m.current)||void 0===e||e.focus()}),100);if(N)console.log("saving"),M();else{const e=b.filter((e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(m.current?m.current.value.toLocaleLowerCase():"")}));console.log("filterd",e),e.length>0&&(L(e[0]),setTimeout((()=>{S(null)}),100))}}else L(null)},M=()=>{return e=void 0,s=void 0,a=function*(){if(N){const e=null,s=null,n=null,a=Object.assign({},N);i===w.EnumEvent.OPERATIONAL&&(a.eventState=I.EnumEventState.UNKNOWN_STATE,a.id="",a.name="");const r=Number(f);if(r>=0){const l={id:"",deviceAlias:t.deviceAlias,deviceId:t.deviceId,initialHourmeter:r,adjustment:0,durationTime:0,finalHourmeter:0,initialTime:D,initialEventState:a,initialState:i,finalState:e,shift:s,status:!1,stateRegister:n,assetType:Et.EnumAssetType.TRUCK,guard:z.EnumGuard.UNKNOWN_GUARD,userId:c.id};console.log("savingnewTimeline",l),yield j((0,Nt.BU)({timeline:l,hour:R})),j((0,A.Go)()),o((e=>!e))}else alert("Ingrese un horometro correcto")}else alert("Seleccionar un evento")},new((n=void 0)||(n=Promise))((function(t,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,r)}l((a=a.apply(e,s||[])).next())}));var e,s,n,a};return(0,s.jsx)(h.Z,Object.assign({elevation:4},{children:(0,s.jsxs)(n.Z,Object.assign({className:d.paddingContainer},{children:[(0,s.jsxs)(ce.Z,{children:["Camión ",t.deviceAlias]},void 0),(0,s.jsxs)(n.Z,{children:[(0,s.jsxs)("div",{children:["Estado actual: ",null===(r=null===(a=e.initialEventState)||void 0===a?void 0:a.event)||void 0===r?void 0:r.name]},void 0),(0,s.jsxs)("div",{children:["Horometro aprox: ",e.initialHourmeter.toFixed(1),"h"]},void 0),(0,s.jsxs)(n.Z,Object.assign({style:{marginTop:8,minHeight:"25vh"}},{children:[(0,s.jsx)(ee.C,{propsForm:{},propsTextField:{variant:"outlined",autoFocus:!1,size:"small",label:"Horometro de ingreso",inputRef:v,onChange:e=>{e.target.value?E(e.target.value):E("")},value:f,inputProps:{onKeyDown:e=>{"Enter"===e.key&&g.current&&g.current.focus()}}}},void 0),(0,s.jsx)(ee.C,{propsForm:{},propsTextField:{variant:"outlined",autoFocus:!1,size:"small",inputRef:g,type:"time",value:R,onChange:e=>{P(e.target.value)},inputProps:{onKeyDown:e=>{"Enter"===e.key&&m.current&&(m.current.focus(),m.current.setSelectionRange(0,m.current.value.length))}}}},void 0),(0,s.jsx)(yt.I,{height:8,width:"100%"},void 0),(0,s.jsx)(U.T5,{children:b.length>0&&((null===(l=b[0].event)||void 0===l?void 0:l.event)!=w.EnumEvent.OPERATIONAL?(0,s.jsx)(Ge.ZP,{renderInput:e=>(0,s.jsx)(Fe.Z,Object.assign({},e,{fullWidth:!0,variant:"outlined",onKeyDown:F,inputRef:m}),void 0),options:b,fullWidth:!0,blurOnSelect:!0,size:"small",value:N,onHighlightChange:(e,t)=>{S(t)},getOptionLabel:e=>e.name,openOnFocus:!0},void 0):(0,s.jsx)(s.Fragment,{children:"CAMBIANDO A OPERATIVO"},void 0))},void 0)]}),void 0),(0,s.jsxs)(n.Z,Object.assign({container:!0,style:{marginTop:8,gap:4},justifyContent:"flex-end"},{children:[(0,s.jsx)(u.Z,Object.assign({onClick:()=>{j((0,A.Go)())},size:"small",variant:"outlined",color:"primary"},{children:"CANCELAR"}),void 0),(0,s.jsx)(u.Z,Object.assign({disabled:p===K.JD.LOADING,size:"small",variant:"contained",color:"secondary",onClick:M},{children:"CONFIRMAR"}),void 0)]}),void 0)]},void 0)]}),void 0)}),void 0)};var St=i(89452);const kt=(0,Ne.Z)({absolute:{position:"fixed",top:0,bottom:0,right:0,left:0,background:"#00000036",zIndex:1201}}),Zt=({setRefresh:e})=>{const[t,i]=(0,T.useState)(null),{eventSelect:n}=(0,y.C)(Je.yJ),{openModal:o,truck:a,loadingCurrentTimeline:r,timeline:l}=(0,y.C)(A.h3),c=(0,y.T)(),d=kt();(0,T.useEffect)((()=>{if(a){const e=document.getElementById(`truck-hormeter-${a.deviceId}`);e&&i(e)}}),[a]);const v=()=>{c((0,A.Go)()),c((0,E.uP)()),i(null)};(0,T.useEffect)((()=>{o||i(null)}),[o]),(0,T.useEffect)((()=>{window.onkeydown=u}),[]),(0,T.useEffect)((()=>{c((0,St.Gy)(n))}),[n]);const u=e=>{"Escape"===e.key&&v()};return(0,s.jsx)(s.Fragment,{children:t&&(0,s.jsxs)(s.Fragment,{children:[o&&(0,s.jsx)("div",{className:d.absolute,onClick:v},void 0),(0,s.jsx)(ft.Z,Object.assign({anchorEl:t,open:o&&!!l,placement:"right",style:{zIndex:1202}},{children:!r&&a&&l?(0,s.jsx)(Ct,{timeline:l,truck:a,setRefresh:e,eventSelect:n},void 0):(0,s.jsx)("div",{children:"Cargando...."},void 0)}),void 0)]},void 0)},void 0)};var Tt=i(67539),It=i(10646),At=i(15635);const wt=({idTruck:e})=>{const t=(0,T.useRef)(),i=(0,T.useRef)(),[r,l]=(0,T.useState)([]),[c,d]=(0,T.useState)({label:"",id:"",value:""}),{truckInfoList:g}=(0,y.C)(fe.ej),{excavatorInfoList:h}=(0,y.C)(Ee.kW),{statusCycle:m}=(0,y.C)(R.XE),[p]=(0,At.r)(m),[x,b]=(0,T.useState)(!1),O=(0,y.T)(),[f,E]=(0,T.useState)(),[N,L]=(0,T.useState)(),[C]=(0,It.l)(new Date),[S]=(0,It.i)(new Date),[k,Z]=(0,T.useState)({date:`${C}T${S}`}),{truckSelect:I}=(0,y.C)(R.XE),A={id:"",centroid:void 0,pointList:void 0,name:"Desconocido",idDme:void 0,color:void 0},[w,D]=(0,T.useState)(A),[P,z]=(0,T.useState)(A),[W,F]=(0,T.useState)(A),{dmeCellList:M,padCellList:_,stockCellList:$,polygonList:U}=(0,y.C)(Je.WD),[H,G]=(0,T.useState)([]),[J,K]=(0,T.useState)([]),[V,B]=(0,T.useState)([]);(0,T.useEffect)((()=>{G([w,...M]),K([P,..._]),B([W,...$])}),[M,_,$]);const[X,Y]=(0,T.useState)(Ke.f.CHANGE_NOTHING),[q,Q]=(0,T.useState)(Ve.TypeDownload.UNKNOWN),ee=(e,t,i)=>{const s=t.find((t=>t.id===e));s&&E(Object.assign(Object.assign({},s),{type:i}))},te=(0,T.useCallback)((()=>(0,Ke.eq)(X,V,q,H,J)),[X,U,V,q,H,J]),ie=(0,T.useCallback)((()=>(0,Ke.M6)(h)),[h]);return(0,T.useEffect)((()=>{d(N?{label:`${null==N?void 0:N.deviceAlias}`,id:`${null==N?void 0:N.deviceId}`,value:`${null==N?void 0:N.deviceId}`}:{label:"",id:"",value:""})}),[N]),(0,T.useEffect)((()=>{b(!!f&&!!N&&!!k.date)}),[f,N,k]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ce.Z,Object.assign({variant:"button",style:{paddingLeft:8,paddingTop:16,color:"black"}},{children:`Agregar Ciclo al camión ${e}`}),void 0),(0,s.jsx)(j.Z,{width:"100%",height:8},void 0),(0,s.jsxs)(n.Z,Object.assign({container:!0,direction:"column",style:{padding:"0.4rem",alignItems:"center"}},{children:[(0,s.jsx)(n.Z,Object.assign({item:!0},{children:(0,s.jsx)(n.Z,{container:!0,direction:"row",alignItems:"center"},void 0)}),void 0),(0,s.jsx)(j.Z,{width:"100%",height:8},void 0),(0,s.jsx)(n.Z,Object.assign({item:!0},{children:(0,s.jsxs)(n.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,s.jsx)(ce.Z,Object.assign({style:{color:"black"}},{children:"Descarga:"}),void 0),(0,s.jsx)(n.Z,Object.assign({item:!0},{children:(0,s.jsx)(n.Z,Object.assign({container:!0},{children:f&&(0,s.jsx)(o.ZP,Object.assign({title:"Nueva Descarga"},{children:(0,s.jsx)(a.Z,Object.assign({color:"primary",size:"small"},{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Me.Z,{},void 0),(0,s.jsx)(v.Z,{size:"small",color:"secondary",label:f.name,onDelete:()=>E("")},void 0)]},void 0)}),void 0)}),void 0)}),void 0)}),void 0)]}),void 0)}),void 0),(0,s.jsx)(j.Z,{width:"100%",height:8},void 0),(0,s.jsx)(n.Z,Object.assign({item:!0},{children:(0,s.jsxs)(n.Z,Object.assign({container:!0,direction:"row",justifyContent:"center"},{children:[(0,s.jsx)(ce.Z,Object.assign({style:{color:"black"}},{children:"Excavadora: "}),void 0),N&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Me.Z,{color:"primary"},void 0),(0,s.jsx)(v.Z,{size:"small",color:"secondary",label:null==N?void 0:N.deviceAlias,onDelete:()=>{L(void 0),d({label:"",id:"",value:""})}},void 0)]},void 0)]}),void 0)}),void 0),(0,s.jsx)(j.Z,{height:8},void 0),(0,s.jsxs)(n.Z,Object.assign({item:!0,style:{marginTop:8}},{children:[(0,s.jsx)(Fe.Z,{id:"date",label:"Fecha",type:"datetime-local",name:"date",value:k.date,onChange:e=>{const t=e.target;Z(Object.assign(Object.assign({},k),{[t.name]:e.target.value}))},InputLabelProps:{shrink:!0,required:!0},error:void 0===k},void 0),(0,s.jsx)(j.Z,{height:12},void 0),(0,s.jsxs)("div",Object.assign({style:{display:"flex",flexDirection:"row",height:"100px"}},{children:[(0,s.jsx)(Ge.ZP,{size:"small",value:c,blurOnSelect:!0,onChange:(e,t)=>{((e,t)=>{const i=t.find((t=>t.deviceId===e));i&&L(i)})(null!=t?t.value:"",h)},options:ie(),renderTags:(e,t)=>e.map(((e,i)=>(0,s.jsx)(v.Z,Object.assign({variant:"outlined",label:e.label},t({index:i})),void 0))),style:{width:150},getOptionLabel:e=>e.label,disableClearable:!0,filterSelectedOptions:!0,renderInput:e=>(0,s.jsx)(Fe.Z,Object.assign({},e,{autoFocus:!0,inputRef:i,label:"Excavadora",variant:"outlined",fullWidth:!0,error:void 0===N}),void 0)},void 0),(0,s.jsx)(j.Z,{width:4},void 0),r.length<3&&(0,s.jsx)(Ge.ZP,{size:"small",value:r,blurOnSelect:!0,onChange:(e,i)=>{switch(l(i),i.length){case 0:Y(Ke.f.CHANGE_DOWNLOAD),Q(Ve.TypeDownload.UNKNOWN);break;case 1:switch(Y(Ke.f.CHANGE_DOWNLOAD),Q(Number(i[0].value)),X){case Ke.f.CHANGE_DOWNLOAD:Q(Number(i[0].value))}break;case 2:switch(X){case Ke.f.CHANGE_DOWNLOAD:switch(q){case Ve.TypeDownload.DME:ee(i[1].id,H,q);break;case Ve.TypeDownload.PAD:ee(i[1].id,J,q);break;case Ve.TypeDownload.STOCK:ee(i[1].id,V,q)}}Q(Ve.TypeDownload.UNKNOWN),Y(Ke.f.CHANGE_DOWNLOAD),l([])}setTimeout((()=>{var e,i;null===(e=t.current)||void 0===e||e.focus(),null===(i=t.current)||void 0===i||i.click()}),100)},options:te(),multiple:!0,renderTags:(e,t)=>e.map(((e,i)=>(0,s.jsx)(v.Z,Object.assign({variant:"outlined",label:e.label},t({index:i})),void 0))),style:{width:200},getOptionLabel:e=>e.label,openOnFocus:!0,disableClearable:!0,filterSelectedOptions:!0,renderInput:e=>(0,s.jsx)(Fe.Z,Object.assign({},e,{autoFocus:!0,inputRef:t,label:"Agrega Descarga",variant:"outlined",fullWidth:!0,error:void 0===f}),void 0)},void 0)]}),void 0)]}),void 0)]}),void 0),(0,s.jsx)(j.Z,{height:30},void 0),(0,s.jsxs)(n.Z,Object.assign({item:!0,style:{textAlign:"center"}},{children:[(0,s.jsx)(u.Z,Object.assign({variant:"outlined",size:"small",color:"secondary",onClick:()=>{return e=void 0,t=void 0,s=function*(){const e={date:k.date,newDownload:f,excavator:N,truck:I};e.date&&e.newDownload&&e.excavator?(yield O((0,R.QM)(e)),yield O((0,Xe.l4)(I.deviceId)),E(""),L(void 0),b(!1),yield O((0,R.EC)(I.deviceId))):b(!0)},new((i=void 0)||(i=Promise))((function(n,o){function a(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}));var e,t,i,s},disabled:!x},{children:"Agregar Ciclo"}),void 0),(0,s.jsx)(j.Z,{height:10},void 0)]}),void 0)]},void 0)},Dt=(0,Ne.Z)((e=>({container:{width:"100%",scrollBehavior:"auto"},item:{justifySelf:"center",justifyContent:"center",alignContent:"center",textAlign:"center"},title:{fontSize:14},header:{display:"flex",padding:4},body:{textAlign:"center",maxHeight:"650px"},cardNewCycle:{height:"100%",color:"white",borderRadius:0},paperNewCycle:{color:"white"}}))),Rt=()=>{const e=Dt(),t=(0,y.T)(),{cyclesList:i,truckSelect:o}=(0,y.C)(R.XE);return(0,T.useEffect)((()=>{t((0,R.EC)(o.deviceId))}),[o]),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(n.Z,Object.assign({container:!0,className:e.container,spacing:0,direction:"column",style:{}},{children:[(0,s.jsx)("div",Object.assign({style:{borderRadius:"4px",backgroundColor:f.Jx,textAlign:"center",padding:2}},{children:(0,s.jsx)(ce.Z,Object.assign({style:{textAlign:"center",fontSize:16,color:"white"},variant:"button"},{children:o?`CICLOS DEL CAMIÓN  ${null==o?void 0:o.deviceAlias}`:"CAMIÓN NO DISPONIBLE"}),void 0)}),void 0),(0,s.jsx)(j.Z,{height:12},void 0),o&&(0,s.jsxs)(n.Z,Object.assign({item:!0,container:!0,className:e.item,md:12,spacing:1},{children:[(0,s.jsx)(n.Z,Object.assign({item:!0,md:6},{children:(0,s.jsx)(h.Z,Object.assign({elevation:2,className:e.body},{children:i&&i.length>0?(0,s.jsx)(Tt.a,{cycleList:i,isCycleTruck:!0},void 0):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(Tt.a,{cycleList:[],isCycleTruck:!0},void 0)},void 0)}),void 0)}),void 0),(0,s.jsx)(n.Z,Object.assign({item:!0,md:6},{children:(0,s.jsxs)(h.Z,Object.assign({elevation:2,className:e.paperNewCycle},{children:[(0,s.jsx)(wt,{idTruck:o.deviceId},void 0),"F"]}),void 0)}),void 0)]}),void 0)]}),void 0)},void 0)},Pt="92vh",zt=(0,Ne.Z)((e=>({rootOperation:{display:"block",position:"relative",flexGrow:1,height:"96vh",margin:e.spacing(1,1,1,1)},rootAbsolute:{position:"absolute",top:0,bottom:0,right:0,left:0},operation:{overflow:"overlay",flex:11},containerOperation:{width:"100%",display:"flex",maxHeight:Pt,minHeight:Pt,alignContent:"center",justifyContent:"flex-start"},containerTrucks:{width:"100%",maxHeight:Pt,minHeight:Pt,margin:2,padding:2},rootTruck:{overflow:"auto",maxHeight:Pt},rootIconResize:{height:Pt,display:"flex",position:"relative",width:16,backgroundColor:f.Jx,paddingRight:7,paddingLeft:7,backgroundClip:"content-box",cursor:"col-resize"},rootLabel:{width:8,height:8,background:"green",borderRadius:4,padding:0,margin:0},withoutMP:{padding:0,margin:0}})));var Wt,Ft,Mt;const _t=()=>{const{operationsAll:e,status:t,truckAvailable:i}=(()=>{const{operationList:e,status:t,truckAvailable:i}=(0,y.C)(E.YL),{truckInfoList:s}=(0,y.C)(fe.ej),{initial:n}=(0,y.C)(Ee.kW),o=(0,y.T)(),[a,r]=(0,T.useState)([]);return(0,T.useEffect)((()=>{if(t===K.JD.DONE&&n!==J.Vj.LOADING){const t=e.map((e=>{var t,i,s;return Object.assign(Object.assign({},e),{excavator:e.excavatorList.length>0?e.excavatorList[0]:{},typeUpload:Ae.WW[null===(t=e.upload)||void 0===t?void 0:t.type],labelUpload:`${Ae.WW[null===(i=e.upload)||void 0===i?void 0:i.type]} ${e.upload?ot(e.upload):""}`,labelDownload:e.download?`${at(e.download)}`:"",typeDownload:Ae.WW[null===(s=e.download)||void 0===s?void 0:s.type],labelstate:Ae.J8[e.state],cycles:e.cycleList.length,truckList:e.truckList.map((e=>{var t;return Object.assign(Object.assign({},e),{deviceAliasNumber:Number(null===(t=e.deviceAlias.match(/\d/g))||void 0===t?void 0:t.join(""))})})).sort(((e,t)=>e.deviceAliasNumber-t.deviceAliasNumber))})}));r(t)}else r([])}),[e]),(0,T.useEffect)((()=>{e.length>0&&s.length>0&&o((0,E.Vb)({truckList:s}))}),[s,t]),{operationsAll:a,status:t,truckAvailable:i}})(),{truckInfoList:r}=(0,y.C)(fe.ej),l=(0,T.useRef)(),c=(0,T.useRef)(),d=(0,T.useRef)(),[v,u]=(0,T.useState)(!1),[g,h]=(0,T.useState)(!1),{state:m}=(0,y.C)(Je.e5),[j,p]=(0,T.useState)(!1),[x,b]=(0,T.useState)(""),[O,N]=(0,T.useState)([]),{excavatorSelect:L,truckSelect:C}=(0,y.C)(R.XE);(({search:e,setSearch:t,items:i,setFilterList:s})=>{const[]=(0,T.useState)([]);(0,T.useEffect)((()=>{if(!e||0===i.length)return void s((e=>0===e.length?e:[]));const t=i.filter((t=>{var i;return null===(i=t.deviceAlias)||void 0===i?void 0:i.toUpperCase().includes(e.toUpperCase())}));s((e=>JSON.stringify(e.map((e=>e.deviceId)))===JSON.stringify(t.map((e=>e.deviceId)))?(console.log("LiminadodPrev",e),e):(console.log("LiminadodChange",t),t)))}),[e,i])})({search:x,setSearch:b,items:r,setFilterList:N});const S=(0,y.T)(),k=zt();(0,T.useEffect)((()=>{}),[]),(0,T.useEffect)((()=>{Wt=document.querySelector("#wrapper"),Ft=null==Wt?void 0:Wt.querySelector("#listTruck"),Mt=null==Wt?void 0:Wt.querySelector("#listOperation");const e=localStorage.getItem("localStorajeTruck"),t=localStorage.getItem("localStorajeOperation");e&&(Ft.style.flex=Number(e)),t&&(Mt.style.flex=Number(t))}),[]),(0,T.useEffect)((()=>{S((0,fe.RK)()),S((0,E.hS)())}),[j]);const Z=(0,T.useMemo)((()=>(0,s.jsx)("div",Object.assign({className:k.containerOperation},{children:t!==K.JD.DONE?(0,s.jsx)(n.Z,Object.assign({container:!0,alignItems:"stretch",justifyContent:"center"},{children:(0,s.jsx)(ct,{height:"100%",width:"100%"},void 0)}),void 0):e.length>0?e.map(((e,t)=>(0,s.jsx)(it,{operation:e,setRefresh:p,filterList:O},t))):(0,s.jsx)(rt,{},void 0)}),void 0)),[e,O,t]);(0,T.useEffect)((()=>{switch(m){case _e.m4.DONE:p((e=>!e))}}),[m]);const I=()=>h((e=>!e)),A=(0,T.useCallback)((e=>{var t;if(!(v&&Wt&&Ft&&Mt))return;const i=12*(e.clientX-Wt.offsetLeft-46)/(null===(t=l.current)||void 0===t?void 0:t.clientWidth),s=Number(c.current.style.flex)>0?c.current.style.flex:0,n=Math.abs(s-i)>.05?Math.max(i,1):s;Ft.style.flex=n,Mt.style.flex=12-n,localStorage.setItem("localStorajeTruck",`${n}`),localStorage.setItem("localStorajeOperation",""+(12-n))}),[v]),w=(0,T.useMemo)((()=>(0,s.jsx)(n.Z,Object.assign({item:!0,id:"listTruck",style:{margin:0,padding:0,flex:1},className:k.rootTruck,innerRef:c},{children:(0,s.jsx)(Ot,{truckAvailable:i,filterList:O},void 0)}),void 0)),[i,O]),D=(0,T.useMemo)((()=>(0,s.jsxs)(n.Z,Object.assign({container:!0,justifyContent:"flex-end",alignItems:"center"},{children:[(0,s.jsx)(o.ZP,Object.assign({title:"Nueva Operación"},{children:(0,s.jsx)(Pe.rU,Object.assign({to:"/operation/create/0/0"},{children:(0,s.jsx)(a.Z,Object.assign({color:"secondary",size:"small"},{children:(0,s.jsx)(ne.Z,{fontSize:"small"},void 0)}),void 0)}),void 0)}),void 0),(0,s.jsx)(o.ZP,Object.assign({title:"Reasignación global de Camiones"},{children:(0,s.jsx)(a.Z,Object.assign({onClick:I,color:"secondary",size:"small"},{children:(0,s.jsx)(oe.Z,{fontSize:"small"},void 0)}),void 0)}),void 0),(0,s.jsx)(ht,{search:x,setSearch:b},void 0)]}),void 0)),[x]),P=(0,T.useCallback)((e=>{e.target===d.current&&u(!0)}),[d]),z=(0,T.useCallback)((()=>u(!1)),[]),W=(0,T.useMemo)((()=>(0,s.jsx)(Zt,{setRefresh:p},void 0)),[]),F=()=>{S((0,R.kY)()),p((e=>!e))};return(0,s.jsx)(st.W,Object.assign({backend:nt.PD},{children:(0,s.jsxs)("div",Object.assign({className:k.rootOperation},{children:[(0,s.jsxs)("div",Object.assign({className:k.rootAbsolute},{children:[(0,s.jsx)(n.Z,Object.assign({item:!0,innerRef:c},{children:D}),void 0),(0,s.jsxs)(n.Z,Object.assign({container:!0,innerRef:l,id:"wrapper",onMouseUp:z,onMouseMove:A,onMouseDown:P},{children:[w,(0,s.jsx)(U.P4,{className:k.rootIconResize,id:"handler",innerRef:d},void 0),(0,s.jsx)(n.Z,Object.assign({item:!0,className:k.operation,id:"listOperation"},{children:(0,s.jsx)(n.Z,Object.assign({container:!0,direction:"column"},{children:(0,s.jsxs)(n.Z,Object.assign({item:!0},{children:[(0,s.jsx)("div",Object.assign({className:k.containerOperation},{children:t!==K.JD.DONE?(0,s.jsx)(n.Z,Object.assign({container:!0,alignItems:"stretch",justifyContent:"center"},{children:(0,s.jsx)(ct,{height:"100%",width:"100%"},void 0)}),void 0):e.length>0?Z:(0,s.jsx)(rt,{},void 0)}),void 0),(0,s.jsxs)(U.T5,Object.assign({container:!0,direction:"row",style:{gap:8}},{children:[(0,s.jsx)(U.P4,{children:(0,s.jsxs)(U.T5,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,s.jsx)("p",{className:k.rootLabel},void 0),(0,s.jsx)("p",Object.assign({style:{padding:0,margin:0}},{children:"Asignados"}),void 0)]}),void 0)},void 0),(0,s.jsx)(U.P4,{children:(0,s.jsxs)(U.T5,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,s.jsx)("p",{style:{background:f.J$},className:k.rootLabel},void 0),(0,s.jsx)("p",Object.assign({style:{padding:0,margin:0}},{children:"No asignados"}),void 0)]}),void 0)},void 0),(0,s.jsx)(U.P4,{children:(0,s.jsxs)(U.T5,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,s.jsx)("p",{style:{background:f.sb},className:k.rootLabel},void 0),(0,s.jsx)("p",Object.assign({style:{padding:0,margin:0}},{children:"Excavadora"}),void 0)]}),void 0)},void 0),(0,s.jsx)(U.P4,{children:(0,s.jsxs)(U.T5,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,s.jsx)("p",{style:{borderColor:f.J$,background:"#00000000",borderStyle:"solid",borderWidth:2},className:k.rootLabel},void 0),(0,s.jsxs)("p",Object.assign({style:{padding:0,margin:0}},{children:["Área de carguío (",te.Xb,"mts)"]}),void 0)]}),void 0)},void 0)]}),void 0)]}),void 0)}),void 0)}),void 0)]}),void 0)]}),void 0),(0,s.jsx)(De,{open:g,setOpen:h,setRefresh:p,operations:e},void 0),(0,s.jsx)(xe,{open:!!L.deviceId,setOpen:F,children:(0,s.jsx)(Tt.S,{},void 0),handleClose:F,handleClickConfirm:F},void 0),(0,s.jsx)(xe,{open:!!C.deviceId,setOpen:F,children:(0,s.jsx)(Rt,{},void 0),handleClose:F,handleClickConfirm:F},void 0),W]}),void 0)}),void 0)};function $t(){return(0,s.jsx)(_t,{},void 0)}}}]);