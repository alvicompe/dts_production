"use strict";(self.webpackChunkdts_hytera=self.webpackChunkdts_hytera||[]).push([[633],{63663:(e,t,i)=>{i.d(t,{F2:()=>l,xu:()=>u.I,zx:()=>d,iz:()=>f,T5:()=>h,P4:()=>g,hU:()=>v,Mi:()=>x,IB:()=>a.C});var n=i(85893),o=i(8286),s=i(96588);const l=e=>(0,n.jsx)(s.ZP,Object.assign({},Object.assign({},e.propsAutocomplete),{renderInput:e=>(0,n.jsx)(o.Z,Object.assign({},e,{label:"Seleccione una opciÃ³n",variant:"outlined"}),void 0)}),void 0);var a=i(45287),r=i(282);const d=e=>(0,n.jsx)(r.Z,Object.assign({},Object.assign({},e.propsButton),{children:e.label}),void 0);var c=i(17812);const v=e=>(0,n.jsx)(c.Z,Object.assign({},Object.assign({},e),{children:e.children}),void 0);var u=i(47463),m=i(41749);const h=e=>(0,n.jsx)(m.Z,Object.assign({},Object.assign({},e),{container:!0},{children:e.children}),void 0),g=e=>(0,n.jsx)(m.Z,Object.assign({},Object.assign({},e),{item:!0},{children:e.children}),void 0);var j=i(55517);const f=e=>(0,n.jsx)(j.Z,Object.assign({},Object.assign({},e)),void 0);var b=i(82285);const x=e=>(0,n.jsx)(b.Z,Object.assign({},Object.assign({},e),{children:(0,n.jsx)(m.Z,{children:e.children},void 0)}),void 0)},45287:(e,t,i)=>{i.d(t,{C:()=>l});var n=i(85893),o=i(64436),s=i(8286);const l=e=>{const{propsTextField:t,propsForm:i}=e;return(0,n.jsx)(o.Z,Object.assign({},Object.assign({},i),{children:(0,n.jsx)(s.Z,Object.assign({},Object.assign({},t)),void 0)}),void 0)}},47463:(e,t,i)=>{i.d(t,{I:()=>s});var n=i(85893),o=i(10046);const s=({children:e,height:t,width:i})=>(0,n.jsx)(o.Z,Object.assign({height:t,width:i},{children:e}),void 0)},61242:(e,t,i)=>{i.d(t,{a:()=>u});var n=i(85893),o=i(41120),s=i(52663),l=i(66083),a=i(29525),r=i(66856),d=i(95477),c=i(282);const v=(0,o.Z)({disabledPadding:{padding:0,textAlign:"center"}}),u=({open:e,handleClose:t,handleConfirm:i,title:o,children:u,maxWidth:m="lg",disabled:h=!1,loading:g})=>{const j=v();return(0,n.jsxs)(s.Z,Object.assign({open:e,onClose:t,maxWidth:m},{children:[(0,n.jsx)(l.Z,Object.assign({className:j.disabledPadding},{children:o}),void 0),(0,n.jsx)(a.Z,{children:u},void 0),(0,n.jsx)(r.Z,{children:g?(0,n.jsx)(d.Z,{style:{width:"30px",height:"30px"}},void 0):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.Z,Object.assign({size:"small",color:"primary",onClick:t},{children:"Cancelar"}),void 0),i&&(0,n.jsx)(c.Z,Object.assign({disabled:h,variant:"outlined",size:"small",color:"secondary",onClick:i,autoFocus:!0},{children:"Confirmar"}),void 0)]},void 0)},void 0)]}),void 0)}},2834:(e,t,i)=>{i.d(t,{d:()=>l});var n=i(85893),o=i(282),s=i(95477);const l=e=>{var{loading:t,text:i}=e,l=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i}(e,["loading","text"]);return(0,n.jsx)(o.Z,Object.assign({},l,{disabled:t},{children:t?(0,n.jsx)(s.Z,{style:{width:"20px",height:"20px"}},void 0):i}),void 0)}},89958:(e,t,i)=>{i.d(t,{M:()=>l});var n=i(88093),o=i(10646),s=i(56731);const l=()=>{const[e]=(0,n.R)(),[t]=(0,o.l)(e),i=`${t}T00:00`;return[{shift:s.Shift.UNKNOWN_SHIFT,date:i}]}},58637:(e,t,i)=>{i.d(t,{b:()=>d});var n=i(73914),o=i(57850),s=i(59693),l=i(93584);function a(e){return e.type||e.mode}const r=(0,o.Z)(),d=(0,n.Z)((e=>{a(e.palette);const t=t=>"dark"===a(e.palette)?(0,s._j)(t,.1):(0,s.$n)(t,.1);return{root:{"& .super-app-theme--cell":{backgroundColor:"rgb(26,62,114,0.1)",color:"#1a3e72",fontWeight:"600"},"& .Mui-error.negative":{backgroundColor:"#CCFFFF",color:"#1a3e72",fontWeight:"600"},"& .Mui-error.positive":{backgroundColor:"rgba(157, 255, 118, 0.49)",color:"#1a3e72",fontWeight:"600"},"& .super-app-theme--false":{backgroundColor:(i="rgb(255, 48, 83)","dark"===a(e.palette)?(0,s._j)(i,.1):(0,s.$n)(i,.5)),"&:hover":{backgroundColor:t(e.palette.error.main)}},"& .MuiDataGrid-row":{"&:hover":{backgroundColor:t(`${l.sb}`)},"& .Mui-selected":{"&:hover":{backgroundColor:t(`${l.sb}`)}}}}};var i}),{defaultTheme:r})},85335:(e,t,i)=>{i.d(t,{Z:()=>v});var n=i(85893),o=i(67294),s=i(41120),l=i(35117),a=i(85639),r=i(64436),d=i(26209);const c=(0,s.Z)((e=>(0,l.Z)({formControl:{margin:e.spacing(1),minWidth:"100%"},selectEmpty:{marginTop:e.spacing(2)}})));function v(e){var{placeholder:t,iteams:i,selectValue:s,value:l}=e,v=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i}(e,["placeholder","iteams","selectValue","value"]);const u=c(),[m,h]=o.useState("");return(0,o.useEffect)((()=>{h(l||"")}),[l]),(0,o.useEffect)((()=>{s(m)}),[m]),(0,n.jsx)("div",{children:(0,n.jsx)(r.Z,Object.assign({className:u.formControl},{children:(0,n.jsxs)(d.Z,Object.assign({},v,{value:m,onChange:e=>{h(e.target.value)},displayEmpty:!0,className:u.selectEmpty,inputProps:{"aria-label":"Without label"}},{children:[(0,n.jsx)(a.Z,Object.assign({value:"",disabled:!0},{children:t}),void 0),null==i?void 0:i.map((e=>(0,n.jsx)(a.Z,Object.assign({value:null==e?void 0:e.value},{children:null==e?void 0:e.tittle}),e.value)))]}),void 0)}),void 0)},void 0)}},990:(e,t,i)=>{i.d(t,{M:()=>o});var n=i(67294);const o=e=>{const[t,i]=(0,n.useState)(e);return[t,e=>{i(Object.assign(Object.assign({},t),{[e.target.name]:e.target.value}))},()=>{i(e)},i]}},15635:(e,t,i)=>{i.d(t,{r:()=>s});var n=i(67294),o=i(95090);const s=e=>{const[t,i]=(0,n.useState)(!1);return(0,n.useEffect)((()=>(e===o.JD.DONE||e===o.JD.UNKNOWN||e===o.JD.ERROR?i(!1):i(!0),()=>{i(!1)})),[e]),[t]}},12708:(e,t,i)=>{i.r(t),i.d(t,{HourmeterView:()=>qe,default:()=>Xe});var n=i(85893),o=i(41749),s=i(10046),l=i(67294),a=i(73855),r=i(12207),d=i(74046),c=i(61242),v=i(60702),u=i(44562);const m=({error:e,index:t})=>{const[i,o]=l.useState(!0),[s,a]=l.useState({vertical:"bottom",horizontal:"right"}),{vertical:r,horizontal:d}=s,c=(e,t)=>{"clickaway"!==t&&o(!1)};return(0,n.jsx)(v.Z,Object.assign({anchorOrigin:{vertical:r,horizontal:d},open:i,onClose:c,style:{marginBottom:60*t+"px"}},{children:(0,n.jsx)(u.Z,Object.assign({style:{marginTop:".5rem"},onClose:c,severity:"error"},{children:(0,n.jsx)("strong",{children:e.message},void 0)}),void 0)}),void 0)},h=({error:e})=>{const[t,i]=l.useState({open:!0,vertical:"bottom",horizontal:"right"}),{vertical:o,horizontal:s,open:a}=t,r=()=>{i(Object.assign(Object.assign({},t),{open:!1}))};return(0,n.jsx)(v.Z,Object.assign({open:!0,anchorOrigin:{vertical:o,horizontal:s}},{children:(0,n.jsx)("div",{children:null==e?void 0:e.map(((e,t)=>(0,n.jsx)(m,{error:e,handleClose:r,index:t},e.deviceId)))},void 0)}),void 0)};var g=i(2050),j=i(58637),f=i(868),b=i(17812),x=i(52303),E=i(80024),p=i(38396),O=i(85639),S=i(79192),T=i(67774),N=i(97700);const y=()=>{const{eventList:e}=(0,a.C)(N.yJ),t=(0,a.T)(),[i,n]=l.useState([]);return(0,l.useEffect)((()=>{n([{id:"NONE",name:"NONE",event:""},...e])}),[e]),(0,l.useEffect)((()=>{t((0,T.TU)())}),[]),[i]},C=(e,t)=>{const i=(0,a.T)();return[(n="NONE")=>{t(null),i(e("NONE"===n?{columnField:"statusEvent",operatorValue:"startsWith",value:""}:{columnField:"statusEvent",operatorValue:"startsWith",value:n}))}]};function Z(){const[e]=y(),[t,i]=l.useState(null),o=Boolean(t),[s]=C(d.V,i);return(0,n.jsxs)("div",{children:[(0,n.jsx)(b.Z,Object.assign({style:{padding:"0px",margin:"0px"},"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:e=>{i(e.currentTarget)}},{children:(0,n.jsx)(S.Z,{},void 0)}),void 0),(0,n.jsx)(p.Z,Object.assign({id:"long-menu",anchorEl:t,keepMounted:!0,open:o,onClose:()=>s("NINGUNO"),PaperProps:{style:{maxHeight:216,width:"20ch"}}},{children:e.map((e=>(0,n.jsx)(O.Z,Object.assign({onClick:()=>s(e.event.toString())},{children:e.name}),e.name)))}),void 0)]},void 0)}var w=i(8286),I=i(78479);const A=({row:e})=>{var t,i,o,r;const[c,v]=(0,I._)("hourmeterExcavator",{}),u=(0,a.T)();return console.log("row",e),(0,l.useEffect)((()=>{u((0,d.WZ)(c))}),[c]),(0,n.jsx)(s.Z,Object.assign({component:"form",onSubmit:t=>{t.preventDefault();const i=new FormData(t.currentTarget),n={};n[e.deviceId]={value:i.get("hourmeter"),color:"rgba(157, 255, 118, 0.49)"},(e=>{const t=JSON.parse(window.localStorage.getItem("hourmeterExcavator")),i=Object.assign(t,e);v(Object.assign({},i))})(n),"UNKNOWN_SHIFT"!==e.shift&&u((0,d.zi)(Object.assign(Object.assign({},e),{hourmeter:i.get("hourmeter")})))},sx:{mt:1}},{children:(0,n.jsx)(w.Z,{style:{background:(null===(t=c[e.deviceId])||void 0===t?void 0:t.color)?null===(i=c[e.deviceId])||void 0===i?void 0:i.color:""},inputProps:{pattern:"^[0-9]+([.][0-9]+)?$"},name:"hourmeter",autoComplete:"off",id:"hourmeter",defaultValue:(null===(o=c[e.deviceId])||void 0===o?void 0:o.value)?null===(r=c[e.deviceId])||void 0===r?void 0:r.value:e.hourmeterCurrent},void 0)}),void 0)},k=(e,t,i,o)=>[Object.assign(Object.assign({},g.mf9),{width:60,renderHeader:e=>(0,n.jsxs)(l.Fragment,{children:[(0,n.jsx)(g.KOw,Object.assign({},e),void 0),(0,n.jsx)(Z,{},void 0)]},void 0)}),{field:"excavator",headerName:"Excavadora",hideSortIcons:!0},{field:"shift",headerName:"Turno",hideSortIcons:!0,width:60,renderCell:({row:e})=>(0,n.jsx)(f.ZP,Object.assign({title:e.shift},{children:(0,n.jsx)("p",{children:e.shift},void 0)}),void 0)},{field:"statusEvent",headerName:"Evento",type:"string",hide:!0},{field:"status",headerName:"Estado",width:100,hideSortIcons:!0,renderCell:({row:e})=>(0,n.jsx)(f.ZP,Object.assign({title:e.status},{children:(0,n.jsx)("p",{children:e.status},void 0)}),void 0)},{field:"hmtStart",headerName:"Horometro",editable:!1,type:"number",hideSortIcons:!0},{field:"hourmeterCurrent",headerName:"Horometro actual",editable:!o,hideSortIcons:!0,type:"number"},{field:"xx",headerName:"Horometro actual",cellClassName:"super-app-theme--cell",hideSortIcons:!0,renderCell:({row:e})=>(0,n.jsx)(A,{row:e},void 0)},{field:"adjustment",headerName:"Ajuste",type:"number",hideSortIcons:!0},{field:"Opciones",headerName:"Opc",hideSortIcons:!0,minWidth:110,renderCell:({row:o})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.ZP,Object.assign({onClick:()=>{t(o),e(!0)},title:"Add timeline"},{children:(0,n.jsx)(b.Z,Object.assign({size:"small"},{children:(0,n.jsx)(E.Z,{color:"primary",fontSize:"small"},void 0)}),void 0)}),void 0),(0,n.jsx)(f.ZP,Object.assign({onClick:()=>{t(o),i(!0)},title:"View Timeline"},{children:(0,n.jsx)(b.Z,Object.assign({size:"small"},{children:(0,n.jsx)(x.Z,{htmlColor:"Green",fontSize:"small"},void 0)}),void 0)}),void 0)]},void 0)}],L=(e,t)=>{const[i,n]=(0,l.useState)([{field:e,sort:t}]);return{sortModel:i,handleModelGrid:e=>{0!=e.length?e[0].field==i[0].field&&e[0].sort==i[0].sort||n(e):"desc"==i[0].sort?n([Object.assign(Object.assign({},i[0]),{sort:"asc"})]):n([Object.assign(Object.assign({},i[0]),{sort:"desc"})])}}};var D,F;!function(e){e[e.UNKNOWN_STATE_EVENT=0]="UNKNOWN_STATE_EVENT",e[e.MA=1]="MA",e[e.NOP=2]="NOP",e[e.DOP=3]="DOP",e[e.OP=4]="OP"}(D||(D={})),function(e){e[e.UNKNOWN_SHIFT=0]="UNKNOWN_SHIFT",e[e.NOCHE=1]="NOCHE",e[e.DIA=2]="DIA",e[e.AMBOS=3]="AMBOS"}(F||(F={}));var H=i(95090);const P=(e,t)=>{const[i,n]=(0,l.useState)([]);return(0,l.useEffect)((()=>{t===H.JD.DONE?n(null==e?void 0:e.map((e=>{var t,i,n,o,s,l,a,r,d,c,v,u,m,h,g,j;return Object.assign(Object.assign({},e),{id:e.deviceId,excavator:e.deviceAlias,status:` ${(null===(i=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.name)?null===(o=null===(n=e.eventState)||void 0===n?void 0:n.event)||void 0===o?void 0:o.name.substring(0,3):""}  ${(null===(s=e.eventState)||void 0===s?void 0:s.name)?` - ${null===(l=e.eventState)||void 0===l?void 0:l.name.toString().toLowerCase()}`:""}`,statusEvent:null===(r=null===(a=e.eventState)||void 0===a?void 0:a.event)||void 0===r?void 0:r.event,hmtStart:null===(d=e.historyShiftList[0])||void 0===d?void 0:d.initialHourmeter.toFixed(2),hourmeterCurrent:null===(c=e.historyShiftList.at(-1))||void 0===c?void 0:c.initialHourmeter.toFixed(2),shift:F[null===(v=e.currentTimeline)||void 0===v?void 0:v.shift],date:new Date(1e3*(null===(m=null===(u=e.currentTimeline)||void 0===u?void 0:u.shiftDate)||void 0===m?void 0:m.seconds)).toLocaleDateString(),adjustment:(null===(h=e.currentTimeline)||void 0===h?void 0:h.adjustment)?e.currentTimeline.adjustment:0,statusAdjustment:!!(null===(g=e.currentTimeline)||void 0===g?void 0:g.status)&&(null===(j=e.currentTimeline)||void 0===j?void 0:j.status)})}))):n([])}),[e,t]),[i,n]},M=(e,t,i)=>{const n=(0,a.T)();Object.keys(e).length>=2?(t({}),n(i({}))):(Object.keys(e).forEach((t=>{if(e[t].hourmeterCurrent){var i=e[t].hourmeterCurrent.value>0;e[t].hourmeterCurrent=Object.assign(Object.assign({},e[t].hourmeterCurrent),{error:!i})}})),t(e),n(i(e)))},R=({setOpen:e,setTimelineCurrent:t,setOpenTimeline:i})=>{const o=(0,j.b)(),s=(0,a.T)(),{statusTimeslineExcavator:r,filterDataGrid:c,isEditableRows:v,timeslineExcavator:u,oneTimelimeUpdate:m}=(0,a.C)(d.tH),[h,f]=P(u.currentTimelineList,r),{sortModel:b,handleModelGrid:x}=L("excavator","asc"),[E,p]=(0,I._)("hourmeterExcavator",{}),[O,S]=(0,l.useState)();return(0,l.useEffect)((()=>{r===H.JD.DONE&&(s((0,d.hV)()),s((0,d.OE)()))}),[h]),(0,l.useEffect)((()=>{((e,t,i)=>{var n,o,s,l,a,r,d,c,v,u,m,h,g,j,f,b,x;if(t){x=Object.assign(Object.assign({},t),{id:t.deviceId,excavator:t.deviceAlias,status:` ${(null===(o=null===(n=t.eventState)||void 0===n?void 0:n.event)||void 0===o?void 0:o.name)?null===(l=null===(s=t.eventState)||void 0===s?void 0:s.event)||void 0===l?void 0:l.name.substring(0,3):""}  ${(null===(a=t.eventState)||void 0===a?void 0:a.name)?` - ${null===(r=t.eventState)||void 0===r?void 0:r.name.toString().toLowerCase()}`:""}`,statusEvent:null===(c=null===(d=t.eventState)||void 0===d?void 0:d.event)||void 0===c?void 0:c.event,hmtStart:null===(v=t.historyShiftList[0])||void 0===v?void 0:v.initialHourmeter.toFixed(2),hourmeterCurrent:null===(u=t.historyShiftList.at(-1))||void 0===u?void 0:u.initialHourmeter.toFixed(2),shift:F[null===(m=t.currentTimeline)||void 0===m?void 0:m.shift],date:new Date(1e3*(null===(g=null===(h=t.currentTimeline)||void 0===h?void 0:h.shiftDate)||void 0===g?void 0:g.seconds)).toLocaleDateString(),adjustment:(null===(j=t.currentTimeline)||void 0===j?void 0:j.adjustment)?t.currentTimeline.adjustment:0,statusAdjustment:!!(null===(f=t.currentTimeline)||void 0===f?void 0:f.status)&&(null===(b=t.currentTimeline)||void 0===b?void 0:b.status)});const E=e.findIndex((e=>e.id===x.id)),p=[...e];console.log("rows",e),console.log("rowsindex",E),console.log("rowsaux",p),console.log("rows",e),E>=0&&(p[E]=x),i([...p])}})(h,m.currentTimeline,f)}),[m]),(0,n.jsx)("div",Object.assign({style:{height:"1113px",overflowY:"scroll",display:"flex",flexDirection:"column"}},{children:(0,n.jsx)(g._$r,{className:o.root,rowHeight:30,rows:h,columns:k(e,t,i,v),density:"compact",checkboxSelection:!0,disableSelectionOnClick:!0,onSelectionModelChange:e=>(e=>{const t=new Set(e),i=h.filter((e=>t.has(e.id.toString())));s((0,d.Xm)(i))})(e),disableColumnMenu:!0,sortModel:b,editRowsModel:O,onEditRowsModelChange:e=>(e=>{var t="";for(var[i,n]of Object.entries(e))Object.keys(n).length<=1&&Object.keys(n).forEach((e=>{t=e}));var o=Object.assign({},e);switch(t){case"hourmeterCurrent":S(Object.assign(Object.assign({},O),o)),s((0,d.Jo)(o));break;case"hmtStart":M(o,S,d.Yb)}})(e),filterModel:{items:[c]},getRowClassName:e=>`super-app-theme--${e.row.statusAdjustment}`},void 0)}),void 0)};var _=i(66977),$=i(990),z=i(88093),W=i(10646),U=i(49032),V=i(64436),K=i(96019),G=i(67162),B=i(30553),J=i(40074),Y=i(81395),q=i(89452);const X=({setEventState:e,event:t})=>{var i,o;const[s,r,d,c]=(0,$.M)({status:U.EnumEvent.UNKNOWN_STATE_EVENT}),{eventStateList:v,statusEventStateList:u}=(0,a.C)(N.eG),m=(0,a.T)();return(0,l.useEffect)((()=>{if(t.toString()===U.EnumEvent.OPERATIONAL.toString()){if(u===H.JD.DONE){const t=v[0];e(Object.assign(Object.assign({},t),{id:"",name:"",eventState:0,event:null==t?void 0:t.event}))}}else{const t=v.find((e=>e.eventState.toString()===s.status.toString()));e(t)}}),[s.status]),(0,l.useEffect)((()=>{m((0,q.Gy)(t))}),[t]),(0,l.useEffect)((()=>{e({id:"",name:"",eventState:0,event:{id:"",name:"",event:0}})}),[]),(0,l.useEffect)((()=>{if(u===H.JD.DONE&&t.toString()===U.EnumEvent.OPERATIONAL.toString()){const t=v[0];e(Object.assign(Object.assign({},t),{id:"",name:"",eventState:0,event:null==t?void 0:t.event}))}}),[u]),(0,l.useEffect)((()=>{d()}),[t]),(null==t?void 0:t.toString())===U.EnumEvent.OPERATIONAL.toString()?null:(0,n.jsxs)(V.Z,Object.assign({component:"fieldset"},{children:[(0,n.jsx)(K.Z,Object.assign({component:"legend"},{children:null===(o=null===(i=null==v?void 0:v.find((e=>{var i;return(null===(i=null==e?void 0:e.event)||void 0===i?void 0:i.event)==t})))||void 0===i?void 0:i.event)||void 0===o?void 0:o.name}),void 0),(0,n.jsx)(G.Z,Object.assign({defaultValue:"female","aria-label":"hourmeter",name:"customized-radios"},{children:null==v?void 0:v.map((e=>{var t,i,o;return(0,n.jsx)(B.Z,{value:null==e?void 0:e.eventState,control:(0,n.jsx)(J.Z,{checked:s.status===(null===(t=null==e?void 0:e.eventState)||void 0===t?void 0:t.toString()),icon:(0,n.jsx)(Y.Z,{},void 0),checkedIcon:(0,n.jsx)(Y.Z,{},void 0),name:"status",onClick:()=>{},onChange:r,disabled:(null===(o=null===(i=null==e?void 0:e.event)||void 0===i?void 0:i.event)||void 0===o?void 0:o.toString())===U.EnumEvent.OPERATIONAL.toString()},void 0),label:null==e?void 0:e.name},null==e?void 0:e.id)}))}),void 0)]}),void 0)};var Q=i(73914),ee=i(10150);const te=(0,Q.Z)((e=>(0,ee.Z)({container:{display:"flex",flexDirection:"column",flexWrap:"wrap",fontFamily:"inherit"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),paddingBottom:"10px"}}))),ie=({value:e,label:t})=>{const i=te(),s=(0,a.T)(),d=new Date,c=`0${d.getHours()}`,v=`0${d.getMinutes()}`,[u]=(0,W.l)(new Date),[m,h]=(0,l.useState)({hoursStart:`${c.slice(-2)}:${v.slice(-2)}`,date:u,status:e,substatus:{id:"",name:"",eventState:U.EnumEvent.UNKNOWN_STATE_EVENT,event:{id:"",name:"",event:U.EnumEvent.UNKNOWN_STATE_EVENT}}}),[g,j]=(0,l.useState)({id:"",name:"",eventState:U.EnumEvent.UNKNOWN_STATE_EVENT,event:{id:"",name:"",event:U.EnumEvent.UNKNOWN_STATE_EVENT}});console.log(m);const f=e=>{h(Object.assign(Object.assign({},m),{[e.target.name]:e.target.value}))};(0,l.useEffect)((()=>{s((0,r.gS)(Object.assign({},m)))}),[m]),(0,l.useEffect)((()=>()=>{s((0,r.XH)())}),[]),(0,l.useEffect)((()=>{h(Object.assign(Object.assign({},m),{substatus:g}))}),[g]);const{hoursStart:b}=m;return(0,n.jsxs)(o.Z,Object.assign({container:!0,spacing:1},{children:[(0,n.jsx)(o.Z,Object.assign({item:!0,lg:6,md:6,sm:6,xs:6},{children:(0,n.jsxs)("form",Object.assign({className:i.container,noValidate:!0},{children:[(0,n.jsx)(w.Z,{id:"date",name:"date",label:"Fecha",type:"date",defaultValue:m.date,onChange:f,className:i.textField,InputLabelProps:{shrink:!0}},void 0),(0,n.jsx)(w.Z,{id:"date",label:"Hora inicial",type:"time",name:"hoursStart",value:b,onChange:f,className:i.textField,InputLabelProps:{shrink:!0,required:!0}},void 0)]}),void 0)}),void 0),(0,n.jsx)(o.Z,Object.assign({item:!0,lg:6,md:6,sm:6,xs:6},{children:(0,n.jsx)(X,{setEventState:j,event:m.status},void 0)}),void 0)]}),void 0)};var ne=i(282);const oe=({rowsTimelines:e,setOpenEvent:t,setevent:i})=>{const o=(0,a.T)(),{eventList:s}=(0,a.C)(N.yJ),[r,d]=l.useState(null),[c]=(e=>{const[t,i]=(0,l.useState)(!0),[n,o]=(0,l.useState)(!0),[s,a]=(0,l.useState)(!0);(0,l.useEffect)((()=>{d()&&(i(!1),o(!0),a(!1)),v()&&(i(!1),o(!1),a(!1)),r()&&(i(!0),o(!1),a(!1)),c()&&(i(!1),o(!1),a(!0)),0==v()&&0==r()&&0==c()&&0==d()&&(i(!0),o(!0),a(!0))}),[e]);const r=()=>0!==e.length&&e.every((e=>{var t,i;return(null===(i=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===U.EnumEvent.NO_OPERATIONAL})),d=()=>0!==e.length&&e.every((e=>{var t,i;return(null===(i=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===U.EnumEvent.OPERATIONAL})),c=()=>0!==e.length&&e.every((e=>{var t,i;return(null===(i=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===U.EnumEvent.OPERATIONAL_DELAY})),v=()=>0!==e.length&&e.every((e=>{var t,i;return void 0===(null===(i=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)}));return[e=>{var i=!1;return e===U.EnumEvent.OPERATIONAL_DELAY&&(i=s),e===U.EnumEvent.OPERATIONAL&&(i=n),e===U.EnumEvent.NO_OPERATIONAL&&(i=t),e===U.EnumEvent.MAINTENANCE&&(i=!0),i}]})(e);return(0,l.useEffect)((()=>{o((0,T.TU)())}),[]),(0,n.jsxs)("div",{children:[(0,n.jsx)(ne.Z,Object.assign({"aria-controls":"simple-menu","aria-haspopup":"true",onClick:e=>{d(e.currentTarget)},color:"primary",size:"small",variant:"outlined"},{children:"Ir a"}),void 0),(0,n.jsx)(p.Z,Object.assign({id:"simple-menu",anchorEl:r,keepMounted:!0,open:Boolean(r),onClose:()=>{d(null)}},{children:s.map((e=>(0,n.jsx)(O.Z,Object.assign({disabled:c(null==e?void 0:e.event),onClick:()=>(e=>{t(!0),i(e)})(null==e?void 0:e.event),color:"primary"},{children:e.name}),e.id)))}),void 0)]},void 0)};var se=i(97480),le=i(71267),ae=i(69798);const re=({shift:e,date:t})=>{const i=new Date(t).toLocaleDateString(),o=(new Date).toLocaleDateString();return(0,n.jsxs)("div",{children:[(0,n.jsx)(le.Z,{icon:(0,n.jsx)(se.Z,{},void 0),label:e,clickable:!0,color:"secondary",deleteIcon:(0,n.jsx)(se.Z,{},void 0),variant:"outlined"},void 0),(0,n.jsx)(le.Z,{icon:(0,n.jsx)(ae.Z,{},void 0),label:t,clickable:!0,color:`${i===o}`?"secondary":"primary",deleteIcon:(0,n.jsx)(ae.Z,{},void 0),variant:"outlined"},void 0)]},void 0)},de=l.memo(re);var ce=i(15635),ve=i(53375);const ue=()=>{const{timeslineExcavator:e,rowsEditModelHourmeterExcavator:t,isCheckFinalizeExcavator:i}=(0,a.C)(d.tH),o=(0,a.T)(),[s,r]=(0,l.useState)(!0),[c]=(0,z.R)();return(0,l.useEffect)((()=>{e.currentTimelineList.some((e=>{var t;return!1===(null===(t=e.currentTimeline)||void 0===t?void 0:t.status)}))?r(!0):e.currentTimelineList.length===(null==t?void 0:t.length)?r(!1):r(!0)}),[t,e]),(0,n.jsx)(ne.Z,Object.assign({onClick:()=>{return e=void 0,t=void 0,n=function*(){yield o((0,d.Qc)()),window.localStorage.removeItem("hourmeterExcavator"),o((0,d.jF)()),location.reload()},new((i=void 0)||(i=Promise))((function(o,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function a(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((n=n.apply(e,t||[])).next())}));var e,t,i,n},disabled:s,startIcon:(0,n.jsx)(ve.Z,{},void 0),variant:"outlined",color:"primary",size:"small"},{children:"Cerrar turno"}),void 0)};const me=()=>{var e,t;const{rowsTimeline:i,hourmeterStart:v,timeslineExcavator:u,statusTimeslineExcavator:m,statusCreateTimelineTruckListExcavator:h}=(0,a.C)(d.tH),g=(0,a.T)(),[j]=(0,z.R)(),{formValuesBtn:f}=(0,a.C)(r.k3),[b]=(0,W.l)(j),[x,E]=(0,l.useState)(!1),[p,O]=(0,l.useState)(U.EnumEvent.UNKNOWN_STATE_EVENT),[S]=P(u.currentTimelineList,m),[T,N]=(0,l.useState)(!1),[y]=(0,ce.r)(h),[C,Z]=(0,$.M)({columnField:"excavator",operatorValue:"contains",value:""}),{value:I}=C;return(0,l.useEffect)((()=>{g((0,d.V)(C))}),[I]),(0,l.useEffect)((()=>{var e,t;(null===(t=null===(e=f.substatus)||void 0===e?void 0:e.event)||void 0===t?void 0:t.id)?N(!1):N(!0)}),[f]),(0,n.jsxs)(o.Z,Object.assign({container:!0,justifyContent:"flex-start",spacing:1,style:{paddingBottom:"20px"},alignItems:"center"},{children:[(0,n.jsx)(o.Z,Object.assign({item:!0,style:{width:"20%"}},{children:(0,n.jsxs)(s.Z,Object.assign({sx:{display:"flex",alignItems:"flex-end"}},{children:[(0,n.jsx)(_.Z,{},void 0),(0,n.jsx)(w.Z,{id:"input-with-sx",label:"Buscar ",variant:"standard",name:"value",onChange:Z,fullWidth:!0},void 0)]}),void 0)}),void 0),(0,n.jsx)(o.Z,Object.assign({item:!0},{children:(0,n.jsx)(oe,{rowsTimelines:i,setevent:O,setOpenEvent:E},void 0)}),void 0),(0,n.jsx)(o.Z,{children:(0,n.jsx)(ue,{},void 0)},void 0),(0,n.jsx)(o.Z,{item:!0},void 0),(0,n.jsx)(o.Z,Object.assign({item:!0},{children:(0,n.jsx)(re,{shift:null===(e=S[0])||void 0===e?void 0:e.shift,date:null===(t=S[0])||void 0===t?void 0:t.date},void 0)}),void 0),(0,n.jsx)(c.a,Object.assign({open:x,handleClose:()=>{E(!1)},handleConfirm:()=>{return e=void 0,t=void 0,n=function*(){yield g((0,d.vd)()),!y&&E(!1);const e={shift:0,date:`${b}T00:00`};yield g((0,d.pW)(e))},new((i=void 0)||(i=Promise))((function(o,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function a(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((n=n.apply(e,t||[])).next())}));var e,t,i,n},title:`Excavator to ${D[p]}  `,disabled:T,loading:y},{children:(0,n.jsx)(ie,{value:p},void 0)}),void 0)]}),void 0)};var he=i(94491),ge=i(41120),je=i(35117);const fe=(0,ge.Z)((()=>(0,je.Z)({line:{width:"100%",minWidth:"100px",height:"1px",border:"0",backgroundColor:"rgba(191,128,11,1)",padding:"1px",margin:"5px"},container:{display:"flex",alignItems:"center"},timeline:{display:"flex",flexWrap:"wrap",flexDirection:"column",WebkitUserSelect:"none"},span:{display:"flex",alignSelf:"start",WebkitUserSelect:"none"}}))),be=({icon:e})=>{const t=fe();return(0,n.jsxs)("div",Object.assign({className:t.container},{children:[e||(0,n.jsx)(he.Z,{htmlColor:"#F2BB13"},void 0),(0,n.jsx)(o.Z,{className:t.line},void 0)]}),void 0)},xe=(0,l.createContext)({}),{Provider:Ee}=xe,pe=({children:e,data:t,setData:i})=>{const o=fe();return(0,n.jsx)(Ee,Object.assign({value:{data:t}},{children:(0,n.jsx)("div",Object.assign({className:o.timeline,onClick:()=>{i()}},{children:e}),void 0)}),void 0)};var Oe=i(22318);const Se=({title:e})=>{const t=fe();return(0,n.jsx)("div",Object.assign({className:t.span},{children:(0,n.jsx)(Oe.Z,Object.assign({variant:"button",display:"block",gutterBottom:!0},{children:e}),void 0)}),void 0)},Te=({title:e,subTitle:t})=>{var i;const{data:o}=(0,l.useContext)(xe);return(0,n.jsxs)(l.Fragment,{children:[(0,n.jsx)(Oe.Z,Object.assign({style:{fontSize:".7rem",fontWeight:700,padding:"0 2rem"},variant:"h6",component:"h6"},{children:e||(null===(i=null==o?void 0:o.title)||void 0===i?void 0:i.toString().toLowerCase())}),void 0),(0,n.jsx)("span",Object.assign({style:{color:"rgba(0, 0, 0, 0.54)",padding:"0 2rem"}},{children:t}),void 0)]},void 0)};var Ne=i(28428),ye=i(2834);const Ce=({currentTimeline:e,updateTimeline:t,startDeleteTimeline:i,setFormUpdateTimeline:o,handleGetTimeline:s,loading:r})=>{var d,c,v,u,m;const h=te(),g=(0,a.T)(),j=new Date(1e3*(null===(d=t.initialTime)||void 0===d?void 0:d.seconds)),f=new Date(1e3*(null===(c=t.finalTime)||void 0===c?void 0:c.seconds)),b=`0${j.getHours()}`,x=`0${j.getMinutes()}`,E=`0${f.getHours()}`,p=`0${f.getMinutes()}`,O=`${b.slice(-2)}:${x.slice(-2)}`,[S]=(0,W.l)(j),T=`${E.slice(-2)}:${p.slice(-2)}`,[N,y]=(0,l.useState)(Object.assign(Object.assign({},t),{date:S,initialHourmeter:null===(v=t.initialHourmeter)||void 0===v?void 0:v.toFixed(2),time:O})),[C,Z]=(0,l.useState)(!1),[I,A]=(0,l.useState)(!1);(0,l.useEffect)((()=>{(null==e?void 0:e.historyShiftList.at(-1).id)===t.id&&Z(!0),(null==e?void 0:e.historyShiftList.at(0).id)===t.id&&Z(!1)}),[t]),(0,l.useEffect)((()=>{(null==e?void 0:e.historyShiftList.at(0).id)===t.id&&A(!0)}),[t]);const k=e=>{y(Object.assign(Object.assign({},N),{[e.target.name]:e.target.value}))},{initialHourmeter:L}=N;return(0,l.useEffect)((()=>(g(o(Object.assign({},N))),()=>{})),[N]),(0,l.useEffect)((()=>()=>{g(o({})),y({})}),[]),(0,n.jsxs)("div",{children:[(0,n.jsxs)("form",Object.assign({className:h.container,noValidate:!0},{children:[(0,n.jsx)(w.Z,{id:"date",name:"date",label:"Fecha",type:"date",defaultValue:N.date,onChange:k,className:h.textField,InputLabelProps:{shrink:!0}},void 0),(0,n.jsx)(w.Z,{id:"date",label:"HOUR",type:"time",name:"time",defaultValue:O,disabled:I,onChange:k,className:h.textField,InputLabelProps:{shrink:!0,required:!0}},void 0),(0,n.jsx)(w.Z,{id:"date",label:"HOUR",type:"time",name:"timeEnd",defaultValue:T,disabled:!0,className:h.textField,InputLabelProps:{shrink:!0,required:!0}},void 0),(0,n.jsx)(w.Z,{id:"date",label:"INITIAL HOURMETER",type:"number",name:"initialHourmeter",disabled:(null===(u=null==t?void 0:t.initialEventState)||void 0===u?void 0:u.event.event.toString())!=U.EnumEvent.MAINTENANCE.toString(),defaultValue:L,onChange:k,className:h.textField,InputLabelProps:{shrink:!0}},void 0),(0,n.jsx)(w.Z,{id:"date",label:"END HOURMETER ",type:"number",name:"initialHourmeter",disabled:!0,defaultValue:null===(m=t.finalHourmeter)||void 0===m?void 0:m.toFixed(2),className:h.textField,InputLabelProps:{shrink:!0}},void 0)]}),void 0),C&&(0,n.jsx)(ye.d,{variant:"contained",onClick:()=>{return e=void 0,t=void 0,o=function*(){yield g(i()),yield s()},new((n=void 0)||(n=Promise))((function(i,s){function l(e){try{r(o.next(e))}catch(e){s(e)}}function a(e){try{r(o.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}r((o=o.apply(e,t||[])).next())}));var e,t,n,o},style:{background:"rgb(154, 0, 54)",color:"white",width:"100%"},startIcon:(0,n.jsx)(Ne.Z,{},void 0),loading:r,text:"Delete"},void 0)]},void 0)};var Ze=i(89958),we=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function a(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const Ie=({setClose:e})=>{var t,i;const{statusTimeslineExcavator:s,currentTimeline:r,updateTimeline:v,statusUpdateTimelineExcavator:u}=(0,a.C)(d.tH),m=(0,a.T)(),[h,g]=(0,l.useState)(!1),[j]=(0,Ze.M)(),[f]=(0,ce.r)(u),b=(0,l.useCallback)((()=>{g(!1),m((0,d.zX)({}))}),[]),x=(0,l.useCallback)((()=>we(void 0,void 0,void 0,(function*(){yield m((0,d.NT)()),m((0,d.zX)({})),s===H.JD.DONE&&(g(!1),e(!1)),yield m((0,d.pW)(j))}))),[]),E=(0,l.useCallback)((()=>we(void 0,void 0,void 0,(function*(){m((0,d.zX)({})),s===H.JD.DONE&&(g(!1),e(!1)),yield m((0,d.pW)(j))}))),[]);return(0,n.jsxs)(o.Z,Object.assign({container:!0,alignItems:"flex-end"},{children:[null==r?void 0:r.historyShiftList.map((e=>{var t,i,o,s,l,a,r;let c=new Date(1e3*(null===(t=e.initialTime)||void 0===t?void 0:t.seconds)).toLocaleString();return(0,n.jsxs)(pe,Object.assign({data:e,setData:()=>(e=>{m((0,d.zX)(e)),g(!0)})(e)},{children:[(0,n.jsx)(Te,{title:(null===(o=null===(i=e.initialEventState)||void 0===i?void 0:i.event)||void 0===o?void 0:o.name)?null===(l=null===(s=e.initialEventState)||void 0===s?void 0:s.event)||void 0===l?void 0:l.name:"",subTitle:(null===(a=e.initialEventState)||void 0===a?void 0:a.name)?null===(r=e.initialEventState)||void 0===r?void 0:r.name.toString().toLowerCase():""},void 0),(0,n.jsx)(be,{},void 0),(0,n.jsx)(Se,{title:c.toLocaleString().split(" ")[1].substring(0,c.split(" ")[1].length-3)},void 0)]}),e.id+Math.random())})),(0,n.jsx)(c.a,Object.assign({open:h,handleClose:b,handleConfirm:x,title:`Update Timeline ${new Date(1e3*(null===(t=v.initialTime)||void 0===t?void 0:t.seconds)).toLocaleString().split(" ")[1].substring(0,new Date(1e3*(null===(i=v.initialTime)||void 0===i?void 0:i.seconds)).toLocaleString().split(" ")[1].length-3)}`,loading:f},{children:(0,n.jsx)(Ce,{currentTimeline:r,updateTimeline:v,startDeleteTimeline:d.T1,setFormUpdateTimeline:d.mP,handleGetTimeline:E},void 0)}),void 0)]}),void 0)},Ae=(e,t)=>{const i=Number.parseFloat(e)+Number.parseFloat(t);return Number.parseFloat(i.toFixed(2))},ke=l.memo((({setstateform:e,isDisabled:t,setisManto:i,handleIsManto:o})=>{const{eventList:s}=(0,a.C)(N.yJ),r=(0,a.T)(),[d,c]=(0,l.useState)({status:U.EnumEvent.UNKNOWN_STATE_EVENT,Substatus:{id:"",name:"",eventState:0,event:{id:"",name:"",event:0}}}),v=e=>{d.status!=U.EnumEvent.MAINTENANCE?c(Object.assign(Object.assign({},d),{[e.target.name]:e.target.value})):c(Object.assign(Object.assign({},d),{[e.target.name]:e.target.value}))},u=()=>{c(Object.assign(Object.assign({},d),{Substatus:{id:"",name:"",eventState:0,event:{id:"",name:"",event:0}}})),i(!1)},[m]=(e=>{const[t,i]=(0,l.useState)(!0),[n,o]=(0,l.useState)(!0),[s,a]=(0,l.useState)(!0),[r,d]=(0,l.useState)(!0);return(0,l.useEffect)((()=>{e.toString()===U.EnumEvent.OPERATIONAL.toString()&&(i(!1),a(!1),d(!1),o(!0)),e.toString()===U.EnumEvent.UNKNOWN_STATE_EVENT.toString()&&(i(!1),o(!1),a(!1),d(!1)),e.toString()===U.EnumEvent.NO_OPERATIONAL.toString()&&(d(!1),o(!1),a(!1),i(!0)),e.toString()===U.EnumEvent.OPERATIONAL_DELAY.toString()&&(o(!1),a(!0),i(!0),d(!0)),e.toString()===U.EnumEvent.MAINTENANCE.toString()&&(i(!1),o(!1),a(!0),d(!0))}),[e]),[e=>{var i=!1;return e===U.EnumEvent.OPERATIONAL_DELAY&&(i=s),e===U.EnumEvent.OPERATIONAL&&(i=n),e===U.EnumEvent.NO_OPERATIONAL&&(i=t),e===U.EnumEvent.MAINTENANCE&&(i=r),i}]})(t);return(0,l.useEffect)((()=>{e(d)}),[d]),(0,l.useEffect)((()=>{r((0,T.TU)())}),[]),(0,n.jsxs)(V.Z,Object.assign({component:"fieldset"},{children:[(0,n.jsx)(K.Z,Object.assign({component:"legend"},{children:"Opciones"}),void 0),(0,n.jsx)(G.Z,Object.assign({defaultValue:"female","aria-label":"hourmeter",name:"customized-radios"},{children:null==s?void 0:s.map((e=>{var t,i;return(null==e?void 0:e.event.toString())===U.EnumEvent.MAINTENANCE.toString()?(0,n.jsx)(B.Z,{value:null==e?void 0:e.event,control:(0,n.jsx)(J.Z,{icon:(0,n.jsx)(Y.Z,{},void 0),checkedIcon:(0,n.jsx)(Y.Z,{},void 0),name:"status",onClick:()=>o(),onChange:v,checked:d.status.toString()===(null===(t=null==e?void 0:e.event)||void 0===t?void 0:t.toString()),disabled:m(null==e?void 0:e.event)},void 0),label:null==e?void 0:e.name},null==e?void 0:e.id):(0,n.jsx)(B.Z,{value:null==e?void 0:e.event,onClick:u,control:(0,n.jsx)(J.Z,{icon:(0,n.jsx)(Y.Z,{},void 0),checkedIcon:(0,n.jsx)(Y.Z,{},void 0),name:"status",checked:d.status.toString()===(null===(i=null==e?void 0:e.event)||void 0===i?void 0:i.toString()),disabled:m(null==e?void 0:e.event),onClick:u,onChange:v},void 0),label:null==e?void 0:e.name},null==e?void 0:e.id)}))}),void 0)]}),void 0)})),Le=l.memo((({currentTimeline:e,handleConfirm:t})=>{var i,d,c,v,u,m,h;const g=te(),j=(0,a.T)(),[f,b]=(0,l.useState)(0),[x,E]=(0,l.useState)(!1),p=new Date,O=`0${p.getHours()}`,S=`0${p.getMinutes()}`,[T]=(0,W.l)(new Date),[N,y]=(0,l.useState)({time:`${O.slice(-2)}:${S.slice(-2)}`,date:T,hourmeterEnd:0===(null===(i=null==e?void 0:e.historyShiftList)||void 0===i?void 0:i.length)?0:null===(c=null===(d=null==e?void 0:e.historyShiftList)||void 0===d?void 0:d.at(-1).initialHourmeter)||void 0===c?void 0:c.toFixed(1),htm:0,status:U.EnumEvent.UNKNOWN_STATE_EVENT,Substatus:{id:"",name:"",eventState:U.EnumEvent.UNKNOWN_STATE_EVENT,event:{id:"",name:"",event:U.EnumEvent.UNKNOWN_STATE_EVENT}},currentTimeline:e}),C=(null===(u=null===(v=null==e?void 0:e.eventState)||void 0===v?void 0:v.event)||void 0===u?void 0:u.event)?null===(h=null===(m=null==e?void 0:e.eventState)||void 0===m?void 0:m.event)||void 0===h?void 0:h.event:U.EnumEvent.UNKNOWN_STATE_EVENT,{time:Z,hourmeterEnd:I}=N,A=function(e,t){var i,n,o;if(0===(null===(i=null==t?void 0:t.historyShiftList)||void 0===i?void 0:i.length))return 0;{const i=null===(n=null==t?void 0:t.historyShiftList)||void 0===n?void 0:n.at(-1),l=new Date(e),a=new Date(1e3*(null===(o=null==i?void 0:i.initialTime)||void 0===o?void 0:o.seconds));var s=(l.getTime()-a.getTime())/1e3;return 1/60*Math.ceil(s/60)}}(`${N.date}T${Z}`,e),[k,L]=(0,l.useState)({id:"",name:"",eventState:0,event:{id:"",name:"",event:0}}),[D,F]=(0,l.useState)({}),H=e=>{N.status!=U.EnumEvent.MAINTENANCE?y(Object.assign(Object.assign({},N),{[e.target.name]:e.target.value})):y(Object.assign(Object.assign({},N),{[e.target.name]:e.target.value}))};return(0,l.useEffect)((()=>(j((0,r.$6)(N)),()=>{})),[N]),console.log("form",N),(0,l.useEffect)((()=>(b(Ae(I,A)),()=>{j((0,r.J$)())})),[]),(0,l.useEffect)((()=>{var t,i,n,o,s;(null===(t=null==e?void 0:e.state)||void 0===t?void 0:t.toString())===U.EnumEvent.UNKNOWN_STATE_EVENT.toString()?b(I):(null===(o=null===(n=null===(i=null==e?void 0:e.eventState)||void 0===i?void 0:i.event)||void 0===n?void 0:n.event)||void 0===o?void 0:o.toString())===U.EnumEvent.NO_OPERATIONAL.toString()?b(null==e?void 0:e.hourmeterCurrent):b(Ae(I,A)),(null===(s=null==e?void 0:e.state)||void 0===s?void 0:s.toString())===U.EnumEvent.MAINTENANCE.toString()&&y(Object.assign(Object.assign({},N),{htm:null==e?void 0:e.hourmeterCurrent})),N.status!=U.EnumEvent.MAINTENANCE&&y(Object.assign(Object.assign({},N),{htm:f}))}),[Z,N.date]),(0,l.useEffect)((()=>{y(Object.assign(Object.assign({},N),{Substatus:Object.assign({},k)}))}),[k]),(0,l.useEffect)((()=>{y(Object.assign(Object.assign({},N),D))}),[D]),(0,l.useEffect)((()=>{const e=setTimeout((()=>{y(Object.assign(Object.assign({},N),{htm:f}))}),9);return()=>clearTimeout(e)}),[f]),(0,n.jsxs)(s.Z,Object.assign({component:"form",onSubmit:e=>{alert("d")}},{children:[(0,n.jsxs)(o.Z,Object.assign({container:!0,spacing:1},{children:[(0,n.jsx)(o.Z,Object.assign({item:!0,lg:6,md:6,sm:6,xs:12},{children:(0,n.jsxs)(s.Z,Object.assign({className:g.container},{children:[(0,n.jsx)(w.Z,{id:"date",name:"date",label:"Fecha",type:"date",defaultValue:N.date,onChange:H,className:g.textField,InputLabelProps:{shrink:!0}},void 0),(0,n.jsx)(w.Z,{id:"date",label:"Hora",type:"time",name:"time",value:Z,onChange:H,className:g.textField,InputLabelProps:{shrink:!0,required:!0}},void 0),(0,n.jsx)(w.Z,{id:"date",label:"Horometro",type:"number",disabled:!0,name:"hourmeterCalculated",value:f,onChange:H,className:g.textField,InputLabelProps:{shrink:!0}},void 0),(C===U.EnumEvent.MAINTENANCE||x)&&(0,n.jsx)(w.Z,{autoFocus:!0,id:"date",label:"Horometro inicial",type:"number",name:"htm",defaultValue:f,onChange:H,className:g.textField,InputLabelProps:{shrink:!0,required:!0}},void 0)]}),void 0)}),void 0),(0,n.jsx)(o.Z,Object.assign({item:!0,lg:6,md:6,sm:6,xs:12},{children:(0,n.jsx)(ke,{setstateform:F,isDisabled:C,setisManto:E,handleIsManto:e=>{E(!0),y(Object.assign(Object.assign({},N),{htm:f,status:U.EnumEvent.MAINTENANCE,Substatus:{id:"",name:"",eventState:U.EnumEvent.UNKNOWN_STATE_EVENT,event:{id:"",name:"",event:U.EnumEvent.UNKNOWN_STATE_EVENT}}}))}},void 0)}),void 0)]}),void 0),(0,n.jsx)(o.Z,Object.assign({container:!0,spacing:2},{children:!!N.status&&(0,n.jsx)(o.Z,Object.assign({item:!0,lg:12,md:12,sm:12,xs:12},{children:(0,n.jsx)(X,{setEventState:L,event:N.status},void 0)}),void 0)}),void 0)]}),void 0)})),De=e=>{const[t,i]=(0,l.useState)(!0);return(0,l.useEffect)((()=>{var t,n;e.status&&(null===(n=null===(t=e.Substatus)||void 0===t?void 0:t.event)||void 0===n?void 0:n.id)?i(!1):i(!0)}),[e.status,e.Substatus]),[t]};var Fe=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function a(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const He=()=>{const e=(0,a.T)(),{timelineErrorList:t,currentTimeline:i,statusCreateTimelineExcavator:v}=(0,a.C)(d.tH),{formValues:u}=(0,a.C)(r.k3),[m]=(0,Ze.M)(),[g,j]=(0,l.useState)(!1),[f,b]=(0,l.useState)(!1),[x]=De(u),[E,p]=(0,l.useState)([]),[O]=(0,ce.r)(v),S=(0,l.useCallback)((()=>{j(!1),b(!1)}),[]);(0,l.useEffect)((()=>(e((0,d.pW)(m)),()=>{})),[]);const T=()=>Fe(void 0,void 0,void 0,(function*(){yield e((0,d.SN)()),!O&&j(!1),yield function(){return Fe(this,void 0,void 0,(function*(){yield e((0,d.pW)(m))}))}()}));return(0,l.useEffect)((()=>{e((0,d.gc)(E))}),[E]),(0,n.jsxs)(s.Z,Object.assign({m:2,p:.5,style:{height:"100%"}},{children:[(0,n.jsx)(o.Z,{children:(0,n.jsx)(me,{},void 0)},void 0),(0,n.jsx)(o.Z,Object.assign({container:!0,style:{height:"100%"}},{children:(0,n.jsx)(o.Z,Object.assign({item:!0,lg:12,md:12,sm:12,xs:12},{children:(0,n.jsx)(R,{setOpen:j,setTimelineCurrent:p,setOpenTimeline:b},void 0)}),void 0)}),void 0),(0,n.jsx)(c.a,Object.assign({open:g,handleClose:S,handleConfirm:T,title:`Excavadora  ${E.deviceAlias}  `,disabled:x,loading:O},{children:(0,n.jsx)(Le,{handleConfirm:T,currentTimeline:i},void 0)}),void 0),(0,n.jsx)(c.a,Object.assign({open:f,handleClose:S,title:`Linea de tiempo de la excavadora  ${E.deviceAlias} `,disabled:x},{children:(0,n.jsx)(Ie,{setClose:b},void 0)}),void 0),!(null==t?void 0:t.success)&&(0,n.jsx)(h,{error:null==t?void 0:t.errorsList},void 0)]}),void 0)};var Pe=i(83945),Me=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function a(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const Re=({setClose:e})=>{var t,i;const{status:s,currentTimeline:r,updateTimeline:d,statusUpdateTimeline:v,statusDeleteTimeline:u}=(0,a.C)(Pe.rf),m=(0,a.T)(),[h,g]=(0,l.useState)(!1),[j]=(0,z.R)(),[f]=(0,W.l)(j),[b]=(0,ce.r)(v),[x]=(0,ce.r)(u),[E]=(0,Ze.M)(),p=(0,l.useCallback)((()=>{g(!1),m((0,Pe.Uy)({}))}),[]),O=(0,l.useCallback)((()=>Me(void 0,void 0,void 0,(function*(){yield m((0,Pe.ft)({})),m((0,Pe.Uy)({})),!1===b&&(g(!1),e(!1),yield m((0,Pe.mA)(E)))}))),[]),S=(0,l.useCallback)((()=>Me(void 0,void 0,void 0,(function*(){yield m((0,Pe.Uy)({})),!1===x&&(g(!1),e(!1),yield m((0,Pe.mA)(E)))}))),[]);return(0,n.jsxs)(o.Z,Object.assign({container:!0,alignItems:"flex-end"},{children:[null==r?void 0:r.historyShiftList.map((e=>{var t,i,o,s,l,a,r;let d=new Date(1e3*(null===(t=e.initialTime)||void 0===t?void 0:t.seconds)).toLocaleString();return(0,n.jsxs)(pe,Object.assign({data:e,setData:()=>(e=>{m((0,Pe.Uy)(e)),g(!0)})(e)},{children:[(0,n.jsx)(Te,{title:(null===(o=null===(i=null==e?void 0:e.initialEventState)||void 0===i?void 0:i.event)||void 0===o?void 0:o.name)?null===(l=null===(s=null==e?void 0:e.initialEventState)||void 0===s?void 0:s.event)||void 0===l?void 0:l.name:null,subTitle:(null===(a=null==e?void 0:e.initialEventState)||void 0===a?void 0:a.name)?`${null===(r=null==e?void 0:e.initialEventState)||void 0===r?void 0:r.name.toString().toLowerCase()}`:""},void 0),(0,n.jsx)(be,{},void 0),(0,n.jsx)(Se,{title:d.toLocaleString().split(" ")[1].substring(0,d.split(" ")[1].length-3)},void 0)]}),e.id+Math.random())})),(0,n.jsx)(c.a,Object.assign({open:h,handleClose:p,handleConfirm:O,title:`Update  ${new Date(1e3*(null===(t=d.initialTime)||void 0===t?void 0:t.seconds)).toLocaleString().split(" ")[1].substring(0,new Date(1e3*(null===(i=d.initialTime)||void 0===i?void 0:i.seconds)).toLocaleString().split(" ")[1].length-3)}`,loading:b},{children:(0,n.jsx)(Ce,{currentTimeline:r,updateTimeline:d,startDeleteTimeline:Pe.a8,setFormUpdateTimeline:Pe.Zp,handleGetTimeline:S,loading:x},void 0)}),void 0)]}),void 0)},_e=(e,t)=>{const[i,n]=(0,l.useState)([]);return(0,l.useEffect)((()=>{t===H.JD.DONE?n(null==e?void 0:e.map(((e,t)=>{var i,n,o,s,l,a,r,d,c,v,u,m,h,g,j,f;return Object.assign(Object.assign({},e),{tabIndex:t,id:e.deviceId,truck:e.deviceAlias,status:`${(null===(n=null===(i=e.eventState)||void 0===i?void 0:i.event)||void 0===n?void 0:n.name)?null===(s=null===(o=e.eventState)||void 0===o?void 0:o.event)||void 0===s?void 0:s.name.substring(0,3):""}  ${(null===(l=e.eventState)||void 0===l?void 0:l.name)?` - ${null===(a=e.eventState)||void 0===a?void 0:a.name.toString().toLowerCase()}`:""}`,statusEvent:null===(d=null===(r=e.eventState)||void 0===r?void 0:r.event)||void 0===d?void 0:d.event,hmtStart:null===(c=e.historyShiftList[0])||void 0===c?void 0:c.initialHourmeter.toFixed(2),hourmeterCurrent:null===(v=e.historyShiftList.at(-1))||void 0===v?void 0:v.initialHourmeter.toFixed(2),shift:F[null===(u=e.currentTimeline)||void 0===u?void 0:u.shift],date:new Date(1e3*(null===(h=null===(m=e.currentTimeline)||void 0===m?void 0:m.shiftDate)||void 0===h?void 0:h.seconds)).toLocaleDateString(),adjustment:(null===(g=e.currentTimeline)||void 0===g?void 0:g.adjustment)?e.currentTimeline.adjustment:0,statusAdjustment:!!(null===(j=e.currentTimeline)||void 0===j?void 0:j.status)&&(null===(f=e.currentTimeline)||void 0===f?void 0:f.status)})}))):n([])}),[e,t]),[i,n]};const $e=()=>{const{timesline:e,rowsEditModelHourmeterTruck:t}=(0,a.C)(Pe.rf),{currentTimelineList:i}=e,o=(0,a.T)(),[s,r]=(0,l.useState)(!0);return(0,l.useEffect)((()=>{i.some((e=>{var t;return!1===(null===(t=e.currentTimeline)||void 0===t?void 0:t.status)}))?r(!0):i.length===(null==t?void 0:t.length)?r(!1):r(!0)}),[i,t]),(0,n.jsx)(ne.Z,Object.assign({onClick:()=>{return e=void 0,t=void 0,n=function*(){yield o((0,Pe.nx)()),window.localStorage.removeItem("hourmeterTruck"),o((0,Pe.zq)()),location.reload()},new((i=void 0)||(i=Promise))((function(o,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function a(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((n=n.apply(e,t||[])).next())}));var e,t,i,n},disabled:s,startIcon:(0,n.jsx)(ve.Z,{},void 0),variant:"outlined",color:"primary",size:"small"},{children:"Cerrar turno"}),void 0)};const ze=()=>{var e,t;const{rowsTimeline:i,timesline:d,status:v,statusCreateTimelineTruckListtruck:u}=(0,a.C)(Pe.rf),{formValuesBtn:m}=(0,a.C)(r.k3),h=(0,a.T)(),[g]=(0,z.R)(),[j]=_e(d.currentTimelineList,v),[f]=(0,W.l)(g),[b,x]=(0,l.useState)(!1),[E,p]=(0,l.useState)(U.EnumEvent.UNKNOWN_STATE_EVENT),[O,S]=(0,l.useState)(!1),[T]=(0,ce.r)(u),N=(0,l.useRef)(),[y]=((e,t)=>{const[i,n]=l.useState("");return l.useEffect((()=>{const t=t=>{n(t.key),(t.altKey&&t.key===e.toUpperCase()||t.altKey&&t.key===e.toLocaleLowerCase()||t.altKey&&t.key===e)&&(()=>{var e;null===(e=null==N?void 0:N.current)||void 0===e||e.focus()})()};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}}),[]),[i]})("B"),[C,Z]=(0,$.M)({columnField:"truck",operatorValue:"contains",value:""}),{value:I}=C;return(0,l.useEffect)((()=>{h((0,Pe.V)(C))}),[I]),(0,l.useEffect)((()=>{var e,t;(null===(t=null===(e=m.substatus)||void 0===e?void 0:e.event)||void 0===t?void 0:t.id)?S(!1):S(!0)}),[m]),(0,n.jsxs)(o.Z,Object.assign({container:!0,spacing:1,justifyContent:"flex-start",style:{paddingBottom:"20px"},alignItems:"center"},{children:[(0,n.jsx)(o.Z,Object.assign({item:!0,style:{width:"20%"}},{children:(0,n.jsxs)(s.Z,Object.assign({sx:{display:"flex",alignItems:"flex-end"}},{children:[(0,n.jsx)(_.Z,{},void 0),(0,n.jsx)(w.Z,{focused:!1,inputRef:N,id:"input-with-sx",label:"Buscar ",variant:"standard",name:"value",onChange:Z,fullWidth:!0},void 0)]}),void 0)}),void 0),(0,n.jsx)(oe,{rowsTimelines:i,setevent:p,setOpenEvent:x},void 0),(0,n.jsx)(o.Z,Object.assign({item:!0},{children:(0,n.jsx)($e,{},void 0)}),void 0),(0,n.jsx)(o.Z,Object.assign({item:!0},{children:(0,n.jsx)(de,{shift:null===(e=j[0])||void 0===e?void 0:e.shift,date:null===(t=j[0])||void 0===t?void 0:t.date},void 0)}),void 0),(0,n.jsx)(c.a,Object.assign({open:b,handleClose:()=>{x(!1)},handleConfirm:()=>{return e=void 0,t=void 0,n=function*(){yield h((0,Pe._C)()),!T&&x(!1);const e={shift:0,date:`${f}T00:00`};yield h((0,Pe.mA)(e))},new((i=void 0)||(i=Promise))((function(o,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function a(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((n=n.apply(e,t||[])).next())}));var e,t,i,n},title:`Truck to ${D[E]}  `,disabled:O,loading:T},{children:(0,n.jsx)(ie,{value:E},void 0)}),void 0)]}),void 0)};function We(){const[e]=y(),[t,i]=l.useState(null),o=Boolean(t),[s]=C(Pe.V,i);return(0,n.jsxs)(l.Fragment,{children:[(0,n.jsx)(b.Z,Object.assign({style:{padding:"0px",margin:"5px"},"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:e=>{i(e.currentTarget)}},{children:(0,n.jsx)(S.Z,{},void 0)}),void 0),(0,n.jsx)(p.Z,Object.assign({id:"long-menu",anchorEl:t,keepMounted:!0,open:o,onClose:()=>s("NONE"),PaperProps:{style:{maxHeight:216,width:"20ch"}}},{children:e.map((e=>(0,n.jsx)(O.Z,Object.assign({onClick:()=>s(e.event.toString())},{children:e.name}),e.name)))}),void 0)]},void 0)}const Ue=({row:e})=>{var t,i,o,r,d,c,v;const[u,m]=(0,I._)("hourmeterTruck",{}),[h]=(0,Ze.M)(),g=(0,a.T)(),j=t=>{t.preventDefault();const i=new FormData(t.currentTarget),n={};n[e.deviceId]={value:i.get("hourmeter"),color:"rgba(157, 255, 118, 0.49)"},(e=>{const t=JSON.parse(window.localStorage.getItem("hourmeterTruck")),i=Object.assign(t,e);m(Object.assign({},i))})(n),"UNKNOWN_SHIFT"!==e.shift&&g((0,Pe.Ir)(Object.assign(Object.assign({},e),{hourmeter:i.get("hourmeter")})))};return(0,l.useEffect)((()=>{g((0,Pe.H3)(u))}),[u]),(0,n.jsx)(s.Z,Object.assign({component:"form",tabIndex:e.tabindex,onSubmit:j,sx:{mt:1}},{children:(0,n.jsx)(w.Z,{disabled:1===(null===(t=null==e?void 0:e.historyShiftList)||void 0===t?void 0:t.length)&&(null===(o=null===(i=null==e?void 0:e.eventState)||void 0===i?void 0:i.event)||void 0===o?void 0:o.event)===U.EnumEvent.NO_OPERATIONAL,style:{background:(null===(r=u[e.deviceId])||void 0===r?void 0:r.color)?null===(d=u[e.deviceId])||void 0===d?void 0:d.color:""},onBlur:e=>j(e),autoComplete:"off",inputProps:{pattern:"^[0-9]+([.][0-9]+)?$"},name:"hourmeter",id:"hourmeter",defaultValue:(null===(c=u[e.deviceId])||void 0===c?void 0:c.value)?null===(v=u[e.deviceId])||void 0===v?void 0:v.value:e.hourmeterCurrent},void 0)}),void 0)},Ve=(e,t,i,o)=>[Object.assign(Object.assign({},g.mf9),{width:70,align:"left",renderHeader:e=>(0,n.jsxs)(l.Fragment,{children:[(0,n.jsx)(g.KOw,Object.assign({},e),void 0),(0,n.jsx)(We,{},void 0)]},void 0)}),{field:"truck",headerName:"CamiÃ³n",hideSortIcons:!0},{field:"shift",headerName:"Turno",hideSortIcons:!0,width:60,renderCell:({row:e})=>(0,n.jsx)(f.ZP,Object.assign({title:e.shift},{children:(0,n.jsx)("p",{children:e.shift},void 0)}),void 0)},{field:"statusEvent",headerName:"Evento",type:"string",hide:!0},{field:"status",headerName:"Estado",width:100,hideSortIcons:!0,renderCell:({row:e})=>(0,n.jsx)(f.ZP,Object.assign({title:e.status?e.status:void 0},{children:(0,n.jsx)("p",{children:e.status?e.status:void 0},void 0)}),void 0)},{field:"hmtStart",headerName:"Horometro",editable:!1,type:"number",hideSortIcons:!0},{field:"hourmeterCurrent",headerName:"Horometro actual",editable:!o,type:"number",hideSortIcons:!0},{field:"hourmeterend",headerName:"Horometro Final",cellClassName:"super-app-theme--cell",hideSortIcons:!0,renderCell:({row:e})=>(0,n.jsx)(Ue,{row:e},void 0)},{field:"adjustment",headerName:"Ajuste",type:"number",width:60,hideSortIcons:!0},{field:"Opciones",headerName:"Opc",minWidth:110,hideSortIcons:!0,renderCell:({row:o})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.ZP,Object.assign({onClick:()=>{t(o),e(!0)},title:"Add timeline"},{children:(0,n.jsx)(b.Z,Object.assign({size:"small"},{children:(0,n.jsx)(E.Z,{color:"primary",fontSize:"small"},void 0)}),void 0)}),void 0),(0,n.jsx)(f.ZP,Object.assign({onClick:()=>{t(o),i(!0)},title:"View Timeline"},{children:(0,n.jsx)(b.Z,Object.assign({size:"small"},{children:(0,n.jsx)(x.Z,{htmlColor:"Green",fontSize:"small"},void 0)}),void 0)}),void 0)]},void 0)}],Ke=l.memo((({setOpen:e,setTimelineCurrent:t,setOpenTimeline:i})=>{const o=(0,j.b)(),s=(0,a.T)(),{status:r,filterDataGrid:d,statusUpdateInitialHourmeterTimeline:c,isEditableRows:v,timesline:u,oneTimelimeUpdate:m}=(0,a.C)(Pe.rf),[h,f]=_e(u.currentTimelineList,r),[b,x]=l.useState([]),{sortModel:E}=L("truck","asc"),[p,O]=(0,l.useState)({});return(0,l.useEffect)((()=>{((e,t,i)=>{var n,o,s,l,a,r,d,c,v,u,m,h,g,j,f,b,x;if(t){x=Object.assign(Object.assign({},t),{id:t.deviceId,truck:t.deviceAlias,status:`${(null===(o=null===(n=t.eventState)||void 0===n?void 0:n.event)||void 0===o?void 0:o.name)?null===(l=null===(s=t.eventState)||void 0===s?void 0:s.event)||void 0===l?void 0:l.name.substring(0,3):""}  ${(null===(a=t.eventState)||void 0===a?void 0:a.name)?` - ${null===(r=t.eventState)||void 0===r?void 0:r.name.toString().toLowerCase()}`:""}`,statusEvent:null===(c=null===(d=t.eventState)||void 0===d?void 0:d.event)||void 0===c?void 0:c.event,hmtStart:null===(v=t.historyShiftList[0])||void 0===v?void 0:v.initialHourmeter.toFixed(2),hourmeterCurrent:null===(u=t.historyShiftList.at(-1))||void 0===u?void 0:u.initialHourmeter.toFixed(2),shift:F[null===(m=t.currentTimeline)||void 0===m?void 0:m.shift],date:new Date(1e3*(null===(g=null===(h=t.currentTimeline)||void 0===h?void 0:h.shiftDate)||void 0===g?void 0:g.seconds)).toLocaleDateString(),adjustment:(null===(j=t.currentTimeline)||void 0===j?void 0:j.adjustment)?t.currentTimeline.adjustment:0,statusAdjustment:!!(null===(f=t.currentTimeline)||void 0===f?void 0:f.status)&&(null===(b=t.currentTimeline)||void 0===b?void 0:b.status)});const E=e.findIndex((e=>e.id===x.id)),p=[...e];E>=0&&(p[E]=x),i([...p])}})(h,m.currentTimeline,f)}),[m]),(0,n.jsx)("div",Object.assign({style:{height:"1150px",overflowY:"scroll",display:"flex",flexDirection:"column"}},{children:(0,n.jsx)(g._$r,{className:o.root,rowHeight:30,rows:h,columns:Ve(e,t,i,v),density:"compact",checkboxSelection:!0,disableSelectionOnClick:!0,sortModel:E,onSelectionModelChange:e=>(e=>{const t=new Set(e),i=h.filter((e=>t.has(e.id.toString())));s((0,Pe.Xm)(i))})(e),disableColumnMenu:!0,editRowsModel:p,onEditRowsModelChange:e=>(e=>{var t="";for(var[i,n]of Object.entries(e))Object.keys(n).length<=1&&Object.keys(n).forEach((e=>{t=e}));var o=Object.assign({},e);switch(t){case"hourmeterCurrent":O(Object.assign(Object.assign({},p),o));break;case"hmtStart":M(o,O,Pe.SZ)}})(e),filterModel:{items:[d]},getRowClassName:e=>`super-app-theme--${e.row.statusAdjustment}`,onCellEditStop:(e,t)=>{console.log(e),alert("params")}},void 0)}),void 0)}));var Ge=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function a(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const Be=()=>{const e=(0,a.T)(),{status:t,timelineErrorList:i,currentTimeline:d,statusCreateTimeline:v}=(0,a.C)(Pe.rf),{formValues:u}=(0,a.C)(r.k3),[m]=(0,Ze.M)(),[g,j]=(0,l.useState)(!1),[f,b]=(0,l.useState)(!1),[x]=De(u),[E,p]=(0,l.useState)([]),[O]=(0,ce.r)(v),S=(0,l.useCallback)((()=>{j(!1),b(!1)}),[]);(0,l.useEffect)((()=>(e((0,Pe.mA)(m)),()=>{e((0,Pe.gI)())})),[]);const T=()=>Ge(void 0,void 0,void 0,(function*(){yield e((0,Pe.Sp)()),!O&&j(!1),yield function(){return Ge(this,void 0,void 0,(function*(){yield e((0,Pe.mA)(m))}))}()}));return(0,l.useEffect)((()=>{e((0,Pe.jO)(E))}),[E]),(0,n.jsxs)(s.Z,Object.assign({m:2,p:.5,style:{height:"100%"}},{children:[(0,n.jsx)(o.Z,{children:(0,n.jsx)(ze,{},void 0)},void 0),(0,n.jsx)(o.Z,Object.assign({container:!0,style:{height:"100%"}},{children:(0,n.jsx)(o.Z,Object.assign({item:!0,lg:12,md:12,sm:12,xs:12},{children:(0,n.jsx)(Ke,{setOpen:j,setTimelineCurrent:p,setOpenTimeline:b},void 0)}),void 0)}),void 0),(0,n.jsx)(c.a,Object.assign({open:g,handleClose:S,handleConfirm:T,title:`CamiÃ³n  ${E.truck}  `,disabled:x,loading:O},{children:(0,n.jsx)(Le,{handleConfirm:T,currentTimeline:d},void 0)}),void 0),(0,n.jsx)(c.a,Object.assign({open:f,handleClose:S,title:`Linea de tiempo del camiÃ³n ${E.truck} `,disabled:x,maxWidth:"lg"},{children:(0,n.jsx)(Re,{setClose:b},void 0)}),void 0),t===H.JD.DONE&&!(null==i?void 0:i.success)&&(0,n.jsx)(h,{error:null==i?void 0:i.errorsList},void 0)]}),void 0)},Je=()=>(0,n.jsxs)(o.Z,Object.assign({container:!0},{children:[(0,n.jsx)(o.Z,Object.assign({item:!0,lg:6},{children:(0,n.jsx)(Be,{},void 0)}),void 0),(0,n.jsx)(o.Z,Object.assign({item:!0,lg:6},{children:(0,n.jsx)(He,{},void 0)}),void 0)]}),void 0);var Ye=i(49521);const qe=()=>(0,n.jsxs)("div",{children:[(0,n.jsx)(Ye.h,{title:"Hourmeter"},void 0),(0,n.jsx)("div",Object.assign({style:{marginTop:"60px"}},{children:(0,n.jsx)(Je,{},void 0)}),void 0)]},void 0),Xe=qe},38581:(e,t,i)=>{i.r(t),i.d(t,{HourmeterView:()=>He,default:()=>Pe});var n=i(85893),o=i(71267),s=i(13258),l=i(41749),a=i(67162),r=i(30553),d=i(40074),c=i(282),v=i(67294),u=i(88093),m=i(73855),h=i(56731),g=i(93068),j=i(38062),f=i(29829),b=i(85639),x=i(24837),E=i(96617),p=i(20170),O=i(79895),S=i(52387),T=i(81605),N=i(93584),y=i(95090),C=i(78479),Z=i(49032),w=i(67774),I=i(97700);const A=43200,k=e=>{new Date;const[t]=(0,u.R)();t.getHours()>=7&&t.getHours()<19?(t.setHours(7),t.setSeconds(0),t.setMinutes(0),t.setMilliseconds(0)):(t.setHours(19),t.setSeconds(0),t.setMinutes(0),t.setMilliseconds(0));const i=((new Date).getTime()-t.getTime())/1e3;return{flex:i/A||0,time:i}},L=e=>{if(e&&e.initialEventState&&e.initialEventState.event)switch(e.initialEventState.event.event){case Z.EnumEvent.MAINTENANCE:return"#FF0000";case Z.EnumEvent.OPERATIONAL:return"#069B15";case Z.EnumEvent.NO_OPERATIONAL:return"#F1C012";case Z.EnumEvent.OPERATIONAL_DELAY:return"#0000FF"}return"#fff"},D=e=>{switch(e){case Z.EnumEvent.MAINTENANCE:return"#FF0000";case Z.EnumEvent.OPERATIONAL:return"#069B15";case Z.EnumEvent.NO_OPERATIONAL:return"#F1C012";case Z.EnumEvent.OPERATIONAL_DELAY:return"#0000FF"}},F=e=>`${`0${e.getHours()}`.slice(-2)}:${`0${e.getMinutes()}`.slice(-2)}`;var H=i(41120),P=i(35117),M=i(89452),R=i(8286),_=i(62822),$=i(50998),z=i(95757),W=i(78721),U=i(19238),V=i(17684),K=i(89958);const G=({handlePopoverClose:e,eventSelect:t})=>{var i,o,s;const{dateShiftSelect:a,shiftSelect:r,unitSelectList:d}=(0,m.C)(g.yV),[u]=(0,K.M)(),h=(0,m.T)(),[j,f]=(0,v.useState)(F(new Date)),[b,x]=(0,v.useState)(""),[E,p]=(0,v.useState)(),{eventStateList:O,statusEventStateList:S}=(0,m.C)(I.eG),T=1===d.length&&(null===(s=null===(o=null===(i=d[0])||void 0===i?void 0:i.initialEventState)||void 0===o?void 0:o.event)||void 0===s?void 0:s.event)===Z.EnumEvent.MAINTENANCE;return S===y.JD.LOADING?(0,n.jsx)(n.Fragment,{children:"CARGANDO..."},void 0):(0,n.jsxs)(l.Z,Object.assign({onMouseLeave:e},{children:[(0,n.jsx)(R.Z,{label:"Entrada",type:"time",value:j,autoFocus:!0,name:"timeStart",size:"small",InputLabelProps:{shrink:!0,required:!0},onChange:e=>f(e.target.value)},void 0),T&&(0,n.jsx)(R.Z,{label:"H. inicial",type:"number",name:"initialHourmeter",size:"small",value:b,style:{maxWidth:100},onChange:e=>{var t;return x(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)},InputLabelProps:{shrink:!0}},void 0),t&&t.event!==Z.EnumEvent.OPERATIONAL&&(0,n.jsx)(_.Z,{children:O.map(((e,t)=>(0,n.jsx)($.Z,Object.assign({selected:(null==E?void 0:E.id)===e.id,dense:!0,button:!0,onClick:()=>p(e),disableGutters:!0},{children:(0,n.jsx)(z.Z,{secondary:e.name},void 0)}),t)))},void 0),(0,n.jsxs)(l.Z,Object.assign({container:!0},{children:[(0,n.jsx)(c.Z,Object.assign({onClick:e,color:"primary",variant:"outlined",size:"small"},{children:"CANCELAR"}),void 0),(0,n.jsx)(c.Z,Object.assign({disabled:!(null==E?void 0:E.id)&&t&&t.event!==Z.EnumEvent.OPERATIONAL,onClick:()=>{return e=void 0,i=void 0,o=function*(){var e;let i=E;t.event===Z.EnumEvent.OPERATIONAL&&(i={eventState:W.EnumEventState.UNKNOWN_STATE,id:"",name:"",event:t}),i&&i.event?(T?yield(0,V.tV)({htm:b,Substatus:i,status:null===(e=null==i?void 0:i.event)||void 0===e?void 0:e.event,currentTimeline:d[0],date:(0,U.v)(new Date(a)),time:j}):yield h((0,g.hd)({event:i.event,eventState:i,dateShift:(0,U.v)(new Date(a)),hourStart:j})),h((0,g.mA)(u))):alert("Seleccione un subestado")},new((n=void 0)||(n=Promise))((function(t,s){function l(e){try{r(o.next(e))}catch(e){s(e)}}function a(e){try{r(o.throw(e))}catch(e){s(e)}}function r(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(e){e(i)}))).then(l,a)}r((o=o.apply(e,i||[])).next())}));var e,i,n,o},color:"secondary",variant:"contained",size:"small"},{children:"CONFIRMAR"}),void 0)]}),void 0)]}),void 0)},B=(0,H.Z)((e=>(0,P.Z)({popover:{},paper:{padding:e.spacing(1),zIndex:5}}))),J=({list:e,setOpen:t,setSelected:i,selected:o})=>(0,n.jsx)(f.Z,Object.assign({id:"split-button-menu"},{children:e.map(((e,s)=>(0,n.jsx)(b.Z,Object.assign({disabled:e.event===Z.EnumEvent.MAINTENANCE,selected:e===o,onClick:n=>((e,n)=>{i(n),t(!1)})(0,e)},{children:e.name}),s)))}),void 0),Y=()=>{const e=B(),[t,i]=(0,C._)("MOVE_SELECT_EVENT",!1),{eventList:o,statusEventList:s}=(0,m.C)(I.yJ),l=(0,m.T)(),a=(0,v.useRef)(),[r,d]=(0,v.useState)(!1),[u,h]=(0,v.useState)(null),g=()=>{h(null)};(0,v.useEffect)((()=>{t&&l((0,M.Gy)(t.event))}),[t]),(0,v.useEffect)((()=>{l((0,w.TU)())}),[]);const j=Boolean(u);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(x.Z,Object.assign({variant:"contained",color:"primary",ref:a,size:"small","aria-owns":j?"mouse-over-popover":void 0,"aria-label":"split button"},{children:[(0,n.jsx)(c.Z,Object.assign({style:{padding:4,margin:0,color:"#fff",fontSize:10,background:t?D(t.event):N.sb},size:"small",onClick:t?e=>{h(e.currentTarget),l((0,M.Gy)(null==t?void 0:t.event))}:void 0},{children:t?t.name:"MOVER A"}),void 0),(0,n.jsx)(c.Z,Object.assign({color:"primary",size:"small","aria-controls":"split-button-menu","aria-expanded":"true","aria-label":"select merge strategy","aria-haspopup":"menu",onClick:()=>{d((e=>!e))},style:{padding:0,margin:0,color:"#fff",background:t?D(t.event):N.sb}},{children:(0,n.jsx)(T.Z,{fontSize:"small"},void 0)}),void 0)]}),void 0),(0,n.jsx)(E.Z,Object.assign({open:r,anchorEl:a.current,role:void 0,transition:!0},{children:({TransitionProps:e,placement:l})=>(0,n.jsx)(p.Z,Object.assign({},e,{style:{transformOrigin:"bottom"===l?"center top":"center bottom"}},{children:(0,n.jsx)(O.Z,{children:(0,n.jsx)(J,{setOpen:d,list:s===y.JD.DONE?o:[],selected:t,setSelected:i},void 0)},void 0)}),void 0)}),void 0),(0,n.jsx)(S.ZP,Object.assign({id:"mouse-over-popover",className:e.popover,classes:{paper:e.paper},open:j,anchorEl:u,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:g},{children:(0,n.jsx)(G,{eventSelect:t,handlePopoverClose:g},void 0)}),void 0)]},void 0)};var q=i(39704),X=i(46067),Q=i(89449),ee=i(63663),te=i(81449);const ie=()=>{const[e,t]=(0,v.useState)({flex:0,time:0}),[i]=(0,u.R)();return(0,v.useEffect)((()=>{i.getHours()>=7&&i.getHours()<19?t(k(h.Shift.DAY)):t(k(h.Shift.NIGHT)),setInterval((()=>{i.getHours()>=7&&i.getHours()<19?t(k(h.Shift.DAY)):t(k(h.Shift.NIGHT))}),5e3)}),[]),{currentLine:e}},ne=(0,H.Z)((()=>({borderLeft:{borderLeftColor:"gray",borderLeftWidth:1,borderLeftStyle:"dashed",flex:1,paddingLeft:4},inputHourmeterFinal:{width:"100%",borderColor:e=>e.error?"orange":"#ccc",borderRadius:2,flex:3,paddingLeft:4},borderAdjustement:{borderLeftColor:"gray",borderLeftWidth:1,borderLeftStyle:"dashed",color:e=>e.errorAjustment?"red":"grey",textAlign:"center",flex:1}}))),oe=(e,t,i)=>{if(e<0)return null;let n;const o=i?`input_close_${e===t?0:e+1}`:`input_close_${0===e?t:e-1}`;return n=document.getElementById(o),n&&n.disabled&&(n=null),!n&&e<t&&0!==e?oe(i?e+1:e-1,t,i):n},se=({currentTimeline:e,index:t,lastIndex:i,timeFinal:o,setTimeFinal:a})=>{var r,d,c,u,h,j;const{}=ie(),f=(0,m.T)(),{unitSelectList:b}=(0,m.C)(g.yV),{error:x,textInput:E,onChangeText:p,onKeyDown:O}=(({currentState:e,setTimeFinal:t,timeFinal:i})=>{const[n,o]=(0,C._)("close_shift_units",[]),[s,l]=(0,v.useState)(null),[a,r]=(0,v.useState)(""),[d,c]=(0,v.useState)(!1);(0,v.useEffect)((()=>{const i=n.find((t=>t.deviceId===e.deviceId));i&&(r(0===i.hourmeter?"":`${i.hourmeter}`),t(i.time))}),[]);return{error:d,textInput:a,setTextInput:r,timeFinal:i,setTimeFinal:t,onChangeText:i=>{r(i.target.value),t(i.target.value?(new Date).getTime()/1e3:-1),clearTimeout(s);const n=setTimeout((()=>(t=>{const i=localStorage.getItem("close_shift_units"),n=i?JSON.parse(i):[],s=n.findIndex((t=>t.deviceId===e.deviceId)),l=t,a=(new Date).getTime()/1e3,r={deviceId:e.deviceId,hourmeter:l>0?l:0,time:l>0?a:0},d=[...n];-1===s?d.push(r):d[s]=r,e.initialTime.seconds,o(d)})(Number(i.target.value))),500);l(n),console.log("Â¡typingTimer",s)},onKeyDown:()=>{clearTimeout(s)}}})({currentState:e,setTimeFinal:a,timeFinal:o}),S=((e,t)=>{var i,n,o,s,l,a;if((null===(n=null===(i=e.initialEventState)||void 0===i?void 0:i.event)||void 0===n?void 0:n.event)!==Z.EnumEvent.NO_OPERATIONAL&&(null===(s=null===(o=e.initialEventState)||void 0===o?void 0:o.event)||void 0===s?void 0:s.event)!==Z.EnumEvent.MAINTENANCE){if(-1===t){const t=((new Date).getTime()/1e3-(null===(l=null==e?void 0:e.initialTime)||void 0===l?void 0:l.seconds))/3600;return(e.initialHourmeter+t).toFixed(2)}const i=((t||(new Date).getTime()/1e3)-(null===(a=null==e?void 0:e.initialTime)||void 0===a?void 0:a.seconds))/3600;return(e.initialHourmeter+i).toFixed(2)}return e.initialHourmeter.toFixed(2)})(e,Number(o)),T=Number(E)>0?Number(E)-Number(S):0,N=ne({error:x,errorAjustment:T>=.3||T<=-.3}),y=(0,v.useCallback)((()=>b.some((t=>t.deviceId===e.deviceId))),[b]);return(0,v.useEffect)((()=>{var t,i;(null===(i=null===(t=e.initialEventState)||void 0===t?void 0:t.event)||void 0===i?void 0:i.event)===Z.EnumEvent.MAINTENANCE?p({target:{value:e.initialHourmeter}}):p({target:{value:""}})}),[null===(d=null===(r=e.initialEventState)||void 0===r?void 0:r.event)||void 0===d?void 0:d.event]),(0,n.jsxs)(l.Z,Object.assign({style:{width:230,display:"flex"}},{children:[(0,n.jsxs)("label",Object.assign({style:{width:30,userSelect:"none",flex:2}},{children:[(0,n.jsx)(s.Z,{onClick:()=>{f((0,g.WZ)(e))},checked:y(),style:{padding:0,flex:1},size:"small"},void 0),"C",e.deviceAlias.slice(-2)]}),void 0),(0,n.jsx)("label",Object.assign({className:N.borderLeft},{children:S}),void 0),(0,n.jsx)("label",Object.assign({className:N.borderAdjustement},{children:E?T.toFixed(2):"...."}),void 0),(0,n.jsx)("input",{id:`input_close_${t}`,className:N.inputHourmeterFinal,disabled:(null===(u=null===(c=e.initialEventState)||void 0===c?void 0:c.event)||void 0===u?void 0:u.event)===Z.EnumEvent.MAINTENANCE,value:(null===(j=null===(h=e.initialEventState)||void 0===h?void 0:h.event)||void 0===j?void 0:j.event)===Z.EnumEvent.MAINTENANCE?e.initialHourmeter.toFixed(2):E,onChange:p,onKeyDown:n=>{let o=null;switch(n.key){case"ArrowDown":o=oe(t,i,!0),p({target:{value:E}});break;case"ArrowUp":o=oe(t,i,!1),p({target:{value:E}});break;case"Enter":o=oe(t,i,!0),f((0,g.tj)({hourmeter:n.value,deviceId:e.deviceId})),p({target:{value:E}});break;default:O()}o&&o.focus()}},void 0)]}),void 0)};var le=i(73914),ae=i(15635),re=i(83945),de=i(28428),ce=i(2834),ve=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function l(e){try{r(n.next(e))}catch(e){s(e)}}function a(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,a)}r((n=n.apply(e,t||[])).next())}))};const ue=(0,le.Z)((()=>({root:{minWidth:150,padding:4,borderWidth:2,borderStyle:"solid"}}))),me=e=>{var t;const i=new Date(1e3*(null===(t=null==e?void 0:e.initialTime)||void 0===t?void 0:t.seconds)),n=(null==e?void 0:e.finalTime)?new Date(1e3*(null==e?void 0:e.finalTime.seconds)):new Date;return{timeInitial:i,timeFinal:n,hourInitial:F(i),hourFinal:F(n)}},he=({timeline:e})=>{var t,i,s,a,r,d,c;const u=L(e),[h]=(0,K.M)(),{statusUpdateTimeline:j}=(0,m.C)(re.rf),{historyTimelineShift:f,statusDelete:b}=(0,m.C)(g.yV),[x]=(0,ae.r)(j),[E]=(0,ae.r)(b),p=(0,q.I0)(),S=ue(),T=(0,v.useRef)(),{hourInitial:N,hourFinal:y}=me(e),[C,w]=(0,v.useState)(N),[I,A]=(0,v.useState)(null===(t=null==e?void 0:e.initialHourmeter)||void 0===t?void 0:t.toFixed(1)),[k,D]=(0,v.useState)(!1);(0,v.useEffect)((()=>{var t,i,n,o;const s=f.find((t=>t.deviceId===e.deviceId));(null===(i=null===(t=null==s?void 0:s.historyShiftList)||void 0===t?void 0:t.at(-1))||void 0===i?void 0:i.id)===(null==e?void 0:e.id)?D(!0):(null===(o=null===(n=null==s?void 0:s.historyShiftList)||void 0===n?void 0:n.at(0))||void 0===o||o.id,null==e||e.id,D(!1))}),[e]),(0,v.useEffect)((()=>{var t;const{hourInitial:i}=me(e);w(i),A(null===(t=null==e?void 0:e.initialHourmeter)||void 0===t?void 0:t.toFixed(1)),T.current&&setTimeout((()=>{T.current.focus()}),100)}),[e]);const F=(null==e?void 0:e.finalHourmeter)-(null==e?void 0:e.initialHourmeter),H=()=>ve(void 0,void 0,void 0,(function*(){var t;const[i,n]=C.split(":"),[o,s]=N.split(":"),l=Number(i)-Number(o);if(0==1e3*(60*(Number(n)-Number(s))+60*l*60)||!e.id)return;const a={};a.id=e.id,a.deviceId=e.deviceId,a.deviceAlias=e.deviceAlias,a.initialHourmeter=e.initialHourmeter,a.finalHourmeter=e.finalHourmeter,a.initialState=e.initialState,a.finalState=e.finalState,a.date=(0,U.v)(new Date),a.time=C,e.finalTime&&(a.finalTime={seconds:null===(t=e.finalTime)||void 0===t?void 0:t.seconds}),a.shiftDate={seconds:e.shiftDate.seconds},a.shift=e.shift,console.log(a),yield p((0,re.ft)(a)),p((0,re.mA)(h))}));return(0,n.jsx)(O.Z,Object.assign({elevation:4,className:S.root,style:{borderColor:u}},{children:(0,n.jsxs)(ee.T5,Object.assign({alignItems:"center",justifyContent:"center",direction:"row",style:{gap:4,alignItems:"stretch"}},{children:[(0,n.jsx)(l.Z,Object.assign({item:!0},{children:(0,n.jsxs)(l.Z,Object.assign({container:!0,direction:"column",style:{height:"100%"}},{children:[(0,n.jsx)(ee.P4,{children:(0,n.jsx)(o.Z,{size:"small",label:null==e?void 0:e.deviceAlias},void 0)},void 0),(0,n.jsx)(ee.P4,{children:(0,n.jsx)(o.Z,{style:{background:u,color:"#fff"},size:"small",label:(0,n.jsx)("span",Object.assign({style:{fontSize:9}},{children:null===(s=null===(i=null==e?void 0:e.initialEventState)||void 0===i?void 0:i.event)||void 0===s?void 0:s.name}),void 0)},void 0)},void 0),(null===(a=e.initialEventState)||void 0===a?void 0:a.name)&&(0,n.jsx)(ee.P4,{children:(0,n.jsx)(o.Z,{style:{maxWidth:150,borderWidth:2,borderStyle:"solid",borderColor:u},size:"small",label:(0,n.jsx)("span",Object.assign({style:{fontSize:9}},{children:null===(r=e.initialEventState)||void 0===r?void 0:r.name}),void 0)},void 0)},void 0),(0,n.jsx)(ee.P4,{children:(0,n.jsx)(o.Z,{size:"small",label:F>=0?`${F.toFixed(1)}h`:"..."},void 0)},void 0)]}),void 0)}),void 0),(0,n.jsx)(l.Z,Object.assign({item:!0},{children:(0,n.jsxs)(l.Z,Object.assign({container:!0,direction:"column"},{children:[(0,n.jsx)(R.Z,{label:"Entrada",type:"time",value:C,autoFocus:!0,onKeyDown:e=>ve(void 0,void 0,void 0,(function*(){"Enter"===e.key&&H()})),name:"timeStart",size:"small",inputRef:T,InputLabelProps:{shrink:!0,required:!0},onChange:e=>w(e.target.value)},void 0),(0,n.jsx)(R.Z,{label:"Salida",type:"time",name:"timeEnd",size:"small",disabled:!0,value:y},void 0)]}),void 0)}),void 0),(0,n.jsx)(l.Z,Object.assign({item:!0},{children:(0,n.jsxs)(l.Z,Object.assign({container:!0,direction:"column"},{children:[(0,n.jsx)(R.Z,{label:"H. inicial",type:"number",name:"initialHourmeter",size:"small",disabled:(null===(c=null===(d=null==e?void 0:e.initialEventState)||void 0===d?void 0:d.event)||void 0===c?void 0:c.event.toString())!=Z.EnumEvent.MAINTENANCE.toString(),value:I,style:{maxWidth:100},onChange:e=>A(e.target.value),InputLabelProps:{shrink:!0}},void 0),(0,n.jsx)(R.Z,{label:"H. final ",name:"initialHourmeter",size:"small",disabled:!0,style:{maxWidth:100},value:e.finalHourmeter?e.finalHourmeter.toFixed(1):"...",InputLabelProps:{shrink:!0}},void 0)]}),void 0)}),void 0),(0,n.jsx)(ce.d,{size:"small",variant:"contained",color:"secondary",onClick:H,text:"GUARDAR",loading:x},void 0),k&&(0,n.jsx)(ce.d,{size:"small",variant:"contained",onClick:()=>ve(void 0,void 0,void 0,(function*(){const t={};t.id=e.id,t.deviceId=e.deviceId,yield p((0,g.a8)(t)),p((0,re.mA)(h))})),style:{background:"rgb(154, 0, 54)",color:"white"},startIcon:(0,n.jsx)(de.Z,{},void 0),loading:!1,text:"Borrar"},void 0)]}),void 0)}),void 0)};var ge=i(10046),je=i(85335);const fe=({timeline:e})=>{var t,i;L(e);const[s]=(0,K.M)(),a=new Date,r=`0${a.getHours()}`,d=`0${a.getMinutes()}`,u=(0,q.I0)(),h=ue(),g=(0,v.useRef)(),[j,f]=(0,v.useState)(`${r.slice(-2)}:${d.slice(-2)}`),[b,x]=(0,v.useState)(""),{eventStateList:E,statusEventStateList:p}=(0,m.C)(I.eG);(0,v.useEffect)((()=>{u((0,M.Gy)(Z.EnumEvent.MAINTENANCE))}),[]);const[S,T]=v.useState();return console.log("selectValue",E),(0,n.jsx)(ge.Z,Object.assign({component:"form",onSubmit:t=>{return i=void 0,n=void 0,l=function*(){var i;t.preventDefault();const n={},o=E.find((e=>e.eventState===S));n.deviceId=null==e?void 0:e.deviceId,n.deviceAlias=null==e?void 0:e.deviceAlias,n.assetType=null==e?void 0:e.assetType,n.initialHourmeter=b,n.initialState=Z.EnumEvent.MAINTENANCE,n.initialEventState=o,n.date=(0,U.v)(new Date),n.time=j,n.shiftDate={seconds:null===(i=null==e?void 0:e.shiftDate)||void 0===i?void 0:i.seconds},n.shift=null==e?void 0:e.shift,n.eventState=o,yield u((0,re.qZ)(n)),u((0,re.mA)(s))},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{r(l.next(e))}catch(e){t(e)}}function a(e){try{r(l.throw(e))}catch(e){t(e)}}function r(t){var i;t.done?e(t.value):(i=t.value,i instanceof o?i:new o((function(e){e(i)}))).then(s,a)}r((l=l.apply(i,n||[])).next())}));var i,n,o,l}},{children:(0,n.jsx)(O.Z,Object.assign({elevation:4,className:h.root,style:{borderColor:D(Z.EnumEvent.MAINTENANCE)}},{children:(0,n.jsxs)(ee.T5,Object.assign({alignItems:"center",justifyContent:"center",direction:"row",style:{gap:4,alignItems:"stretch"}},{children:[(0,n.jsx)(l.Z,Object.assign({item:!0},{children:(0,n.jsxs)(l.Z,Object.assign({container:!0,direction:"column",style:{height:"100%"}},{children:[(0,n.jsx)(ee.P4,{children:(0,n.jsx)(o.Z,{size:"small",label:null==e?void 0:e.deviceAlias},void 0)},void 0),(0,n.jsx)(ee.P4,{children:(0,n.jsx)(o.Z,{style:{background:D(Z.EnumEvent.MAINTENANCE),color:"#fff"},size:"small",label:(0,n.jsx)("span",Object.assign({style:{fontSize:9}},{children:null===(i=null===(t=E[0])||void 0===t?void 0:t.event)||void 0===i?void 0:i.name}),void 0)},void 0)},void 0),(0,n.jsx)(je.Z,{required:!0,value:"",placeholder:"Estado",iteams:E.map((e=>({value:e.eventState,tittle:e.name}))),selectValue:T},void 0)]}),void 0)}),void 0),(0,n.jsx)(l.Z,Object.assign({item:!0},{children:(0,n.jsx)(l.Z,Object.assign({container:!0,direction:"column"},{children:(0,n.jsx)(R.Z,{required:!0,label:"Entrada",type:"time",value:j,autoFocus:!0,name:"timeStart",size:"small",inputRef:g,InputLabelProps:{shrink:!0,required:!0},onChange:e=>f(e.target.value)},void 0)}),void 0)}),void 0),(0,n.jsx)(l.Z,Object.assign({item:!0},{children:(0,n.jsxs)(l.Z,Object.assign({container:!0,direction:"column"},{children:[(0,n.jsx)(R.Z,{required:!0,label:"H. inicial",type:"number",name:"initialHourmeter",size:"small",value:b,style:{maxWidth:100},onChange:e=>x(e.target.value),InputLabelProps:{shrink:!0}},void 0),(0,n.jsx)(R.Z,{label:"H. final ",name:"initialHourmeter",size:"small",disabled:!0,style:{maxWidth:100},value:(null==e?void 0:e.finalHourmeter)?null==e?void 0:e.finalHourmeter.toFixed(1):"...",InputLabelProps:{shrink:!0}},void 0)]}),void 0)}),void 0),(0,n.jsx)(c.Z,Object.assign({size:"small",type:"submit",variant:"contained",color:"secondary"},{children:"GUARDAR"}),void 0)]}),void 0)}),void 0)}),void 0)},be=(0,H.Z)({layoutPopper:{position:"absolute",top:0,bottom:0,right:0,left:0,zIndex:3},arrowPopper:{width:11,height:4,background:e=>e.color,transform:"translateX(-7px) rotate(40deg)"},rootPopper:{zIndex:4,marginTop:8,marginLeft:6}}),xe=()=>{var e,t;const i=(0,m.T)(),{currentTimeline:o,currentMantoTimeline:s}=(0,m.C)(g.yV),[l,a]=(0,v.useState)(null);(0,v.useEffect)((()=>{if(o){const e=document.getElementById(`state-${(null==o?void 0:o.id)?null==o?void 0:o.id:null==o?void 0:o.deviceId}`);e&&a(e),o&&i((0,g.Gf)())}}),[o]),(0,v.useEffect)((()=>{if(s){const e=document.getElementById(`stateManto-${(null==s?void 0:s.id)?null==s?void 0:s.id:null==s?void 0:s.deviceId}`);e&&a(e),s&&i((0,g.IE)())}}),[s]);const r=o?L(o):"#fff",d=be({color:r});return l&&(o||s)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(E.Z,Object.assign({open:!!o||!!s,className:d.rootPopper,anchorEl:l,placement:"right-start"},{children:[(0,n.jsx)("div",{className:d.arrowPopper},void 0),s&&(null===(t=null===(e=s.initialEventState)||void 0===e?void 0:e.event)||void 0===t?void 0:t.event)!==Z.EnumEvent.MAINTENANCE&&(0,n.jsx)(fe,{timeline:s},void 0),o&&(0,n.jsx)(he,{timeline:o},void 0)]}),void 0),(0,n.jsx)("div",{onClick:()=>{i((0,g.IE)()),i((0,g.Gf)())},className:d.layoutPopper},void 0)]},void 0):(0,n.jsx)(n.Fragment,{},void 0)},Ee=(0,H.Z)((()=>({root:{position:"absolute",display:"flex",bottom:0,right:230,left:40,top:-4},itemHour:{flex:1,borderRightColor:"grey",borderRightWidth:1,borderRightStyle:"dashed",position:"relative"},labelItemHour:{color:"rgb(131 126 126)",position:"absolute",left:-19,top:-8,userSelect:"none"},rootTimeline:{position:"absolute",right:0,height:"100%",left:0,display:"flex",zIndex:0},beforeTimeline:{height:0},afterTimeline:{height:0,borderRightColor:"#ccc",borderRightWidth:1,borderRightStyle:"dashed"},line:{width:1,background:N.Jx,height:"100%"},rootLine:{paddingTop:8,height:"100%"}}))),pe=({shift:e})=>{const{currentLine:t}=ie(),i=Ee(),o=(e=>e===h.Shift.DAY?[7,8,9,10,11,12,13,14,15,16,17,18]:[19,20,21,22,23,0,1,2,3,4,5,6])(e),s=(0,v.useMemo)((()=>o.map(((e,t)=>(0,n.jsx)("div",Object.assign({className:i.itemHour},{children:(0,n.jsxs)("label",Object.assign({className:i.labelItemHour},{children:[`0${e}`.slice(-2),":00"]}),void 0)}),t)))),[o]);return(0,n.jsxs)(l.Z,Object.assign({className:i.root},{children:[s,(0,n.jsxs)("div",Object.assign({className:i.rootTimeline},{children:[(0,n.jsx)("div",{className:i.beforeTimeline,style:{flex:t.flex}},void 0),(0,n.jsx)("div",Object.assign({className:i.rootLine},{children:(0,n.jsx)("div",{className:i.line},void 0)}),void 0),(0,n.jsx)("div",{className:i.afterTimeline,style:{flex:1-t.flex}},void 0)]}),void 0)]}),void 0)},Oe=(0,H.Z)((()=>({rootUnitState:{height:2,position:"relative"},dotUnitState:{width:12,height:12,borderRadius:6,background:"#fff",position:"absolute",borderColor:"#6d6c6c",borderWidth:2,borderStyle:"solid",top:-5,left:-4,zIndex:5,cursor:"pointer"},dotUnitStateCurrent:{width:12,height:12,borderRadius:6,position:"absolute",top:-5,right:-5,zIndex:4,cursor:"pointer"},dotLabelHour:{fontSize:9,position:"absolute",left:-4,bottom:-15,userSelect:"none"},rootRowTimeline:{background:e=>e.indexTimeline%2!=0?"#cccccc52":"#fff","&:hover, &:focus":{backgroundColor:"#ccc"}}}))),Se=({state:e,line:t,setState:i})=>{var o,s;const a=(0,m.T)(),{currentTimeline:r}=(0,q.v9)(g.yV),d=Oe({}),[c,u]=(0,v.useState)(!1),h=(0,v.useRef)(),j=(null===(o=null==e?void 0:e.finalTime)||void 0===o?void 0:o.seconds)-(null===(s=null==e?void 0:e.initialTime)||void 0===s?void 0:s.seconds),f=(0,v.useCallback)((()=>{a((0,g.Sf)(e))}),[e]);return(0,v.useEffect)((()=>{(null==r?void 0:r.id)===e.id&&a((0,g.Sf)(e))}),[e]),(0,v.useCallback)((n=>{var o,s;if(!c||!h.current||!t.current)return;const l=(t.current.clientWidth-(n.clientX-t.current.offsetLeft-32))*j/t.current.clientWidth;if(console.log("TIMEEEE",l,j),i){const t=new X.Timeline,n=new Date(1e3*((null===(o=null==e?void 0:e.initialTime)||void 0===o?void 0:o.seconds)-(j-l))),a=new Date(1e3*(null===(s=null==e?void 0:e.finalTime)||void 0===s?void 0:s.seconds));t.setInitialTime((0,Q.X)(n.toString())),t.setFinalTime((0,Q.X)(a.toString())),console.log("initialTime",t.toObject()),i(t.toObject())}}),[c,t,e]),(0,v.useCallback)((e=>{e.target===h.current&&u(!0)}),[h]),(0,n.jsx)(l.Z,{id:`state-${e.id?e.id:e.deviceId}`,className:d.dotUnitState,onMouseEnter:f,ref:h,style:{borderColor:L(e)}},void 0)},Te=({state:e})=>{var t;const[i,o]=(0,v.useState)(e);(0,v.useEffect)((()=>{o(e)}),[e]);const s=(0,v.useRef)(),l=new Date(1e3*(null===(t=null==i?void 0:i.initialTime)||void 0===t?void 0:t.seconds)).getMinutes(),a=Oe({}),r=(e=>{var t,i;return(null==e?void 0:e.finalTime)?(null===(t=null==e?void 0:e.finalTime)||void 0===t?void 0:t.seconds)-(null===(i=null==e?void 0:e.initialTime)||void 0===i?void 0:i.seconds):0})(i)/A;return(0,n.jsxs)("div",Object.assign({className:a.rootUnitState,style:{flex:r,zIndex:4,background:L(i)},ref:s},{children:[(0,n.jsx)(Se,{state:i,line:s,setState:o},void 0),l?(0,n.jsx)("label",Object.assign({className:a.dotLabelHour},{children:`0${l}`.slice(-2)}),void 0):(0,n.jsx)(n.Fragment,{},void 0)]}),void 0)},Ne=({currentTimeline:e,timeFinal:t})=>{var i,o;const{}=ie(),s=Oe({}),[a]=(0,te.v)(),r=new Date(1e3*(null===(i=null==e?void 0:e.initialTime)||void 0===i?void 0:i.seconds)).getMinutes(),[d,c]=(0,v.useState)(((t>0?t:(new Date).getTime()/1e3)-(null===(o=null==e?void 0:e.initialTime)||void 0===o?void 0:o.seconds))/A);(0,v.useEffect)((()=>{var i;c(((t>0?t:(new Date).getTime()/1e3)-(null===(i=null==e?void 0:e.initialTime)||void 0===i?void 0:i.seconds))/A);const n=setInterval((()=>{var i;c(((t>0?t:(new Date).getTime()/1e3)-(null===(i=null==e?void 0:e.initialTime)||void 0===i?void 0:i.seconds))/A)}),5e3);return()=>{window.clearInterval(n)}}),[e]),console.log(d);const u=L(e),h=(0,m.T)();return(0,n.jsxs)("div",Object.assign({className:s.rootUnitState,style:{flex:d,background:u}},{children:[(0,n.jsx)(l.Z,{className:s.dotUnitState,onMouseEnter:()=>h((0,g.Sf)(e)),style:{flex:d,borderColor:L(e)},id:`state-${e.id?e.id:e.deviceId}`},void 0),r?(0,n.jsx)("label",Object.assign({className:s.dotLabelHour},{children:`0${r}`.slice(-2)}),void 0):(0,n.jsx)(n.Fragment,{},void 0),(0,n.jsx)(l.Z,{className:s.dotUnitStateCurrent,id:`stateManto-${e.id?e.id:e.deviceId}`,onMouseEnter:()=>h((0,g.MD)(e)),style:{background:u}},void 0)]}),void 0)},ye=e=>{var t;const{}=ie();return(null===(t=e.initialEventState)||void 0===t?void 0:t.eventState)===W.EnumEventState.CHANGE_OF_SHIFT?L(e):"#ccc"},Ce=e=>{var t;const[i]=(0,u.R)();i.getHours()>=7&&i.getHours()<19?(i.setHours(7),i.setMinutes(0),i.setSeconds(0)):(i.setHours(19),i.setMinutes(0),i.setSeconds(0));const n=(new Date).getTime()/1e3,o=null===(t=null==e?void 0:e.initialTime)||void 0===t?void 0:t.seconds,s=o>n?o:n;return(i.getTime()/1e3-s)/A},Ze=({currentTimeline:e})=>(0,n.jsx)("div",Object.assign({style:{flex:Ce(e),height:12,display:"flex",alignItems:"center"}},{children:(0,n.jsx)("div",{style:{width:"100%",background:ye(e),height:1}},void 0)}),void 0),we=({states:e,currentTimeline:t,timeFinal:i})=>{const[o,s]=(0,v.useState)(t);return(0,v.useEffect)((()=>(console.log("states",e,o),s(t),()=>{})),[o,e]),e?(0,n.jsx)(l.Z,Object.assign({item:!0,style:{flex:1,marginTop:2,marginBottom:2}},{children:(0,n.jsxs)(ee.T5,Object.assign({alignItems:"center"},{children:[null==e?void 0:e.map(((e,t)=>(null==e?void 0:e.id)!==(null==o?void 0:o.id)&&(0,n.jsx)(Te,{state:e},t))),(0,n.jsx)(Ne,{currentTimeline:o,timeFinal:i},void 0),(0,n.jsx)(Ze,{currentTimeline:o},void 0)]}),void 0)}),void 0):(0,n.jsx)(n.Fragment,{},void 0)},Ie=({index:e,lastIndex:t,timeline:i})=>{const[o,s]=(0,v.useState)(-1),a=Oe({indexTimeline:e});return(0,n.jsxs)(l.Z,Object.assign({container:!0,direction:"row",alignItems:"center",className:a.rootRowTimeline},{children:[(0,n.jsxs)("label",Object.assign({style:{width:40,userSelect:"none"}},{children:["C",i.deviceAlias.slice(-2)]}),void 0),(0,n.jsx)(we,{setTimeFinal:s,timeFinal:o,states:i.historyShiftList,currentTimeline:i.currentTimeline},e),(0,n.jsx)(se,{states:i.historyShiftList,currentTimeline:i.currentTimeline,index:e,lastIndex:t,timeFinal:o,setTimeFinal:s},void 0)]}),e)},Ae=({shift:e})=>{const t=(0,m.T)(),{historyTimelineShift:i,statusGetTimeline:o,statusCreateTimeline:s}=(0,m.C)(g.yV),[a]=(0,K.M)();return(0,v.useEffect)((()=>(t((0,g.mA)(a)),()=>{})),[]),(0,n.jsxs)(l.Z,Object.assign({container:!0,style:{position:"relative",paddingTop:8,borderColor:"#000"}},{children:[(null==i?void 0:i.length)>0&&(null==i?void 0:i.map(((e,t)=>e.currentTimeline&&(0,n.jsx)(Ie,{index:t,lastIndex:(null==i?void 0:i.length)-1,timeline:e},t)))),(0,n.jsx)(xe,{},void 0),(0,n.jsx)(pe,Object.assign({},{shift:e}),void 0)]}),void 0)};const ke=new Date,Le=()=>{const e=(0,m.T)();return(0,n.jsx)(o.Z,{avatar:(0,n.jsx)(s.Z,{onClick:()=>{e((0,g.IT)())},size:"small"},void 0),label:"Todos"},void 0)},De=()=>{const[e]=(0,u.R)(),{dateShiftSelect:t,shiftSelect:i}=(0,m.C)(g.yV),o=(0,m.T)(),s=new Date(ke.getTime()-26784e5);(0,v.useEffect)((()=>{o((0,g.tp)(e.getTime()))}),[e.getDate()]);const f=e=>{o((0,g.Nx)(e))};return(0,v.useEffect)((()=>{e.getHours()>=7&&e.getHours()<19?o((0,g.Nx)(h.Shift.DAY)):o((0,g.Nx)(h.Shift.NIGHT))}),[]),(0,n.jsxs)(l.Z,Object.assign({container:!0,direction:"row"},{children:[(0,n.jsx)(l.Z,Object.assign({item:!0,lg:12,md:12,xs:12,style:{background:"#dbdbdb"}},{children:(0,n.jsx)(j.M,{startDate:s,days:31,marked:[{}],selectDate:new Date(t),getSelectedDay:e=>{o((0,g.tp)(e.getTime()))},color:"#024e8c"},void 0)}),void 0),(0,n.jsxs)(l.Z,Object.assign({item:!0,lg:12,md:12,xs:12},{children:[(0,n.jsxs)(l.Z,Object.assign({container:!0,style:{marginBottom:16,marginTop:8,gap:4,position:"relative",zIndex:5},justifyContent:"space-between"},{children:[(0,n.jsx)(l.Z,Object.assign({item:!0},{children:(0,n.jsxs)(a.Z,Object.assign({row:!0,"aria-label":"shift",name:"shift",value:i,style:{marginRight:8}},{children:[(0,n.jsx)(r.Z,{value:h.Shift.DAY,control:(0,n.jsx)(d.Z,{style:{padding:0},size:"small",color:"primary"},void 0),label:"DÃ­a",onClick:()=>f(h.Shift.DAY),labelPlacement:"start"},void 0),(0,n.jsx)(r.Z,{value:h.Shift.NIGHT,control:(0,n.jsx)(d.Z,{style:{padding:0},size:"small",color:"primary"},void 0),label:"Noche",onClick:()=>f(h.Shift.NIGHT),labelPlacement:"start"},void 0)]}),void 0)}),void 0),(0,n.jsxs)(l.Z,Object.assign({item:!0},{children:[(0,n.jsx)(Y,{},void 0),(0,n.jsx)(Le,{},void 0),(0,n.jsx)(c.Z,Object.assign({color:"secondary",size:"small",variant:"outlined",onClick:()=>{return e=void 0,n=void 0,l=function*(){yield o((0,g.nx)({shiftDateString:new Date(t).toString(),shift:i})),localStorage.removeItem("close_shift_units"),location.reload()},new((s=void 0)||(s=Promise))((function(t,i){function o(e){try{r(l.next(e))}catch(e){i(e)}}function a(e){try{r(l.throw(e))}catch(e){i(e)}}function r(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(e){e(i)}))).then(o,a)}r((l=l.apply(e,n||[])).next())}));var e,n,s,l}},{children:"CERRAR TURNO"}),void 0)]}),void 0)]}),void 0),(0,n.jsx)(Ae,Object.assign({},{shift:i}),void 0)]}),void 0)]}),void 0)};var Fe=i(49521);const He=()=>(0,n.jsxs)("div",{children:[(0,n.jsx)(Fe.h,{title:"Linea de tiempo"},void 0),(0,n.jsx)("div",Object.assign({style:{marginTop:"48px"}},{children:(0,n.jsx)(De,{},void 0)}),void 0)]},void 0),Pe=He}}]);