(self.webpackChunkdts_hytera=self.webpackChunkdts_hytera||[]).push([[408],{86905:(e,t,i)=>{e.exports=i.p+"322f531ddb14529b83bd73182d28de44.png"},77501:(e,t,i)=>{e.exports=i.p+"89f059a2790e391b484a369a3b9f92fb.png"},51790:(e,t,i)=>{e.exports=i.p+"20557549695e4a02b8f5e299c9687642.png"},79800:(e,t,i)=>{"use strict";i.d(t,{H:()=>a});const a=e=>{e.current.loadImage(i(51790),(function(t,i){if(t)throw t;e.current.addImage("truck_nav",i)})),e.current.loadImage(i(86905),(function(t,i){if(t)throw t;e.current.addImage("excavator_nav",i)})),e.current.loadImage(i(77501),(function(t,i){if(t)throw t;e.current.addImage("pickup_nav",i)}))}},16886:(e,t,i)=>{"use strict";i.d(t,{N:()=>n});var a=i(85893),s=i(67294);const n=({excavatorListClass:e,excavatorList:t})=>((0,s.useEffect)((()=>{e.addToMap()}),[]),(0,s.useEffect)((()=>{e.updateInMap()}),[t]),(0,a.jsx)(a.Fragment,{},void 0))},62837:(e,t,i)=>{"use strict";i.d(t,{b:()=>o});var a=i(85893),s=i(67294),n=i(6777);const o=({truckListClass:e,truckList:t})=>(n.ET,(0,s.useEffect)((()=>{e.addToMap()}),[]),(0,s.useEffect)((()=>{e.updateInMap()}),[t]),(0,a.jsx)(a.Fragment,{},void 0))},74248:(e,t,i)=>{"use strict";i.d(t,{f:()=>n});var a=i(67294),s=i(52573);const n=({polygonList:e,idSource:t,idLayer:i,idSourceCentroid:n,idLayerCentroid:o,map:r,haveCentroid:d,onClickFeature:c})=>((0,a.useEffect)((()=>{const a=new s.z(e,r,t,i,n,o,c,d);return a.addToMap(),()=>{a.removeOfMap()}}),[e]),null)},48101:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var a=i(85893),s=i(67294),n=i(34880);const o=i(6158);o.accessToken=n.c3;const r=({dragRotate:e,map:t,pitch:i,bearing:n,mapContainer:r,lng:d,lat:c,zoom:l,setLoad:u,style:v,height:p})=>((0,s.useEffect)((()=>{console.log("map.current",t.current,n),t.current||(r&&(t.current=new o.Map({container:r.current,style:v,center:[d,c],pitch:i,bearing:n,zoom:l,antialias:!0,dragRotate:e})),console.log("inianco"))}),[t,r]),(0,s.useEffect)((()=>{t.current&&(t.current.addControl(new o.FullscreenControl,"bottom-left"),t.current.addControl(new o.NavigationControl,"bottom-left"),t.current.on("move",(()=>{})),t.current.on("click",(e=>{console.log(e.lngLat)})),t.current.on("load",(()=>{t.current&&u(!0)})))}),[t]),(0,s.useEffect)((()=>{t.current&&t.current.setBearing(n)}),[n]),(0,a.jsx)("div",{ref:r,style:{flex:1,height:p||"100vh",width:"100%"},className:"map-container"},void 0))},14276:(e,t,i)=>{"use strict";i.d(t,{c:()=>a});class a{constructor(e,t,i,a,s,n){this.unitsList=e,this.map=t,this.idSource=i,this.idLayer=a,this.iconImagen=s,this.offsetY=-2.1,this.fontSize=9,this.onClickElement=n}getInMap(){return this.map.getSource(this.idSource)}generateFeatures(){return this.unitsList.map((e=>{const{latitude:t,longitude:i,direction:a}=e.sensor,s=e.deviceAlias.split("-"),n=s.length>1&&""!==s[1].trim()?`${s[0].substr(0,1)}${s[1].substr(-2)}`:e.deviceAlias;return{type:"Feature",geometry:{type:"Point",coordinates:[i,t]},properties:{deviceId:e.deviceId,rotate:a,name:`${n}`,rotation:-180+a,offsetdata:[0,0]}}}))}addToMap(){!this.getInMap()&&this.unitsList.length>0&&(this.map.addSource(this.idSource,{type:"geojson",data:{type:"FeatureCollection",features:this.generateFeatures()}}),this.map.addLayer({id:this.idLayer,type:"symbol",source:this.idSource,layout:{"icon-image":this.iconImagen,"icon-size":.08,"icon-ignore-placement":!0,"icon-allow-overlap":!0,"icon-rotate":["get","rotate"]}}),this.map.addLayer({id:`LABEL_${this.idLayer}`,type:"symbol",source:this.idSource,layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":this.fontSize,"text-rotate":["get","rotation"],"text-offset":["get","offsetdata"],"text-allow-overlap":!0},paint:{"text-color":"#fff","text-halo-color":"#00296b","text-halo-width":4}}),this.map.on("click",this.idLayer,(e=>{this.onClickElement&&this.onClickElement(e)})),this.map.on("mouseenter",this.idLayer,(()=>{this.map.getCanvas().style.cursor="pointer"})),this.map.on("mouseleave",this.idLayer,(()=>{this.map.getCanvas().style.cursor=""})))}updateInMap(){const e=this.getInMap();e?e.setData({type:"FeatureCollection",features:this.generateFeatures()}):this.addToMap()}removeOfMap(){this.getInMap()&&(this.map.removeLayer(this.idLayer),this.map.removeLayer(`LABEL_${this.idLayer}`),this.map.removeSource(this.idSource))}}},52573:(e,t,i)=>{"use strict";i.d(t,{z:()=>s});var a=i(35573);class s{constructor(e,t,i,a,s,n,o,r){this.polygonList=e,this.map=t,this.idSource=i,this.idLayer=a,this.idSourceCentroid=s,this.idLayerCentroid=n,this.fontSize=9,this.onClickElement=o,this.haveCentroid=r}getInMap(){return this.map.getSource(this.idSource)}getCenterInMap(){return this.map.getSource(this.idSourceCentroid)}generateCentroids(){return this.polygonList.map((e=>{var t,i,a;if(!e.centroid)return{type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{}};const{latitude:s,longitude:n}=e.centroid;return{type:"Feature",geometry:{type:"Point",coordinates:[n,s]},properties:{name:`${e.name}${e.material?`-${e.material.type}`:""}`,points_polygonTajo:e.pointList.map((e=>[e.longitude,e.latitude])),name_polygon:e.name,name_material:null===(t=e.material)||void 0===t?void 0:t.type,id_polygonTajo:e.id,agTajo:e.ag,agcnTajo:e.agcn,alteTajo:e.alte,asTajo:e.as,auTajo:e.au,auchTajo:e.auch,altitudeTajo:e.altitude,descripcionTajo:"",heightTajo:e.height,litoTajo:e.litio,materialTajo:null===(i=e.material)||void 0===i?void 0:i.type,namePolTajo:e.name,nameProjectTajo:e.nameProject,onzasTajo:e.onzas,orezonetTajo:e.orezonet,ptaucnTajo:e.ptaucn,sTajo:e.s,tonnesTajo:e.tonnes,volumeTajo:e.volume,nameDme:`${e.name}`,points_polygonDme:e.pointList.map((e=>[e.longitude,e.latitude])),id_polygonDme:e.id,tonnesDme:e.tonnes,volumeDme:e.volume,namePad:`${e.name}`,id_Pad:`${e.id}_pad`,points_Pad:e.pointList.map((e=>[e.longitude,e.latitude])),tonnesPad:e.tonnes,volumePad:e.volume,nameStock:`${e.name}`,id_polygonStock:e.id,points_polygonStock:e.pointList.map((e=>[e.longitude,e.latitude])),materialStock:null===(a=e.material)||void 0===a?void 0:a.type,altitudeStock:e.altitude,volumeStock:e.volume}}}))}generateFeatures(){return this.polygonList.map((e=>({type:"Feature",properties:{color:a.O[e.color]?a.O[e.color].hex:e.color,out_color:"blue",opacity:this.haveCentroid?1:.2,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.pointList.map((e=>[e.longitude,e.latitude,e.altitude]))]}})))}addToMap(){!this.getInMap()&&this.polygonList.length>0?(console.log("this.generateFeatures()",this.generateFeatures()),this.map.getSource(this.idSource)||this.map.addSource(this.idSource,{type:"geojson",data:{type:"FeatureCollection",features:this.generateFeatures()}}),this.map.getLayer(this.idLayer)||this.map.addLayer({id:this.idLayer,type:"fill",source:this.idSource,paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}}),this.map.getLayer(`BORDER_${this.idLayer}`)||this.map.addLayer({id:`BORDER_${this.idLayer}`,type:"line",source:this.idSource,paint:{"line-color":["get","out_color"],"line-width":2,"line-opacity":["get","opacity_border"]},filter:["==","$type","Polygon"]}),this.haveCentroid&&(this.map.getSource(this.idSourceCentroid)||this.map.addSource(this.idSourceCentroid,{type:"geojson",data:{type:"FeatureCollection",features:this.generateCentroids()}}),this.map.getLayer(this.idLayerCentroid)||this.map.addLayer({id:this.idLayerCentroid,type:"symbol",source:this.idSourceCentroid,layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":this.fontSize},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})),this.map.on("click",this.idLayerCentroid,(e=>{this.onClickElement&&this.onClickElement(e)})),this.map.on("mouseenter",this.idLayerCentroid,(()=>{this.map.getCanvas().style.cursor="pointer"})),this.map.on("mouseleave",this.idLayerCentroid,(()=>{this.map.getCanvas().style.cursor=""}))):this.getInMap()&&this.updateInMap()}updateInMap(){const e=this.getInMap();e?e.setData({type:"FeatureCollection",features:this.generateFeatures()}):this.addToMap()}removeOfMap(){this.getInMap()&&(this.map.removeLayer(this.idLayer),this.map.removeLayer(`BORDER_${this.idLayer}`),this.map.removeSource(this.idSource),this.getCenterInMap()&&(this.map.removeLayer(this.idLayerCentroid),this.map.removeSource(this.idSourceCentroid)))}}},75724:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ge});var a=i(85893),s=i(67294),n=i(10046),o=i(41749),r=i(95477),d=i(282),c=i(79895),l=i(41120),u=i(41423),v=i(22318),p=i(18463),g=i(79912),m=i(71267),h=i(14096),j=i(62822),x=i(33570),y=i(50998),b=i(95757);const f=(0,l.Z)((e=>({disablePadding:{padding:0,margin:0,flex:1},nested:{margin:0,padding:0,marginLeft:e.spacing(2.5),flex:1}}))),O=({primary:e,Icon:t,isSubItem:i,isSelect:n,onClick:o})=>{(0,s.useEffect)((()=>()=>{}),[]);const r=f();return(0,a.jsxs)(y.Z,Object.assign({selected:n,onClick:o,dense:!0,button:!0,className:i?r.nested:r.disablePadding},{children:[t&&(0,a.jsx)(t,{fontSize:"small"},void 0),(0,a.jsx)(b.Z,{className:r.disablePadding,primary:e},void 0)]}),void 0)};var L=i(10465),C=i(73855),Z=i(18973),S=i(95090),k=i(66217);const w=({p:e})=>{const{selectedDownloadList:t}=(0,C.C)(Z.nx),i=(0,C.T)(),n=(0,s.useCallback)((e=>!!t.find((t=>t.id===e.id))),[t]);return(0,a.jsx)(O,{primary:`Celda - ${e.name?e.name:"SIN NOM"}`,onClick:()=>{return t=e,i((0,k.BG)(Object.assign(Object.assign({},t),{type:S.NZ.PAD}))),void i((0,k.Ru)());var t},isSelect:n(e)},void 0)},T=({padCells:e})=>{const t=(0,s.useState)(!1),[i]=t,n=e.map((e=>(0,a.jsx)(w,Object.assign({},{p:e}),e.id)));return(0,a.jsxs)(j.Z,Object.assign({dense:!0,style:{width:"100%",paddingLeft:4,maxHeight:"75vh",overflowY:"scroll"},subheader:(0,a.jsx)(x.v,{title:"Descarga",useOpen:t},void 0)},{children:[i&&(0,a.jsx)(L.V,{functionCancel:()=>{},functionFilter:()=>{}},void 0),n]}),void 0)},I=({p:e})=>{const{selectedDownloadList:t}=(0,C.C)(Z.nx),i=(0,C.T)(),n=(0,s.useCallback)((e=>!!t.find((t=>t.id===e.id))),[t]);return(0,a.jsx)(O,{primary:`Celda - ${e.name?e.name:"SIN NOM"}`,onClick:()=>{return t=e,i((0,k.Fc)(Object.assign(Object.assign({},t),{type:S.NZ.STOCK}))),void i((0,k.Ru)());var t},isSelect:n(e)},void 0)},D=({stockCells:e})=>{const t=(0,s.useState)(!1),[i]=t,n=e.map((e=>(0,a.jsx)(I,Object.assign({},{p:e}),e.id)));return(0,a.jsxs)(j.Z,Object.assign({dense:!0,style:{width:"100%",paddingLeft:4,maxHeight:"75vh",overflowY:"scroll"},subheader:(0,a.jsx)(x.v,{title:"Descarga",useOpen:t},void 0)},{children:[i&&(0,a.jsx)(L.V,{functionCancel:()=>{},functionFilter:()=>{}},void 0),n]}),void 0)};var E=i(78479);const $=({p:e})=>{const{selectedDownloadList:t}=(0,C.C)(Z.nx),i=(0,C.T)(),n=(0,s.useCallback)((e=>!!t.find((t=>t.id===e.id))),[t]);return(0,a.jsx)(O,{primary:`${e.name?e.name:"SIN NOM"}`,onClick:()=>{return t=e,i((0,k.dI)(Object.assign(Object.assign({},t),{type:S.NZ.DME}))),void i((0,k.Ru)());var t},isSelect:n(e)},void 0)},_=({dmeCells:e})=>{const t=(0,s.useState)(!1),[i]=t,n=e.map((e=>(0,a.jsx)($,Object.assign({},{p:e}),e.id)));return(0,a.jsxs)(j.Z,Object.assign({dense:!0,style:{width:"100%",paddingLeft:4,maxHeight:"75vh",overflowY:"scroll"},subheader:(0,a.jsx)(x.v,{title:"Descarga",useOpen:t},void 0)},{children:[i&&(0,a.jsx)(L.V,{functionCancel:()=>{},functionFilter:()=>{}},void 0),n]}),void 0)};const N=(0,l.Z)((e=>({nested:{marginLeft:e.spacing(1),marginBottom:0},root_unload:{display:"flex"},tabs:{borderRight:`1px solid ${e.palette.divider}`},tab:{minWidth:10,padding:1,paddingTop:8,paddingBottom:8},buttonTab:{writingMode:"vertical-rl"}})));function R(e){const{children:t,value:i,index:s}=e,n=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i}(e,["children","value","index"]);return(0,a.jsx)("div",Object.assign({role:"tabpanel",hidden:i!==s,id:`vertical-tabpanel-${s}`,"aria-labelledby":`vertical-tab-${s}`,style:{flex:1}},n,{children:i===s&&t}),void 0)}function A(e){return{id:`vertical-tab-${e}`,"aria-controls":`vertical-tabpanel-${e}`}}const F=({value:e,handleChange:t})=>{const i=N();return(0,a.jsxs)(h.Z,Object.assign({orientation:"vertical",variant:"scrollable",value:e,indicatorColor:"primary",textColor:"primary",onChange:t,"aria-label":"Vertical tabs",className:i.tabs},{children:[(0,a.jsx)(u.Z,Object.assign({className:i.tab,label:(0,a.jsx)(v.Z,Object.assign({variant:"caption",className:i.buttonTab},{children:"PAD"}),void 0)},A(0)),void 0),(0,a.jsx)(u.Z,Object.assign({className:i.tab,label:(0,a.jsx)(v.Z,Object.assign({variant:"caption",className:i.buttonTab},{children:"DME"}),void 0)},A(1)),void 0),(0,a.jsx)(u.Z,Object.assign({className:i.tab,label:(0,a.jsx)(v.Z,Object.assign({variant:"caption",className:i.buttonTab},{children:"STOCKs"}),void 0)},A(2)),void 0)]}),void 0)},M=()=>{const{padCellList:e,dmeCellList:t,stockCellList:i}=(0,C.C)(Z.WD),{selectedDownloadList:s}=(0,C.C)(Z.nx),n=N(),[r,d]=(0,E._)("index_tab_unload_operation",0);return(0,a.jsxs)(c.Z,Object.assign({elevation:4,style:{width:"100%"}},{children:[(0,a.jsxs)(o.Z,Object.assign({container:!0,className:n.root_unload},{children:[(0,a.jsx)(F,Object.assign({},{value:r,handleChange:(e,t)=>{d(t)}}),void 0),(0,a.jsx)(R,Object.assign({value:r,index:0},{children:(0,a.jsx)(T,{padCells:e.filter((e=>e.state!==S.p$.FINISHED))},void 0)}),void 0),(0,a.jsx)(R,Object.assign({value:r,index:1},{children:(0,a.jsx)(_,{dmeCells:t.filter((e=>e.state!==S.p$.FINISHED))},void 0)}),void 0),(0,a.jsx)(R,Object.assign({value:r,index:2},{children:(0,a.jsx)(D,{stockCells:i.filter((e=>e.state!==S.p$.FINISHED))},void 0)}),void 0)]}),void 0),(0,a.jsx)(p.Z,{children:(0,a.jsx)(g.Z,{children:s.map((e=>(0,a.jsx)(m.Z,{label:4===e.type?e.name:`Celda - ${e.name}`},e.id)))},void 0)},void 0)]}),void 0)};var P=i(65738),z=i(70461);const W=(0,l.Z)((e=>({root:{flex:1}}))),U=()=>{const e=(0,C.T)(),t=W(),[i,n]=(0,s.useState)([]);return(0,a.jsx)(c.Z,Object.assign({className:t.root,elevation:4,style:{flex:1}},{children:(0,a.jsx)(o.Z,Object.assign({container:!0,direction:"row"},{children:(0,a.jsx)(z.K,{handleonchangeTruck:t=>{e((0,k.Db)(t))},setTrucksSelect:n,trucksSelect:i,disableWithOperation:!0},void 0)}),void 0)}),void 0)};var B=i(64436),Y=i(52541),G=i(30553),K=i(40074),H=i(55517),V=i(72198);const J=(0,l.Z)((e=>({root:{flex:1},list:{maxHeight:"75vh",paddingLeft:e.spacing(1),marginLeft:e.spacing(1),overflowY:"scroll",marginBottom:e.spacing(2)}}))),q=()=>{const e=(0,s.useState)(!1),{excavatorInfoList:t}=(0,C.C)(V.kW),i=(0,C.T)(),[n,o]=(0,s.useState)([]);(0,s.useEffect)((()=>{o(t)}),[t]);const r=J();return(0,a.jsx)(c.Z,Object.assign({elevation:4,style:{width:"100%"}},{children:(0,a.jsx)(j.Z,Object.assign({className:r.list,dense:!0,disablePadding:!0,subheader:(0,a.jsx)(x.v,{title:"Palas",useOpen:e},void 0)},{children:(0,a.jsx)(y.Z,Object.assign({dense:!0,disableGutters:!0},{children:(0,a.jsx)(B.Z,Object.assign({size:"small",fullWidth:!0,component:"fieldset"},{children:(0,a.jsx)(Y.Z,Object.assign({"aria-label":"gender",name:"radio-buttons-group"},{children:n.map((e=>(0,a.jsxs)(s.Fragment,{children:[(0,a.jsx)(G.Z,{value:e.id,control:(0,a.jsx)(K.Z,{size:"small"},void 0),onClick:()=>(e=>{i((0,k.Zh)(e))})(e),label:(0,a.jsx)(v.Z,Object.assign({component:"span",variant:"body2"},{children:e.deviceAlias}),void 0)},void 0),(0,a.jsx)(H.Z,{},void 0)]},e.deviceId)))}),void 0)}),void 0)}),void 0)}),void 0)}),void 0)};var X=i(55501),Q=i(48101),ee=i(74248),te=i(14276),ie=i(8693),ae=i(62837),se=i(16886),ne=i(79800);const oe=({map:e})=>{const{excavatorInfoList:t}=(0,C.C)(V.kW),{truckInfoList:i}=(0,C.C)(ie.ej),n=(0,s.useMemo)((()=>{const t=i.filter((e=>e.sensor)),s=new te.c(t,e.current,"TRUCK_LIST_SOURCE","TRUCK_LIST_LAYER","truck_nav");return(0,a.jsx)(ae.b,{truckList:t,truckListClass:s},void 0)}),[i]),o=(0,s.useMemo)((()=>{const i=t.filter((e=>e.sensor)),s=new te.c(i,e.current,"EXCAVATOR_LIST_SOURCE","EXCAVATOR_LIST_LAYER","excavator_nav");return(0,a.jsx)(se.N,{excavatorList:i,excavatorListClass:s},void 0)}),[t]);return(0,a.jsxs)(a.Fragment,{children:[n,o]},void 0)},re=()=>{const e=(0,s.useRef)(null),t=(0,s.useRef)(null),{selectedUploadList:i,selectedDownloadList:n}=(0,C.C)(Z.nx);(0,s.useEffect)((()=>()=>{e.current=null}),[]);const[o,r]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{o&&(0,ne.H)(e)}),[o]),(0,a.jsxs)(a.Fragment,{children:[o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ee.f,Object.assign({},{polygonList:i,map:e.current,idSource:"UPLOAD_SOURCE",idLayer:"UPLOAD_LAYER",idSourceCentroid:"CENTROID_UPLOAD_SOURCE",idLayerCentroid:"CENTROID_UPLOAD_LAYER",haveCentroid:!0}),void 0),(0,a.jsx)(ee.f,Object.assign({},{polygonList:n,map:e.current,idSource:"DOWNLOAD_SOURCE",idLayer:"DOWNLOAD_LAYER",idSourceCentroid:"CENTROID_DOWNLOAD_SOURCE",idLayerCentroid:"CENTROID_DOWNLOAD_LAYER",haveCentroid:!0,onClickFeature:()=>{}}),void 0),(0,a.jsx)(oe,{map:e},void 0)]},void 0),(0,a.jsx)(Q.Z,Object.assign({map:e,dragRotate:!1,style:"mapbox://styles/dispatchgat/ckqqsfc2y46bo17sf1y29zwnj",mapContainer:t,bearing:0,pitch:15,height:"90vh"},{lat:-7.6163,lng:-78.196,zoom:14,setLoad:r}),void 0)]},void 0)};var de=i(78965),ce=i(5977),le=i(52672);const ue=()=>{const[e,t]=(0,s.useState)(!1),i=(0,ce.k6)(),c=(0,C.T)(),{selectedExcavator:l,selectedTruckList:u,selectedUploadList:v,selectedDownloadList:p}=(0,C.C)(Z.nx);return(0,s.useEffect)((()=>()=>{c((0,k.nw)())}),[]),(0,a.jsx)(n.Z,Object.assign({padding:1},{children:(0,a.jsx)(o.Z,Object.assign({container:!0,justifyContent:"flex-end",alignItems:"center",alignContent:"center"},{children:e?(0,a.jsx)(r.Z,{},void 0):(0,a.jsx)(d.Z,Object.assign({variant:"outlined",onClick:()=>{l.length<=0?c((0,le.L8)({msg:"Debe seleccionar una excavadora",open:!0,severity:"warning"})):v.length>0&&p.length>0?(t(!0),(0,X.pg)(v,p,u,l,[]).then((e=>{(0,le.L8)({msg:"Done!!",open:!0,severity:"success"}),c((0,k.nw)()),t(!1),i.replace("/operation")})).catch((e=>{console.log(e),t(!1),c((0,le.L8)({msg:`Error al guardar: posiblemente las unidades ya estan en otra operación: ${e.message}`,open:!0,severity:"warning"}))}))):c((0,le.L8)({msg:"Debe seleccionar un Carguío y descarga",open:!0,severity:"warning"}))},color:"primary",size:"small",startIcon:(0,a.jsx)(de.Z,{fontSize:"small"},void 0)},{children:"Guardar"}),void 0)}),void 0)}),void 0)},ve=()=>(0,a.jsxs)(o.Z,Object.assign({container:!0},{children:[(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)(o.Z,Object.assign({container:!0,style:{padding:4,flex:1}},{children:[(0,a.jsx)(P.m,{},void 0),(0,a.jsxs)(o.Z,Object.assign({container:!0,alignContent:"flex-start",style:{flex:1,marginLeft:8,marginRight:8,gap:8}},{children:[(0,a.jsx)(M,{},void 0),(0,a.jsx)(q,{},void 0)]}),void 0),(0,a.jsx)(U,{},void 0)]}),void 0),(0,a.jsx)(ue,{},void 0)]},void 0),(0,a.jsx)(re,{},void 0)]}),void 0);var pe=i(16281);function ge(){return(0,a.jsxs)("div",{children:[(0,a.jsx)(pe.h,{title:"Create Operation"},void 0),(0,a.jsx)(ve,{},void 0)]},void 0)}},8960:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>X});var a=i(85893),s=i(67294),n=i(5977),o=i(79895),r=i(50998),d=i(41749),c=i(95757),l=i(81860),u=i(66037),v=i(62822),p=i(31125),g=i(73099),m=i(61920);const h=({value:e,cy:t})=>{var i,s,n,o;switch(e){case m.u6.PAD:return(0,a.jsx)(c.Z,{primary:`Descarga: ${m.WW[t.download.type]} -  ${null===(i=t.download.pad.cellList[0])||void 0===i?void 0:i.name}`},void 0);case m.u6.DME:return(0,a.jsx)(c.Z,{primary:`Descarga: ${m.WW[t.download.type]} -  ${null===(s=t.download.dme.cellList[0])||void 0===s?void 0:s.name}`},void 0);case m.u6.PIT:return(0,a.jsx)(c.Z,{primary:`Descarga: ${m.WW[t.download.type]} -  ${null===(n=t.download.pit.cellList[0])||void 0===n?void 0:n.name}`},void 0);case m.u6.STOCK:return(0,a.jsx)(c.Z,{primary:`Descarga: ${m.WW[t.download.type]} -  ${null===(o=t.download.stock.cellList[0])||void 0===o?void 0:o.name}`},void 0);default:return(0,a.jsx)(a.Fragment,{},void 0)}},j=({value:e,cy:t})=>{switch(e){case m.u6.PIT:return(0,a.jsx)(c.Z,{primary:`Carga: ${m.WW[t.upload.type]} -  ${t.upload.pit.projectList[0].name}- ${t.upload.pit.projectList[0].polygonList[0].name}`},void 0);case m.u6.STOCK:return console.log("cy.upload.stock",t.upload.stock),(0,a.jsx)(c.Z,{primary:`Carga: ${m.WW[t.upload.type]} -  ${t.upload.stock.cellList[0].name}}`},void 0);default:return(0,a.jsx)(a.Fragment,{children:"node"},void 0)}},x=()=>(0,a.jsx)(o.Z,Object.assign({elevation:1,style:{marginBottom:4}},{children:(0,a.jsx)(r.Z,Object.assign({dense:!0,disableGutters:!0,selected:!0,button:!0},{children:(0,a.jsxs)(d.Z,Object.assign({justifyContent:"space-between",container:!0},{children:[(0,a.jsx)(c.Z,{primary:"TRUCK"},void 0),(0,a.jsx)(c.Z,{primary:"INICIO"},void 0),(0,a.jsx)(c.Z,{primary:"DESCARGA"},void 0),(0,a.jsx)(c.Z,{primary:"FIN"},void 0)]}),void 0)}),void 0)}),void 0),y=s.memo((({cy:e,index:t})=>{var i,n,m;const[x,y]=(0,s.useState)(!1),b=()=>{y(!x)},f=e.startTime?new Date(1e3*(null===(i=e.startTime)||void 0===i?void 0:i.seconds)).toLocaleString():"NO REG",O=e.downloadArrivalTime?new Date(1e3*(null===(n=e.downloadArrivalTime)||void 0===n?void 0:n.seconds)).toLocaleString():"NO REG. ",L=e.endTime?new Date(1e3*(null===(m=e.endTime)||void 0===m?void 0:m.seconds)).toLocaleString():"NO REG. ";return(0,a.jsxs)(o.Z,Object.assign({elevation:1,style:{marginBottom:4},id:e.id},{children:[(0,a.jsxs)(r.Z,Object.assign({dense:!0,disableGutters:!0,selected:!0,button:!0,onClick:b},{children:[(0,a.jsxs)(d.Z,Object.assign({justifyContent:"space-between",container:!0},{children:[(0,a.jsx)(c.Z,{primary:`${t}.${e.truck.deviceAlias} `},void 0),(0,a.jsx)(c.Z,{primary:f},void 0),(0,a.jsx)(c.Z,{primary:O},void 0),(0,a.jsx)(c.Z,{primary:L},void 0)]}),void 0),(0,a.jsx)(l.Z,Object.assign({onClick:b},{children:(0,a.jsx)(d.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:x?(0,a.jsx)(p.Z,{fontSize:"small",onClick:b},void 0):(0,a.jsx)(g.Z,{fontSize:"small",onClick:b},void 0)}),void 0)}),void 0)]}),void 0),(0,a.jsx)(u.Z,Object.assign({in:x,style:{paddingLeft:10}},{children:(0,a.jsxs)(v.Z,Object.assign({dense:!0,disablePadding:!0},{children:[(0,a.jsx)(r.Z,{children:(0,a.jsx)((()=>{let t="";return e.upload.pit&&(t="pit"),e.upload.stock&&(t="stock"),(0,a.jsx)(j,{value:t,cy:e},void 0)}),{},void 0)},void 0),(0,a.jsx)(r.Z,{children:(0,a.jsx)((()=>{var t,i,s;let n="";return(null===(t=e.download)||void 0===t?void 0:t.dme)&&(n="dme"),(null===(i=e.download)||void 0===i?void 0:i.pad)&&(n="pad"),(null===(s=e.download)||void 0===s?void 0:s.stock)&&(n="stock"),(0,a.jsx)(h,{value:n,cy:e},void 0)}),{},void 0)},void 0),(0,a.jsx)(r.Z,{children:(0,a.jsx)(c.Z,{primary:`Pala: ${e.excavator.deviceAlias} `},void 0)},void 0),(0,a.jsx)(r.Z,{children:(0,a.jsx)(c.Z,{primary:`Camion: ${e.truck.deviceAlias} `},void 0)},void 0)]}),void 0)}),void 0)]}),e.id)}));var b=i(96019),f=i(26209),O=i(71267),L=i(85639),C=i(13258),Z=i(10046),S=i(82285),k=i(22318),w=i(282),T=i(41120),I=i(30553);const D=(0,T.Z)((e=>({disabledSpacing:{},checkbox:{"& .MuiCheckbox-root":{margin:0,padding:0,paddingLeft:8}}}))),E=({truck:e,checked:t,useTrucksSelect:i})=>{const s=D(),[n,o]=i;return(0,a.jsx)(r.Z,Object.assign({button:!0,dense:!0,className:s.disabledSpacing},{children:(0,a.jsx)(I.Z,{className:s.checkbox,onChange:()=>{const t=n.findIndex((t=>e.deviceId===t.deviceId));-1===t?n.push(e):n.splice(t,1),o(JSON.parse(JSON.stringify(n)))},control:(0,a.jsx)(C.Z,{size:"small",checked:t,inputProps:{style:{padding:0}}},void 0),label:`${e.deviceAlias} `},void 0)}),void 0)};var $=i(34250),_=i(2780),N=i(24673),R=i(90179),A=i(98561);const F=({value:e,operationSelect:t})=>(0,a.jsx)(d.Z,Object.assign({item:!0},{children:(0,a.jsx)(O.Z,{style:{marginLeft:4},icon:(0,a.jsx)(A.Z,{},void 0),size:"small",label:(()=>{switch(e){case m.u6.DME:return`Descarga: ${m.WW[t.download.type]} ${t.download.dme.name}`;case m.u6.PAD:return`Descarga: ${m.WW[t.download.type]} ${t.download.pad.name}`;case m.u6.STOCK:return`Descarga: ${m.WW[t.download.type]}`;default:return""}})()},void 0)}),void 0),M=({value:e,operationSelect:t})=>(0,a.jsx)(d.Z,Object.assign({item:!0},{children:(0,a.jsx)(O.Z,{style:{marginLeft:4},icon:(0,a.jsx)(A.Z,{},void 0),size:"small",label:(()=>{switch(e){case m.u6.STOCK:return`Carga:  ${m.WW[t.upload.type]}  ${t.upload.stock.name}`;case m.u6.PIT:return`Carga:  ${m.WW[t.upload.type]}  ${t.upload.pit.name}`;default:return""}})()},void 0)}),void 0);var P=i(61242),z=i(57965),W=i(73855),U=i(52672),B=i(78715);const Y=e=>{const{operation:t}=e,[i,o]=s.useState(!1),r=(0,W.T)(),c=(0,n.k6)(),l=t&&t.excavatorList&&t.excavatorList.length>0?t.excavatorList[0]:{};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(d.Z,Object.assign({container:!0,style:{paddingLeft:2},alignItems:"center"},{children:[(0,a.jsx)(d.Z,Object.assign({item:!0},{children:(0,a.jsxs)(k.Z,Object.assign({variant:"button",style:{paddingLeft:4,paddingTop:16}},{children:["Detalle de operación",(0,a.jsx)(O.Z,{style:{marginLeft:4},icon:(0,a.jsx)(z.Z,{},void 0),size:"small",label:l.deviceAlias},void 0)]}),void 0)}),void 0),(0,a.jsx)(d.Z,Object.assign({item:!0},{children:(0,a.jsx)(O.Z,{style:{marginLeft:4},icon:(0,a.jsx)(z.Z,{},void 0),size:"small",label:`Trucks: ${t?t.truckList.length:0}`},void 0)}),void 0),(0,a.jsx)(d.Z,Object.assign({item:!0},{children:(0,a.jsx)(O.Z,{style:{marginLeft:4},icon:(0,a.jsx)(z.Z,{},void 0),size:"small",label:`Cycles: ${t?t.cycleList.length:0}`},void 0)}),void 0),(0,a.jsx)(d.Z,Object.assign({item:!0},{children:(0,a.jsx)((()=>{let e="";return t?(t.upload.pit&&(e="pit"),t.upload.stock&&(e="stock"),(0,a.jsx)(M,{value:e,operationSelect:t},void 0)):(0,a.jsx)(a.Fragment,{},void 0)}),{},void 0)}),void 0),(0,a.jsx)(d.Z,Object.assign({item:!0},{children:(0,a.jsx)((()=>{let e="";return t?(t.download.dme&&(e="dme"),t.download.pad&&(e="pad"),t.download.stock&&(e="stock"),(0,a.jsx)(F,{value:e,operationSelect:t},void 0)):(0,a.jsx)(a.Fragment,{},void 0)}),{},void 0)}),void 0),t&&t.state===m.J8.Operando&&(0,a.jsxs)(Z.Z,Object.assign({m:.5},{children:[(0,a.jsx)(w.Z,Object.assign({variant:"contained",color:"primary",onClick:()=>{o(!0)},size:"small"},{children:"Finalizar Operación"}),void 0),(0,a.jsx)(P.a,Object.assign({open:i,handleClose:()=>{o(!1)},handleConfirm:()=>{return e=void 0,i=void 0,s=function*(){const e=yield(0,_.wg)(t.id);e?r((0,U.L8)({open:!0,msg:e,severity:"error"})):(r((0,U.Ui)()),c.replace("/operation")),o(!1)},new((a=void 0)||(a=Promise))((function(t,n){function o(e){try{d(s.next(e))}catch(e){n(e)}}function r(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var i;e.done?t(e.value):(i=e.value,i instanceof a?i:new a((function(e){e(i)}))).then(o,r)}d((s=s.apply(e,i||[])).next())}));var e,i,a,s},title:"¿Esta seguro?"},{children:(0,a.jsxs)(B.Z,Object.assign({severity:"warning"},{children:["`Esta intentando finalizar la operacion $",t.excavatorList[0].deviceAlias,", si ocurre algun error se le informará`"]}),void 0)}),void 0)]}),void 0)]}),void 0)},void 0)};var G=i(76796),K=i(39299);function H(e,t){return(0,a.jsx)(y,{cy:e,index:t+1},e.id)}const V=function({cycles:e}){const[t,i]=(0,s.useState)([]),[n,o]=(0,s.useState)([]);return(0,s.useEffect)((()=>{const t=e.map((e=>e.truck)),a=[...new Set(t.map((e=>e.deviceId)))];i(a.map((e=>t.find((t=>t.deviceId===e)))))}),[e.length]),(0,a.jsxs)(v.Z,Object.assign({dense:!0,style:{margin:"0px 8px"}},{children:[(0,a.jsx)(b.Z,Object.assign({id:"id-label"},{children:"Filtro por Camión"}),void 0),(0,a.jsx)(f.Z,Object.assign({labelId:"id-label",style:{width:"100%"},multiple:!0,value:n,onChange:e=>{const t=e.target.value;o(t)},renderValue:e=>(0,a.jsx)("div",{children:e.map((e=>(0,a.jsx)(O.Z,{label:t.find((t=>t.deviceId===e)).deviceAlias,clickable:!0,deleteIcon:(0,a.jsx)(N.Z,{onMouseDown:e=>e.stopPropagation()},void 0),onDelete:t=>(e=>{const t=n.findIndex((t=>t===e));t>=0&&n.splice(t,1),o(JSON.parse(JSON.stringify(n)))})(e)},e)))},void 0)},{children:t.map((e=>(0,a.jsxs)(L.Z,Object.assign({value:e.deviceId},{children:[(0,a.jsx)(C.Z,{checked:!!n.find((t=>t===e.deviceId))},void 0),(0,a.jsx)(c.Z,{primary:e.deviceAlias},void 0)]}),e.deviceId)))}),void 0),(0,a.jsx)(Z.Z,{height:4},void 0),(0,a.jsx)(x,{},void 0),0===n.length?e.map(H):e.filter((e=>n.find((t=>t===e.truck.deviceId)))).map(H)]}),void 0)},J=()=>{const e=(0,s.useState)([]),{id:t}=(0,n.UO)(),i=e[0],l=(0,W.T)(),u=(0,n.k6)(),{operationDetail:p,status:g}=(0,W.C)(G.tl);console.log("operationDetail",p);const m=p&&p.cycleList;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(d.Z,Object.assign({container:!0},{children:[(0,a.jsx)(Y,{operation:p},void 0),(0,a.jsxs)(d.Z,Object.assign({container:!0},{children:[m&&(0,a.jsx)(d.Z,Object.assign({item:!0,md:6},{children:(0,a.jsx)(S.Z,Object.assign({direction:"left",in:!!p,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsxs)(o.Z,Object.assign({elevation:4},{children:[(0,a.jsx)(k.Z,Object.assign({variant:"button",style:{paddingLeft:8,paddingTop:16}},{children:"Ciclos"}),void 0),(0,a.jsx)(V,{cycles:p.cycleList},void 0)]}),void 0)}),void 0)}),void 0),(0,a.jsx)(d.Z,Object.assign({item:!0,md:3,style:{paddingLeft:4}},{children:(0,a.jsx)(S.Z,Object.assign({in:!!p,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsxs)(o.Z,Object.assign({elevation:4},{children:[(0,a.jsx)(k.Z,Object.assign({variant:"button",style:{paddingLeft:8,paddingTop:16}},{children:"Trucks"}),void 0),(0,a.jsxs)(v.Z,Object.assign({dense:!0},{children:[m&&p.truckList.map((t=>{return(0,a.jsx)(E,{checked:(s=t,!!i.find((e=>s.id===e.id))),useTrucksSelect:e,truck:t},t.id);var s})),(0,a.jsx)(r.Z,{children:(0,a.jsx)(w.Z,Object.assign({onClick:()=>{return e=void 0,t=void 0,s=function*(){(yield(0,_.We)(p.id,i))?(l((0,U.Ui)()),u.replace("/operation")):(l((0,U.Ui)()),l((0,U.L8)({open:!0,msg:"Ocurrió un error",severity:"error"})))},new((a=void 0)||(a=Promise))((function(i,n){function o(e){try{d(s.next(e))}catch(e){n(e)}}function r(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}d((s=s.apply(e,t||[])).next())}));var e,t,a,s},color:"secondary",variant:"contained",size:"small",disabled:0===i.length},{children:"Leave Trucks"}),void 0)},void 0)]}),void 0)]}),void 0)}),void 0)}),void 0),(0,a.jsxs)(d.Z,Object.assign({item:!0,md:3,style:{paddingLeft:4}},{children:[(0,a.jsx)(S.Z,Object.assign({in:!!p,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsxs)(o.Z,Object.assign({elevation:4},{children:[(0,a.jsx)(k.Z,Object.assign({variant:"button",style:{paddingLeft:8,paddingTop:16}},{children:"Roads"}),void 0),(0,a.jsx)(v.Z,Object.assign({dense:!0},{children:m&&p.roadList.map((e=>(0,a.jsx)(r.Z,{children:(0,a.jsx)(c.Z,{primary:`${e.name}`},void 0)},e.id)))}),void 0)]}),void 0)}),void 0),(0,a.jsx)($.Z,{visible:!0,actionClick:()=>{l((0,G.l4)(t))},Icon:R.Z,disabled:g==K.jR.LOADING,color:"secondary",right:16,keyAction:"R"},void 0)]}),void 0)]}),void 0)]}),void 0)},void 0)};var q=i(16281);function X(){const{id:e}=(0,n.UO)(),t=(0,W.T)();return(0,s.useEffect)((()=>{t((0,G.l4)(e))}),[e]),(0,a.jsxs)("div",{children:[(0,a.jsx)(q.h,{title:"Detail Operation"},void 0),(0,a.jsx)(J,{},void 0)]},void 0)}}}]);