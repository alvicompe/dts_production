"use strict";(self.webpackChunkdts_hytera=self.webpackChunkdts_hytera||[]).push([[219],{63663:(e,t,n)=>{n.d(t,{F2:()=>r,xu:()=>v.I,zx:()=>c,iz:()=>p,T5:()=>m,P4:()=>h,hU:()=>u,Mi:()=>b,IB:()=>o.C});var i=n(85893),s=n(8286),a=n(96588);const r=e=>(0,i.jsx)(a.ZP,Object.assign({},Object.assign({},e.propsAutocomplete),{renderInput:e=>(0,i.jsx)(s.Z,Object.assign({},e,{label:"Seleccione una opción",variant:"outlined"}))}));var o=n(45287),l=n(282);const c=e=>(0,i.jsx)(l.Z,Object.assign({},Object.assign({},e.propsButton),{children:e.label}));var d=n(17812);const u=e=>(0,i.jsx)(d.Z,Object.assign({},Object.assign({},e),{children:e.children}));var v=n(47463),g=n(41749);const m=e=>(0,i.jsx)(g.Z,Object.assign({},Object.assign({},e),{container:!0},{children:e.children})),h=e=>(0,i.jsx)(g.Z,Object.assign({},Object.assign({},e),{item:!0},{children:e.children}));var j=n(55517);const p=e=>(0,i.jsx)(j.Z,Object.assign({},Object.assign({},e)));var x=n(82285);const b=e=>(0,i.jsx)(x.Z,Object.assign({},Object.assign({},e),{children:(0,i.jsx)(g.Z,{children:e.children})}))},45287:(e,t,n)=>{n.d(t,{C:()=>r});var i=n(85893),s=n(64436),a=n(8286);const r=e=>{const{propsTextField:t,propsForm:n}=e;return(0,i.jsx)(s.Z,Object.assign({},Object.assign({},n),{children:(0,i.jsx)(a.Z,Object.assign({},Object.assign({},t)))}))}},47463:(e,t,n)=>{n.d(t,{I:()=>a});var i=n(85893),s=n(60395);const a=({children:e,height:t,width:n})=>(0,i.jsx)(s.Z,Object.assign({height:t,width:n},{children:e}))},61242:(e,t,n)=>{n.d(t,{a:()=>g});var i=n(85893),s=n(41120),a=n(52663),r=n(66083),o=n(29525),l=n(66856),c=n(95477),d=n(282),u=n(93584);const v=(0,s.Z)({disabledPadding:{padding:0,textAlign:"center"}}),g=({open:e,handleClose:t,handleConfirm:n,title:s,children:g,maxWidth:m="lg",disabled:h=!1,loading:j})=>{const p=v();return(0,i.jsxs)(a.Z,Object.assign({open:e,onClose:t,maxWidth:m},{children:[(0,i.jsx)(r.Z,Object.assign({style:{color:"white",background:`${u.Jx}`,padding:"0.5rem"},className:p.disabledPadding},{children:s})),(0,i.jsx)(o.Z,{children:g}),(0,i.jsx)(l.Z,{children:j?(0,i.jsx)(c.Z,{style:{width:"30px",height:"30px"}}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,Object.assign({size:"small",color:"primary",onClick:t},{children:"Cancelar"})),n&&(0,i.jsx)(d.Z,Object.assign({disabled:h,variant:"outlined",size:"small",color:"secondary",onClick:n,autoFocus:!0},{children:"Confirmar"}))]})})]}))}},11818:(e,t,n)=>{n.d(t,{y:()=>a});var i=n(67294),s=n(49032);const a=e=>{const[t,n]=(0,i.useState)(!0),[a,r]=(0,i.useState)(!0),[o,l]=(0,i.useState)(!0),[c,d]=(0,i.useState)(!0);return(0,i.useEffect)((()=>{const t=()=>0!==(null==e?void 0:e.length)&&(null==e?void 0:e.every((e=>{var t,n;return(null===(n=null===(t=null==e?void 0:e.initialEventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.event)===s.EnumEvent.NO_OPERATIONAL}))),i=()=>0!==(null==e?void 0:e.length)&&(null==e?void 0:e.every((e=>{var t,n;return(null===(n=null===(t=null==e?void 0:e.initialEventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.event)===s.EnumEvent.OPERATIONAL}))),a=()=>0!==(null==e?void 0:e.length)&&(null==e?void 0:e.every((e=>{var t,n;return(null===(n=null===(t=null==e?void 0:e.initialEventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.event)===s.EnumEvent.OPERATIONAL_DELAY}))),o=()=>0!==(null==e?void 0:e.length)&&(null==e?void 0:e.every((e=>{var t,n;return(null===(n=null===(t=null==e?void 0:e.initialEventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.event)===s.EnumEvent.MAINTENANCE}))),c=()=>0!==(null==e?void 0:e.length)&&(null==e?void 0:e.every((e=>{var t,n;return void 0===(null===(n=null===(t=null==e?void 0:e.initialEventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.event)})));n(!0),r(!0),l(!0),d(!0),i()&&(n(!1),r(!0),l(!1),d(!1)),c()&&(n(!1),r(!1),l(!1)),t()&&(n(!0),r(!1),l(!1)),a()&&(n(!1),r(!1),l(!0)),o()&&(n(!1),r(!1),l(!0),d(!0)),0==c()&&0==t()&&0==a()&&0==i()&&0==o()&&(n(!0),r(!0),l(!0),d(!0))}),[e]),[t,a,o,c]}},15635:(e,t,n)=>{n.d(t,{r:()=>a});var i=n(67294),s=n(95090);const a=e=>{const[t,n]=(0,i.useState)(!1);return(0,i.useEffect)((()=>(console.log("state",e),e===s.JD.DONE||e===s.JD.UNKNOWN||e===s.JD.ERROR?n(!1):n(!0),()=>{n(!1)})),[e]),[t]}},31379:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ut});var i=n(85893),s=n(41749),a=n(868),r=n(17812),o=n(30115),l=n(59240),c=n(95757),d=n(50998),u=n(71267),v=n(282),g=n(62822),m=n(79895),h=n(55517),j=n(60395),p=n(33681);const x=({loading:e})=>e?(0,i.jsx)(p.Z,{}):(0,i.jsx)(i.Fragment,{}),b="truck";var O=n(5200),f=n(93584),E=n(73855),N=n(73250),y=n(75647),S=n(44824),L=n(28231),C=n(715),T=n(95692),A=n(41042),k=n(67294),Z=n(78721),I=n(5814),w=n(49032),D=n(67774),R=n(52314),P=n(56731),z=n(7258),_=n(53559),W=n(97700),F=n(1754),M=n(57163),$=n(89452),U=n(99302),H=n(60465),G=function(e,t,n,i){return new(n||(n=Promise))((function(s,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};const K=(0,o.Z)({rootFilter:{flex:"0 0",margin:2,border:"1px dashed #7b81836e",cursor:"move",float:"left",width:"98%",background:f.sb},rootItem:{margin:2,border:"1px dashed #7b81836e",cursor:"move",float:"left",width:"98%",flex:"0 0"},rootItemTemporal:{flex:"0 0",margin:2,border:"1px dashed green",cursor:"move",float:"left",width:"98%",background:"#34d0ff6e"},rootItemTemporalRemove:{flex:"0 0",margin:2,border:"1px dashed red",background:"#ff60604a",cursor:"move",float:"left",width:"98%"},titleTruck:{fontSize:"1em",cursor:"move"},contentTruck:{margin:2,padding:0,width:"100%",position:"relative",height:"100%"},contentCycle:{height:16,minWidth:16,display:"flex",borderRadius:"50%",background:"#efecec",justifyContent:"center",alignItems:"center",justifyItems:"center"},stateTruck:{position:"absolute",fontSize:"0.5rem",top:0,left:0},containerMoreTruck:{position:"absolute",top:-6,right:2,cursor:"pointer"},moreTruck:{fontSize:"0.8rem",cursor:"pointer"},actions:{minWidth:36},labelCycleNumber:{fontSize:11,color:"#5a5757"},labelExcavator:{marginTop:4,background:"#424141",color:"#fff"},labelDistance:{marginTop:4,background:`${f.J$}20`}}),J=({truck:e})=>{var t;let n="",s=null;switch(null===(t=e.operativeState)||void 0===t?void 0:t.eventState){case Z.EnumEventState.UNKNOWN_STATE:s=(0,i.jsx)(y.Z,{style:{fontSize:"1rem"},fontSize:"small"}),n=e.operationList&&e.operationList.length>0?"En camino":"Sin operación";break;case Z.EnumEventState.DOWNLOAD:s=(0,i.jsx)(S.Z,{style:{fontSize:"1rem"},fontSize:"small"}),n=e.operativeState.name;break;case Z.EnumEventState.UPLOAD:s=(0,i.jsx)(L.Z,{style:{fontSize:"1rem"},fontSize:"small"}),n=e.operativeState.name;break;case Z.EnumEventState.TO_UPLOAD:s=(0,i.jsx)(C.Z,{style:{fontSize:"1rem",transform:"rotate(180deg)"},fontSize:"small"}),n=e.operativeState.name;break;case Z.EnumEventState.TO_DOWNLOAD:s=(0,i.jsx)(C.Z,{style:{fontSize:"1rem"},fontSize:"small"}),n=e.operativeState.name;break;default:s=(0,i.jsx)(T.Z,{style:{fontSize:"1rem"},fontSize:"small"}),n="Advertencia!!! en otro estado..."}return s&&(0,i.jsx)(a.ZP,Object.assign({title:n},{children:(0,i.jsx)(r.Z,Object.assign({style:{margin:0,padding:0,zIndex:4},size:"small",onClick:()=>{}},{children:s}))}))},V=({truck:e,temporal:t,operation:n,temporalRemove:r,eventFrom:o,isFilter:l=!1,distanceToExcavator:c,excavator:u,id:v})=>{var g;const h=(0,E.T)(),{eventStateList:j}=(0,E.C)(W.eG),{timeline:p}=(0,E.C)(I.h3),{user:x}=(0,E.C)(_.MR),[y,S]=(0,k.useState)(Number(null==p?void 0:p.initialHourmeter.toFixed(1))),{hours:L,minutes:C}=(()=>{const e=new Date;return{hours:e.getHours(),minutes:e.getMinutes()}})(),T=`${`00${L}`.slice(-2)}:${`00${C}`.slice(-2)}`,[V]=(0,k.useState)(T),{lostConnection:B}=(0,H.AT)(e),Y=K(),[{isDragging:X},q]=(0,O.c)((()=>({type:b,item:{truck:e},end:(t,i)=>{const s=i.getDropResult();i.canDrag(),null!==s&&(h((0,I.Qi)({truck:e,eventTo:null==s?void 0:s.eventTo,eventFrom:o})),h((0,D.CB)(null==s?void 0:s.eventTo)),h((0,I.h1)(e)),(null==s?void 0:s.operation)&&h((0,N.UN)({operationId:s.operation.id,truck:e,operationOldId:n?n.id:""})))},collect:e=>({isDragging:e.isDragging(),handlerId:e.getHandlerId()})})),[r,n,e]),Q=(0,k.useCallback)((()=>{var t;const n=null===(t=e.deviceAlias)||void 0===t?void 0:t.split("-");return n&&n.length>1?n[1]:""}),[e.deviceAlias]);return(0,i.jsx)(m.Z,Object.assign({id:v||`truck-${e.deviceId}`,style:{opacity:X?.5:1},className:l&&!r?Y.rootFilter:t?Y.rootItemTemporal:r?Y.rootItemTemporalRemove:Y.rootItem,ref:q,elevation:4},{children:(0,i.jsxs)(d.Z,Object.assign({disableGutters:!0,className:Y.contentTruck},{children:[(0,i.jsx)(A.Z,{className:Y.stateTruck,style:{color:B?f.fQ:f.FD},fontSize:"small"}),(0,i.jsxs)(s.Z,Object.assign({container:!0,onMouseDown:()=>G(void 0,void 0,void 0,(function*(){const e={id:"",name:"",event:o},t={id:"",deviceId:"",deviceAlias:"",initialHourmeter:0,finalHourmeter:0,initialEventState:{id:"",name:"",eventState:Z.EnumEventState.UNKNOWN_STATE,event:e},initialState:w.EnumEvent.UNKNOWN_STATE_EVENT,finalState:w.EnumEvent.UNKNOWN_STATE_EVENT,durationTime:0,shift:P.Shift.UNKNOWN_SHIFT,stateRegister:0,adjustment:0,status:!1,assetType:0,guard:z.EnumGuard.UNKNOWN_GUARD,userId:x.user.id};yield h((0,I.f0)(t))}))},{children:[(0,i.jsx)(s.Z,Object.assign({item:!0,style:{marginTop:4}},{children:(0,i.jsx)(a.ZP,{title:(()=>{var t,n;return(null===(n=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.name)?e.eventState.event.name:""})(),children:(0,i.jsx)("label",Object.assign({className:Y.titleTruck,style:{color:`${(e=>{var t;let n;switch(null===(t=null==e?void 0:e.event)||void 0===t?void 0:t.event){case w.EnumEvent.NO_OPERATIONAL:n=e.eventState===Z.EnumEventState.LACK_OF_OPERATOR?f.DM:f.oz;break;case w.EnumEvent.OPERATIONAL:n=f.Ez;break;case w.EnumEvent.OPERATIONAL_DELAY:n=f.Gj}return n})(e.eventState)}`}},{children:Q()})),onClick:()=>{(e=>{G(void 0,void 0,void 0,(function*(){var t,n,i,s;if(yield h((0,$.Gy)(w.EnumEvent.OPERATIONAL)),console.log("EventoObj: After"),(null===(n=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.event)===w.EnumEvent.OPERATIONAL_DELAY||(null===(s=null===(i=e.eventState)||void 0===i?void 0:i.event)||void 0===s?void 0:s.event)===w.EnumEvent.NO_OPERATIONAL&&e.operationList.length>0){yield h((0,I.h1)(e));const t=j.find((e=>{var t;return(null===(t=e.event)||void 0===t?void 0:t.event)===w.EnumEvent.OPERATIONAL}));console.log("EventoObj: ",t);const n=null,i=null,s=null,a=Number(y);if(null==t?void 0:t.event){const r={id:"",deviceAlias:e.deviceAlias,deviceId:e.deviceId,initialHourmeter:a,adjustment:0,durationTime:0,finalHourmeter:0,initialTime:T,initialEventState:Object.assign(Object.assign({},t),{id:"",name:"",eventState:Z.EnumEventState.UNKNOWN_STATE}),initialState:w.EnumEvent.OPERATIONAL,finalState:n,shift:i,status:!1,stateRegister:s,assetType:M.EnumAssetType.TRUCK,guard:z.EnumGuard.UNKNOWN_GUARD,userId:x.user.id};(0,I.hO)(r),yield h((0,F.BU)({timeline:r,hour:V})),h((0,N.hS)()),h((0,U.RK)()),console.log("Cambiando a Operative")}}}))})(e)}})})),(0,i.jsxs)(s.Z,Object.assign({item:!0},{children:[(0,i.jsxs)(s.Z,Object.assign({container:!0,className:Y.actions,alignItems:"center"},{children:[(0,i.jsx)(J,{truck:e}),(0,i.jsx)("div",Object.assign({style:{display:"flex",flexDirection:"row",alignItems:"center"}},{children:(0,i.jsx)(a.ZP,Object.assign({title:(()=>{let t=!1;return null==n||n.truckList.find((n=>{n.deviceId===e.deviceId&&(t=!0)})),t})()?"Agregar Ciclo":"Número de ciclos"},{children:(0,i.jsx)("div",Object.assign({className:Y.contentCycle},{children:(0,i.jsx)("label",Object.assign({className:Y.labelCycleNumber,onClick:()=>{h((0,R.eh)(e))}},{children:void 0===e.cycleNumber?"0":e.cycleNumber}))}))}))}))]})),void 0!==c&&(0,i.jsx)(s.Z,Object.assign({item:!0,className:Y.labelDistance},{children:(0,i.jsxs)("label",Object.assign({className:Y.titleTruck},{children:[c.toFixed(2),"m"]}))})),void 0!==u&&(0,i.jsx)(s.Z,Object.assign({item:!0,className:Y.labelExcavator},{children:(0,i.jsx)("label",Object.assign({className:Y.titleTruck},{children:e.operationList&&e.operationList.length>0?null===(g=e.operationList[0].excavator)||void 0===g?void 0:g.deviceAlias:""}))}))]}))]}))]}))}))};var B=n(63663),Y=n(48101),X=n(10980),q=n(6777),Q=n(95090),ee=n(89613),te=n(34344),ne=n(54150),ie=n(40036);class se{constructor(e,t,n,i,s,a,r,o){this.circleList=e,this.map=t,this.idSource=n,this.radius=s,this.idLayer=i,this.fontSize=9,this.color=a,this.transparent=r,this.onClickElement=o}getInMap(){return this.map.getSource(this.idSource)}generateFeatures(){return this.circleList.map((e=>({type:"Feature",properties:{label:e.label},geometry:{type:"Point",coordinates:2===e.point.length?e.point:[0,0]}})))}addToMap(){var e,t;!this.getInMap()&&this.circleList.length>0&&(this.map.getSource(this.idSource)||this.map.addSource(this.idSource,{type:"geojson",data:{type:"FeatureCollection",features:this.generateFeatures()}}),this.map.getLayer(this.idLayer)||(this.map.addLayer({id:this.idLayer,type:"circle",source:this.idSource,paint:{"circle-radius":{stops:[[0,0],[20,(e=this.radius,t=this.circleList[0].point[1],e/.075/Math.cos(t*Math.PI/180))]],base:2},"circle-stroke-color":this.color,"circle-stroke-width":this.transparent?2:0,"circle-color":this.color,"circle-opacity":this.transparent?0:1}}),this.map.addLayer({id:this.idLayer+"LABEL",type:"symbol",source:this.idSource,layout:{"text-field":["get","label"],"text-variable-anchor":["top"],"text-radial-offset":.5,"text-justify":"auto","text-allow-overlap":!0}})),this.map.on("click",this.idLayer,(e=>{this.onClickElement&&this.onClickElement(e)})),this.map.on("mouseenter",this.idLayer,(()=>{this.map.getCanvas().style.cursor="pointer"})),this.map.on("mouseleave",this.idLayer,(()=>{this.map.getCanvas().style.cursor=""})))}updateInMap(){const e=this.getInMap();e?e.setData({type:"FeatureCollection",features:this.generateFeatures()}):this.addToMap()}removeOfMap(){this.getInMap()&&(this.map.removeLayer(this.idLayer),this.map.removeLayer(this.idLayer+"LABEL")),this.map.removeSource(this.idSource)}}var ae=n(78479),re=n(45287),oe=n(34880);const le=(0,o.Z)({rootList:{flex:1,padding:2,margin:2,overflow:"auto"},rootMap:{borderRadius:16,position:"relative",right:0,left:0},mapBackground:{position:"absolute",right:0,left:0,top:0,bottom:0,zIndex:1}}),ce=({operation:e})=>{const t=(0,k.useRef)(null),[n,a]=(0,ae._)(`RADIOSEX${e.excavatorList&&e.excavatorList.length>0?e.excavatorList[0].deviceAlias:""}`,35),r=le(),o=(0,k.useRef)(null),{excavator:l,truckInRange:c,truckListInOperation:d}=(({operation:e,radio:t})=>{const[n,i]=(0,k.useState)(X.kM),[s,a]=(0,k.useState)([]),[r,o]=(0,k.useState)([]),{initial:l,truckStream:c}=(0,E.C)(te.dc),{initial:d,excavatorStream:u}=(0,E.C)(ee.oT);return(0,k.useEffect)((()=>{if(l===q.Vj.INITIAL&&c.sensor&&c.sensor.latitude&&n.sensor&&n.sensor.latitude&&!s.some((e=>e.deviceId===c.deviceId))){const e=(0,ne.xmu)([c.sensor.longitude,c.sensor.latitude]),i=(0,ne.xmu)([n.sensor.longitude,n.sensor.latitude]),s=(0,ne.TE$)(e,i),a=r.findIndex((e=>e.truck.deviceId===c.deviceId)),l=[...r];if(1e3*s<=t){const e={truck:c,distance:1e3*s};if(console.log("distanceBettween",s,a),-1===a){let t="";switch(n.deviceAlias.slice(0,2)){case"EX":t="excavadora";break;case"CF":t="cargador frontal"}const i=Number(c.deviceAlias.slice(-2));(0,ie.jQ)(`volquete ${i} en ${t} ${n.deviceAlias.slice(-2)}`),l.push(e)}else l[a]=e;o(l)}else-1!==a&&(l.splice(a,1),o(l))}}),[c,s,t]),(0,k.useEffect)((()=>{var e;n.deviceId&&d===Q.JD.DONE&&u.deviceId===n.deviceId&&(!n.sensor&&u.sensor||u.sensor&&u.sensor.latitude!==(null===(e=n.sensor)||void 0===e?void 0:e.latitude))&&i(u)}),[u]),(0,k.useEffect)((()=>{e.excavatorList&&n.deviceId!=e.excavatorList[0].deviceId&&i(e.excavatorList[0]);let t=!1;const s=[...r];e.truckList.forEach((e=>{const n=r.findIndex((t=>t.truck.deviceId===e.deviceId));n>-1&&(s.splice(n,1),console.log("truckInRangeremommmmm",n),t=!0)})),t&&o(s),a(e.truckList)}),[e.truckList]),{truckListInOperation:s,truckInRange:r,excavator:n}})({operation:e,radio:n}),[u,v]=(0,k.useState)(!1);(0,k.useEffect)((()=>()=>{o.current=null,t.current=null}),[]),(0,k.useEffect)((()=>{let e,n;if(u&&l.deviceId&&l.sensor&&l.sensor.latitude){const i={point:[l.sensor.longitude,l.sensor.latitude],label:l.deviceAlias};e=new se([i],t.current,`ID_SOUCE_CIRCLE_${l.deviceAlias}`,`ID_LAYER_CIRCLE_${l.deviceAlias}`,oe.Xb,f.J$,!0),e.addToMap(),n=new se([i],t.current,`ID_SOUCE_EXCAVATOR_${l.deviceAlias}`,`ID_SOUCE_EXCAVATOR_${l.deviceAlias}`,1,f.sb,!1),e.addToMap(),n.addToMap(),setTimeout((()=>{var e;null===(e=t.current)||void 0===e||e.setCenter(i.point)}),100)}return()=>{e&&(e.removeOfMap(),n.removeOfMap())}}),[u,l]),(0,k.useEffect)((()=>{let e;if(u&&l.deviceId&&d.length>0){const n=d.map((e=>e.sensor?{point:[e.sensor.longitude,e.sensor.latitude],label:`C${e.deviceAlias.slice(-2)} /${e.sensor.speed.toFixed(0)}kh`}:{point:[0,0],label:""}));e=new se(n,t.current,`ID_SOUCE_TRUCKOPE_${l.deviceAlias}`,`ID_SOUCE_TRUCKOPE_${l.deviceAlias}`,1,"green",!1),e.addToMap()}return()=>{e&&e.removeOfMap()}}),[u,d]),(0,k.useEffect)((()=>{let e;if(u&&l.deviceId&&c.length>0){const n=c.map((e=>{var t,n;return{point:[e.truck.sensor?e.truck.sensor.longitude:0,e.truck.sensor?e.truck.sensor.latitude:0],label:`C${e.truck.deviceAlias.slice(-2)} /${null===(n=null===(t=e.truck)||void 0===t?void 0:t.sensor)||void 0===n?void 0:n.speed.toFixed(0)}kh`}}));e=new se(n,t.current,`ID_SOUCE_TRUCKRANGE_${l.deviceAlias}`,`ID_LAYER_TRUCKRANGE_${l.deviceAlias}`,1,f.J$,!1),e.addToMap()}return()=>{e&&e.removeOfMap()}}),[u,c]);const g=(0,k.useMemo)((()=>(0,i.jsx)(B.T5,Object.assign({style:{position:"absolute",top:0,zIndex:2}},{children:(0,i.jsx)(B.T5,Object.assign({container:!0,direction:"row"},{children:c.map((e=>(0,i.jsx)(V,{eventFrom:e.truck.operationList&&e.truck.operationList.length>0?w.EnumEvent.OPERATIONAL:w.EnumEvent.UNKNOWN_STATE_EVENT,truck:e.truck,distanceToExcavator:e.distance,excavator:l},e.truck.deviceId)))}))}))),[c,l.deviceAlias]),m=(0,k.useMemo)((()=>(0,i.jsx)(B.P4,Object.assign({item:!0},{children:(0,i.jsx)(re.C,{propsForm:{},propsTextField:{variant:"outlined",size:"small",label:"Radio de proximidad",style:{marginTop:8},onChange:e=>{const t=parseInt(e.target.value);t&&a(t)},value:n}})}))),[n]);return(0,i.jsxs)(s.Z,Object.assign({className:r.rootList},{children:[m,(0,i.jsxs)(B.P4,Object.assign({item:!0,className:r.rootMap},{children:[g,(0,i.jsxs)(B.T5,{children:[(0,i.jsx)(B.P4,{className:r.mapBackground}),(0,i.jsx)(Y.Z,Object.assign({map:t,dragRotate:!1,style:"mapbox://styles/dispatchgat/ckqqsfc2y46bo17sf1y29zwnj",mapContainer:o,bearing:0,pitch:15},{lat:-7.6163,lng:-78.196,zoom:18,setLoad:v},{height:"300px",dragControls:!1}),"map2")]})]}))]}))};var de=n(43829),ue=n(82200),ve=n(59544),ge=n(7654),me=n(78965),he=n(22318),je=n(64436),pe=n(52541),xe=n(30553),be=n(40074),Oe=n(95477),fe=n(52663),Ee=n(66856),Ne=n(29525);function ye({open:e,setOpen:t,handleClickConfirm:n,children:s,loading:a,handleClose:r}){return(0,i.jsxs)(fe.Z,Object.assign({fullWidth:!0,maxWidth:"lg",open:e,onClose:r||(()=>{t(!1)}),"aria-labelledby":"max-width-dialog-title"},{children:[(0,i.jsx)(Ne.Z,{children:s}),(0,i.jsx)(Ee.Z,{children:a?(0,i.jsx)(Oe.Z,{}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.Z,Object.assign({onClick:r,size:"small",color:"primary"},{children:"Cancel"})),(0,i.jsx)(v.Z,Object.assign({onClick:n,variant:"outlined",size:"small",color:"secondary"},{children:"Confirm"}))]})})]}))}var Se=n(61242),Le=n(76533),Ce=n(52672),Te=n(14125),Ae=n(41120),ke=n(10465),Ze=n(13258);const Ie=(0,Ae.Z)((e=>({disabledSpacing:{margin:0,padding:0,width:"auto"},checkbox:{"& .MuiCheckbox-root":{margin:0,padding:0,paddingLeft:8}}}))),we=k.memo((({truck:e,checked:t,trucksSelect:n,setTrucksSelect:s,disableWithOperation:a,handleonchangeTruck:r})=>{const o=Ie(),l=e.state>=0?e.state===Z.EnumEventState.UNKNOWN_STATE&&e.operationList&&e.operationList.length>0?"En camino":Q.SS[e.state]:"Conexión perdida",u=e.operationList&&e.operationList.length>0&&e.operationList[0]&&e.operationList[0].excavator?e.operationList[0].excavator.deviceAlias:"";return(0,i.jsx)(d.Z,Object.assign({button:!0,dense:!0,className:o.disabledSpacing,disabled:!!a&&!!u},{children:(0,i.jsx)(xe.Z,{className:o.checkbox,onChange:()=>{const t=n.findIndex((t=>e.deviceId===t.deviceId));-1===t?n.push(e):n.splice(t,1),s(JSON.parse(JSON.stringify(n)))},control:(0,i.jsx)(Ze.Z,{onClick:()=>r(e),size:"small",checked:t,inputProps:{style:{padding:0}}}),label:(0,i.jsx)(c.Z,{primary:`${e.deviceAlias} ${u?` ➜ ${u}`:""} (${l})`})})}))})),De=(0,Ae.Z)({root:{paddingLeft:4,maxHeight:"60vh",overflowY:"scroll",boxShadow:"inset 0px -2px 10px 0px rgb(17 16 10 / 56%)",borderRadius:4},searchContainer:{marginRight:8}}),Re=k.memo((({trucksSelect:e,setTrucksSelect:t,handleonchangeTruck:n,disableWithOperation:a})=>{const{truckInfoList:r}=(0,E.C)(U.ej),o=De(),[l,c]=(0,k.useState)([]),[d,u]=(0,k.useState)("");(0,k.useEffect)((()=>{c(r.filter((e=>e.deviceAlias.toLowerCase().includes(d.toLowerCase()))))}),[r]);const v=(0,k.useCallback)((e=>{if(e){const t=e.target?e.target.value.toUpperCase():"";c(r.filter((e=>e.deviceAlias.toUpperCase().includes(t)))),u(t)}}),[r]),m=(0,k.useCallback)((()=>{c(r),u("")}),[r]);return(0,i.jsxs)(g.Z,Object.assign({dense:!0,disablePadding:!0,style:{margin:4,paddingTop:4}},{children:[(0,i.jsx)(ke.V,{functionFilter:v,functionCancel:m}),(0,i.jsx)(s.Z,Object.assign({container:!0,className:o.root},{children:l.map((s=>{return(0,i.jsx)(k.Fragment,{children:(0,i.jsx)(we,{handleonchangeTruck:n,disableWithOperation:a,checked:(r=s,!!e.find((e=>r.deviceId===e.deviceId))),trucksSelect:e,setTrucksSelect:t,truck:s})},s.deviceId);var r}))}))]}))}));var Pe=n(44562),ze=n(61920);const _e=(e,t,n,i)=>{return s=void 0,a=void 0,o=function*(){n(!0);const s=yield(0,Le.e1)(e,t);n(!1),i((e=>!e));let a="";s.truckErrorList.length>0&&s.truckErrorList.forEach((e=>{const t=1===e.state?"CARGANDO":"A DESCARGA";a+=` ${e.truckError.deviceAlias}=> ${t},`})),""!==a&&alert(`Las siguientes unidades no han podido ser reasignadas: ${a}`)},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{l(o.next(e))}catch(e){t(e)}}function i(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var s;t.done?e(t.value):(s=t.value,s instanceof r?s:new r((function(e){e(s)}))).then(n,i)}l((o=o.apply(s,a||[])).next())}));var s,a,r,o},We=({open:e,setOpen:t,setRefresh:n,operations:r})=>{const o=(0,E.T)(),[l,u]=(0,k.useState)([]),[v,h]=(0,k.useState)(""),[j,p]=(0,k.useState)([]),[x,b]=(0,k.useState)(!1),[O,f]=k.useState(!1);(0,k.useEffect)((()=>{o(U.RK),o(Te.CE)}),[]);const N=e=>{h(e.target.value)};return(0,i.jsxs)(ye,Object.assign({},{loading:O},{open:e,handleClickConfirm:()=>{j.length<=0||v.length<=0?o((0,Ce.L8)({open:!0,msg:"Debe seleccionar almenos una excavadora y un camión",severity:"warning"})):b(!0)},handleClose:()=>{t(!1),p([]),h("")}},{children:[(0,i.jsx)(s.Z,Object.assign({container:!0},{children:(0,i.jsx)(s.Z,Object.assign({item:!0,xs:12},{children:(0,i.jsx)(he.Z,Object.assign({variant:"button",style:{paddingLeft:8,paddingTop:16}},{children:"Reasignación de camiones"}))}))})),(0,i.jsxs)(s.Z,Object.assign({container:!0,style:{paddingLeft:4}},{children:[(0,i.jsx)(s.Z,Object.assign({item:!0,xs:6},{children:(0,i.jsx)(m.Z,Object.assign({elevation:4},{children:(0,i.jsx)(Re,{handleonchangeTruck:()=>{},setTrucksSelect:p,trucksSelect:j})}))})),(0,i.jsx)(s.Z,Object.assign({item:!0,xs:6},{children:(0,i.jsx)(m.Z,Object.assign({style:{margin:10}},{children:(0,i.jsxs)(g.Z,{children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{secondary:"Excavadora de destino"})}),(0,i.jsx)(d.Z,{children:(0,i.jsx)(c.Z,{children:(0,i.jsx)(je.Z,Object.assign({component:"fieldset"},{children:(0,i.jsx)(pe.Z,Object.assign({row:!0,"aria-label":"gender",name:"radio-buttons-group"},{children:r.map((e=>{var t;return(0,i.jsx)(a.ZP,Object.assign({title:e.state!==ze.J8.Operando?"Excavadora sin operación":"Excavadora de destino"},{children:(0,i.jsx)(xe.Z,{value:e.id,disabled:e.state!==ze.J8.Operando,control:(0,i.jsx)(be.Z,{disabled:e.state!==ze.J8.Operando}),onChange:N,label:`  ${null===(t=e.excavatorList[0])||void 0===t?void 0:t.deviceAlias}`})}),e.id)}))}))}))})})]})}))}))]})),(0,i.jsx)(Se.a,Object.assign({open:x,handleClose:()=>{b(!1)},handleConfirm:()=>{b(!1),t(!1),p([]),h(""),_e(v,j,f,n)},title:"Area you sure?"},{children:(0,i.jsx)(Pe.Z,Object.assign({severity:"warning"},{children:"Intentaremos mover estos camiones, si ocurre algun error se le informará"}))}))]}))};var Fe=n(30433),Me=n(73727),$e=n(2780),Ue=n(66083),He=n(8286),Ge=n(86072),Ke=n(89601);const Je=({newOperation:e})=>{const t=(0,E.T)(),n=()=>{t((0,Ke.mg)())},o=(0,k.useMemo)((()=>e.uploadList.map(((e,t)=>{const s=e.type===ze.WW.TAJO?`\n      ${e.nameProject}-${e.name}-${e.material?e.material.type:""}\n      `:e.name;return(0,i.jsx)(u.Z,{color:"secondary",label:s,onDelete:n},t)}))),[e.uploadList]);return 0===e.uploadList.length?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(s.Z,Object.assign({item:!0},{children:(0,i.jsxs)(s.Z,Object.assign({container:!0},{children:[(0,i.jsx)(a.ZP,Object.assign({title:"Change Upload"},{children:(0,i.jsx)(r.Z,Object.assign({color:"primary",size:"small"},{children:(0,i.jsx)(Ge.Z,{})}))})),o]}))}))},Ve=({newOperation:e})=>{const t=(0,E.T)(),n=(0,k.useMemo)((()=>e.downloadList.map(((e,n)=>(0,i.jsx)(u.Z,{color:"secondary",label:e.name,onDelete:()=>{return n=e.id,void t((0,Ke.$g)({id:n}));var n}},n)))),[e.downloadList]);return 0===e.downloadList.length?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(s.Z,Object.assign({item:!0},{children:(0,i.jsxs)(s.Z,Object.assign({container:!0},{children:[(0,i.jsx)(a.ZP,Object.assign({title:"Change Download"},{children:(0,i.jsx)(r.Z,Object.assign({color:"primary",size:"small"},{children:(0,i.jsx)(Ge.Z,{})}))})),n]}))}))},Be=({newOperation:e})=>{const t=(0,E.T)(),n=()=>{t((0,Ke.QW)())},o=(0,k.useMemo)((()=>e.excavatorList.map(((e,t)=>{const s=e.deviceAlias;return(0,i.jsx)(u.Z,{color:"secondary",label:s,onDelete:n},t)}))),[e.excavatorList]);return 0===e.excavatorList.length?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(s.Z,Object.assign({item:!0},{children:(0,i.jsxs)(s.Z,Object.assign({container:!0},{children:[(0,i.jsx)(a.ZP,Object.assign({title:"Change Excavator"},{children:(0,i.jsx)(r.Z,Object.assign({color:"primary",size:"small"},{children:(0,i.jsx)(Ge.Z,{})}))})),o]}))}))};var Ye=n(96588),Xe=n(97111),qe=n(50648);const Qe=({open:e,operation:t,setOpen:n})=>{const[r,o]=(0,k.useState)([]),{excavatorInfoList:l}=(0,E.C)(Te.kW),c=(0,k.useRef)(),{dmeCellList:d,padCellList:g,stockCellList:m,polygonList:p}=(0,E.C)(W.WD),[x,b]=(0,k.useState)(Xe.f.CHANGE_NOTHING),[O,f]=(0,k.useState)(ze.WW.DESCONOCIDO),[N,y]=(0,k.useState)(qe.TypeDownload.UNKNOWN),S=(0,E.T)(),{newOperation:L}=(0,E.C)(W.e5),C=(e,t,n)=>{const i=t.find((t=>t.id===e));i&&S((0,Ke.qn)(Object.assign(Object.assign({},i),{type:n})))},T=(e,t,n)=>{const i=t.find((t=>t.id===e));i&&S((0,Ke.Ru)(Object.assign(Object.assign({},i),{type:n})))},A=(0,k.useCallback)((()=>(0,Xe.BF)(x,O,p,m,N,d,g,l)),[x,O,p,m,N,d,g,l]);return(0,i.jsxs)(fe.Z,Object.assign({open:e,onClose:n,title:"Migrate Operation"},{children:[(0,i.jsx)(Ue.Z,Object.assign({style:{paddingTop:8,paddingBottom:0}},{children:"Update Operation Attributes"})),(0,i.jsx)(Ne.Z,Object.assign({style:{minHeight:320}},{children:(0,i.jsxs)(s.Z,Object.assign({container:!0,direction:"column"},{children:[(0,i.jsx)(s.Z,Object.assign({item:!0},{children:(0,i.jsxs)(s.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,i.jsx)(he.Z,{children:"Upload:"}),(0,i.jsx)(Fe.g7,{operation:t,lineThrough:L.uploadList.length>0}),(0,i.jsx)(Je,Object.assign({},{operation:t,newOperation:L}))]}))})),(0,i.jsx)(j.Z,{width:"100%",height:8}),(0,i.jsxs)(s.Z,Object.assign({item:!0},{children:[(0,i.jsxs)(s.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,i.jsx)(he.Z,{children:"Download: "}),(0,i.jsx)(Fe.DQ,{operation:t,lineThrough:L.downloadList.length>0}),(0,i.jsx)(Ve,Object.assign({},{operation:t,newOperation:L}))]})),(0,i.jsx)(j.Z,{width:"100%",height:8}),(0,i.jsx)(h.Z,{orientation:"horizontal"}),(0,i.jsx)(a.ZP,Object.assign({title:"Puede agregar hasta 2 puntos de descarga"},{children:(0,i.jsx)(he.Z,Object.assign({style:{fontSize:11}},{children:"*You can add up to 2 download points, example 1 DME and 1 PAD or 1 STOCK"}))})),(0,i.jsx)(h.Z,{orientation:"horizontal"})]})),(0,i.jsx)(j.Z,{width:"100%",height:8}),(0,i.jsx)(s.Z,Object.assign({item:!0},{children:(0,i.jsxs)(s.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,i.jsx)(he.Z,{children:"Excavator: "}),(0,i.jsx)(Fe.Ez,{operation:t,lineThrough:L.excavatorList.length>0}),(0,i.jsx)(Be,Object.assign({},{operation:t,newOperation:L}))]}))})),(0,i.jsx)(j.Z,{height:8}),(1!==L.excavatorList.length||2!==L.downloadList.length||1!==L.uploadList.length)&&(0,i.jsx)(s.Z,Object.assign({item:!0,style:{marginTop:8}},{children:(0,i.jsx)(Ye.ZP,{size:"small",value:r,blurOnSelect:!0,onChange:(e,t)=>{switch(o(t),t.length){case 0:b(Xe.f.CHANGE_NOTHING),f(ze.WW.DESCONOCIDO),y(qe.TypeDownload.UNKNOWN);break;case 1:b(t[0].value),f(ze.WW.DESCONOCIDO),y(qe.TypeDownload.UNKNOWN);break;case 2:switch(x){case Xe.f.CHANGE_UPLOAD:f(Number(t[1].value));break;case Xe.f.CHANGE_DOWNLOAD:y(Number(t[1].value));break;case Xe.f.CHANGE_EXCAVATOR:((e,t)=>{const n=t.find((t=>t.id===e));n&&S((0,Ke.Zh)(n))})(t[1].value,l),o([]),b(Xe.f.CHANGE_NOTHING)}break;case 3:switch(x){case Xe.f.CHANGE_UPLOAD:switch(O){case ze.WW.TAJO:C(t[2].id,p,ze.WW.TAJO);break;case ze.WW.STOCK:C(t[2].id,m,ze.WW.STOCK)}break;case Xe.f.CHANGE_DOWNLOAD:switch(N){case qe.TypeDownload.DME:T(t[2].id,d,N);break;case qe.TypeDownload.PAD:T(t[2].id,g,N);break;case qe.TypeDownload.STOCK:T(t[2].id,m,N)}}f(ze.WW.DESCONOCIDO),y(qe.TypeDownload.UNKNOWN),b(Xe.f.CHANGE_NOTHING),o([])}setTimeout((()=>{var e,t;null===(e=c.current)||void 0===e||e.focus(),null===(t=c.current)||void 0===t||t.click()}),100)},options:A(),multiple:!0,renderTags:(e,t)=>e.map(((e,n)=>(0,i.jsx)(u.Z,Object.assign({variant:"outlined",label:e.label},t({index:n}))))),style:{minWidth:200},getOptionLabel:e=>e.label,openOnFocus:!0,disableClearable:!0,getOptionDisabled:e=>(0,Xe.HT)(e,L,N),filterSelectedOptions:!0,renderInput:e=>(0,i.jsx)(He.Z,Object.assign({},e,{autoFocus:!0,inputRef:c,label:"Cómo puedo ayudarte?",variant:"outlined",fullWidth:!0}))})}))]}))})),(0,i.jsx)(Ee.Z,{children:(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(v.Z,Object.assign({onClick:n,size:"small",color:"primary"},{children:"Cancel"})),(0,i.jsx)(v.Z,Object.assign({variant:"outlined",size:"small",color:"secondary",onClick:()=>{S((0,Ke.db)({oldOperation:t,newOperation:L}))}},{children:"Save"}))]})})]}))};var et=n(76796);const tt=(0,o.Z)({rootList:{flex:1,padding:2,margin:2,overflow:"auto"},rootNoDropItem:{padding:2,margin:2,width:32,height:"92vh"},rootListOver:{flex:1,padding:2,margin:2,overflow:"auto",background:"#80808045"},rootNotDropList:{width:300,padding:2,margin:2,overflow:"auto",zIndex:1,transform:"translateX(-50%) translateY(130px) rotate(-90deg)",msTransform:"translateX(-50%) translateY(130px) rotate(-90deg)",mozTransform:"translateX(-50%) translateY(130px) rotate(-90deg)",OTransform:"translateX(-50%) translateY(130px) rotate(-90deg)",position:"absolute",left:"50%",top:"0%"},rootNotOperation:{width:36,padding:2,margin:2,background:`${f.J$}10`,borderColor:f.J$,borderWidth:2,borderStyle:"dotted"},disabledPadding:{padding:0,paddingBottom:2,flex:1},labelExcavator:{fontSize:21,borderRadius:8,borderStyle:"dotted",padding:4,margin:2,background:"#424141",color:"#fff"}}),nt=({operation:e})=>{const t=tt(),n=e.excavatorList.length>0?e.excavatorList[0]:null;return(0,i.jsxs)(B.T5,Object.assign({container:!0,className:t.disabledPadding,alignItems:"center",justifyContent:e.id?"flex-start":"flex-end"},{children:[(0,i.jsx)(B.P4,Object.assign({item:!0},{children:(0,i.jsx)(c.Z,{secondary:(0,i.jsx)("strong",Object.assign({className:t.labelExcavator},{children:null==n?void 0:n.deviceAlias}))})})),!e.id&&(0,i.jsx)(Me.rU,Object.assign({style:{textDecoration:"none"},to:`/operation/create/${n?n.deviceId:""}/${n?n.id:""}`},{children:(0,i.jsx)(a.ZP,Object.assign({title:`Asignar operación a ${n?n.deviceAlias:""}`},{children:(0,i.jsx)(r.Z,Object.assign({size:"small",color:"secondary"},{children:(0,i.jsx)(de.Z,{fontSize:"small"})}))}))}))]}))},it=({operation:e,loading:t,setLoading:n,setRefresh:o})=>{const l=tt(),[c,g]=(0,k.useState)(!1),[m,h]=(0,k.useState)(!1),{timeline:j}=(0,E.C)(I.h3),[p,x]=(0,k.useState)(Number(null==j?void 0:j.initialHourmeter.toFixed(1))),[b,O]=(0,k.useState)(null),{hours:f,minutes:y}=(()=>{const e=new Date;return{hours:e.getHours(),minutes:e.getMinutes()}})(),S=`${`00${f}`.slice(-2)}:${`00${y}`.slice(-2)}`,[L,C]=(0,k.useState)(S),{user:T}=(0,E.C)(_.MR),A=()=>{h((e=>!e))},D=(0,E.T)(),{state:P}=(0,E.C)(W.e5),{eventStateList:$}=(0,E.C)(W.eG);(0,k.useEffect)((()=>{switch(P){case Ke.m4.SAVING:n(!0);break;case Ke.m4.ERROR:n(!1);break;case Ke.m4.DONE:n(!1),h(!1)}}),[P]);const U=()=>g((e=>!e)),H=e.excavatorList.length>0?e.excavatorList[0]:null;return e.id?(0,i.jsxs)(d.Z,Object.assign({disableGutters:!0,className:l.disabledPadding},{children:[(0,i.jsx)(Se.a,Object.assign({open:c,handleClose:U,handleConfirm:()=>{return t=void 0,i=void 0,a=function*(){n(!0);const t=yield(0,$e.wg)(e.id);D(t?(0,Ce.L8)({open:!0,msg:t,severity:"error"}):(0,Ce.Ui)()),n(!1),o((e=>!e)),g(!1)},new((s=void 0)||(s=Promise))((function(e,n){function r(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(r,o)}l((a=a.apply(t,i||[])).next())}));var t,i,s,a},title:"Esta seguro?"},{children:(0,i.jsxs)(Pe.Z,Object.assign({severity:"warning"},{children:["Esta intentando finalizar la operacion"," ",e.excavatorList[0].deviceAlias,", si ocurre algun error se le informará"]}))})),(0,i.jsxs)(s.Z,Object.assign({container:!0},{children:[(0,i.jsxs)(s.Z,Object.assign({container:!0},{children:[(0,i.jsx)(nt,Object.assign({},{operation:e})),(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(a.ZP,Object.assign({title:"Cambiar Carga/Descarga/Cambiones/Excavadora"},{children:(0,i.jsx)(r.Z,Object.assign({color:"secondary",size:"small",onClick:A},{children:(0,i.jsx)(ue.Z,{fontSize:"small"})}))})),(0,i.jsx)(a.ZP,Object.assign({title:"Finalizar Operación"},{children:(0,i.jsx)(r.Z,Object.assign({color:"secondary",onClick:U,size:"small"},{children:(0,i.jsx)(ve.Z,{fontSize:"small"})}))})),(0,i.jsx)(a.ZP,Object.assign({title:"Detalle Operación"},{children:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(r.Z,Object.assign({color:"secondary",size:"small",onClick:()=>{D((0,et.l4)(H.deviceId)),D((0,R.m1)(H))}},{children:(0,i.jsx)(ge.Z,{fontSize:"small"})}))})}))]})]})),(0,i.jsxs)(s.Z,Object.assign({item:!0,md:12},{children:[(0,i.jsx)(Fe.g7,{operation:e}),(0,i.jsx)(Fe.DQ,{operation:e}),e.truckList.length>0?(0,i.jsx)(u.Z,{size:"small",label:`${e.truckList.length} camiones`}):(0,i.jsx)(i.Fragment,{})]})),(0,i.jsx)(s.Z,Object.assign({item:!0},{children:e.truckTemporalList&&e.truckTemporalList.length>0&&!t&&(0,i.jsx)(a.ZP,Object.assign({title:"Guardar cambios"},{children:(0,i.jsx)(v.Z,Object.assign({size:"small",variant:"outlined",color:"secondary",startIcon:(0,i.jsx)(me.Z,{color:"secondary",fontSize:"small"}),onClick:()=>{var t;D((0,N.hK)({operationId:e.id})),_e(e.id,e.truckTemporalList,n,o);const i=$.find((e=>{var t;return(null===(t=e.event)||void 0===t?void 0:t.event)===w.EnumEvent.OPERATIONAL}));(null===(t=null==i?void 0:i.event)||void 0===t?void 0:t.event)&&e.truckTemporalList.map((e=>{var t,n,s,a;if(console.log("eventStateObject: ",i),(null===(n=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.event)===w.EnumEvent.NO_OPERATIONAL||(null===(a=null===(s=e.eventState)||void 0===s?void 0:s.event)||void 0===a?void 0:a.event)===w.EnumEvent.OPERATIONAL_DELAY){D((0,I.h1)(e));const t=null,n=null,s=null,a=Number(p),r={id:"",deviceAlias:e.deviceAlias,deviceId:e.deviceId,initialHourmeter:a,adjustment:0,durationTime:0,finalHourmeter:0,initialTime:S,initialEventState:Object.assign(Object.assign({},i),{id:"",name:"",eventState:Z.EnumEventState.UNKNOWN_STATE}),initialState:w.EnumEvent.OPERATIONAL,finalState:t,shift:n,status:!1,stateRegister:s,assetType:M.EnumAssetType.TRUCK,guard:z.EnumGuard.UNKNOWN_GUARD,userId:T.user.id};(0,I.hO)(r),D((0,F.BU)({timeline:r,hour:L})),console.log("Changuin Operative")}}))}},{children:"GUARDAR"}))}))})),(0,i.jsx)(Qe,{open:m,operation:e,setOpen:A})]}))]})):(0,i.jsx)(nt,Object.assign({},{operation:e}))},st=({operation:e,filterList:t})=>{const n=(0,k.useMemo)((()=>{var n;return null===(n=e.truckTemporalList)||void 0===n?void 0:n.map(((n,s)=>(0,i.jsx)(V,{operation:e,truck:n,eventFrom:w.EnumEvent.OPERATIONAL,temporal:!0,isFilter:t.some((e=>e.deviceId===n.deviceId))},s)))}),[e.truckTemporalList]);return(0,i.jsx)(i.Fragment,{children:n})},at=({operation:e,filterList:t})=>{const[n,s]=(0,k.useState)(e.truckList);(0,k.useEffect)((()=>{s((t=>e.truckList&&e.truckList.length!==n.length||n.some((t=>e.truckList.some((e=>e.deviceId==t.deviceId&&(t.sensor&&e.sensor?t.cycleNumber!==e.cycleNumber||t.state!==e.state||t.eventState!==e.eventState||t.sensor.latitude!=e.sensor.latitude:t.cycleNumber!==e.cycleNumber||t.state!==e.state||t.eventState!==e.eventState)))))?e.truckList:t))}),[e.truckList]);const a=(0,k.useMemo)((()=>e.truckList.map(((n,s)=>{var a;return(0,i.jsx)(V,{operation:e,isFilter:t.some((e=>e.deviceId===n.deviceId)),eventFrom:w.EnumEvent.OPERATIONAL,truck:n,temporalRemove:null===(a=e.truckTemporalRemoveList)||void 0===a?void 0:a.some((e=>e.deviceId===n.deviceId))},s)}))),[n,t]);return(0,i.jsx)(i.Fragment,{children:a})},rt=({operation:e,setRefresh:t,filterList:n})=>{const[a,r]=(0,k.useState)(!1),[o,c]=(0,k.useState)(X.kM);(0,k.useEffect)((()=>{e&&e.truckList&&e.truckList.length>0?c((t=>o.deviceId!==e.excavatorList[0].deviceId?e.excavatorList[0]:t)):c(X.kM)}),[e]);const[{canDrop:d,isOver:u},v]=(0,l.L)((()=>({accept:b,drop:()=>({operation:e,eventTo:w.EnumEvent.OPERATIONAL}),collect:t=>({isOver:!!t.isOver(),canDrop:!!e.id})})),[e]),p=tt(),O=(0,k.useCallback)((()=>u&&d?p.rootListOver:u&&!d?p.rootNotDropList:p.rootList),[u,d]),f=(0,k.useMemo)((()=>(0,i.jsx)(i.Fragment,{children:o&&(0,i.jsx)(ce,{truckList:[],operation:e})})),[o,e]),E=(0,k.useMemo)((()=>(0,i.jsxs)(s.Z,Object.assign({container:!0},{children:[(0,i.jsx)(at,{operation:e,filterList:n}),(0,i.jsx)(st,{operation:e,filterList:n})]}))),[e,n]);return d?(0,i.jsxs)(g.Z,Object.assign({ref:v,disablePadding:!0,component:m.Z,style:{display:"flex",flexDirection:"column"},className:O()},{children:[(0,i.jsxs)(B.P4,Object.assign({item:!0,style:{flex:1}},{children:[(0,i.jsx)(it,Object.assign({},{operation:e,setLoading:r,loading:a,setRefresh:t})),(0,i.jsx)(h.Z,{orientation:"horizontal"}),(0,i.jsx)(x,{loading:a}),(0,i.jsx)(j.Z,{height:4}),E]})),f]})):(0,i.jsx)(g.Z,Object.assign({disablePadding:!0,component:m.Z,className:p.rootNotOperation},{children:(0,i.jsx)("div",Object.assign({className:p.rootNotDropList},{children:(0,i.jsx)(it,Object.assign({},{operation:e,setLoading:r,loading:a,setRefresh:t}))}))}))};var ot=n(14129),lt=n(57865);const ct=e=>{if(!e)return"";const t=ze.PW[e.type];switch(e.type){case 1:return e.pit&&e.pit.projectList&&e.pit.projectList.length>0&&e.pit.projectList[0].polygonList&&e.pit.projectList[0].polygonList.length>0?`${e.pit.projectList[0].name} - ${e.pit.projectList[0].polygonList[0].name}`:"";case 3:return e[t]&&e[t].cellList&&e[t].cellList.length>0?e[t].cellList[0].name:"";default:return""}},dt=e=>{if(!e&&1!==e.type)return"";const t=ze.PW[e.type];return`${"dme"===t?"Desm.":"stock"===t?"STK":"Mine."} ${e[t]&&e[t].cellList&&e[t].cellList.length>0?e[t].cellList[0].name:""}`},ut=()=>(0,i.jsx)(s.Z,Object.assign({container:!0,justifyContent:"center",alignItems:"center"},{children:(0,i.jsx)(s.Z,Object.assign({item:!0},{children:(0,i.jsx)(he.Z,{children:"No data found"})}))}));var vt=n(58365);const gt=({height:e,width:t})=>(0,i.jsx)(s.Z,Object.assign({container:!0,justifyContent:"center",alignItems:"center"},{children:(0,i.jsx)(vt.Z,{height:e,width:t,variant:"rect"})}));var mt=n(14741),ht=n(17215),jt=n(59693);const pt=(0,Ae.Z)((e=>({search:{position:"relative",marginRight:2,borderRadius:e.shape.borderRadius,backgroundColor:(0,jt.Fq)(e.palette.common.white,.15),"&:hover":{backgroundColor:(0,jt.Fq)(e.palette.common.white,.25)},marginLeft:0,width:"100%",[e.breakpoints.up("sm")]:{width:"auto"}},searchIcon:{padding:e.spacing(0,0),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},cancelIcon:{padding:e.spacing(0,0),height:"100%",alignItems:"center",justifyContent:"center",display:"flex"},inputRoot:{color:"inherit"},inputInput:{padding:e.spacing(1,1,1,0),paddingLeft:`calc(1em + ${e.spacing(1)}px)`,paddingRight:`calc(1em + ${e.spacing(1)}px)`,transition:e.transitions.create("width"),width:"100%",[e.breakpoints.up("sm")]:{width:"40ch","&:focus":{width:"50ch"}}}}))),xt=({search:e,setSearch:t})=>{const n=pt(),a=(0,k.useRef)();(0,k.useEffect)((()=>{document.onkeydown=r}),[]);const r=(0,k.useCallback)((e=>{"Escape"===e.key&&(l(),setTimeout((()=>{var e;console.log("Escape",a.current),null===(e=a.current)||void 0===e||e.focus()}),300))}),[]),o=(0,k.useCallback)((e=>{t(e.target.value)}),[]),l=(0,k.useCallback)((()=>{t("")}),[]);return(0,i.jsx)(m.Z,Object.assign({style:{marginTop:2,marginRight:2}},{children:(0,i.jsx)(s.Z,Object.assign({container:!0,alignItems:"center"},{children:(0,i.jsxs)("div",Object.assign({className:n.search},{children:[(0,i.jsx)("div",Object.assign({className:n.searchIcon},{children:(0,i.jsx)(ht.Z,{color:"primary",fontSize:"small"})})),(0,i.jsx)(mt.Z,{color:"primary",value:e,autoFocus:!0,inputRef:a,onKeyDown:r,onChange:o,placeholder:"Buscar...",classes:{root:n.inputRoot,input:n.inputInput},inputProps:{"aria-label":"search"}})]}))}))}))};var bt=n(31125);n(73099);const Ot=({enumEvent:e})=>{const{truck:t,events:n}=(0,E.C)(I.h3),{eventTo:s,eventFrom:a}=n;return(0,i.jsx)(i.Fragment,{children:s==w.EnumEvent.OPERATIONAL&&a==w.EnumEvent.MAINTENANCE&&1==e||s==e?(0,i.jsx)(V,{eventFrom:w.EnumEvent.UNKNOWN_STATE_EVENT,id:`truck-hormeter-${null==t?void 0:t.deviceId}`,truck:t,isFilter:!1},null==t?void 0:t.deviceId):(0,i.jsx)(i.Fragment,{})})};var ft=n(11818);const Et=(0,Ae.Z)({rootNoDropItem:{},rootListOver:{marginBottom:4,background:"#80808045"},root:{padding:2},rootList:{marginBottom:4},ListItem:{padding:0,margin:0},itemHeaderList:{flex:1,paddingLeft:2},textHeaderList:{margin:0},iconTextList:{padding:0,margin:0},chipText:{height:12,color:"#fff",fontWeight:"bold"}}),Nt=({items:e,filterList:t,title:n,useVisibleList:s,keyState:a,isAviable:r})=>{(0,E.T)();const o=Et(),[{canDrop:v,isOver:h},j]=(0,l.L)((()=>({accept:b,drop:()=>({eventTo:a}),collect:e=>({isOver:e.isOver(),canDrop:!0})})),[]),p=(0,k.useCallback)((()=>h&&v?o.rootListOver:o.rootList),[h,v]),[x,O]=s,f=(0,k.useMemo)((()=>e.map((e=>(0,i.jsx)(V,{eventFrom:a,truck:e,isFilter:t.some((t=>t.deviceId===e.deviceId))},e.deviceId)))),[e,t]),N=(0,k.useCallback)((()=>{const e=x.findIndex((e=>e.value===a));if(e>-1){const t=JSON.parse(JSON.stringify(x));t[e].visible=!t[e].visible,O(t)}}),[x]);return(0,i.jsxs)(g.Z,Object.assign({ref:!1===r?j:null,component:m.Z,disablePadding:!0,className:p()},{children:[(0,i.jsx)(d.Z,Object.assign({button:!0,disableGutters:!0,className:o.ListItem,onClick:N},{children:(0,i.jsxs)(B.T5,Object.assign({container:!0,justifyContent:"space-between",alignItems:"center"},{children:[(0,i.jsxs)(B.P4,Object.assign({className:o.itemHeaderList,container:!0,direction:"column",justifyContent:"center",alignContent:"flex-start"},{children:[(0,i.jsx)(c.Z,{className:o.textHeaderList,secondary:n}),(0,i.jsx)(u.Z,{size:"small",className:o.chipText,color:"primary",label:`(${e.length}) camiones`})]})),e.length?(0,i.jsx)(B.hU,Object.assign({size:"small",className:o.iconTextList},{children:(0,i.jsx)(bt.Z,{fontSize:"small"})})):(0,i.jsx)(i.Fragment,{})]}))})),(0,i.jsx)(B.iz,{orientation:"horizontal"}),(0,i.jsx)(B.Mi,Object.assign({direction:"left",in:!0,mountOnEnter:!0,unmountOnExit:!0},{children:(0,i.jsxs)(B.T5,Object.assign({container:!0,justifyContent:"center"},{children:[f,(0,i.jsx)(Ot,{enumEvent:a})]}))}))]}))},yt=({truckAvailable:e,filterList:t})=>{const n=(0,E.T)(),{timelineObject:s,truck:a}=(0,E.C)(I.h3),[r,o,l,c]=(0,ft.y)(s),{mantoList:d,DOperativeList:u,NOperativeList:v}=(e=>{const{truck:t,events:n}=(0,E.C)(I.h3),[i,s]=(0,k.useState)([]),[a,r]=(0,k.useState)([]),[o,l]=(0,k.useState)([]),[c,d]=(0,k.useState)([]);return(0,k.useEffect)((()=>{r((t=>{const n=e.filter((e=>{var t,n;return e.eventState&&(null===(n=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.event)===w.EnumEvent.MAINTENANCE}));return t.length===n.length&&JSON.stringify(t)===JSON.stringify(n)?t:n})),l((t=>{const n=e.filter((e=>{var t,n;return e.eventState&&(null===(n=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.event)===w.EnumEvent.OPERATIONAL_DELAY}));return t.length===n.length&&JSON.stringify(t)===JSON.stringify(n)?t:n})),d((t=>{const n=e.filter((e=>{var t,n,i,s,a,r,o,l;return e.eventState&&(null===(n=null===(t=e.eventState)||void 0===t?void 0:t.event)||void 0===n?void 0:n.event)===w.EnumEvent.NO_OPERATIONAL||e.state===Z.EnumEventState.UNKNOWN_STATE&&e.eventState&&(null===(s=null===(i=e.eventState)||void 0===i?void 0:i.event)||void 0===s?void 0:s.event)===w.EnumEvent.UNKNOWN_STATE_EVENT||e.eventState&&(null===(r=null===(a=e.eventState)||void 0===a?void 0:a.event)||void 0===r?void 0:r.event)===w.EnumEvent.OPERATIONAL||(null===(l=null===(o=e.eventState)||void 0===o?void 0:o.event)||void 0===l?void 0:l.event)===w.EnumEvent.UNKNOWN_STATE_EVENT}));return t.length===n.length&&JSON.stringify(t)===JSON.stringify(n)?t:n}))}),[e]),{availableList:i,mantoList:a,DOperativeList:o,NOperativeList:c}})(e);(0,k.useEffect)((()=>()=>{n((0,I.S)())}),[a]);const g=Et(),m=(0,ae._)("VISIBLE_STATES_TABS",Object.keys(w.EnumEvent).map(((e,t)=>({value:w.EnumEvent[e],label:e,visible:!1})))),h=(0,k.useMemo)((()=>(0,i.jsx)(B.T5,Object.assign({className:g.root},{children:(0,i.jsx)(Nt,{items:v,filterList:t,title:"NOPERATIVO",useVisibleList:m,keyState:w.EnumEvent.NO_OPERATIONAL,isAviable:r})}))),[v,t,m]),j=(0,k.useMemo)((()=>(0,i.jsx)(B.T5,Object.assign({className:g.root},{children:(0,i.jsx)(Nt,{items:d,filterList:t,title:"MANTO",useVisibleList:m,keyState:w.EnumEvent.MAINTENANCE,isAviable:c})}))),[d,t,m]),p=(0,k.useMemo)((()=>(0,i.jsx)(B.T5,Object.assign({className:g.root},{children:(0,i.jsx)(Nt,{items:u,filterList:t,title:"DOPERATIVO",useVisibleList:m,keyState:w.EnumEvent.OPERATIONAL_DELAY,isAviable:l})}))),[u,t,m]);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(B.T5,Object.assign({className:g.root},{children:[h,j,p]}))})};var St=n(96617),Lt=n(47463);const Ct=(0,Ae.Z)({paddingContainer:{padding:8}}),Tt=({timeline:e,truck:t,eventSelect:n,setRefresh:a})=>{var r,o,l;const c=Ct(),d=(0,k.useRef)(),u=(0,k.useRef)(),g=(0,k.useRef)(),h=(0,E.T)(),{stateCreateTimeline:j}=(0,E.C)(F.yV),{eventStateList:p}=(0,E.C)(W.eG),[x,b]=(0,k.useState)([]),[O,f]=(0,k.useState)(Number(e.initialHourmeter.toFixed(1))),[N,y]=(0,k.useState)(null),[S,L]=(0,k.useState)(null),{hours:C,minutes:T}=(()=>{const e=new Date;return{hours:e.getHours(),minutes:e.getMinutes()}})(),A=`${`00${C}`.slice(-2)}:${`00${T}`.slice(-2)}`,[D,R]=(0,k.useState)(A),{user:P}=(0,E.C)(_.MR),{events:$}=(0,E.C)(I.h3),{eventTo:U,eventFrom:H}=$;(0,k.useEffect)((()=>{p.length>0&&(b(p),y(p[0]))}),[p,n]),(0,k.useEffect)((()=>{d&&d.current&&(d.current.focus(),d.current.setSelectionRange(d.current.value.length-2,d.current.value.length))}),[d]);const G=e=>{if(console.log("enumEventState Value: ",N),console.log("enumEventStateHig Value: ",S),"Scape"===e.key)return y(null),void setTimeout((()=>{var e;L(null),null===(e=g.current)||void 0===e||e.focus()}),100);if(("Enter"===e.key||"Tab"===e.key)&&p.length>0){if(console.log("enumEventHigthlight",S),S)return y(S),void setTimeout((()=>{var e;L(null),null===(e=g.current)||void 0===e||e.focus()}),100);if(N)console.log("saving"),K();else{const e=x.filter((e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(g.current?g.current.value.toLocaleLowerCase():"")}));console.log("filterd",e),e.length>0&&(y(e[0]),setTimeout((()=>{L(null)}),100))}}else y(null)},K=()=>{return e=void 0,i=void 0,r=function*(){if(N){const e=null,i=null,s=null,r=Object.assign({},N);n===w.EnumEvent.OPERATIONAL&&(r.eventState=Z.EnumEventState.UNKNOWN_STATE,r.id="",r.name="");const o=Number(O);if(o>=0){const l={id:"",deviceAlias:t.deviceAlias,deviceId:t.deviceId,initialHourmeter:o,adjustment:0,durationTime:0,finalHourmeter:0,initialTime:A,initialEventState:r,initialState:n,finalState:e,shift:i,status:!1,stateRegister:s,assetType:M.EnumAssetType.TRUCK,guard:z.EnumGuard.UNKNOWN_GUARD,userId:P.user.id};switch(n){case w.EnumEvent.MAINTENANCE:break;case w.EnumEvent.NO_OPERATIONAL:r.eventState===Z.EnumEventState.LACK_OF_OPERATOR&&t.operationList.length>0&&(console.log("removing Of Operation... ",t.deviceAlias),yield(0,$e.We)(t.operationList[0].id,[t]));case w.EnumEvent.OPERATIONAL:case w.EnumEvent.OPERATIONAL_DELAY:}console.log("savingnewTimeline",l),(0,I.hO)(l),yield h((0,F.BU)({timeline:l,hour:D})),h((0,I.Go)()),a((e=>!e))}else alert("Ingrese un horometro correcto")}else alert("Seleccionar un evento")},new((s=void 0)||(s=Promise))((function(t,n){function a(e){try{l(r.next(e))}catch(e){n(e)}}function o(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s((function(e){e(n)}))).then(a,o)}l((r=r.apply(e,i||[])).next())}));var e,i,s,r};return(0,i.jsx)(m.Z,Object.assign({elevation:4},{children:(0,i.jsxs)(s.Z,Object.assign({className:c.paddingContainer},{children:[(0,i.jsxs)(he.Z,{children:["Camión ",t.deviceAlias]}),(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)("div",{children:["Estado actual: ",null===(o=null===(r=e.initialEventState)||void 0===r?void 0:r.event)||void 0===o?void 0:o.name]}),(0,i.jsxs)("div",{children:["Horometro aprox: ",e.initialHourmeter.toFixed(1),"h"]}),(0,i.jsxs)(s.Z,Object.assign({style:{marginTop:8,minHeight:"25vh"}},{children:[(()=>{if(H===w.EnumEvent.MAINTENANCE&&U===w.EnumEvent.OPERATIONAL||H===w.EnumEvent.OPERATIONAL&&U===w.EnumEvent.MAINTENANCE)return!0})()&&(0,i.jsx)(re.C,{propsForm:{},propsTextField:{variant:"outlined",autoFocus:!1,size:"small",label:"Horometro de ingreso",inputRef:d,onChange:e=>{e.target.value?f(e.target.value):f("")},value:O,inputProps:{onKeyDown:e=>{"Enter"===e.key&&u.current&&u.current.focus()}}}}),(0,i.jsx)(re.C,{propsForm:{},propsTextField:{variant:"outlined",autoFocus:!1,size:"small",inputRef:u,type:"time",value:D,onChange:e=>{R(e.target.value)},inputProps:{onKeyDown:e=>{"Enter"===e.key&&g.current&&(g.current.focus(),g.current.setSelectionRange(0,g.current.value.length))}}}}),(0,i.jsx)(Lt.I,{height:8,width:"100%"}),(0,i.jsx)(B.T5,{children:x.length>0&&((null===(l=x[0].event)||void 0===l?void 0:l.event)!=w.EnumEvent.OPERATIONAL?(0,i.jsx)(Ye.ZP,{renderInput:e=>(0,i.jsx)(He.Z,Object.assign({},e,{fullWidth:!0,variant:"outlined",onKeyDown:G,inputRef:g})),options:x,fullWidth:!0,blurOnSelect:!0,onChange:(e,t)=>y(t),size:"small",value:N,onHighlightChange:(e,t)=>{L(t)},getOptionLabel:e=>e.name,openOnFocus:!0}):(0,i.jsx)(i.Fragment,{children:"CAMBIANDO A OPERATIVO"}))})]})),(0,i.jsxs)(s.Z,Object.assign({container:!0,style:{marginTop:8,gap:4},justifyContent:"flex-end"},{children:[(0,i.jsx)(v.Z,Object.assign({onClick:()=>{h((0,I.Go)())},size:"small",variant:"outlined",color:"primary"},{children:"CANCELAR"})),(0,i.jsx)(v.Z,Object.assign({disabled:j===Q.JD.LOADING,size:"small",variant:"contained",color:"secondary",onClick:K},{children:"CONFIRMAR"}))]}))]})]}))}))},At=(0,Ae.Z)({absolute:{position:"fixed",top:0,bottom:0,right:0,left:0,background:"#00000036",zIndex:1201},modal:{position:"absolute",top:"50%",left:"50%",transform:"translate3d(100vh, 30vh, 30vh)",width:450,zIndex:12}}),kt=({setRefresh:e})=>{const[t,n]=(0,k.useState)(null),{eventSelect:s}=(0,E.C)(W.yJ),[a,r]=(0,k.useState)(!1),{openModal:o,truck:l,loadingCurrentTimeline:c,timeline:d}=(0,E.C)(I.h3),u=(0,E.T)(),v=At();(0,k.useEffect)((()=>{if(l){const e=document.getElementById(`truck-hormeter-${l.deviceId}`);e&&n(e)}}),[l]);const g=()=>{u((0,I.Go)()),u((0,N.uP)()),n(null)};(0,k.useEffect)((()=>{o||n(null)}),[o]),(0,k.useEffect)((()=>{window.onkeydown=m}),[]),(0,k.useEffect)((()=>{u((0,$.Gy)(s))}),[s]);const m=e=>{"Escape"===e.key&&g()};return(0,i.jsx)(i.Fragment,{children:t&&(0,i.jsxs)(i.Fragment,{children:[o&&(0,i.jsx)("div",{className:v.absolute,onClick:g}),(0,i.jsx)(St.Z,Object.assign({anchorEl:t,open:o&&!!d,placement:"right",style:{zIndex:1202}},{children:(0,i.jsx)("div",{children:!c&&l&&d?(0,i.jsx)(Tt,{timeline:d,truck:l,setRefresh:e,eventSelect:s}):(0,i.jsx)(Oe.Z,{})})}))]})})};var Zt=n(70164),It=n(10646),wt=n(15635);const Dt=({idTruck:e})=>{const t=(0,k.useRef)(),n=(0,k.useRef)(),[o,l]=(0,k.useState)([]),[c,d]=(0,k.useState)({label:"",id:"",value:""}),{truckInfoList:g}=(0,E.C)(U.ej),{excavatorInfoList:m}=(0,E.C)(Te.kW),{statusCycle:h}=(0,E.C)(R.XE),[p]=(0,wt.r)(h),[x,b]=(0,k.useState)(!1),O=(0,E.T)(),[f,N]=(0,k.useState)(),[y,S]=(0,k.useState)(),[L]=(0,It.l)(new Date),[C]=(0,It.i)(new Date),[T,A]=(0,k.useState)({date:`${L}T${C}`}),{truckSelect:Z}=(0,E.C)(R.XE),I={id:"",centroid:void 0,pointList:void 0,name:"Desconocido",idDme:void 0,color:void 0},[w,D]=(0,k.useState)(I),[P,z]=(0,k.useState)(I),[_,F]=(0,k.useState)(I),{dmeCellList:M,padCellList:$,stockCellList:H,polygonList:G}=(0,E.C)(W.WD),[K,J]=(0,k.useState)([]),[V,B]=(0,k.useState)([]),[Y,X]=(0,k.useState)([]);(0,k.useEffect)((()=>{J([w,...M]),B([P,...$]),X([_,...H])}),[M,$,H]);const[q,Q]=(0,k.useState)(Xe.f.CHANGE_NOTHING),[ee,te]=(0,k.useState)(qe.TypeDownload.UNKNOWN),ne=(e,t,n)=>{const i=t.find((t=>t.id===e));i&&N(Object.assign(Object.assign({},i),{type:n}))},ie=(0,k.useCallback)((()=>(0,Xe.eq)(q,Y,ee,K,V)),[q,G,Y,ee,K,V]),se=(0,k.useCallback)((()=>(0,Xe.M6)(m)),[m]);return(0,k.useEffect)((()=>{d(y?{label:`${null==y?void 0:y.deviceAlias}`,id:`${null==y?void 0:y.deviceId}`,value:`${null==y?void 0:y.deviceId}`}:{label:"",id:"",value:""})}),[y]),(0,k.useEffect)((()=>{b(!!f&&!!y&&!!T.date)}),[f,y,T]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(he.Z,Object.assign({variant:"button",style:{paddingLeft:8,paddingTop:16,color:"black"}},{children:`Agregar Ciclo al camión ${e}`})),(0,i.jsx)(j.Z,{width:"100%",height:8}),(0,i.jsxs)(s.Z,Object.assign({container:!0,direction:"column",style:{padding:"0.4rem",alignItems:"center"}},{children:[(0,i.jsx)(s.Z,Object.assign({item:!0},{children:(0,i.jsx)(s.Z,{container:!0,direction:"row",alignItems:"center"})})),(0,i.jsx)(j.Z,{width:"100%",height:8}),(0,i.jsx)(s.Z,Object.assign({item:!0},{children:(0,i.jsxs)(s.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,i.jsx)(he.Z,Object.assign({style:{color:"black"}},{children:"Descarga:"})),(0,i.jsx)(s.Z,Object.assign({item:!0},{children:(0,i.jsx)(s.Z,Object.assign({container:!0},{children:f&&(0,i.jsx)(a.ZP,Object.assign({title:"Nueva Descarga"},{children:(0,i.jsx)(r.Z,Object.assign({color:"primary",size:"small"},{children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Ge.Z,{}),(0,i.jsx)(u.Z,{size:"small",color:"secondary",label:f.name,onDelete:()=>N("")})]})}))}))}))}))]}))})),(0,i.jsx)(j.Z,{width:"100%",height:8}),(0,i.jsx)(s.Z,Object.assign({item:!0},{children:(0,i.jsxs)(s.Z,Object.assign({container:!0,direction:"row",justifyContent:"center"},{children:[(0,i.jsx)(he.Z,Object.assign({style:{color:"black"}},{children:"Excavadora: "})),y&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Ge.Z,{color:"primary"}),(0,i.jsx)(u.Z,{size:"small",color:"secondary",label:null==y?void 0:y.deviceAlias,onDelete:()=>{S(void 0),d({label:"",id:"",value:""})}})]})]}))})),(0,i.jsx)(j.Z,{height:8}),(0,i.jsxs)(s.Z,Object.assign({item:!0,style:{marginTop:8}},{children:[(0,i.jsx)(He.Z,{id:"date",label:"Fecha",type:"datetime-local",name:"date",value:T.date,onChange:e=>{const t=e.target;A(Object.assign(Object.assign({},T),{[t.name]:e.target.value}))},InputLabelProps:{shrink:!0,required:!0},error:void 0===T}),(0,i.jsx)(j.Z,{height:12}),(0,i.jsxs)("div",Object.assign({style:{display:"flex",flexDirection:"row",height:"100px"}},{children:[(0,i.jsx)(Ye.ZP,{size:"small",value:c,blurOnSelect:!0,onChange:(e,t)=>{((e,t)=>{const n=t.find((t=>t.deviceId===e));n&&S(n)})(null!=t?t.value:"",m)},options:se(),renderTags:(e,t)=>e.map(((e,n)=>(0,i.jsx)(u.Z,Object.assign({variant:"outlined",label:e.label},t({index:n}))))),style:{width:150},getOptionLabel:e=>e.label,disableClearable:!0,filterSelectedOptions:!0,renderInput:e=>(0,i.jsx)(He.Z,Object.assign({},e,{autoFocus:!0,inputRef:n,label:"Excavadora",variant:"outlined",fullWidth:!0,error:void 0===y}))}),(0,i.jsx)(j.Z,{width:4}),o.length<3&&(0,i.jsx)(Ye.ZP,{size:"small",value:o,blurOnSelect:!0,onChange:(e,n)=>{switch(l(n),n.length){case 0:Q(Xe.f.CHANGE_DOWNLOAD),te(qe.TypeDownload.UNKNOWN);break;case 1:Q(Xe.f.CHANGE_DOWNLOAD),te(Number(n[0].value)),q===Xe.f.CHANGE_DOWNLOAD&&te(Number(n[0].value));break;case 2:if(q===Xe.f.CHANGE_DOWNLOAD)switch(ee){case qe.TypeDownload.DME:ne(n[1].id,K,ee);break;case qe.TypeDownload.PAD:ne(n[1].id,V,ee);break;case qe.TypeDownload.STOCK:ne(n[1].id,Y,ee)}te(qe.TypeDownload.UNKNOWN),Q(Xe.f.CHANGE_DOWNLOAD),l([])}setTimeout((()=>{var e,n;null===(e=t.current)||void 0===e||e.focus(),null===(n=t.current)||void 0===n||n.click()}),100)},options:ie(),multiple:!0,renderTags:(e,t)=>e.map(((e,n)=>(0,i.jsx)(u.Z,Object.assign({variant:"outlined",label:e.label},t({index:n}))))),style:{width:200},getOptionLabel:e=>e.label,openOnFocus:!0,disableClearable:!0,filterSelectedOptions:!0,renderInput:e=>(0,i.jsx)(He.Z,Object.assign({},e,{autoFocus:!0,inputRef:t,label:"Agrega Descarga",variant:"outlined",fullWidth:!0,error:void 0===f}))})]}))]}))]})),(0,i.jsx)(j.Z,{height:30}),(0,i.jsxs)(s.Z,Object.assign({item:!0,style:{textAlign:"center"}},{children:[(0,i.jsx)(v.Z,Object.assign({variant:"outlined",size:"small",color:"secondary",onClick:()=>{return e=void 0,t=void 0,i=function*(){const e={date:T.date,newDownload:f,excavator:y,truck:Z};e.date&&e.newDownload&&e.excavator?(yield O((0,R.QM)(e)),yield O((0,et.l4)(Z.deviceId)),N(""),S(void 0),b(!1),yield O((0,R.EC)(Z.deviceId))):b(!0)},new((n=void 0)||(n=Promise))((function(s,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i},disabled:!x},{children:"Agregar Ciclo"})),(0,i.jsx)(j.Z,{height:10})]}))]})},Rt=(0,Ae.Z)((e=>({container:{width:"100%",scrollBehavior:"auto"},item:{justifySelf:"center",justifyContent:"center",alignContent:"center",textAlign:"center"},title:{fontSize:14},header:{display:"flex",padding:4},body:{textAlign:"center",maxHeight:"650px"},cardNewCycle:{height:"100%",color:"white",borderRadius:0},paperNewCycle:{color:"white"}}))),Pt=()=>{const e=Rt(),t=(0,E.T)(),{cyclesList:n,truckSelect:a}=(0,E.C)(R.XE);return(0,k.useEffect)((()=>{t((0,R.EC)(a.deviceId))}),[a]),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(s.Z,Object.assign({container:!0,className:e.container,spacing:0,direction:"column",style:{}},{children:[(0,i.jsx)("div",Object.assign({style:{borderRadius:"4px",backgroundColor:f.Jx,textAlign:"center",padding:2}},{children:(0,i.jsx)(he.Z,Object.assign({style:{textAlign:"center",fontSize:16,color:"white"},variant:"button"},{children:a?`CICLOS DEL CAMIÓN  ${null==a?void 0:a.deviceAlias}`:"CAMIÓN NO DISPONIBLE"}))})),(0,i.jsx)(j.Z,{height:12}),a&&(0,i.jsxs)(s.Z,Object.assign({item:!0,container:!0,className:e.item,md:12,spacing:1},{children:[(0,i.jsx)(s.Z,Object.assign({item:!0,md:6},{children:(0,i.jsx)(m.Z,Object.assign({elevation:2,className:e.body},{children:n&&n.length>0?(0,i.jsx)(Zt.a,{cycleList:n,isCycleTruck:!0}):(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(Zt.a,{cycleList:[],isCycleTruck:!0})})}))})),(0,i.jsx)(s.Z,Object.assign({item:!0,md:6},{children:(0,i.jsxs)(m.Z,Object.assign({elevation:2,className:e.paperNewCycle},{children:[(0,i.jsx)(Dt,{idTruck:a.deviceId}),"F"]}))}))]}))]}))})},zt="92vh",_t=(0,Ae.Z)((e=>({rootOperation:{display:"block",position:"relative",flexGrow:1,height:"96vh",margin:e.spacing(1,1,1,1)},rootAbsolute:{position:"absolute",top:0,bottom:0,right:0,left:0},operation:{overflow:"overlay",flex:11},containerOperation:{width:"100%",display:"flex",maxHeight:zt,minHeight:zt,alignContent:"center",justifyContent:"flex-start"},containerTrucks:{width:"100%",maxHeight:zt,minHeight:zt,margin:2,padding:2},rootTruck:{overflow:"auto",maxHeight:zt},rootIconResize:{height:zt,display:"flex",position:"relative",width:16,backgroundColor:f.Jx,paddingRight:7,paddingLeft:7,backgroundClip:"content-box",cursor:"col-resize"},rootLabel:{width:8,height:8,background:"green",borderRadius:4,padding:0,margin:0},withoutMP:{padding:0,margin:0}})));var Wt,Ft,Mt;const $t=()=>{const{operationsAll:e,status:t,truckAvailable:n}=(()=>{const{operationList:e,status:t,truckAvailable:n}=(0,E.C)(N.YL),{truckInfoList:i}=(0,E.C)(U.ej),{initial:s}=(0,E.C)(Te.kW),a=(0,E.T)(),[r,o]=(0,k.useState)([]);return(0,k.useEffect)((()=>{if(t===Q.JD.DONE&&s!==q.Vj.LOADING){const t=e.map((e=>{var t,n,i;return Object.assign(Object.assign({},e),{excavator:e.excavatorList.length>0?e.excavatorList[0]:{},typeUpload:ze.WW[null===(t=e.upload)||void 0===t?void 0:t.type],labelUpload:`${ze.WW[null===(n=e.upload)||void 0===n?void 0:n.type]} ${e.upload?ct(e.upload):""}`,labelDownload:e.download?`${dt(e.download)}`:"",typeDownload:ze.WW[null===(i=e.download)||void 0===i?void 0:i.type],labelstate:ze.J8[e.state],cycles:e.cycleList.length,truckList:e.truckList.map((e=>{var t;return Object.assign(Object.assign({},e),{deviceAliasNumber:Number(null===(t=e.deviceAlias.match(/\d/g))||void 0===t?void 0:t.join(""))})})).sort(((e,t)=>e.deviceAliasNumber-t.deviceAliasNumber))})}));o(t)}else o([])}),[e]),(0,k.useEffect)((()=>{e.length>0&&i.length>0&&a((0,N.Vb)({truckList:i}))}),[i,t]),{operationsAll:r,status:t,truckAvailable:n}})(),{truckInfoList:o}=(0,E.C)(U.ej),l=(0,k.useRef)(),c=(0,k.useRef)(),d=(0,k.useRef)(),[u,v]=(0,k.useState)(!1),[g,m]=(0,k.useState)(!1),{state:h}=(0,E.C)(W.e5),[j,p]=(0,k.useState)(!1),[x,b]=(0,k.useState)(""),[O,y]=(0,k.useState)([]),{excavatorSelect:S,truckSelect:L}=(0,E.C)(R.XE);(({search:e,setSearch:t,items:n,setFilterList:i})=>{const[]=(0,k.useState)([]);(0,k.useEffect)((()=>{if(!e||0===n.length)return void i((e=>0===e.length?e:[]));const t=n.filter((t=>{var n;return null===(n=t.deviceAlias)||void 0===n?void 0:n.toUpperCase().includes(e.toUpperCase())}));i((e=>JSON.stringify(e.map((e=>e.deviceId)))===JSON.stringify(t.map((e=>e.deviceId)))?e:(console.log("LiminadodChange",t),t)))}),[e,n])})({search:x,setSearch:b,items:o,setFilterList:y});const C=(0,E.T)(),T=_t();(0,k.useEffect)((()=>{}),[]),(0,k.useEffect)((()=>{Wt=document.querySelector("#wrapper"),Ft=null==Wt?void 0:Wt.querySelector("#listTruck"),Mt=null==Wt?void 0:Wt.querySelector("#listOperation");const e=localStorage.getItem("localStorajeTruck"),t=localStorage.getItem("localStorajeOperation");e&&(Ft.style.flex=Number(e)),t&&(Mt.style.flex=Number(t))}),[]),(0,k.useEffect)((()=>{C((0,U.RK)()),C((0,N.hS)())}),[j]);const A=(0,k.useMemo)((()=>(0,i.jsx)("div",Object.assign({className:T.containerOperation},{children:t!==Q.JD.DONE?(0,i.jsx)(s.Z,Object.assign({container:!0,alignItems:"stretch",justifyContent:"center"},{children:(0,i.jsx)(gt,{height:"100%",width:"100%"})})):e.length>0?e.map(((e,t)=>(0,i.jsx)(rt,{operation:e,setRefresh:p,filterList:O},t))):(0,i.jsx)(ut,{})}))),[e,O,t]);(0,k.useEffect)((()=>{h===Ke.m4.DONE&&p((e=>!e))}),[h]);const Z=()=>m((e=>!e)),I=(0,k.useCallback)((e=>{var t;if(!(u&&Wt&&Ft&&Mt))return;const n=12*(e.clientX-Wt.offsetLeft-46)/(null===(t=l.current)||void 0===t?void 0:t.clientWidth),i=Number(c.current.style.flex)>0?c.current.style.flex:0,s=Math.abs(i-n)>.05?Math.max(n,1):i;Ft.style.flex=s,Mt.style.flex=12-s,localStorage.setItem("localStorajeTruck",`${s}`),localStorage.setItem("localStorajeOperation",""+(12-s))}),[u]),w=(0,k.useMemo)((()=>(0,i.jsx)(s.Z,Object.assign({item:!0,id:"listTruck",style:{margin:0,padding:0,flex:1},className:T.rootTruck,innerRef:c},{children:(0,i.jsx)(yt,{truckAvailable:n,filterList:O})}))),[n,O]),D=(0,k.useMemo)((()=>(0,i.jsxs)(s.Z,Object.assign({container:!0,justifyContent:"flex-end",alignItems:"center"},{children:[(0,i.jsx)(a.ZP,Object.assign({title:"Nueva Operación"},{children:(0,i.jsx)(Me.rU,Object.assign({to:"/operation/create/0/0"},{children:(0,i.jsx)(r.Z,Object.assign({color:"secondary",size:"small"},{children:(0,i.jsx)(de.Z,{fontSize:"small"})}))}))})),(0,i.jsx)(a.ZP,Object.assign({title:"Reasignación global de Camiones"},{children:(0,i.jsx)(r.Z,Object.assign({onClick:Z,color:"secondary",size:"small"},{children:(0,i.jsx)(ue.Z,{fontSize:"small"})}))})),(0,i.jsx)(xt,{search:x,setSearch:b})]}))),[x]),P=(0,k.useCallback)((e=>{e.target===d.current&&v(!0)}),[d]),z=(0,k.useCallback)((()=>v(!1)),[]),_=(0,k.useMemo)((()=>(0,i.jsx)(kt,{setRefresh:p})),[]),F=()=>{C((0,R.kY)()),p((e=>!e))};return(0,i.jsx)(ot.W,Object.assign({backend:lt.PD},{children:(0,i.jsxs)("div",Object.assign({className:T.rootOperation},{children:[(0,i.jsxs)("div",Object.assign({className:T.rootAbsolute},{children:[(0,i.jsx)(s.Z,Object.assign({item:!0,innerRef:c},{children:D})),(0,i.jsxs)(s.Z,Object.assign({container:!0,innerRef:l,id:"wrapper",onMouseUp:z,onMouseMove:I,onMouseDown:P},{children:[w,(0,i.jsx)(B.P4,{className:T.rootIconResize,id:"handler",innerRef:d}),(0,i.jsx)(s.Z,Object.assign({item:!0,className:T.operation,id:"listOperation"},{children:(0,i.jsx)(s.Z,Object.assign({container:!0,direction:"column"},{children:(0,i.jsxs)(s.Z,Object.assign({item:!0},{children:[(0,i.jsx)("div",Object.assign({className:T.containerOperation},{children:t!==Q.JD.DONE?(0,i.jsx)(s.Z,Object.assign({container:!0,alignItems:"stretch",justifyContent:"center"},{children:(0,i.jsx)(gt,{height:"100%",width:"100%"})})):e.length>0?A:(0,i.jsx)(ut,{})})),(0,i.jsxs)(B.T5,Object.assign({container:!0,direction:"row",style:{gap:8}},{children:[(0,i.jsx)(B.P4,{children:(0,i.jsxs)(B.T5,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,i.jsx)("p",{className:T.rootLabel}),(0,i.jsx)("p",Object.assign({style:{padding:0,margin:0}},{children:"Asignados"}))]}))}),(0,i.jsx)(B.P4,{children:(0,i.jsxs)(B.T5,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,i.jsx)("p",{style:{background:f.J$},className:T.rootLabel}),(0,i.jsx)("p",Object.assign({style:{padding:0,margin:0}},{children:"No asignados"}))]}))}),(0,i.jsx)(B.P4,{children:(0,i.jsxs)(B.T5,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,i.jsx)("p",{style:{background:f.sb},className:T.rootLabel}),(0,i.jsx)("p",Object.assign({style:{padding:0,margin:0}},{children:"Excavadora"}))]}))}),(0,i.jsx)(B.P4,{children:(0,i.jsxs)(B.T5,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,i.jsx)("p",{style:{borderColor:f.J$,background:"#00000000",borderStyle:"solid",borderWidth:2},className:T.rootLabel}),(0,i.jsxs)("p",Object.assign({style:{padding:0,margin:0}},{children:["Área de carguío (",oe.Xb,"mts)"]}))]}))})]}))]}))}))}))]}))]})),(0,i.jsx)(We,{open:g,setOpen:m,setRefresh:p,operations:e}),(0,i.jsx)(ye,{open:!!S.deviceId,setOpen:F,children:(0,i.jsx)(Zt.S,{}),handleClose:F,handleClickConfirm:F}),(0,i.jsx)(ye,{open:!!L.deviceId,setOpen:F,children:(0,i.jsx)(Pt,{}),handleClose:F,handleClickConfirm:F}),_]}))}))};function Ut(){return(0,i.jsx)($t,{})}}}]);