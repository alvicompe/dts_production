"use strict";(self.webpackChunkdts_hytera=self.webpackChunkdts_hytera||[]).push([[219],{25947:(e,t,i)=>{i.d(t,{F2:()=>a,xu:()=>p,zx:()=>c,iz:()=>b,T5:()=>j,P4:()=>m,hU:()=>u,Mi:()=>f,IB:()=>l});var o=i(85893),n=i(8286),s=i(96588);const a=e=>(0,o.jsx)(s.ZP,Object.assign({},Object.assign({},e.propsAutocomplete),{renderInput:e=>(0,o.jsx)(n.Z,Object.assign({},e,{label:"Select an option",variant:"outlined"}),void 0)}),void 0);var r=i(64436);const l=e=>{const{propsTextField:t,propsForm:i}=e;return(0,o.jsx)(r.Z,Object.assign({},Object.assign({},i),{children:(0,o.jsx)(n.Z,Object.assign({},Object.assign({},t)),void 0)}),void 0)};var d=i(282);const c=e=>(0,o.jsx)(d.Z,Object.assign({},Object.assign({},e.propsButton),{children:e.label}),void 0);var v=i(17812);const u=e=>(0,o.jsx)(v.Z,Object.assign({},Object.assign({},e),{children:e.children}),void 0);var g=i(10046);const p=({children:e,height:t,width:i})=>(0,o.jsx)(g.Z,Object.assign({height:t,width:i},{children:e}),void 0);var h=i(41749);const j=e=>(0,o.jsx)(h.Z,Object.assign({},Object.assign({},e),{children:e.children}),void 0),m=e=>(0,o.jsx)(h.Z,Object.assign({},Object.assign({},e),{children:e.children}),void 0);var x=i(55517);const b=e=>(0,o.jsx)(x.Z,Object.assign({},Object.assign({},e)),void 0);var O=i(82285);const f=e=>(0,o.jsx)(O.Z,Object.assign({},Object.assign({},e),{children:(0,o.jsx)(h.Z,{children:e.children},void 0)}),void 0)},61242:(e,t,i)=>{i.d(t,{a:()=>u});var o=i(85893),n=i(41120),s=i(52663),a=i(66083),r=i(29525),l=i(66856),d=i(95477),c=i(282);const v=(0,n.Z)({disabledPadding:{padding:0,textAlign:"center"}}),u=({open:e,handleClose:t,handleConfirm:i,title:n,children:u,maxWidth:g="lg",disabled:p=!1,loading:h})=>{const j=v();return(0,o.jsxs)(s.Z,Object.assign({open:e,onClose:t,maxWidth:g},{children:[(0,o.jsx)(a.Z,Object.assign({className:j.disabledPadding},{children:n}),void 0),(0,o.jsx)(r.Z,{children:u},void 0),(0,o.jsx)(l.Z,{children:h?(0,o.jsx)(d.Z,{style:{width:"30px",height:"30px"}},void 0):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Z,Object.assign({size:"small",color:"primary",onClick:t},{children:"Cancel"}),void 0),i&&(0,o.jsx)(c.Z,Object.assign({disabled:p,variant:"outlined",size:"small",color:"secondary",onClick:i,autoFocus:!0},{children:"Confirm"}),void 0)]},void 0)},void 0)]}),void 0)}},48101:(e,t,i)=>{i.d(t,{Z:()=>r});var o=i(85893),n=i(67294),s=i(34880);const a=i(6158);a.accessToken=s.c3;const r=({dragRotate:e,map:t,pitch:i,bearing:s,mapContainer:r,lng:l,lat:d,zoom:c,setLoad:v,style:u,height:g})=>((0,n.useEffect)((()=>{console.log("map.current",t.current,s),t.current||(r&&(t.current=new a.Map({container:r.current,style:u,center:[l,d],pitch:i,bearing:s,zoom:c,antialias:!0,dragRotate:e})),console.log("inianco"))}),[t,r]),(0,n.useEffect)((()=>{t.current&&(t.current.addControl(new a.FullscreenControl,"bottom-left"),t.current.addControl(new a.NavigationControl,"bottom-left"),t.current.on("move",(()=>{})),t.current.on("click",(e=>{console.log(e.lngLat)})),t.current.on("load",(()=>{t.current&&v(!0)})))}),[t]),(0,n.useEffect)((()=>{t.current&&t.current.setBearing(s)}),[s]),(0,o.jsx)("div",{ref:r,style:{flex:1,height:g||"100vh",width:"100%"},className:"map-container"},void 0))},30433:(e,t,i)=>{i.d(t,{DQ:()=>u,Ez:()=>g,g7:()=>v});var o=i(85893),n=i(71267),s=i(12575),a=i(61920),r=i(99945),l=i(44326);const d=({value:e,operation:t,lineThrough:i=!1})=>{const s=e=>{var i,o,n,s,r,l,d,c,v,u,g,p;switch(e){case a.u6.DME:const e=(null===(o=null===(i=t.download)||void 0===i?void 0:i.dme)||void 0===o?void 0:o.cellList.length)>0?null===(s=null===(n=t.download)||void 0===n?void 0:n.dme)||void 0===s?void 0:s.cellList[0].name:"";return e.toUpperCase().includes("DME")?e:`DME-${e}`;case a.u6.PAD:const h=(null===(l=null===(r=t.download)||void 0===r?void 0:r.pad)||void 0===l?void 0:l.cellList.length)>0?null===(c=null===(d=t.download)||void 0===d?void 0:d.pad)||void 0===c?void 0:c.cellList[0].name:"";return h.toUpperCase().includes("PAD")?h:`PAD-${h}`;case a.u6.STOCK:const j=(null===(u=null===(v=t.download)||void 0===v?void 0:v.stock)||void 0===u?void 0:u.cellList.length)>0?null===(p=null===(g=t.download)||void 0===g?void 0:g.stock)||void 0===p?void 0:p.cellList[0].name:"";return j.toUpperCase().includes("STOCK")?j:`STK-${j}`;default:return""}};return(0,o.jsx)(o.Fragment,{children:e===a.u6.DME_PAD?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.Z,{color:i?"default":"secondary",icon:(0,o.jsx)(r.Z,{color:"secondary",fontSize:"small"},void 0),size:"small",label:(0,o.jsx)("p",Object.assign({style:{margin:0,padding:0,fontSize:"0.6rem",textDecoration:i?"line-through":"solid"}},{children:s("pad")}),void 0)},void 0),(0,o.jsx)(n.Z,{color:i?"default":"secondary",icon:(0,o.jsx)(r.Z,{color:"secondary",fontSize:"small"},void 0),size:"small",label:(0,o.jsx)("p",Object.assign({style:{margin:0,padding:0,fontSize:"0.6rem",textDecoration:i?"line-through":"solid"}},{children:s("dme")}),void 0)},void 0)]},void 0):(0,o.jsx)(n.Z,{icon:(0,o.jsx)(r.Z,{color:"secondary",fontSize:"small"},void 0),size:"small",color:i?"default":"secondary",label:(0,o.jsx)("p",Object.assign({style:{margin:0,padding:0,fontSize:"0.6rem",textDecoration:i?"line-through":"solid"}},{children:s(e)}),void 0)},void 0)},void 0)},c=({value:e,operation:t,lineThrough:i=!1})=>(0,o.jsx)(n.Z,{icon:(0,o.jsx)(l.Z,{color:"secondary",fontSize:"small"},void 0),size:"small",color:i?"default":"secondary",label:(0,o.jsx)("p",Object.assign({style:{margin:0,padding:0,fontSize:"0.6rem",textDecoration:i?"line-through":"solid"}},{children:(()=>{var i,o,n,s,r,l,d,c,v,u,g,p;switch(e){case a.u6.STOCK:const e=(null===(o=null===(i=t.upload)||void 0===i?void 0:i.stock)||void 0===o?void 0:o.cellList)&&(null===(s=null===(n=t.upload)||void 0===n?void 0:n.stock)||void 0===s?void 0:s.cellList.length)>0?null===(l=null===(r=t.upload)||void 0===r?void 0:r.stock)||void 0===l?void 0:l.cellList[0].name:"";return`${a.WW[t.upload.type]}  ${e}`;case a.u6.PIT:const h=null===(c=null===(d=t.upload)||void 0===d?void 0:d.pit)||void 0===c?void 0:c.name,j=(null===(v=t.upload.pit)||void 0===v?void 0:v.projectList.length)>0?`${null===(u=t.upload.pit)||void 0===u?void 0:u.projectList[0].name}`.substring(5):"",m=j&&(null===(g=t.upload.pit)||void 0===g?void 0:g.projectList[0].polygonList.length)>0?null===(p=t.upload.pit)||void 0===p?void 0:p.projectList[0].polygonList[0].name:"";return`${a.WW[t.upload.type]} ${h} ${j} ${m}`;default:return""}})()}),void 0)},void 0),v=({operation:e,lineThrough:t})=>{var i,n;let s="";return e?((null===(i=e.upload)||void 0===i?void 0:i.pit)&&(s="pit"),(null===(n=e.upload)||void 0===n?void 0:n.stock)&&(s="stock"),(0,o.jsx)(c,{value:s,operation:e,lineThrough:t},void 0)):(0,o.jsx)(o.Fragment,{},void 0)},u=({operation:e,lineThrough:t})=>{var i,n,s,a,r;let l="";return e?((null===(i=e.download)||void 0===i?void 0:i.dme)&&(l="dme"),(null===(n=e.download)||void 0===n?void 0:n.pad)&&(l="pad"),(null===(s=e.download)||void 0===s?void 0:s.stock)&&(l="stock"),(null===(a=e.download)||void 0===a?void 0:a.dme)&&(null===(r=e.download)||void 0===r?void 0:r.pad)&&(l="dme_pad"),(0,o.jsx)(d,{value:l,operation:e,lineThrough:t},void 0)):(0,o.jsx)(o.Fragment,{},void 0)},g=({operation:e,lineThrough:t})=>{const i=e&&e.excavatorList&&e.excavatorList.length>0?e.excavatorList[0].deviceAlias:"";return(0,o.jsx)(n.Z,{color:t?"default":"secondary",icon:(0,o.jsx)(s.Z,{fontSize:"small"},void 0),size:"small",style:{textDecoration:t?"line-through":"solid"},label:i},void 0)}},2780:(e,t,i)=>{i.d(t,{We:()=>s,wg:()=>a});var o=i(76533),n=function(e,t,i,o){return new(i||(i=Promise))((function(n,s){function a(e){try{l(o.next(e))}catch(e){s(e)}}function r(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((o=o.apply(e,t||[])).next())}))};const s=(e,t)=>n(void 0,void 0,void 0,(function*(){return yield(0,o.g$)(t,e)})),a=e=>n(void 0,void 0,void 0,(function*(){const t=yield(0,o.zY)(e);console.log("finalizeOperationEvent",t);let i="";return t.truckErrorList.length>0&&t.truckErrorList.forEach((e=>{const t=1===e.state?"CARGANDO":"A DESCARGA";i+=` ${e.truckError.deviceAlias} => ${t},`})),i}))},37519:(e,t,i)=>{i.r(t),i.d(t,{default:()=>mt});var o=i(85893),n=i(41749),s=i(868),a=i(17812),r=i(79895),l=i(14741),d=i(73914),c=i(59240),v=i(95757),u=i(50998),g=i(282),p=i(62822),h=i(55517),j=i(10046),m=i(33681);const x=({loading:e})=>e?(0,o.jsx)(m.Z,{},void 0):(0,o.jsx)(o.Fragment,{},void 0),b="truck";var O=i(5200),f=i(93584),L=i(73855),Z=i(73250),y=i(75647),C=i(44824),N=i(28231),E=i(715),k=i(95692),A=i(41042),S=i(67294),T=i(78721);const w=(0,d.Z)({rootFilter:{flex:"0 0",margin:2,border:"1px dashed #7b81836e",cursor:"move",float:"left",width:"98%",background:f.sb},rootItem:{margin:2,border:"1px dashed #7b81836e",cursor:"move",float:"left",width:"98%",flex:"0 0"},rootItemTemporal:{flex:"0 0",margin:2,border:"1px dashed green",cursor:"move",float:"left",width:"98%",background:"#34d0ff6e"},rootItemTemporalRemove:{flex:"0 0",margin:2,border:"1px dashed red",background:"#ff60604a",cursor:"move",float:"left",width:"98%"},titleTruck:{fontSize:"1em",cursor:"move"},contentTruck:{margin:2,padding:0,width:"100%",position:"relative",height:"100%"},contentCycle:{height:16,minWidth:16,display:"flex",borderRadius:"50%",background:"#efecec",justifyContent:"center",alignItems:"center",justifyItems:"center"},stateTruck:{position:"absolute",fontSize:"0.5rem",top:0,left:0},actions:{minWidth:36},labelCycleNumber:{fontSize:11,color:"#5a5757"}}),D=({truck:e})=>{let t="",i=null;switch(e.state){case T.EnumEventState.UNKNOWN_STATE:i=(0,o.jsx)(y.Z,{style:{fontSize:"1rem"},fontSize:"small"},void 0),t=e.operationList&&e.operationList.length>0?"In road":"Without operation/ sin operación";break;case T.EnumEventState.DOWNLOAD:i=(0,o.jsx)(C.Z,{style:{fontSize:"1rem"},fontSize:"small"},void 0),t="Downloading/Descargando";break;case T.EnumEventState.UPLOAD:i=(0,o.jsx)(N.Z,{style:{fontSize:"1rem"},fontSize:"small"},void 0),t="Uploading/Cargando";break;case T.EnumEventState.TO_UPLOAD:i=(0,o.jsx)(E.Z,{style:{fontSize:"1rem",transform:"rotate(180deg)"},fontSize:"small"},void 0),t="To Upload/Yendo a carga";break;case T.EnumEventState.TO_DOWNLOAD:i=(0,o.jsx)(E.Z,{style:{fontSize:"1rem"},fontSize:"small"},void 0),t="To download/Yendo a descarga";break;default:i=(0,o.jsx)(k.Z,{style:{fontSize:"1rem"},fontSize:"small"},void 0),t="Waiting.../Espeando..."}return i&&(0,o.jsx)(s.ZP,Object.assign({title:t},{children:(0,o.jsx)(a.Z,Object.assign({style:{margin:0,padding:0},size:"small"},{children:i}),void 0)}),void 0)},I=({truck:e,temporal:t,operation:i,temporalRemove:a,disabledDrag:l,isFilter:d=!1})=>{const c=w(),v=(0,L.T)(),[{isDragging:g},p]=(0,O.c)((()=>({type:b,item:{truck:e},end:(t,o)=>{const n=o.getDropResult();l?confirm("NOT AVAILABLE, firt change to OPERATIVE in HOURMETER")&&window.open("/#/hourmeter"):t&&n&&!a&&v((0,Z.UN)({operationId:n.operation.id,truck:e,operationOldId:i?i.id:""}))},collect:e=>({isDragging:e.isDragging(),handlerId:e.getHandlerId()})})),[a,i]),h=void 0!==e.sensor,j=(0,S.useCallback)((()=>{var t;const i=null===(t=e.deviceAlias)||void 0===t?void 0:t.split("-");return i&&i.length>1?i[1]:""}),[e.deviceAlias]);return(0,o.jsx)(r.Z,Object.assign({className:d&&!a?c.rootFilter:t?c.rootItemTemporal:a?c.rootItemTemporalRemove:c.rootItem,ref:p,elevation:4},{children:(0,o.jsxs)(u.Z,Object.assign({disableGutters:!0,className:c.contentTruck},{children:[(0,o.jsx)(A.Z,{className:c.stateTruck,style:{color:h?"#49df94":"#ff9090"},fontSize:"small"},void 0),(0,o.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,o.jsx)(n.Z,Object.assign({item:!0,style:{marginTop:4}},{children:(0,o.jsx)("label",Object.assign({className:c.titleTruck},{children:j()}),void 0)}),void 0),(0,o.jsx)(n.Z,Object.assign({item:!0},{children:(0,o.jsxs)(n.Z,Object.assign({container:!0,className:c.actions,alignItems:"center"},{children:[(0,o.jsx)(D,{truck:e},void 0),(0,o.jsx)(s.ZP,Object.assign({title:"Number cycle/Número de ciclos"},{children:(0,o.jsx)("div",Object.assign({className:c.contentCycle},{children:(0,o.jsx)("label",Object.assign({className:c.labelCycleNumber},{children:void 0===e.cycleNumber?"0":e.cycleNumber}),void 0)}),void 0)}),void 0)]}),void 0)}),void 0)]}),void 0)]}),void 0)}),void 0)};var z=i(25947),R=i(48101),W=i(10980),P=i(6777),$=i(95090),H=i(89613),_=i(34344),G=i(54150);console.log("pointpointpoint",G.xmu);const U=(0,d.Z)({rootList:{flex:1,padding:2,margin:2,overflow:"auto"},rootMap:{borderRadius:16}}),M=({operation:e})=>{const t=(0,S.useRef)(null),i=U(),n=(0,S.useRef)(null),{}=(({operation:e,radio:t})=>{const[i,o]=(0,S.useState)(W.kM),[n,s]=(0,S.useState)([]),[a,r]=(0,S.useState)([]),{initial:l,truckStream:d}=(0,L.C)(_.dc),{initial:c,excavatorStream:v}=(0,L.C)(H.oT);return(0,S.useEffect)((()=>{if(l===P.Vj.INITIAL&&d.sensor&&d.sensor.latitude&&i.sensor&&i.sensor.latitude&&!n.some((e=>e.deviceId===d.deviceId))){const e=(0,G.xmu)([d.sensor.longitude,d.sensor.latitude]),o=(0,G.xmu)([i.sensor.longitude,i.sensor.latitude]),n=(0,G.TE$)(e,o);if(console.log("TRUCK_RANGE_distanceBettween",`ope${i.deviceAlias}`,n),1e3*n<=t){const e=a.findIndex((e=>e.truck.deviceId===d.deviceId)),t=[...a],o={truck:d,distance:n};-1===e?t.push(o):t[e]=o,console.log("TRUCK_RANGE",`ope${i.deviceAlias}`,t),r(t)}}}),[i,d,n,t]),(0,S.useEffect)((()=>{console.log("excavator",i),i.deviceId&&c===$.JD.DONE&&v.deviceId===i.deviceId&&(!i.sensor&&v.sensor||v.sensor&&v.sensor.latitude!==i.sensor.latitude)&&o(v)}),[v]),(0,S.useEffect)((()=>{e.excavatorList&&i.deviceId!=e.excavatorList[0].deviceId&&(o(e.excavatorList[0]),s(e.truckList)),console.log("changeOperattion",e)}),[e]),{truckListInOperation:n,truckInRange:a}})({operation:e,radio:10}),[s,a]=(0,S.useState)(!1);return(0,S.useEffect)((()=>(console.log("rendeing"),()=>{console.log("desmontDispa"),n.current=null,t.current=null})),[]),e.excavatorList&&e.excavatorList.length>0&&e.excavatorList[0],(0,o.jsx)(z.T5,Object.assign({className:i.rootList},{children:(0,o.jsx)(z.P4,Object.assign({item:!0,className:i.rootMap},{children:(0,o.jsx)(R.Z,Object.assign({map:t,dragRotate:!1,style:"mapbox://styles/dispatchgat/ckqqsfc2y46bo17sf1y29zwnj",mapContainer:n,bearing:0,pitch:15},{lat:-7.6163,lng:-78.196,zoom:18,setLoad:a},{height:"420px"}),"map2")}),void 0)}),void 0)};var F=i(43829),K=i(82200),V=i(41396),J=i(7654),B=i(78965),Y=i(22318),X=i(64436),q=i(67162),Q=i(30553),ee=i(40074),te=i(95477),ie=i(52663),oe=i(66856),ne=i(29525);function se({open:e,setOpen:t,handleClickConfirm:i,children:n,loading:s,handleClose:a}){return(0,o.jsxs)(ie.Z,Object.assign({fullWidth:!0,maxWidth:"lg",open:e,onClose:a||(()=>{t(!1)}),"aria-labelledby":"max-width-dialog-title"},{children:[(0,o.jsx)(ne.Z,{children:n},void 0),(0,o.jsx)(oe.Z,{children:s?(0,o.jsx)(te.Z,{},void 0):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g.Z,Object.assign({onClick:a,size:"small",color:"primary"},{children:"Cancel"}),void 0),(0,o.jsx)(g.Z,Object.assign({onClick:i,variant:"outlined",size:"small",color:"secondary"},{children:"Confirm"}),void 0)]},void 0)},void 0)]}),void 0)}var ae=i(61242),re=i(76533),le=i(99302),de=i(52672),ce=i(14125),ve=i(41120),ue=i(10465),ge=i(13258);const pe=(0,ve.Z)((e=>({disabledSpacing:{margin:0,padding:0,width:"auto"},checkbox:{"& .MuiCheckbox-root":{margin:0,padding:0,paddingLeft:8}}}))),he=S.memo((({truck:e,checked:t,trucksSelect:i,setTrucksSelect:n,disableWithOperation:s,handleonchangeTruck:a})=>{const r=pe(),l=e.state>=0?e.state===$.SS["Sin Operación"]&&e.operationList&&e.operationList.length>0?"En camino":$.SS[e.state]:"Sin conex...",d=e.operationList&&e.operationList.length>0?e.operationList[0].excavator.deviceAlias:"";return(0,o.jsx)(u.Z,Object.assign({button:!0,dense:!0,className:r.disabledSpacing,disabled:!!s&&!!d},{children:(0,o.jsx)(Q.Z,{className:r.checkbox,onChange:()=>{const t=i.findIndex((t=>e.deviceId===t.deviceId));-1===t?i.push(e):i.splice(t,1),n(JSON.parse(JSON.stringify(i)))},control:(0,o.jsx)(ge.Z,{onClick:()=>a(e),size:"small",checked:t,inputProps:{style:{padding:0}}},void 0),label:(0,o.jsx)(v.Z,{primary:`${e.deviceAlias} ${d?` ➜ ${d}`:""} (${l})`},void 0)},void 0)}),void 0)})),je=(0,ve.Z)({root:{paddingLeft:4,maxHeight:"60vh",overflowY:"scroll",boxShadow:"inset 0px -2px 10px 0px rgb(17 16 10 / 56%)",borderRadius:4},searchContainer:{marginRight:8}}),me=S.memo((({trucksSelect:e,setTrucksSelect:t,handleonchangeTruck:i,disableWithOperation:s})=>{const{truckInfoList:a}=(0,L.C)(le.ej),r=je(),[l,d]=(0,S.useState)([]),[c,v]=(0,S.useState)("");(0,S.useEffect)((()=>{d(a.filter((e=>e.deviceAlias.toLowerCase().includes(c.toLowerCase()))))}),[a]);const u=(0,S.useCallback)((e=>{if(e){const t=e.target?e.target.value.toUpperCase():"";d(a.filter((e=>e.deviceAlias.toUpperCase().includes(t)))),v(t)}}),[a]),g=(0,S.useCallback)((()=>{d(a),v("")}),[a]);return(0,o.jsxs)(p.Z,Object.assign({dense:!0,disablePadding:!0,style:{margin:4,paddingTop:4}},{children:[(0,o.jsx)(ue.V,{functionFilter:u,functionCancel:g},void 0),(0,o.jsx)(n.Z,Object.assign({container:!0,className:r.root},{children:l.map((n=>{return(0,o.jsx)(S.Fragment,{children:(0,o.jsx)(he,{handleonchangeTruck:i,disableWithOperation:s,checked:(a=n,!!e.find((e=>a.deviceId===e.deviceId))),trucksSelect:e,setTrucksSelect:t,truck:n},void 0)},n.deviceId);var a}))}),void 0)]}),void 0)}));var xe=i(44562),be=i(61920);const Oe=(e,t,i,o)=>{return n=void 0,s=void 0,r=function*(){i(!0);const n=yield(0,re.e1)(e,t);console.log("responseAssigment",n),i(!1),o((e=>!e));let s="";n.truckErrorList.length>0&&n.truckErrorList.forEach((e=>{const t=1===e.state?"CARGANDO":"A DESCARGA";s+=` ${e.truckError.deviceAlias}=> ${t},`})),""!==s&&alert(`Las siguientes unidades no han podido ser reasignadas: ${s}`)},new((a=void 0)||(a=Promise))((function(e,t){function i(e){try{l(r.next(e))}catch(e){t(e)}}function o(e){try{l(r.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(i,o)}l((r=r.apply(n,s||[])).next())}));var n,s,a,r},fe=({open:e,setOpen:t,setRefresh:i,operations:a})=>{const l=(0,L.T)(),[d,c]=(0,S.useState)([]),[g,h]=(0,S.useState)(""),[j,m]=(0,S.useState)([]),[x,b]=(0,S.useState)(!1),[O,f]=S.useState(!1);(0,S.useEffect)((()=>{l(le.RK),l(ce.CE)}),[]);const Z=e=>{h(e.target.value)};return(0,o.jsxs)(se,Object.assign({},{loading:O},{open:e,handleClickConfirm:()=>{j.length<=0||g.length<=0?l((0,de.L8)({open:!0,msg:"Debe seleccionar almenos una excavadora y un camión",severity:"warning"})):b(!0)},handleClose:()=>{t(!1),m([]),h("")}},{children:[(0,o.jsx)(n.Z,Object.assign({container:!0},{children:(0,o.jsx)(n.Z,Object.assign({item:!0,xs:12},{children:(0,o.jsx)(Y.Z,Object.assign({variant:"button",style:{paddingLeft:8,paddingTop:16}},{children:"Trucks reassignment"}),void 0)}),void 0)}),void 0),(0,o.jsxs)(n.Z,Object.assign({container:!0,style:{paddingLeft:4}},{children:[(0,o.jsx)(n.Z,Object.assign({item:!0,xs:6},{children:(0,o.jsx)(r.Z,Object.assign({elevation:4},{children:(0,o.jsx)(me,{handleonchangeTruck:()=>{},setTrucksSelect:m,trucksSelect:j},void 0)}),void 0)}),void 0),(0,o.jsx)(n.Z,Object.assign({item:!0,xs:6},{children:(0,o.jsx)(r.Z,Object.assign({style:{margin:10}},{children:(0,o.jsxs)(p.Z,{children:[(0,o.jsx)(u.Z,{children:(0,o.jsx)(v.Z,{secondary:"Destination Excavator"},void 0)},void 0),(0,o.jsx)(u.Z,{children:(0,o.jsx)(v.Z,{children:(0,o.jsx)(X.Z,Object.assign({component:"fieldset"},{children:(0,o.jsx)(q.Z,Object.assign({row:!0,"aria-label":"gender",name:"radio-buttons-group"},{children:a.map((e=>{var t;return(0,o.jsx)(s.ZP,Object.assign({title:e.state!==be.J8.Operando?"Excavator whitout operation / Excavadora sin operación":"Destination Excavator"},{children:(0,o.jsx)(Q.Z,{value:e.id,disabled:e.state!==be.J8.Operando,control:(0,o.jsx)(ee.Z,{disabled:e.state!==be.J8.Operando},void 0),onChange:Z,label:`  ${null===(t=e.excavatorList[0])||void 0===t?void 0:t.deviceAlias}`},void 0)}),e.id)}))}),void 0)}),void 0)},void 0)},void 0)]},void 0)}),void 0)}),void 0)]}),void 0),(0,o.jsx)(ae.a,Object.assign({open:x,handleClose:()=>{b(!1)},handleConfirm:()=>{b(!1),t(!1),m([]),h(""),Oe(g,j,f,i)},title:"Area you sure?"},{children:(0,o.jsx)(xe.Z,Object.assign({severity:"warning"},{children:"Intentaremos mover estos camiones, si ocurre algun error se le informará"}),void 0)}),void 0)]}),void 0)};var Le=i(30433),Ze=i(73727),ye=i(2780),Ce=i(66083),Ne=i(71267),Ee=i(8286),ke=i(86072),Ae=i(89601);const Se=({newOperation:e})=>{const t=(0,L.T)(),i=()=>{t((0,Ae.mg)())},r=(0,S.useMemo)((()=>e.uploadList.map(((e,t)=>{const n=e.type===be.WW.TAJO?`\n      ${e.nameProject}-${e.name}-${e.material?e.material.type:""}\n      `:e.name;return(0,o.jsx)(Ne.Z,{color:"secondary",label:n,onDelete:i},t)}))),[e.uploadList]);return 0===e.uploadList.length?(0,o.jsx)(o.Fragment,{},void 0):(0,o.jsx)(n.Z,Object.assign({item:!0},{children:(0,o.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,o.jsx)(s.ZP,Object.assign({title:"Change Upload"},{children:(0,o.jsx)(a.Z,Object.assign({color:"primary",size:"small"},{children:(0,o.jsx)(ke.Z,{},void 0)}),void 0)}),void 0),r]}),void 0)}),void 0)},Te=({newOperation:e})=>{const t=(0,L.T)(),i=(0,S.useMemo)((()=>e.downloadList.map(((e,i)=>(0,o.jsx)(Ne.Z,{color:"secondary",label:e.name,onDelete:()=>{return i=e.id,void t((0,Ae.$g)({id:i}));var i}},i)))),[e.downloadList]);return 0===e.downloadList.length?(0,o.jsx)(o.Fragment,{},void 0):(0,o.jsx)(n.Z,Object.assign({item:!0},{children:(0,o.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,o.jsx)(s.ZP,Object.assign({title:"Change Download"},{children:(0,o.jsx)(a.Z,Object.assign({color:"primary",size:"small"},{children:(0,o.jsx)(ke.Z,{},void 0)}),void 0)}),void 0),i]}),void 0)}),void 0)},we=({newOperation:e})=>{const t=(0,L.T)(),i=()=>{t((0,Ae.QW)())},r=(0,S.useMemo)((()=>e.excavatorList.map(((e,t)=>{const n=e.deviceAlias;return(0,o.jsx)(Ne.Z,{color:"secondary",label:n,onDelete:i},t)}))),[e.excavatorList]);return 0===e.excavatorList.length?(0,o.jsx)(o.Fragment,{},void 0):(0,o.jsx)(n.Z,Object.assign({item:!0},{children:(0,o.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,o.jsx)(s.ZP,Object.assign({title:"Change Excavator"},{children:(0,o.jsx)(a.Z,Object.assign({color:"primary",size:"small"},{children:(0,o.jsx)(ke.Z,{},void 0)}),void 0)}),void 0),r]}),void 0)}),void 0)};var De,Ie=i(96588),ze=i(18973),Re=i(50648);!function(e){e.CHANGE_NOTHING="0",e.CHANGE_UPLOAD="1",e.CHANGE_DOWNLOAD="2",e.CHANGE_EXCAVATOR="3",e.CHANGE_TRUCKS="changetruck"}(De||(De={}));const We=[{label:"Change Upload",value:De.CHANGE_UPLOAD,id:De.CHANGE_UPLOAD},{label:"Change/Add Download",value:De.CHANGE_DOWNLOAD,id:De.CHANGE_DOWNLOAD},{label:"Change Excavator",value:De.CHANGE_EXCAVATOR,id:De.CHANGE_EXCAVATOR}],Pe=[{label:"TAJO",value:be.WW.TAJO.toString(),id:""},{label:"STOCK",value:be.WW.STOCK.toString(),id:""}],$e=[{label:"DME",value:Re.TypeDownload.DME.toString(),id:""},{label:"PAD",value:Re.TypeDownload.PAD.toString(),id:""},{label:"STOCK",value:Re.TypeDownload.STOCK.toString(),id:""}],He=({open:e,operation:t,setOpen:i})=>{const[a,r]=(0,S.useState)([]),{excavatorInfoList:l}=(0,L.C)(ce.kW),d=(0,S.useRef)(),{dmeCellList:c,padCellList:v,stockCellList:u,polygonList:p}=(0,L.C)(ze.WD),[m,x]=(0,S.useState)(De.CHANGE_NOTHING),[b,O]=(0,S.useState)(be.WW.DESCONOCIDO),[f,Z]=(0,S.useState)(Re.TypeDownload.UNKNOWN),y=(0,L.T)(),{newOperation:C}=(0,L.C)(ze.e5),N=(e,t,i)=>{const o=t.find((t=>t.id===e));o&&y((0,Ae.qn)(Object.assign(Object.assign({},o),{type:i})))},E=(e,t,i)=>{const o=t.find((t=>t.id===e));o&&y((0,Ae.Ru)(Object.assign(Object.assign({},o),{type:i})))},k=(0,S.useCallback)((()=>((e,t,i,o,n,s,a,r)=>{let l=e===De.CHANGE_NOTHING?We:e===De.CHANGE_UPLOAD?Pe:[];switch(e){case De.CHANGE_NOTHING:l=We;break;case De.CHANGE_UPLOAD:l=Pe;break;case De.CHANGE_DOWNLOAD:l=$e;break;case De.CHANGE_EXCAVATOR:l=r.map((e=>({label:e.deviceAlias,id:e.id,value:e.id})));break;default:l=$e}switch(t){case be.WW.TAJO:l=i.map((e=>({label:`${e.nameProject}-${e.name}-${e.material?e.material.type:""}`,value:e.id,id:e.id})));break;case be.WW.STOCK:l=o.map((e=>({label:`${e.name}`,value:e.id,id:e.id})))}switch(n){case Re.TypeDownload.DME:l=s.map((e=>({label:`${e.name}`,value:e.id,id:e.id})));break;case Re.TypeDownload.PAD:l=a.map((e=>({label:`${e.name}`,value:e.id,id:e.id})));break;case Re.TypeDownload.STOCK:l=o.map((e=>({label:`${e.name}`,value:e.id,id:e.id})))}return l})(m,b,p,u,f,c,v,l)),[m,b,p,u,f,c,v,l]);return(0,o.jsxs)(ie.Z,Object.assign({open:e,onClose:i,title:"Migrate Operation"},{children:[(0,o.jsx)(Ce.Z,Object.assign({style:{paddingTop:8,paddingBottom:0}},{children:"Update Operation Attributes"}),void 0),(0,o.jsx)(ne.Z,Object.assign({style:{minHeight:320}},{children:(0,o.jsxs)(n.Z,Object.assign({container:!0,direction:"column"},{children:[(0,o.jsx)(n.Z,Object.assign({item:!0},{children:(0,o.jsxs)(n.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,o.jsx)(Y.Z,{children:"Upload:"},void 0),(0,o.jsx)(Le.g7,{operation:t,lineThrough:C.uploadList.length>0},void 0),(0,o.jsx)(Se,Object.assign({},{operation:t,newOperation:C}),void 0)]}),void 0)}),void 0),(0,o.jsx)(j.Z,{width:"100%",height:8},void 0),(0,o.jsxs)(n.Z,Object.assign({item:!0},{children:[(0,o.jsxs)(n.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,o.jsx)(Y.Z,{children:"Download: "},void 0),(0,o.jsx)(Le.DQ,{operation:t,lineThrough:C.downloadList.length>0},void 0),(0,o.jsx)(Te,Object.assign({},{operation:t,newOperation:C}),void 0)]}),void 0),(0,o.jsx)(j.Z,{width:"100%",height:8},void 0),(0,o.jsx)(h.Z,{orientation:"horizontal"},void 0),(0,o.jsx)(s.ZP,Object.assign({title:"Puede agregar hasta 2 puntos de descarga"},{children:(0,o.jsx)(Y.Z,Object.assign({style:{fontSize:11}},{children:"*You can add up to 2 download points, example 1 DME and 1 PAD or 1 STOCK"}),void 0)}),void 0),(0,o.jsx)(h.Z,{orientation:"horizontal"},void 0)]}),void 0),(0,o.jsx)(j.Z,{width:"100%",height:8},void 0),(0,o.jsx)(n.Z,Object.assign({item:!0},{children:(0,o.jsxs)(n.Z,Object.assign({container:!0,direction:"row",alignItems:"center"},{children:[(0,o.jsx)(Y.Z,{children:"Excavator: "},void 0),(0,o.jsx)(Le.Ez,{operation:t,lineThrough:C.excavatorList.length>0},void 0),(0,o.jsx)(we,Object.assign({},{operation:t,newOperation:C}),void 0)]}),void 0)}),void 0),(0,o.jsx)(j.Z,{height:8},void 0),(1!==C.excavatorList.length||2!==C.downloadList.length||1!==C.uploadList.length)&&(0,o.jsx)(n.Z,Object.assign({item:!0,style:{marginTop:8}},{children:(0,o.jsx)(Ie.ZP,{size:"small",value:a,blurOnSelect:!0,onChange:(e,t)=>{switch(r(t),t.length){case 0:x(De.CHANGE_NOTHING),O(be.WW.DESCONOCIDO),Z(Re.TypeDownload.UNKNOWN);break;case 1:x(t[0].value),O(be.WW.DESCONOCIDO),Z(Re.TypeDownload.UNKNOWN);break;case 2:switch(console.log("typeHelp",m),m){case De.CHANGE_UPLOAD:O(Number(t[1].value));break;case De.CHANGE_DOWNLOAD:Z(Number(t[1].value));break;case De.CHANGE_EXCAVATOR:((e,t)=>{const i=t.find((t=>t.id===e));console.log("element",i),i&&y((0,Ae.Zh)(i))})(t[1].value,l),r([]),x(De.CHANGE_NOTHING)}break;case 3:switch(m){case De.CHANGE_UPLOAD:switch(b){case be.WW.TAJO:N(t[2].id,p,be.WW.TAJO);break;case be.WW.STOCK:N(t[2].id,u,be.WW.STOCK)}break;case De.CHANGE_DOWNLOAD:switch(f){case Re.TypeDownload.DME:E(t[2].id,c,f);break;case Re.TypeDownload.PAD:E(t[2].id,v,f);break;case Re.TypeDownload.STOCK:E(t[2].id,u,f)}}O(be.WW.DESCONOCIDO),Z(Re.TypeDownload.UNKNOWN),x(De.CHANGE_NOTHING),r([])}setTimeout((()=>{var e,t;null===(e=d.current)||void 0===e||e.focus(),null===(t=d.current)||void 0===t||t.click()}),100)},options:k(),multiple:!0,renderTags:(e,t)=>e.map(((e,i)=>(0,o.jsx)(Ne.Z,Object.assign({variant:"outlined",label:e.label},t({index:i})),void 0))),style:{minWidth:200},getOptionLabel:e=>e.label,openOnFocus:!0,disableClearable:!0,getOptionDisabled:e=>((e,t,i)=>{switch(e.id){case De.CHANGE_UPLOAD:return t.uploadList.length>0;case De.CHANGE_DOWNLOAD:return t.downloadList.length>1;case De.CHANGE_EXCAVATOR:return t.excavatorList.length>0}return console.log("option",t.downloadList),t.downloadList.some((t=>t.type===Number(e.value)))})(e,C),filterSelectedOptions:!0,renderInput:e=>(0,o.jsx)(Ee.Z,Object.assign({},e,{autoFocus:!0,inputRef:d,label:"How can I help you?",variant:"outlined",fullWidth:!0}),void 0)},void 0)}),void 0)]}),void 0)}),void 0),(0,o.jsx)(oe.Z,{children:(0,o.jsxs)(n.Z,{children:[(0,o.jsx)(g.Z,Object.assign({onClick:i,size:"small",color:"primary"},{children:"Cancel"}),void 0),(0,o.jsx)(g.Z,Object.assign({variant:"outlined",size:"small",color:"secondary",onClick:()=>{y((0,Ae.db)({oldOperation:t,newOperation:C}))}},{children:"Save"}),void 0)]},void 0)},void 0)]}),void 0)};const _e=(0,d.Z)({rootList:{flex:1,padding:2,margin:2,overflow:"auto"},rootNoDropItem:{padding:2,margin:2,width:32,height:"92vh"},rootListOver:{flex:1,padding:2,margin:2,overflow:"auto",background:"#80808045"},rootNotDropList:{width:300,padding:2,margin:2,overflow:"auto",zIndex:1,transform:"translateX(-50%) translateY(130px) rotate(-90deg)",msTransform:"translateX(-50%) translateY(130px) rotate(-90deg)",mozTransform:"translateX(-50%) translateY(130px) rotate(-90deg)",OTransform:"translateX(-50%) translateY(130px) rotate(-90deg)",position:"absolute",left:"50%",top:"0%"},rootNotOperation:{width:36,padding:2,margin:2,background:`${f.J$}10`,borderColor:f.J$,borderWidth:2,borderStyle:"dotted"},disabledPadding:{padding:0,paddingBottom:2,flex:1}}),Ge=({operation:e})=>{const t=_e(),i=e.excavatorList.length>0?e.excavatorList[0]:null;return(0,o.jsxs)(z.T5,Object.assign({container:!0,className:t.disabledPadding,alignItems:"center",justifyContent:e.id?"flex-start":"flex-end"},{children:[(0,o.jsx)(z.P4,Object.assign({item:!0},{children:(0,o.jsx)(v.Z,{secondary:(0,o.jsx)("strong",Object.assign({style:{fontSize:16}},{children:e.id?`Operación ${null==i?void 0:i.deviceAlias}`:null==i?void 0:i.deviceAlias}),void 0)},void 0)}),void 0),!e.id&&(0,o.jsx)(Ze.rU,Object.assign({style:{textDecoration:"none"},to:`/operation/create/${i?i.deviceId:""}/${i?i.id:""}`},{children:(0,o.jsx)(s.ZP,Object.assign({title:`Assigment operation to ${i?i.deviceAlias:""}`},{children:(0,o.jsx)(a.Z,Object.assign({size:"small",color:"secondary"},{children:(0,o.jsx)(F.Z,{fontSize:"small"},void 0)}),void 0)}),void 0)}),void 0)]}),void 0)},Ue=({operation:e,loading:t,setLoading:i,setRefresh:r})=>{const l=_e(),[d,c]=(0,S.useState)(!1),[v,p]=(0,S.useState)(!1),h=()=>{p((e=>!e))},j=(0,L.T)(),{state:m}=(0,L.C)(ze.e5);if((0,S.useEffect)((()=>{switch(m){case Ae.m4.SAVING:i(!0);break;case Ae.m4.ERROR:i(!1);break;case Ae.m4.DONE:i(!1),p(!1)}}),[m]),!e.id)return(0,o.jsx)(Ge,Object.assign({},{operation:e}),void 0);const x=()=>c((e=>!e));return(0,o.jsxs)(u.Z,Object.assign({disableGutters:!0,className:l.disabledPadding},{children:[(0,o.jsx)(ae.a,Object.assign({open:d,handleClose:x,handleConfirm:()=>{return t=void 0,o=void 0,s=function*(){i(!0);const t=yield(0,ye.wg)(e.id);j(t?(0,de.L8)({open:!0,msg:t,severity:"error"}):(0,de.Ui)()),i(!1),r((e=>!e)),c(!1)},new((n=void 0)||(n=Promise))((function(e,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function r(e){try{l(s.throw(e))}catch(e){i(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(a,r)}l((s=s.apply(t,o||[])).next())}));var t,o,n,s},title:"Esta seguro?"},{children:(0,o.jsxs)(xe.Z,Object.assign({severity:"warning"},{children:["Esta intentando finalizar la operacion"," ",e.excavatorList[0].deviceAlias,", si ocurre algun error se le informará"]}),void 0)}),void 0),(0,o.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,o.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,o.jsx)(Ge,Object.assign({},{operation:e}),void 0),(0,o.jsxs)(n.Z,{children:[(0,o.jsx)(s.ZP,Object.assign({title:"Cambiar Carga/Descarga/Cambiones/Excavadora"},{children:(0,o.jsx)(a.Z,Object.assign({color:"secondary",size:"small",onClick:h},{children:(0,o.jsx)(K.Z,{fontSize:"small"},void 0)}),void 0)}),void 0),(0,o.jsx)(s.ZP,Object.assign({title:"Finalizar Operación"},{children:(0,o.jsx)(a.Z,Object.assign({color:"secondary",onClick:x,size:"small"},{children:(0,o.jsx)(V.Z,{fontSize:"small"},void 0)}),void 0)}),void 0),(0,o.jsx)(s.ZP,Object.assign({title:"Detalle Operación"},{children:(0,o.jsx)(Ze.rU,Object.assign({target:"_blank",to:`/operation/detail/${e.id}`},{children:(0,o.jsx)(a.Z,Object.assign({color:"secondary",size:"small"},{children:(0,o.jsx)(J.Z,{fontSize:"small"},void 0)}),void 0)}),void 0)}),void 0)]},void 0)]}),void 0),(0,o.jsxs)(n.Z,Object.assign({item:!0,md:12},{children:[(0,o.jsx)(Le.g7,{operation:e},void 0),(0,o.jsx)(Le.DQ,{operation:e},void 0)]}),void 0),(0,o.jsx)(n.Z,Object.assign({item:!0},{children:e.truckTemporalList&&e.truckTemporalList.length>0&&!t&&(0,o.jsx)(s.ZP,Object.assign({title:"Guardar cambios"},{children:(0,o.jsx)(g.Z,Object.assign({size:"small",variant:"outlined",color:"secondary",startIcon:(0,o.jsx)(B.Z,{color:"secondary",fontSize:"small"},void 0),onClick:()=>{j((0,Z.hK)({operationId:e.id})),Oe(e.id,e.truckTemporalList,i,r)}},{children:"GUARDAR"}),void 0)}),void 0)}),void 0),(0,o.jsx)(He,{open:v,operation:e,setOpen:h},void 0)]}),void 0)]}),void 0)},Me=({operation:e,filterList:t})=>{const i=(0,S.useMemo)((()=>{var i;return null===(i=e.truckTemporalList)||void 0===i?void 0:i.map(((i,n)=>(0,o.jsx)(I,{operation:e,truck:i,temporal:!0,isFilter:t.some((e=>e.deviceId===i.deviceId))},n)))}),[e.truckTemporalList]);return(0,o.jsx)(o.Fragment,{children:i},void 0)},Fe=({operation:e,filterList:t})=>{const[i,n]=(0,S.useState)(e.truckList);(0,S.useEffect)((()=>{n((t=>{if(e.truckList&&e.truckList.length!==i.length)return e.truckList;const o=i.some((t=>e.truckList.some((e=>e.deviceId==t.deviceId&&(t.sensor&&e.sensor?t.cycleNumber!==e.cycleNumber||t.state!==e.state||t.eventState!==e.eventState||t.sensor.latitude!=e.sensor.latitude:t.cycleNumber!==e.cycleNumber||t.state!==e.state||t.eventState!==e.eventState)))));return o?(console.log("changeFlagTruck",o,e.excavatorList[0].deviceAlias),e.truckList):t}))}),[e.truckList]);const s=(0,S.useMemo)((()=>e.truckList.map(((i,n)=>{var s;return(0,o.jsx)(I,{operation:e,isFilter:t.some((e=>e.deviceId===i.deviceId)),truck:i,temporalRemove:null===(s=e.truckTemporalRemoveList)||void 0===s?void 0:s.some((e=>e.deviceId===i.deviceId))},n)}))),[i]);return(0,o.jsx)(o.Fragment,{children:s},void 0)},Ke=({operation:e,setRefresh:t,filterList:i})=>{const[s,a]=(0,S.useState)(!1),[{canDrop:l,isOver:d},v]=(0,c.L)((()=>({accept:b,drop:()=>({operation:e}),collect:t=>({isOver:t.isOver(),canDrop:!!e.id})})),[e]),u=_e(),g=d&&l?u.rootListOver:d&&!l?u.rootNotDropList:u.rootList,m=(0,S.useMemo)((()=>(0,o.jsxs)(n.Z,Object.assign({container:!0},{children:[(0,o.jsx)(Fe,{operation:e,filterList:i},void 0),(0,o.jsx)(Me,{operation:e,filterList:i},void 0)]}),void 0)),[e,i]);if(!l)return(0,o.jsx)(p.Z,Object.assign({disablePadding:!0,component:r.Z,className:u.rootNotOperation},{children:(0,o.jsx)("div",Object.assign({className:u.rootNotDropList},{children:(0,o.jsx)(Ue,Object.assign({},{operation:e,setLoading:a,loading:s,setRefresh:t}),void 0)}),void 0)}),void 0);const O=e.excavatorList.length>0?e.excavatorList[0]:null;return(0,o.jsxs)(p.Z,Object.assign({ref:v,disablePadding:!0,component:r.Z,style:{display:"flex",flexDirection:"column"},className:g},{children:[(0,o.jsxs)(z.P4,Object.assign({item:!0,style:{flex:1}},{children:[(0,o.jsx)(Ue,Object.assign({},{operation:e,setLoading:a,loading:s,setRefresh:t}),void 0),(0,o.jsx)(h.Z,{orientation:"horizontal"},void 0),(0,o.jsx)(x,{loading:s},void 0),(0,o.jsx)(j.Z,{height:4},void 0),m]}),void 0),(0,o.jsx)(z.P4,Object.assign({item:!0},{children:O&&(0,o.jsx)(M,{truckList:[],operation:e},void 0)}),void 0)]}),void 0)};var Ve=i(43192),Je=i(57865);const Be=e=>{if(!e)return"";const t=be.PW[e.type];switch(e.type){case 1:return e.pit&&e.pit.projectList&&e.pit.projectList.length>0&&e.pit.projectList[0].polygonList&&e.pit.projectList[0].polygonList.length>0?`${e.pit.projectList[0].name} - ${e.pit.projectList[0].polygonList[0].name}`:"";case 3:return e[t]&&e[t].cellList&&e[t].cellList.length>0?e[t].cellList[0].name:"";default:return""}},Ye=e=>{if(!e&&1!==e.type)return"";const t=be.PW[e.type];return`${"dme"===t?"Desm.":"stock"===t?"STK":"Mine."} ${e[t]&&e[t].cellList&&e[t].cellList.length>0?e[t].cellList[0].name:""}`},Xe=()=>(0,o.jsx)(n.Z,Object.assign({container:!0,justifyContent:"center",alignItems:"center"},{children:(0,o.jsx)(n.Z,Object.assign({item:!0},{children:(0,o.jsx)(Y.Z,{children:"No data found"},void 0)}),void 0)}),void 0);var qe=i(59693),Qe=i(17215),et=i(91050),tt=i(58365);const it=({height:e,width:t})=>(0,o.jsx)(n.Z,Object.assign({container:!0,justifyContent:"center",alignItems:"center"},{children:(0,o.jsx)(tt.Z,{height:e,width:t,variant:"rect"},void 0)}),void 0),ot=()=>{const[e,t]=(0,S.useState)(""),[i,o]=(0,S.useState)([]),{truckInfoList:n,initial:s}=(0,L.C)(le.ej);return(0,S.useEffect)((()=>{if(console.log("StateTruckStreamReducer",s),!e||0===n.length)return void o([]);const t=n.filter((t=>{var i,o;return(null===(i=t.deviceAlias)||void 0===i?void 0:i.toUpperCase().includes(e.toUpperCase()))||(null===(o=t.deviceId)||void 0===o?void 0:o.toUpperCase().includes(e.toUpperCase()))}));o(t)}),[e,s,n]),{search:e,setSearch:t,filterList:i}};var nt=i(49032),st=i(78479),at=i(31125),rt=i(73099);const lt=(0,ve.Z)({root:{padding:2},rootList:{marginBottom:4},ListItem:{padding:0,margin:0},itemHeaderList:{flex:1,paddingLeft:2},textHeaderList:{margin:0},iconTextList:{padding:0,margin:0},chipText:{height:12,color:"#fff",fontWeight:"bold"}}),dt=({items:e,filterList:t,title:i,useVisibleList:n,keyState:s,disabledDrag:a})=>{const l=lt(),[d,c]=n,g=(0,S.useMemo)((()=>e.map((e=>(0,o.jsx)(I,{disabledDrag:s!==nt.EnumEvent.OPERATIONAL,truck:e,isFilter:t.some((t=>t.deviceId===e.deviceId))},e.deviceId)))),[e,t]),h=(0,S.useCallback)((()=>{const e=d.find((e=>e.value===s));return e&&e.visible}),[d]),j=(0,S.useCallback)((()=>{const e=d.findIndex((e=>e.value===s));if(e>-1){const t=JSON.parse(JSON.stringify(d));t[e].visible=!t[e].visible,c(t)}}),[d]),m=h();return(0,o.jsxs)(p.Z,Object.assign({component:r.Z,disablePadding:!0,className:l.rootList},{children:[(0,o.jsx)(u.Z,Object.assign({button:!0,disableGutters:!0,className:l.ListItem,onClick:j},{children:(0,o.jsxs)(z.T5,Object.assign({container:!0,justifyContent:"space-between",alignItems:"center"},{children:[(0,o.jsxs)(z.P4,Object.assign({className:l.itemHeaderList,container:!0,direction:"column",justifyContent:"center",alignContent:"flex-start"},{children:[(0,o.jsx)(v.Z,{className:l.textHeaderList,secondary:i},void 0),(0,o.jsx)(Ne.Z,{size:"small",className:l.chipText,color:"primary",label:`(${e.length}) trucks`},void 0)]}),void 0),e.length?(0,o.jsx)(z.hU,Object.assign({size:"small",className:l.iconTextList},{children:m?(0,o.jsx)(at.Z,{fontSize:"small"},void 0):(0,o.jsx)(rt.Z,{fontSize:"small"},void 0)}),void 0):(0,o.jsx)(o.Fragment,{},void 0)]}),void 0)}),void 0),(0,o.jsx)(z.iz,{orientation:"horizontal"},void 0),(0,o.jsx)(z.Mi,Object.assign({direction:"left",in:m,mountOnEnter:!0,unmountOnExit:!0},{children:(0,o.jsx)(z.T5,Object.assign({container:!0,justifyContent:"center"},{children:g}),void 0)}),void 0)]}),void 0)},ct=({truckAvailable:e})=>{const{filterList:t}=ot(),i=lt(),n=(0,st._)("VISIBLE_STATES_TABS",Object.keys(nt.EnumEvent).map(((e,t)=>({value:nt.EnumEvent[e],label:e,visible:!1}))));return(0,o.jsxs)(z.T5,Object.assign({className:i.root},{children:[(0,o.jsx)(dt,{items:e.filter((e=>e.state===nt.EnumEvent.UNKNOWN_STATE_EVENT&&e.eventState&&e.eventState.event.event===nt.EnumEvent.UNKNOWN_STATE_EVENT||e.eventState&&e.eventState.event.event===nt.EnumEvent.OPERATIONAL)),filterList:t,title:"Disponibles",useVisibleList:n,keyState:nt.EnumEvent.OPERATIONAL},void 0),(0,o.jsx)(dt,{items:e.filter((e=>e.eventState&&e.eventState.event.event===nt.EnumEvent.MAINTENANCE)),filterList:t,title:"MANTO",disabledDrag:!0,useVisibleList:n,keyState:nt.EnumEvent.MAINTENANCE},void 0),(0,o.jsx)(dt,{items:e.filter((e=>e.eventState&&e.eventState.event.event===nt.EnumEvent.OPERATIONAL_DELAY)),filterList:t,title:"DOperativo",useVisibleList:n,keyState:nt.EnumEvent.OPERATIONAL_DELAY},void 0),(0,o.jsx)(dt,{items:e.filter((e=>e.eventState&&e.eventState.event.event===nt.EnumEvent.NO_OPERATIONAL)),filterList:t,title:"NOperativo",useVisibleList:n,keyState:nt.EnumEvent.NO_OPERATIONAL},void 0)]}),void 0)},vt="92vh",ut=(0,ve.Z)((e=>({rootOperation:{display:"block",position:"relative",flexGrow:1,height:"96vh",margin:e.spacing(1,1,1,1)},rootAbsolute:{position:"absolute",top:0,bottom:0,right:0,left:0},operation:{overflow:"overlay",flex:11},containerOperation:{width:"100%",display:"flex",maxHeight:vt,minHeight:vt,alignContent:"center",justifyContent:"flex-start"},containerTrucks:{width:"100%",maxHeight:vt,minHeight:vt,margin:2,padding:2},search:{position:"relative",marginRight:2,borderRadius:e.shape.borderRadius,backgroundColor:(0,qe.Fq)(e.palette.common.white,.15),"&:hover":{backgroundColor:(0,qe.Fq)(e.palette.common.white,.25)},marginLeft:0,width:"100%",[e.breakpoints.up("sm")]:{width:"auto"}},searchIcon:{padding:e.spacing(0,0),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},cancelIcon:{padding:e.spacing(0,0),height:"100%",alignItems:"center",justifyContent:"center",display:"flex"},inputRoot:{color:"inherit"},inputInput:{padding:e.spacing(1,1,1,0),paddingLeft:`calc(1em + ${e.spacing(1)}px)`,paddingRight:`calc(1em + ${e.spacing(1)}px)`,transition:e.transitions.create("width"),width:"100%",[e.breakpoints.up("sm")]:{width:"8ch","&:focus":{width:"20ch"}}},rootTruck:{overflow:"auto",maxHeight:vt},rootIconResize:{height:vt,display:"flex",position:"relative",width:16,backgroundColor:f.Jx,paddingRight:7,paddingLeft:7,backgroundClip:"content-box",cursor:"col-resize"}})));var gt,pt,ht;const jt=()=>{const{operationsAll:e,status:t,truckAvailable:i}=(()=>{const{operationList:e,status:t,truckAvailable:i}=(0,L.C)(Z.YL),{truckInfoList:o}=(0,L.C)(le.ej),{initial:n}=(0,L.C)(ce.kW),s=(0,L.T)(),[a,r]=(0,S.useState)([]);return(0,S.useEffect)((()=>{if(console.log("status === FETCH_ENUM.DONE status",t,$.JD.DONE),console.log("status === FETCH_ENUM.DONE initialExcavator",n,P.Vj.LOADING),t===$.JD.DONE&&n!==P.Vj.LOADING){const t=e.map((e=>{var t,i,o;return Object.assign(Object.assign({},e),{excavator:e.excavatorList.length>0?e.excavatorList[0]:{},typeUpload:be.WW[null===(t=e.upload)||void 0===t?void 0:t.type],labelUpload:`${be.WW[null===(i=e.upload)||void 0===i?void 0:i.type]} ${e.upload?Be(e.upload):""}`,labelDownload:e.download?`${Ye(e.download)}`:"",typeDownload:be.WW[null===(o=e.download)||void 0===o?void 0:o.type],labelstate:be.J8[e.state],cycles:e.cycleList.length,truckList:e.truckList.map((e=>{var t;return Object.assign(Object.assign({},e),{deviceAliasNumber:Number(null===(t=e.deviceAlias.match(/\d/g))||void 0===t?void 0:t.join(""))})})).sort(((e,t)=>e.deviceAliasNumber-t.deviceAliasNumber))})}));r(t)}else r([])}),[e]),(0,S.useEffect)((()=>{console.log("update"),e.length>0&&o.length>0&&s((0,Z.Vb)({truckList:o}))}),[o,t]),{operationsAll:a,status:t,truckAvailable:i}})(),d=(0,S.useRef)(),c=(0,S.useRef)(),v=(0,S.useRef)(),[u,g]=(0,S.useState)(!1),[p,h]=(0,S.useState)(!1),[j,m]=(0,S.useState)(!1),x=(0,S.useRef)(),{search:b,setSearch:O,filterList:f}=ot(),y=(0,L.T)(),C=ut();(0,S.useEffect)((()=>{gt=document.querySelector("#wrapper"),pt=null==gt?void 0:gt.querySelector("#listTruck"),ht=null==gt?void 0:gt.querySelector("#listOperation");const e=localStorage.getItem("localStorajeTruck"),t=localStorage.getItem("localStorajeOperation");e&&(pt.style.flex=Number(e)),t&&(ht.style.flex=Number(t))}),[]),(0,S.useEffect)((()=>{console.log("refreshOPERA",j),y((0,le.RK)()),y((0,Z.hS)())}),[j]);const N=(0,S.useMemo)((()=>e.map(((e,t)=>(0,o.jsx)(Ke,{operation:e,setRefresh:m,filterList:f},t)))),[e,f]),{state:E}=(0,L.C)(ze.e5);(0,S.useEffect)((()=>{E===Ae.m4.DONE&&m((e=>!e))}),[E]);const k=(0,S.useCallback)((e=>{var t;if(!(u&&gt&&pt&&ht))return;const i=12*(e.clientX-gt.offsetLeft-46)/(null===(t=d.current)||void 0===t?void 0:t.clientWidth),o=Number(c.current.style.flex)>0?c.current.style.flex:0,n=Math.abs(o-i)>.05?Math.max(i,1):o;pt.style.flex=n,ht.style.flex=12-n,localStorage.setItem("localStorajeTruck",`${n}`),localStorage.setItem("localStorajeOperation",""+(12-n))}),[u]),A=(0,S.useMemo)((()=>(0,o.jsx)(ct,{truckAvailable:i},void 0)),[i]);return(0,o.jsx)(Ve.W,Object.assign({backend:Je.PD},{children:(0,o.jsxs)("div",Object.assign({className:C.rootOperation},{children:[(0,o.jsxs)("div",Object.assign({className:C.rootAbsolute},{children:[(0,o.jsx)(n.Z,Object.assign({item:!0,innerRef:c},{children:(0,o.jsxs)(n.Z,Object.assign({container:!0,justifyContent:"flex-end",alignItems:"center"},{children:[(0,o.jsx)(s.ZP,Object.assign({title:"Nueva Operación"},{children:(0,o.jsx)(Ze.rU,Object.assign({to:"/operation/create/0/0"},{children:(0,o.jsx)(a.Z,Object.assign({color:"secondary",size:"small"},{children:(0,o.jsx)(F.Z,{fontSize:"small"},void 0)}),void 0)}),void 0)}),void 0),(0,o.jsx)(s.ZP,Object.assign({title:"Reasignación global de Camiones"},{children:(0,o.jsx)(a.Z,Object.assign({onClick:()=>h((e=>!e)),color:"secondary",size:"small"},{children:(0,o.jsx)(K.Z,{fontSize:"small"},void 0)}),void 0)}),void 0),(0,o.jsx)(r.Z,Object.assign({style:{marginTop:2,marginRight:2}},{children:(0,o.jsxs)(n.Z,Object.assign({container:!0,alignItems:"center"},{children:[(0,o.jsxs)("div",Object.assign({className:C.search},{children:[(0,o.jsx)("div",Object.assign({className:C.searchIcon},{children:(0,o.jsx)(Qe.Z,{color:"primary",fontSize:"small"},void 0)}),void 0),(0,o.jsx)(s.ZP,Object.assign({title:"Buscar Camiones: Device Id, Device Alias"},{children:(0,o.jsx)(l.Z,{color:"primary",value:b,inputRef:x,onKeyDown:e=>{var t;"Escape"===e.key&&(O(""),null===(t=x.current)||void 0===t||t.blur())},onChange:e=>O(e.target.value),placeholder:"Buscar...",classes:{root:C.inputRoot,input:C.inputInput},inputProps:{"aria-label":"search"}},void 0)}),void 0)]}),void 0),b&&(0,o.jsx)("div",Object.assign({className:C.cancelIcon},{children:(0,o.jsx)(a.Z,Object.assign({size:"small",onClick:()=>O("")},{children:(0,o.jsx)(et.Z,{color:"inherit",fontSize:"small"},void 0)}),void 0)}),void 0)]}),void 0)}),void 0)]}),void 0)}),void 0),(0,o.jsxs)(n.Z,Object.assign({container:!0,innerRef:d,id:"wrapper",onMouseUp:()=>g(!1),onMouseMove:k,onMouseDown:e=>{e.target===v.current&&g(!0)}},{children:[(0,o.jsx)(n.Z,Object.assign({item:!0,id:"listTruck",style:{margin:0,padding:0,flex:1},className:C.rootTruck,innerRef:c},{children:A}),void 0),(0,o.jsx)(z.P4,{className:C.rootIconResize,id:"handler",innerRef:v},void 0),(0,o.jsx)(n.Z,Object.assign({item:!0,className:C.operation,id:"listOperation"},{children:(0,o.jsx)(n.Z,Object.assign({container:!0,direction:"column"},{children:(0,o.jsx)(n.Z,Object.assign({item:!0},{children:(0,o.jsx)("div",Object.assign({className:C.containerOperation},{children:t===$.JD.LOADING?(0,o.jsx)(n.Z,Object.assign({container:!0,alignItems:"stretch",justifyContent:"center"},{children:(0,o.jsx)(it,{height:"100%",width:"100%"},void 0)}),void 0):e.length>0?N:(0,o.jsx)(Xe,{},void 0)}),void 0)}),void 0)}),void 0)}),void 0)]}),void 0)]}),void 0),(0,o.jsx)(fe,{open:p,setOpen:h,setRefresh:m,operations:e},void 0)]}),void 0)}),void 0)};function mt(){return(0,o.jsx)(jt,{},void 0)}}}]);