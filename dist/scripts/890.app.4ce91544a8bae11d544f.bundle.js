(self.webpackChunkdts_hytera=self.webpackChunkdts_hytera||[]).push([[890],{2499:(e,o,t)=>{e.exports=t.p+"1e3ed9ad1c8b76c4f73b1017e93702f8.png"},7126:(e,o,t)=>{e.exports=t.p+"89f059a2790e391b484a369a3b9f92fb.png"},6593:(e,o,t)=>{e.exports=t.p+"ab5c4ca57e81aaf21cb330668efbde4f.svg"},5413:(e,o,t)=>{e.exports=t.p+"f7bda309f804ba7abdd57c3272cae75b.svg"},6046:(e,o,t)=>{e.exports=t.p+"6349bce6aa562fa9a965484651c725c9.svg"},9091:(e,o,t)=>{e.exports=t.p+"20557549695e4a02b8f5e299c9687642.png"},3890:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>ce});var a=t(5893),i=t(868),s=t(1749),n=t(7294),r=t(3534),c=t(8548),l=t(7348);const d=({data:e,map:o,pin:t,setSelectExcavator:i,setSelectTruck:s})=>{const{deviceId:r,sensor:c,deviceAlias:d,id:p}=e,{latitude:u,longitude:g,direction:y}=c,m=o.getSource(r),v={geometry:{type:"Point",coordinates:[g,u]},type:"Feature",properties:{rotate:y-360,pin:t&&t.deviceId===e.deviceId}},j=!`${d}`.includes("EX-"),_=`${d}`.includes("CM-");return(0,n.useEffect)((()=>{if(`${d}`.includes("EX-")){const e=`excavator_feature_${r}`,t={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:[{geometry:{type:"Point",coordinates:[g,u]},type:"Feature",properties:{}}]};o.getSource(e)?o.getSource(e).setData(t):o.addSource(e,{type:"geojson",cluster:!0,data:(0,l._X)([g,u])}),o.getLayer(e)||o.addLayer({id:e,type:"circle",source:e,paint:{"circle-color":"Red","circle-radius":10,"circle-stroke-width":25,"circle-stroke-color":"rgba(0, 128, 157,0.54)"}})}}),[c]),(0,n.useEffect)((()=>{if(m){if(m._data&&m._data.geometry&&Array.isArray(m._data.geometry.coordinates)){v.geometry.coordinates=[g,u],m.setData(v);const e=`${r}_pin_point`,t=o.getSource(e);if(t){const e=(0,l.X3)([g,u]);t.setData(e)}}}else o.getSource(r)||(o.addSource(`${r}`,{type:"geojson",data:v}),o.addLayer({id:`${r}`,type:"symbol",source:`${r}`,layout:{"icon-image":_?"pickup_nav":j?"truck_nav":"excavator_nav","icon-size":.08,"icon-ignore-placement":!0,"icon-allow-overlap":!0,"icon-rotate":["get","rotate"]}}),o.on("click",`${r}`,(function(o){e.deviceAlias.includes("EX")?(i(void 0),setTimeout((()=>{i(e)}),500)):(s(void 0),setTimeout((()=>{s(e)}),500))})),o.on("mouseenter",`${r}`,(function(){o.getCanvas().style.cursor="pointer"})),o.on("mouseleave",`${r}`,(function(){o.getCanvas().style.cursor=""})))}),[e.sensor.latitude,e.sensor.longitude,e.sensor.direction]),(0,a.jsx)(a.Fragment,{},void 0)};var p=t(3658);const u=({map:e,id:o,color:t,points:i,opacity:s,direction:r,iconImage:c})=>{const d={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:[{geometry:{type:"Point",coordinates:i},type:"Feature",properties:{}}]};return(0,n.useEffect)((()=>{const a=`${o}_point`,s=e.getSource(a);if(e&&!s)e.getSource(o)&&(e.removeLayer(o+""),e.removeSource(o+"")),setTimeout((()=>{const s={geometry:{type:"Point",coordinates:i},type:"Feature",properties:{rotate:r-360,fuel1:"Hydro"}};e.getSource(a)||e.addSource(a,{type:"geojson",cluster:!0,clusterMaxZoom:14,clusterRadius:50,data:(0,l._X)(i)}),e.getLayer(a)||e.addLayer({id:a,type:"circle",source:a,filter:["!has","point_count"],paint:{"circle-color":t,"circle-radius":20,"circle-stroke-width":15,"circle-stroke-color":"rgba(243, 93, 93, .4)"}}),e.getSource(o)||e.addSource(o+"",{type:"geojson",data:s}),e.getLayer(o)||e.addLayer({id:o+"",type:"symbol",source:o+"",layout:{"icon-image":c,"icon-size":.08,"icon-ignore-placement":!0,"icon-allow-overlap":!0,"icon-rotate":["get","rotate"]}})}),1e3);else if(s._data&&s._data.features[0].geometry&&Array.isArray(s._data.features[0].geometry.coordinates)){const e=s._data.features[0].geometry.coordinates,o=i,t=(0,p.TuJ)([e,o]),a=Math.floor((0,p.kE)(t,{units:"meters"})),r=[];for(var n=0;n<a;n++){const e=(0,p.$1t)(t,n,{units:"meters"});r.push(e.geometry.coordinates)}s.setData(d)}return()=>{}}),[e,i]),(0,a.jsx)(a.Fragment,{},void 0)},g=(e,o,t)=>{e.addSource(o,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:JSON.parse(t)}}})},y=(e,o,t)=>{e.addLayer({id:o,type:"line",source:t,layout:{visibility:"visible"},paint:{"line-color":"#C6FF00","line-width":4}})},m=({map:e,padCells:o,stockCells:t,dmeCells:i,polygons:s,polygons_actives:r,geofences:c,routes:l,setIsPaintPolygons:d,curves:u,setFeatureSelected:m})=>{(0,n.useEffect)((()=>{if(e&&r.length>0){const o=[],t=r.map((e=>{var t,a;const{latitude:i,longitude:s}=e.centroid;return o.push({type:"Feature",geometry:{type:"Point",coordinates:[s,i]},properties:{name:`${e.name}${e.material?`-${e.material.type}`:""}`,name_polygon:e.name,name_material:null===(t=e.material)||void 0===t?void 0:t.type,points_polygonTajo:e.points,id_polygonTajo:e.id,agTajo:e.ag,agcnTajo:e.agcn,aliasTajo:e.alias,alteTajo:e.alte,asTajo:e.as,auTajo:e.au,auchTajo:e.auch,centroidTajo:e.centroid,color:e.color,altitudeTajo:e.altitude,descripcionTajo:e.descripcion,heightTajo:e.height,litoTajo:e.lito,materialTajo:null===(a=e.material)||void 0===a?void 0:a.type,namePolTajo:e.name,nameProjectTajo:e.nameProject,onzasTajo:e.onzas,orezonetTajo:e.orezonet,ptaucnTajo:e.ptaucn,sTajo:e.s,tonnesTajo:e.tonnes,volumeTajo:e.volume}}),{type:"Feature",properties:{color:e.color,out_color:"blue",opacity:1,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_actives_2d")||e.addSource("polygons_actives_2d",{type:"geojson",data:{type:"FeatureCollection",features:t}}),e.getSource("centroid_actives")||e.addSource("centroid_actives",{type:"geojson",data:{type:"FeatureCollection",features:o}}),setTimeout((()=>{e.getLayer("polygons_actives_2d_layer")||e.addLayer({id:"polygons_actives_2d_layer",type:"fill",source:"polygons_actives_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":1}}),e.getLayer("polygons_lineborder_actives_2d_layer")||e.addLayer({id:"polygons_lineborder_actives_2d_layer",type:"line",source:"polygons_actives_2d",paint:{"line-color":["get","out_color"],"line-width":2,"line-opacity":1},filter:["==","$type","Polygon"]}),e.getLayer("centroid_plygons_actives_layer")||e.addLayer({id:"centroid_plygons_actives_layer",type:"symbol",source:"centroid_actives",layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),200),e.on("click","centroid_plygons_actives_layer",(function(o){const{points_polygonTajo:t,id_polygonTajo:a,agTajo:i,agcnTajo:s,aliasTajo:n,alteTajo:r,asTajo:c,auTajo:l,auchTajo:d,centroidTajo:p,color:u,altitudeTajo:v,descripcionTajo:j,heightTajo:_,litoTajo:f,materialTajo:x,namePolTajo:h,nameProjectTajo:b,onzasTajo:S,orezonetTajo:T,ptaucnTajo:O,sTajo:Z,tonnesTajo:k,volumeTajo:L}=o.features[0].properties,I=`source_polygon_select_${a}`,P=`layer_polygon_select_${a}`;e.getLayer(P)||(g(e,I,t),y(e,P,I)),m({type:"tajo",idLayerTajo:P,idSourceTajo:I,points_polygonTajo:t,id_polygonTajo:a,agTajo:i,agcnTajo:s,aliasTajo:n,alteTajo:r,asTajo:c,auTajo:l,auchTajo:d,centroidTajo:p,color:u,altitudeTajo:v,descripcionTajo:j,heightTajo:_,litoTajo:f,materialTajo:x,namePolTajo:h,nameProjectTajo:b,onzasTajo:S,orezonetTajo:T,ptaucnTajo:O,sTajo:Z,tonnesTajo:k,volumeTajo:L})}))}}),[e,r]),(0,n.useEffect)((()=>{if(s.length>0&&l.length>0){const o=[],t=[];s.forEach((e=>{const{latitude:a,longitude:i}=e.centroid;t.push({type:"Feature",geometry:{type:"Point",coordinates:[i,a]},properties:{name:`${e.name}${e.material?`-${e.material.type}`:" "}`}}),o.push({type:"Feature",properties:{color:"orange",out_color:"grey",opacity:.1,name:e.name,opacity_border:0},geometry:{type:"Polygon",coordinates:[e.points]}})})),l.forEach((e=>{o.push({type:"Feature",properties:{color:e.color,out_color:"red",opacity:.9,opacity_border:0},geometry:{type:"LineString",coordinates:e.points}})})),e.getSource("polygons_routes_2d")||e.addSource("polygons_routes_2d",{type:"geojson",data:{type:"FeatureCollection",features:o}}),e.getLayer("polygons_2d_layer")||e.addLayer({id:"polygons_2d_layer",type:"fill",source:"polygons_routes_2d",layout:{},paint:{"fill-color":["get","color"],"fill-opacity":["get","opacity"]},filter:["==","$type","Polygon"]}),e.getSource("centroid_no_actives")||e.addSource("centroid_no_actives",{type:"geojson",data:{type:"FeatureCollection",features:t}}),setTimeout((()=>{e.getLayer("routes_2d_layer")||e.addLayer({id:"routes_2d_layer",type:"line",source:"polygons_routes_2d",paint:{"line-width":6,"line-color":["get","color"],"line-opacity":.5},layout:{"line-join":"round","line-cap":"round"},filter:["==","$type","LineString"]}),d(!0)}),500)}return()=>{}}),[s,l]),(0,n.useEffect)((()=>{if(u.length>0){const o=u.map((e=>({type:"Feature",properties:{color:e.color,out_color:"red",opacity:.9,opacity_border:0},geometry:{type:"LineString",coordinates:e.points}})));e.getSource("curves_nivels_2d")||e.addSource("curves_nivels_2d",{type:"geojson",data:{type:"FeatureCollection",features:o}}),e.getLayer("curves_nivels_2d_layer")||e.addLayer({id:"curves_nivels_2d_layer",type:"line",source:"curves_nivels_2d",paint:{"line-width":1,"line-color":"#E6966E","line-opacity":.81},layout:{"line-join":"round","line-cap":"round"}})}return()=>{}}),[u]),(0,n.useEffect)((()=>{if(e&&c.length>0){const o=c.map((e=>({type:"Feature",properties:{color:e.color,out_color:"blue",opacity:.2,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}})));e.getSource("polygons_geofences_2d")||e.addSource("polygons_geofences_2d",{type:"geojson",data:{type:"FeatureCollection",features:o}}),e.getLayer("polygons_geofences_2d")||e.addLayer({id:"polygons_geofences_2d_layer",type:"fill",source:"polygons_geofences_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}})}}),[e,c]),(0,n.useEffect)((()=>{if(e&&o.length>0){const t=[],a=o.map((e=>{const{longitude:o,latitude:a}=e.centroid;return t.push({type:"Feature",geometry:{type:"Point",coordinates:[o,a]},properties:{namePad:`${e.name}`,id_Pad:e.idPad,points_Pad:e.points,tonnesPad:e.tonnes,volumePad:e.volume}}),{type:"Feature",properties:{color:"#80b918",out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_cells_2d")||e.addSource("polygons_cells_2d",{type:"geojson",data:{type:"FeatureCollection",features:a}}),e.getSource("centroid_actives_pad")||e.addSource("centroid_actives_pad",{type:"geojson",data:{type:"FeatureCollection",features:t}}),setTimeout((()=>{e.getLayer("polygons_cells_2d_layer")||e.addLayer({id:"polygons_cells_2d_layer",type:"fill",source:"polygons_cells_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}}),e.getLayer("centroid_pad_layer")||e.addLayer({id:"centroid_pad_layer",type:"symbol",source:"centroid_actives_pad",layout:{"text-field":["get","namePad"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),100),e.on("click","centroid_pad_layer",(o=>{const{namePad:t,points_Pad:a,id_Pad:i,tonnesPad:s,volumePad:n}=o.features[0].properties,r=JSON.parse(a);console.log("Centro Pad",r);const c=`source_polygon_select_pad_${i}`,l=`layer_polygon_select_pad_${i}`;g(e,c,a),y(e,l,c),m({type:"pad",id_Pad:i,namePad:t,points_Pad:a,tonnesPad:s,volumePad:n,idSourPad:c,idLayerPad:l})}))}}),[e,o]),(0,n.useEffect)((()=>{if(e&&i.length>0){const o=[],t=i.map((e=>{const{longitude:t,latitude:a}=e.centroid,i=(0,p.MqI)({type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}},{properties:{nameDme:`${e.name}`,points_polygonDme:e.points,id_polygonDme:e.id,tonnesDme:e.tonnes,volumeDme:e.volume}});return o.push(i),{type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_dmecells_2d")||e.addSource("polygons_dmecells_2d",{type:"geojson",data:{type:"FeatureCollection",features:t}}),e.getSource("centroid_actives_dme")||e.addSource("centroid_actives_dme",{type:"geojson",data:{type:"FeatureCollection",features:o}}),setTimeout((()=>{e.getLayer("polygons_dmecells_2d_layer")||e.addLayer({id:"polygons_dmecells_2d_layer",type:"fill",source:"polygons_dmecells_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}}),e.getLayer("centroid_dme_layer")||e.addLayer({id:"centroid_dme_layer",type:"symbol",source:"centroid_actives_dme",layout:{"text-field":["get","nameDme"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),100),e.on("click","centroid_dme_layer",(o=>{const{nameDme:t,points_polygonDme:a,id_polygonDme:i,tonnesDme:s,volumeDme:n}=o.features[0].properties;console.log("Centro Dme",o.features[0].properties.points_Pad);const r=`source_polygon_select_dme_${i}`,c=`layer_polygon_select_dme_${i}`;g(e,r,a),y(e,c,r),m({type:"dme",id_polygonDme:i,nameDme:t,points_polygonDme:a,tonnesDme:s,volumeDme:n,idSourceDme:r,idLayerDme:c})}))}}),[e,i]);const[v,j]=(0,n.useState)({});return(0,n.useEffect)((()=>{if(e&&t.length>0){const o=[],a=t.map((e=>{var t;const{longitude:a,latitude:i}=e.centroid,s=(0,p.beQ)({type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}},{properties:{nameStock:`${e.name}`,id_polygonStock:e.id,points_polygonStock:e.points,materialStock:null===(t=e.material)||void 0===t?void 0:t.type,altitudeStock:e.altitude,volumeStock:e.volume}});return o.push(s),{type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_stockcells_2d")||e.addSource("polygons_stockcells_2d",{type:"geojson",data:{type:"FeatureCollection",features:a}}),e.getSource("centroid_actives_stock")||e.addSource("centroid_actives_stock",{type:"geojson",data:{type:"FeatureCollection",features:o}}),setTimeout((()=>{e.getLayer("polygons_stockcells_2d_layer")||e.addLayer({id:"polygons_stockcells_2d_layer",type:"fill",source:"polygons_stockcells_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}}),e.getLayer("centroid_stock_layer")||e.addLayer({id:"centroid_stock_layer",type:"symbol",source:"centroid_actives_stock",layout:{"text-field":["get","nameStock"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),100),e.on("click","centroid_stock_layer",(o=>{const{nameStock:t,id_polygonStock:a,points_polygonStock:i,altitudeStock:s,volumeStock:n}=o.features[0].properties,r=`source_polygon_select_stock_${a}`,c=`layer_polygon_select_Stock_${a}`;e.getLayer(c)||(g(e,r,i),y(e,c,r)),m({type:"Stock",id_polygonStock:a,nameStock:t,points_polygonStock:i,altitudeStock:s,volumeStock:n,idSource:r,idLayer:c})}))}}),[e,t]),(0,a.jsx)(a.Fragment,{},void 0)};var v=t(8479);const j=(e,o,t,a,i,s)=>{const n=o.map((e=>{if(!e.sensor)return{type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{name:"",rotation:-180,offsetdate:[0,0]}};const{latitude:o,longitude:t,direction:a}=e.sensor,s=e.deviceAlias.split("-");return{type:"Feature",geometry:{type:"Point",coordinates:[t,o]},properties:{name:`${s.length>1&&""!==s[1].trim()?`${s[0].substr(0,1)}${s[1].substr(-2)}`:e.deviceAlias}`,rotation:-180+a,offsetdate:[0,i]}}})),r=e.getSource(t);r?r.setData({type:"FeatureCollection",features:n}):(e.addSource(t,{type:"geojson",data:{type:"FeatureCollection",features:n}}),e.addLayer({id:a,type:"symbol",source:t,layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":s,"text-rotate":["get","rotation"],"text-offset":["get","offsetdate"]},paint:{"text-color":"#fff","text-halo-color":"#00296b","text-halo-width":4}}))};var _=t(94),f=t(4845),x=t(2285),h=t(6847),b=t(9895),S=t(2302),T=t(3750),O=t(7394),Z=t(8222),k=t(9613);const L=(0,t(3914).Z)({table:{minWidth:100}}),I={root:{position:"fixed",width:"100%",height:"100%",zIndex:2},modal:{width:"20%",height:100,position:"fixed",zIndex:3,top:0,background:"",left:"40%",right:"40%"}},P=({setFeatureSelected:e,featureSelected:o,map:t})=>{const{type:i}=o;switch(i){case"Stock":const{nameStock:i,idLayer:s,idSource:n,volumeStock:r,altitudeStock:c}=o,l=L();function d(){e(void 0),t.removeLayer(s),t.removeSource(n)}function p(e,o){return{name:e,valor:o}}const u=[p("Altitud",c),p("Volumen",r)];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{onClick:d,style:I.root},void 0),(0,a.jsx)(x.Z,Object.assign({direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsx)("div",Object.assign({style:I.modal},{children:(0,a.jsx)(h.Z,Object.assign({component:b.Z},{children:(0,a.jsxs)(S.Z,Object.assign({className:l.table,size:"small","aria-label":"a dense table"},{children:[(0,a.jsx)(T.Z,{children:(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(Z.Z,{children:"Nombre"},void 0),(0,a.jsx)(Z.Z,Object.assign({align:"center"},{children:i}),void 0)]},void 0)},void 0),(0,a.jsx)(k.Z,{children:u.map((e=>(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(Z.Z,Object.assign({component:"th",scope:"row"},{children:e.name}),void 0),(0,a.jsx)(Z.Z,Object.assign({align:"center"},{children:e.valor}),void 0)]},e.name)))},void 0)]}),void 0)}),void 0)}),void 0)}),void 0)]},void 0);case"dme":const{nameDme:g,idLayerDme:y,idSourceDme:m,tonnesDme:v,volumeDme:j}=o;function _(){e(void 0),t.removeLayer(y),t.removeSource(m)}function f(e,o){return{name:e,valor:o}}const P=[f("Toneladas",v),f("Volumen",j)];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{onClick:_,style:I.root},void 0),(0,a.jsx)(x.Z,Object.assign({direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsx)("div",Object.assign({style:I.modal},{children:(0,a.jsx)(h.Z,Object.assign({component:b.Z},{children:(0,a.jsxs)(S.Z,Object.assign({className:"styles.table",size:"small","aria-label":"a dense table"},{children:[(0,a.jsx)(T.Z,{children:(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(Z.Z,{children:"Nombre"},void 0),(0,a.jsx)(Z.Z,Object.assign({align:"center"},{children:g}),void 0)]},void 0)},void 0),(0,a.jsx)(k.Z,{children:P.map((e=>(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(Z.Z,Object.assign({component:"th",scope:"row"},{children:e.name}),void 0),(0,a.jsx)(Z.Z,Object.assign({align:"center"},{children:e.valor}),void 0)]},e.name)))},void 0)]}),void 0)}),void 0)}),void 0)}),void 0)]},void 0);case"pad":const{namePad:C,tonnesPad:E,volumePad:F,idSourPad:w,idLayerPad:A}=o;function $(){e(void 0),t.removeLayer(A),t.removeSource(w)}function z(e,o){return{name:e,valor:o}}const D=[z("Volumen",F),z("Toneladas",E)];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{onClick:$,style:I.root},void 0),(0,a.jsx)(x.Z,Object.assign({direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsx)("div",Object.assign({style:I.modal},{children:(0,a.jsx)(h.Z,Object.assign({component:b.Z},{children:(0,a.jsxs)(S.Z,Object.assign({className:"styles.table",size:"small","aria-label":"a dense table"},{children:[(0,a.jsx)(T.Z,{children:(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(Z.Z,{children:"Nombre"},void 0),(0,a.jsx)(Z.Z,Object.assign({align:"center"},{children:C}),void 0)]},void 0)},void 0),(0,a.jsx)(k.Z,{children:D.map((e=>(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(Z.Z,Object.assign({component:"th",scope:"row"},{children:e.name}),void 0),(0,a.jsx)(Z.Z,Object.assign({align:"center"},{children:e.valor}),void 0)]},e.name)))},void 0)]}),void 0)}),void 0)}),void 0)}),void 0)]},void 0);case"tajo":const{namePolTajo:R,idLayerTajo:M,idSourceTajo:N,agTajo:B,agcnTajo:J,aliasTajo:U,alteTajo:V,asTajo:X,auTajo:H,auchTajo:Y,altitudeTajo:q,descripcionTajo:G,heightTajo:W,litoTajo:K,materialTajo:Q,nameProjectTajo:ee,onzasTajo:oe,orezonetTajo:te,ptaucnTajo:ae,sTajo:ie,tonnesTajo:se,volumeTajo:ne}=o;function re(){e(void 0),t.removeLayer(M),t.removeSource(N)}function ce(e,o){return{name:e,valor:o}}const le=[ce("Proyecto",ee),ce("Material",Q),ce("Ag",B),ce("Onzas",oe),ce("Altitud",q),ce("Toneladas",se),ce("Volumen",ne)];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{onClick:re,style:I.root},void 0),(0,a.jsx)(x.Z,Object.assign({direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsx)("div",Object.assign({style:I.modal},{children:(0,a.jsx)(h.Z,Object.assign({component:b.Z},{children:(0,a.jsxs)(S.Z,Object.assign({className:I.table,size:"small","aria-label":"a dense table"},{children:[(0,a.jsx)(T.Z,{children:(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(Z.Z,{children:"Polígono"},void 0),(0,a.jsx)(Z.Z,Object.assign({align:"center"},{children:R}),void 0)]},void 0)},void 0),(0,a.jsx)(k.Z,{children:le.map((e=>(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(Z.Z,Object.assign({component:"th",scope:"row"},{children:e.name}),void 0),(0,a.jsx)(Z.Z,Object.assign({align:"center"},{children:e.valor}),void 0)]},e.name)))},void 0)]}),void 0)}),void 0)}),void 0)}),void 0)]},void 0);default:return(0,a.jsx)(a.Fragment,{},void 0)}};var C=t(9038),E=t(1120),F=t(998),w=t(5757),A=t(2318),$=t(2822),z=t(6037),D=t(5517),R=t(7812),M=t(3681),N=t(3765),B=t(4562),J=t(573),U=t(6320),V=t(4880),X=t(3584),H=t(5090);const Y=t(6046),q=t(5413),G=(0,E.Z)((e=>({nested:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1),paddingTop:e.spacing(.5),paddingBottom:e.spacing(1)}}))),W=({data:e,selected:o,setSelected:t,map:r,iconImage:c})=>{const l=G(),{datetime:d}=e.sensor,[p,u]=(0,n.useState)(!1),[g,y]=(0,n.useState)(""),[m,v]=(0,n.useState)(!1),j=o&&o.deviceId===e.deviceId;(0,n.useEffect)((()=>{const e=new Date,o=()=>{const{stringValue:o,value:t}=(0,U.dj)(e);y(o),v(t>=V.qi)};o();const t=setInterval((()=>{o()}),5e3);return()=>{clearInterval(t)}}),[d]),(0,n.useEffect)((()=>(u(!0),setTimeout((()=>{u(!1)}),2e3),()=>{})),[e.sensor.datetime]);const _=e.operationList.length>0?e.operationList[0].truckList.length:0;return(0,a.jsx)(s.Z,Object.assign({container:!0,direction:"column",alignItems:"center"},{children:(0,a.jsxs)(b.Z,Object.assign({elevation:4,style:{marginBottom:8,width:"100%"}},{children:[(0,a.jsx)(F.Z,Object.assign({dense:!0,disableGutters:!0,button:!0,selected:j,onClick:()=>{o&&e.deviceId===o.deviceId?t(null):t(e)},style:{paddingLeft:4}},{children:(0,a.jsx)(s.Z,Object.assign({item:!0},{children:(0,a.jsx)(w.Z,{primary:e.deviceAlias,secondary:`Trucks[${_}]`},void 0)}),void 0)}),void 0),(0,a.jsx)(z.Z,Object.assign({in:j,timeout:"auto",unmountOnExit:!0,className:l.nested},{children:(0,a.jsxs)($.Z,Object.assign({dense:!0,disablePadding:!0},{children:[(0,a.jsx)(F.Z,Object.assign({style:{padding:4},dense:!0},{children:(0,a.jsx)(w.Z,{primary:(0,a.jsx)(i.ZP,Object.assign({title:`Última comunicación, i. real: ${e.realInterval} seg`,"aria-label":"add"},{children:(0,a.jsxs)("div",Object.assign({style:{display:"flex"}},{children:[(0,a.jsx)(N.Z,{color:"action",fontSize:"small"},void 0),(0,a.jsx)(A.Z,Object.assign({variant:"body1",style:{marginLeft:4},color:"initial"},{children:g}),void 0)]}),void 0)}),void 0)},void 0)}),void 0),(0,a.jsx)(D.Z,{},void 0),(0,a.jsxs)(F.Z,Object.assign({style:{padding:4},dense:!0},{children:[(0,a.jsx)("img",{width:24,src:Y},void 0),(0,a.jsx)(w.Z,{style:{marginLeft:4},primary:`${_} Activos`},void 0)]}),void 0),(0,a.jsxs)(F.Z,Object.assign({style:{padding:4},dense:!0},{children:[(0,a.jsx)("img",{width:24,src:q},void 0),(0,a.jsx)(w.Z,{style:{marginLeft:4},primary:"[num] cola"},void 0)]}),void 0)]}),void 0)}),void 0),(0,a.jsxs)(s.Z,Object.assign({container:!0,style:{padding:"0px 4px"},alignItems:"center"},{children:[(0,a.jsx)(s.Z,Object.assign({item:!0},{children:(0,a.jsx)(i.ZP,Object.assign({title:"Ubicar",style:{textAlign:"center",flex:1}},{children:(0,a.jsx)(R.Z,Object.assign({onClick:()=>{const{sensor:o}=e;r.getSource(e.deviceId)&&(r.removeLayer(e.deviceId+""),r.removeSource(e.deviceId+""));const{longitude:t,latitude:a,direction:i}=o;setTimeout((()=>{const o={geometry:{type:"Point",coordinates:[t,a]},type:"Feature",properties:{rotate:i-360,fuel1:"Hydro"}};r.addSource(e.deviceId+"",{type:"geojson",data:o}),r.addLayer({id:e.deviceId+"",type:"symbol",source:e.deviceId+"",layout:{"icon-image":c,"icon-size":.08,"icon-ignore-placement":!0,"icon-allow-overlap":!0,"icon-rotate":["get","rotate"]}})}),500);const s=[t,a];r.setCenter(s)},size:"small"},{children:(0,a.jsx)(B.Z,{fontSize:"small"},void 0)}),void 0)}),void 0)}),void 0),(0,a.jsx)(s.Z,Object.assign({item:!0},{children:(0,a.jsxs)(s.Z,Object.assign({container:!0,alignItems:"center"},{children:[(0,a.jsx)(J.Z,{style:{color:m?X.J$:X.sb},fontSize:"small"},void 0),(0,a.jsx)(A.Z,Object.assign({style:{fontSize:8,color:"rgba(0, 0, 0, 0.54)"}},{children:m?"Sin conex":H.l[e.state]}),void 0)]}),void 0)}),void 0)]}),void 0),p&&(0,a.jsx)(M.Z,{color:"primary"},void 0)]}),void 0)}),void 0)},K=t(6593),Q=(0,E.Z)((e=>({root:{},nested:{paddingLeft:e.spacing(1),paddingTop:e.spacing(.5),paddingBottom:e.spacing(1)},root_noFixed:{width:150,paddingRight:8,paddingLeft:8,backgroundColor:"#fbfeffbf",overflowY:"scroll",height:"100vh",zIndex:3}}))),ee=({excavators:e,setSelectedEM:o,selectedExcavatorMap:t,selected:i,setSelected:n,setSelectedAssigment:r,map:c,pinHook:l})=>{const d=Q(),[p,u]=l,g=e.map((function(e,o){return e.sensor?!(t&&t.deviceId===e.deviceId)&&(0,a.jsx)(W,Object.assign({},{key:e.deviceId,data:e,selected:i,setSelected:n,setSelectedAssigment:r,setPin:u,map:c,iconImage:"excavator_nav"}),void 0):(0,a.jsx)(s.Z,Object.assign({item:!0,md:12,style:{padding:"4px 0"},onClick:()=>n(e)},{children:(0,a.jsx)(b.Z,Object.assign({elevation:4},{children:(0,a.jsx)(F.Z,Object.assign({button:!0,style:{padding:4}},{children:(0,a.jsx)(w.Z,{primary:(0,a.jsx)(A.Z,Object.assign({variant:"body2"},{children:e.deviceAlias}),void 0),secondary:(0,a.jsx)("span",Object.assign({style:{fontSize:11,fontWeight:"bold",color:"grey"}},{children:"Sin Conexión..."}),void 0)},void 0)}),void 0)}),void 0)}),e.deviceId)}));return(0,a.jsxs)($.Z,Object.assign({className:d.root,disablePadding:!0},{children:[(0,a.jsxs)(F.Z,Object.assign({dense:!0},{children:[(0,a.jsx)("div",Object.assign({style:{marginRight:8}},{children:(0,a.jsx)("img",{alt:"Excavator",width:24,src:K},void 0)}),void 0),(0,a.jsx)(w.Z,{primary:"Excavators"},void 0)]}),void 0),(0,a.jsx)(x.Z,Object.assign({direction:"left",in:!!t,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsx)(s.Z,Object.assign({container:!0},{children:t&&(0,a.jsx)(W,Object.assign({},{data:t,selected:i,setSelected:n,setSelectedAssigment:r,setPin:u,map:c,iconImage:K}),void 0)}),void 0)}),void 0),(0,a.jsx)(s.Z,Object.assign({container:!0},{children:g}),void 0),(0,a.jsxs)(F.Z,Object.assign({dense:!0},{children:[(0,a.jsx)("div",Object.assign({style:{marginRight:8}},{children:(0,a.jsx)("img",{alt:"Excavator",width:24,src:K},void 0)}),void 0),(0,a.jsx)(w.Z,{primary:"Inactivas"},void 0)]}),void 0),(0,a.jsxs)(F.Z,Object.assign({dense:!0},{children:[(0,a.jsx)("div",Object.assign({style:{marginRight:8}},{children:(0,a.jsx)("img",{alt:"Excavator",width:24,src:K},void 0)}),void 0),(0,a.jsx)(w.Z,{primary:"Stad By"},void 0)]}),void 0)]}),void 0)},oe=(0,E.Z)((e=>({root:{width:150,display:"flex",position:"absolute",paddingRight:8,paddingLeft:8,backgroundColor:"#fbfeffbf",boxShadow:"0px 0px 10px #b5aeae",overflowY:"scroll",height:"100vh",left:0,zIndex:3},root_noFixed:{width:150,paddingRight:8,paddingLeft:8,backgroundColor:"#fbfeffbf",overflowY:"scroll",height:"100vh",zIndex:3},nested:{paddingLeft:e.spacing(1),paddingTop:e.spacing(.5),paddingBottom:e.spacing(1)}}))),te=e=>{const{excavators:o,selectedExcavatorMap:t,setSelectedEM:i,selected:s,setSelected:n,setSelectedAssigment:r,map:c,pinHook:l}=e,d=oe();return(0,a.jsx)("div",Object.assign({className:d.root},{children:(0,a.jsx)(ee,Object.assign({},{excavators:o,selectedExcavatorMap:t,setSelectedEM:i,selected:s,setSelected:n,setSelectedAssigment:r,map:c,pinHook:l}),void 0)}),void 0)},ae=(0,n.createContext)(null),ie=(e,o)=>{const{sensor:t}=e;t&&t.latitude&&t.longitude&&o((o=>{const t=o.findIndex((o=>e.deviceId===o.deviceId));return t>=0?o[t]=Object.assign({},e):o.push(e),JSON.parse(JSON.stringify(o))}))};function se(e){const{children:o,open:t,value:s}=e;return(0,a.jsx)(i.ZP,Object.assign({arrow:!0,color:"#075fcc",open:t,enterTouchDelay:0,placement:"bottom",title:s},{children:o}),void 0)}const ne=({gpsTruck:e,gpsExcavator:o,benchs:i,padCells:l,dmeCells:p,stockCells:g,curves:y,geofences:x,polygons_actives:h,polygons:b,routes:S})=>{const T=(0,n.useRef)(null),O=(0,n.useRef)(null),[Z,k]=(0,n.useState)(-78.196),[L,I]=(0,v._)("bearing_map_dispatch",0),[E,F]=(0,n.useState)(-7.6163),[w,A]=(0,n.useState)(14.81),[$,z]=(0,n.useState)(!1),[D,R]=(0,n.useState)(!1),[M,N]=(0,n.useState)([]),[B,J]=(0,n.useState)([]),[U,V]=(0,n.useState)(),[X,H]=(0,v._)("keys_highlights_units",[]),[Y,q]=(0,n.useState)([]),[G,W]=(0,n.useState)(),[K,Q]=(0,n.useState)(),[ee,oe]=(0,n.useState)(),[ne,re]=(0,n.useState)(-1),[ce,le]=(0,n.useState)(void 0);(0,n.useEffect)((()=>{(e=>{(0,_.r)().then((o=>{e(o)})).catch((o=>{e([]),console.log(o)}))})(N),(e=>{(0,C.X)().then((o=>{e(o)})).catch((o=>{e([]),console.log("Error al obtener las Excavadoras: ",o)}))})(J)}),[]),(0,n.useEffect)((()=>{D&&(O.current.loadImage(t(9091),(function(e,o){if(e)throw e;O.current.addImage("truck_nav",o)})),O.current.loadImage(t(2499),(function(e,o){if(console.log("error",e),e)throw e;O.current.addImage("excavator_nav",o)})),O.current.loadImage(t(7126),(function(e,o){if(console.log("error",e),e)throw e;O.current.addImage("pickup_nav",o)})))}),[D]),(0,n.useEffect)((()=>{const e=M.filter((e=>X.findIndex((o=>o===e.deviceId))>=0));q(e)}),[M,X]),(0,n.useEffect)((()=>{if(o){if(ie(o,J),K&&K.deviceId===o.deviceId&&Q(o),G&&G.deviceId===o.deviceId)if(G.operationList.length>0&&o.operationList.length>0){const e=G.operationList[0],t=o.operationList[0];e.truckList.length!==t.truckList.length&&W(o)}else W(o);q((e=>{const t=e.findIndex((e=>(null==e?void 0:e.deviceId)===o.deviceId));return t>=0&&(e[t]=o),JSON.parse(JSON.stringify(e))}))}}),[o]),(0,n.useEffect)((()=>{o&&ie(o,J)}),[o]),(0,n.useEffect)((()=>{e&&(ie(e,N),U&&U.deviceId===e.deviceId&&V(e),ee&&ee.deviceId===e.deviceId&&oe(e),q((o=>{const t=o.findIndex((o=>(null==o?void 0:o.deviceId)===e.deviceId));return t>=0&&(o[t]=e),JSON.parse(JSON.stringify(o))})))}),[e]),(0,n.useEffect)((()=>{D&&$&&j(O.current,M,"ID_SOURCE_ALIAS_TRUCKS","ID_LAYER_ALIAS_TRUCKS",-2.1,12)}),[M,D,$]),(0,n.useEffect)((()=>{$&&j(O.current,B,"ID_SOURCE_ALIAS_EXCAVATORS","ID_LAYER_ALIAS_EXCAVATORS",-3.2,12)}),[B,$]);const de=D&&Y.map(((e,o)=>(null==e?void 0:e.sensor)&&(0,a.jsx)(u,{id:null==e?void 0:e.deviceId,points:[null==e?void 0:e.sensor.longitude,e.sensor.latitude],opacity:1,color:"orange",direction:null==e?void 0:e.sensor.direction,map:O.current,iconImage:e.deviceAlias.includes("CM-")?"pickup_nav":"truck_nav"},o))),pe=$&&D&&M.concat(B).map(((e,o)=>e.sensor?(0,a.jsx)(d,{setSelectExcavator:Q,setSelectTruck:oe,data:e,map:O.current,pin:U},o):null)),ue=D&&(0,a.jsx)(m,Object.assign({},{polygons_actives:h,polygons:b,curves:y,routes:S,geofences:x,padCells:l,dmeCells:p,stockCells:g,setIsPaintPolygons:z,setFeatureSelected:le},{map:O.current}),void 0);return(0,a.jsx)(ae.Provider,Object.assign({value:O.current},{children:(0,a.jsxs)("div",Object.assign({style:{display:"flex",width:"100%",height:"100vh",position:"relative",overflowY:"scroll"}},{children:[(0,a.jsx)(s.Z,Object.assign({container:!0,style:{maxWidth:"33%",position:"fixed",top:0,zIndex:1,left:"33%"}},{children:(0,a.jsx)(f.Z,{defaultValue:0,ValueLabelComponent:se,getAriaValueText:function(e){return`${e}º`},"aria-labelledby":"discrete-slider-small-steps",valueLabelDisplay:"auto",step:5,marks:!0,min:0,value:L,max:360,onChange:(e,o)=>{I(Number(o))}},void 0)}),void 0),(0,a.jsx)(te,{excavators:B,selected:G,setSelected:W,setSelectedAssigment:re,selectedExcavatorMap:K,setSelectedEM:Q,map:O.current,pinHook:[U,V]},void 0),(0,a.jsx)(r.Z,Object.assign({map:O,dragRotate:!1,style:"mapbox://styles/dispatchgat/ckqqsfc2y46bo17sf1y29zwnj",mapContainer:T,bearing:Number(L),pitch:15},{lat:E,lng:Z,zoom:w,setLat:F,setLng:k,setZoom:A,setLoad:R}),"map2"),de,pe,ue,(0,a.jsx)(c.q,Object.assign({trucks:M},{selectedTruckMap:ee,setSelectedTM:oe},{excavator:G,highlights:X,setHighlights:H,pinHook:[U,V],map:O.current,setSelecteEx:W}),void 0),ce&&O.current&&(0,a.jsx)(P,Object.assign({},{setFeatureSelected:le,featureSelected:ce,map:O.current}),void 0)]}),void 0)}),void 0)};var re=t(3513);const ce=()=>(0,a.jsx)(re.a.Consumer,{children:e=>(0,a.jsx)(ne,{gpsExcavator:e.streamExcavator,gpsTruck:e.streamTruck,benchs:e.benchs,polygons:e.polygons,routes:e.routes,curves:e.curves,polygons_actives:e.polygons_actives,geofences:e.geofences,padCells:e.padCells,dmeCells:e.dmeCells,stockCells:e.stockCells},void 0)},void 0)}}]);