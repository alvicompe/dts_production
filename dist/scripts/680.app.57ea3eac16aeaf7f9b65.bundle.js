(self.webpackChunkdts_hytera=self.webpackChunkdts_hytera||[]).push([[680],{2499:(e,t,o)=>{e.exports=o.p+"1e3ed9ad1c8b76c4f73b1017e93702f8.png"},7126:(e,t,o)=>{e.exports=o.p+"89f059a2790e391b484a369a3b9f92fb.png"},6593:(e,t,o)=>{e.exports=o.p+"ab5c4ca57e81aaf21cb330668efbde4f.svg"},4686:(e,t,o)=>{e.exports=o.p+"36756eca8dc098cf7103be69319d1de6.svg"},5413:(e,t,o)=>{e.exports=o.p+"f7bda309f804ba7abdd57c3272cae75b.svg"},6046:(e,t,o)=>{e.exports=o.p+"6349bce6aa562fa9a965484651c725c9.svg"},9091:(e,t,o)=>{e.exports=o.p+"20557549695e4a02b8f5e299c9687642.png"},5680:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>ce});var a=o(5893),i=o(868),s=o(1749),n=o(7294),r=o(3534),c=o(4515),l=o(7348);const d=({data:e,map:t,pin:o,setSelectExcavator:i,setSelectTruck:s})=>{const{deviceId:r,sensor:c,deviceAlias:d,id:p}=e,{latitude:u,longitude:g,direction:y}=c,m=t.getSource(r),v={geometry:{type:"Point",coordinates:[g,u]},type:"Feature",properties:{rotate:y-360,pin:o&&o.deviceId===e.deviceId}},j=!`${d}`.includes("EX-"),_=`${d}`.includes("CM-");return(0,n.useEffect)((()=>{if(`${d}`.includes("EX-")){const e=`excavator_feature_${r}`,o={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:[{geometry:{type:"Point",coordinates:[g,u]},type:"Feature",properties:{}}]};t.getSource(e)?t.getSource(e).setData(o):t.addSource(e,{type:"geojson",cluster:!0,data:(0,l._X)([g,u])}),t.getLayer(e)||t.addLayer({id:e,type:"circle",source:e,paint:{"circle-color":"Red","circle-radius":10,"circle-stroke-width":25,"circle-stroke-color":"rgba(0, 128, 157,0.54)"}})}}),[c]),(0,n.useEffect)((()=>{if(m){if(m._data&&m._data.geometry&&Array.isArray(m._data.geometry.coordinates)){v.geometry.coordinates=[g,u],m.setData(v);const e=`${r}_pin_point`,o=t.getSource(e);if(o){const e=(0,l.X3)([g,u]);o.setData(e)}}}else t.getSource(r)||(t.addSource(`${r}`,{type:"geojson",data:v}),t.addLayer({id:`${r}`,type:"symbol",source:`${r}`,layout:{"icon-image":_?"pickup_nav":j?"truck_nav":"excavator_nav","icon-size":.08,"icon-ignore-placement":!0,"icon-allow-overlap":!0,"icon-rotate":["get","rotate"]}}),t.on("click",`${r}`,(function(t){e.deviceAlias.includes("EX")?(i(void 0),setTimeout((()=>{i(e)}),500)):(s(void 0),setTimeout((()=>{s(e)}),500))})),t.on("mouseenter",`${r}`,(function(){t.getCanvas().style.cursor="pointer"})),t.on("mouseleave",`${r}`,(function(){t.getCanvas().style.cursor=""})))}),[e.sensor.latitude,e.sensor.longitude,e.sensor.direction]),(0,a.jsx)(a.Fragment,{},void 0)};var p=o(4376);const u=({map:e,id:t,color:o,points:i,opacity:s,direction:r,iconImage:c})=>{const d={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:[{geometry:{type:"Point",coordinates:i},type:"Feature",properties:{}}]};return(0,n.useEffect)((()=>{const a=`${t}_point`,s=e.getSource(a);if(e&&!s)e.getSource(t)&&(e.removeLayer(t+""),e.removeSource(t+"")),setTimeout((()=>{const s={geometry:{type:"Point",coordinates:i},type:"Feature",properties:{rotate:r-360,fuel1:"Hydro"}};e.getSource(a)||e.addSource(a,{type:"geojson",cluster:!0,clusterMaxZoom:14,clusterRadius:50,data:(0,l._X)(i)}),e.getLayer(a)||e.addLayer({id:a,type:"circle",source:a,filter:["!has","point_count"],paint:{"circle-color":o,"circle-radius":20,"circle-stroke-width":15,"circle-stroke-color":"rgba(243, 93, 93, .4)"}}),e.getSource(t)||e.addSource(t+"",{type:"geojson",data:s}),e.getLayer(t)||e.addLayer({id:t+"",type:"symbol",source:t+"",layout:{"icon-image":c,"icon-size":.08,"icon-ignore-placement":!0,"icon-allow-overlap":!0,"icon-rotate":["get","rotate"]}})}),1e3);else if(s._data&&s._data.features[0].geometry&&Array.isArray(s._data.features[0].geometry.coordinates)){const e=s._data.features[0].geometry.coordinates,t=i,o=(0,p.TuJ)([e,t]),a=Math.floor((0,p.kE)(o,{units:"meters"})),r=[];for(var n=0;n<a;n++){const e=(0,p.$1t)(o,n,{units:"meters"});r.push(e.geometry.coordinates)}s.setData(d)}return()=>{}}),[e,i]),(0,a.jsx)(a.Fragment,{},void 0)},g=(e,t,o)=>{e.addSource(t,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:JSON.parse(o)}}})},y=(e,t,o)=>{e.addLayer({id:t,type:"line",source:o,layout:{visibility:"visible"},paint:{"line-color":"#C6FF00","line-width":4}})},m=({map:e,padCells:t,stockCells:o,dmeCells:i,polygons:s,polygons_actives:r,geofences:c,routes:l,setIsPaintPolygons:d,curves:u,setFeatureSelected:m})=>{(0,n.useEffect)((()=>{if(e&&r.length>0){const t=[],o=r.map((e=>{var o,a;const{latitude:i,longitude:s}=e.centroid;return t.push({type:"Feature",geometry:{type:"Point",coordinates:[s,i]},properties:{name:`${e.name}${e.material?`-${e.material.type}`:""}`,name_polygon:e.name,name_material:null===(o=e.material)||void 0===o?void 0:o.type,points_polygonTajo:e.points,id_polygonTajo:e.id,agTajo:e.ag,agcnTajo:e.agcn,aliasTajo:e.alias,alteTajo:e.alte,asTajo:e.as,auTajo:e.au,auchTajo:e.auch,centroidTajo:e.centroid,color:e.color,altitudeTajo:e.altitude,descripcionTajo:e.descripcion,heightTajo:e.height,litoTajo:e.lito,materialTajo:null===(a=e.material)||void 0===a?void 0:a.type,namePolTajo:e.name,nameProjectTajo:e.nameProject,onzasTajo:e.onzas,orezonetTajo:e.orezonet,ptaucnTajo:e.ptaucn,sTajo:e.s,tonnesTajo:e.tonnes,volumeTajo:e.volume}}),{type:"Feature",properties:{color:e.color,out_color:"blue",opacity:1,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_actives_2d")||e.addSource("polygons_actives_2d",{type:"geojson",data:{type:"FeatureCollection",features:o}}),e.getSource("centroid_actives")||e.addSource("centroid_actives",{type:"geojson",data:{type:"FeatureCollection",features:t}}),setTimeout((()=>{e.getLayer("polygons_actives_2d_layer")||e.addLayer({id:"polygons_actives_2d_layer",type:"fill",source:"polygons_actives_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":1}}),e.getLayer("polygons_lineborder_actives_2d_layer")||e.addLayer({id:"polygons_lineborder_actives_2d_layer",type:"line",source:"polygons_actives_2d",paint:{"line-color":["get","out_color"],"line-width":2,"line-opacity":1},filter:["==","$type","Polygon"]}),e.getLayer("centroid_plygons_actives_layer")||e.addLayer({id:"centroid_plygons_actives_layer",type:"symbol",source:"centroid_actives",layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),200),e.on("click","centroid_plygons_actives_layer",(function(t){const{points_polygonTajo:o,id_polygonTajo:a,agTajo:i,agcnTajo:s,aliasTajo:n,alteTajo:r,asTajo:c,auTajo:l,auchTajo:d,centroidTajo:p,color:u,altitudeTajo:v,descripcionTajo:j,heightTajo:_,litoTajo:f,materialTajo:x,namePolTajo:h,nameProjectTajo:b,onzasTajo:S,orezonetTajo:T,ptaucnTajo:O,sTajo:k,tonnesTajo:L,volumeTajo:Z}=t.features[0].properties,I=`source_polygon_select_${a}`,C=`layer_polygon_select_${a}`;e.getLayer(C)||(g(e,I,o),y(e,C,I)),m({type:"tajo",idLayerTajo:C,idSourceTajo:I,points_polygonTajo:o,id_polygonTajo:a,agTajo:i,agcnTajo:s,aliasTajo:n,alteTajo:r,asTajo:c,auTajo:l,auchTajo:d,centroidTajo:p,color:u,altitudeTajo:v,descripcionTajo:j,heightTajo:_,litoTajo:f,materialTajo:x,namePolTajo:h,nameProjectTajo:b,onzasTajo:S,orezonetTajo:T,ptaucnTajo:O,sTajo:k,tonnesTajo:L,volumeTajo:Z})}))}}),[e,r]),(0,n.useEffect)((()=>{if(s.length>0&&l.length>0){const t=[],o=[];s.forEach((e=>{const{latitude:a,longitude:i}=e.centroid;o.push({type:"Feature",geometry:{type:"Point",coordinates:[i,a]},properties:{name:`${e.name}${e.material?`-${e.material.type}`:" "}`}}),t.push({type:"Feature",properties:{color:"orange",out_color:"grey",opacity:.1,name:e.name,opacity_border:0},geometry:{type:"Polygon",coordinates:[e.points]}})})),l.forEach((e=>{t.push({type:"Feature",properties:{color:e.color,out_color:"red",opacity:.9,opacity_border:0},geometry:{type:"LineString",coordinates:e.points}})})),e.getSource("polygons_routes_2d")||e.addSource("polygons_routes_2d",{type:"geojson",data:{type:"FeatureCollection",features:t}}),e.getLayer("polygons_2d_layer")||e.addLayer({id:"polygons_2d_layer",type:"fill",source:"polygons_routes_2d",layout:{},paint:{"fill-color":["get","color"],"fill-opacity":["get","opacity"]},filter:["==","$type","Polygon"]}),e.getSource("centroid_no_actives")||e.addSource("centroid_no_actives",{type:"geojson",data:{type:"FeatureCollection",features:o}}),setTimeout((()=>{e.getLayer("routes_2d_layer")||e.addLayer({id:"routes_2d_layer",type:"line",source:"polygons_routes_2d",paint:{"line-width":6,"line-color":["get","color"],"line-opacity":.5},layout:{"line-join":"round","line-cap":"round"},filter:["==","$type","LineString"]}),d(!0)}),500)}return()=>{}}),[s,l]),(0,n.useEffect)((()=>{if(u.length>0){const t=u.map((e=>({type:"Feature",properties:{color:e.color,out_color:"red",opacity:.9,opacity_border:0},geometry:{type:"LineString",coordinates:e.points}})));e.getSource("curves_nivels_2d")||e.addSource("curves_nivels_2d",{type:"geojson",data:{type:"FeatureCollection",features:t}}),e.getLayer("curves_nivels_2d_layer")||e.addLayer({id:"curves_nivels_2d_layer",type:"line",source:"curves_nivels_2d",paint:{"line-width":1,"line-color":"#E6966E","line-opacity":.81},layout:{"line-join":"round","line-cap":"round"}})}return()=>{}}),[u]),(0,n.useEffect)((()=>{if(e&&c.length>0){const t=c.map((e=>({type:"Feature",properties:{color:e.color,out_color:"blue",opacity:.2,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}})));e.getSource("polygons_geofences_2d")||e.addSource("polygons_geofences_2d",{type:"geojson",data:{type:"FeatureCollection",features:t}}),e.getLayer("polygons_geofences_2d")||e.addLayer({id:"polygons_geofences_2d_layer",type:"fill",source:"polygons_geofences_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}})}}),[e,c]),(0,n.useEffect)((()=>{if(e&&t.length>0){const o=[],a=t.map((e=>{const{longitude:t,latitude:a}=e.centroid;return o.push({type:"Feature",geometry:{type:"Point",coordinates:[t,a]},properties:{name:`${e.name}`}}),{type:"Feature",properties:{color:"#80b918",out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_cells_2d")||e.addSource("polygons_cells_2d",{type:"geojson",data:{type:"FeatureCollection",features:a}}),e.getSource("centroid_actives_pad")||e.addSource("centroid_actives_pad",{type:"geojson",data:{type:"FeatureCollection",features:o}}),setTimeout((()=>{e.getLayer("polygons_cells_2d_layer")||e.addLayer({id:"polygons_cells_2d_layer",type:"fill",source:"polygons_cells_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}}),e.getLayer("centroid_pad_layer")||e.addLayer({id:"centroid_pad_layer",type:"symbol",source:"centroid_actives_pad",layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),100)}}),[e,t]),(0,n.useEffect)((()=>{if(e&&i.length>0){const t=[],o=i.map((e=>{const{longitude:o,latitude:a}=e.centroid,i=(0,p.MqI)({type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}},{properties:{nameDme:`${e.name}`,points_polygonDme:e.points,id_polygonDme:e.id,tonnesDme:e.tonnes,volumeDme:e.volume}});return t.push(i),{type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_dmecells_2d")||e.addSource("polygons_dmecells_2d",{type:"geojson",data:{type:"FeatureCollection",features:o}}),e.getSource("centroid_actives_dme")||e.addSource("centroid_actives_dme",{type:"geojson",data:{type:"FeatureCollection",features:t}}),setTimeout((()=>{e.getLayer("polygons_dmecells_2d_layer")||e.addLayer({id:"polygons_dmecells_2d_layer",type:"fill",source:"polygons_dmecells_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}}),e.getLayer("centroid_dme_layer")||e.addLayer({id:"centroid_dme_layer",type:"symbol",source:"centroid_actives_dme",layout:{"text-field":["get","nameDme"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),100),e.on("click","centroid_dme_layer",(t=>{const{nameDme:o,points_polygonDme:a,id_polygonDme:i,tonnesDme:s,volumeDme:n}=t.features[0].properties,r=`source_polygon_select_dme_${i}`,c=`layer_polygon_select_dme_${i}`;g(e,r,a),y(e,c,r),m({type:"dme",id_polygonDme:i,nameDme:o,points_polygonDme:a,tonnesDme:s,volumeDme:n,idSourceDme:r,idLayerDme:c})}))}}),[e,i]);const[v,j]=(0,n.useState)({});return(0,n.useEffect)((()=>{if(e&&o.length>0){const t=[],a=o.map((e=>{var o;const{longitude:a,latitude:i}=e.centroid,s=(0,p.beQ)({type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}},{properties:{nameStock:`${e.name}`,id_polygonStock:e.id,points_polygonStock:e.points,materialStock:null===(o=e.material)||void 0===o?void 0:o.type,altitudeStock:e.altitude,volumeStock:e.volume}});return t.push(s),{type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_stockcells_2d")||e.addSource("polygons_stockcells_2d",{type:"geojson",data:{type:"FeatureCollection",features:a}}),e.getSource("centroid_actives_stock")||e.addSource("centroid_actives_stock",{type:"geojson",data:{type:"FeatureCollection",features:t}}),setTimeout((()=>{e.getLayer("polygons_stockcells_2d_layer")||e.addLayer({id:"polygons_stockcells_2d_layer",type:"fill",source:"polygons_stockcells_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}}),e.getLayer("centroid_stock_layer")||e.addLayer({id:"centroid_stock_layer",type:"symbol",source:"centroid_actives_stock",layout:{"text-field":["get","nameStock"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),100),e.on("click","centroid_stock_layer",(t=>{const{nameStock:o,id_polygonStock:a,points_polygonStock:i,altitudeStock:s,volumeStock:n}=t.features[0].properties,r=`source_polygon_select_stock_${a}`,c=`layer_polygon_select_Stock_${a}`;e.getLayer(c)||(g(e,r,i),y(e,c,r)),m({type:"Stock",id_polygonStock:a,nameStock:o,points_polygonStock:i,altitudeStock:s,volumeStock:n,idSource:r,idLayer:c})}))}}),[e,o]),(0,a.jsx)(a.Fragment,{},void 0)};var v=o(8479);const j=(e,t,o,a,i,s)=>{const n=t.map((e=>{if(!e.sensor)return{type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{name:"",rotation:-180,offsetdate:[0,0]}};const{latitude:t,longitude:o,direction:a}=e.sensor,s=e.deviceAlias.split("-");return{type:"Feature",geometry:{type:"Point",coordinates:[o,t]},properties:{name:`${s.length>1&&""!==s[1].trim()?`${s[0].substr(0,1)}${s[1].substr(-2)}`:e.deviceAlias}`,rotation:-180+a,offsetdate:[0,i]}}})),r=e.getSource(o);r?r.setData({type:"FeatureCollection",features:n}):(e.addSource(o,{type:"geojson",data:{type:"FeatureCollection",features:n}}),e.addLayer({id:a,type:"symbol",source:o,layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":s,"text-rotate":["get","rotation"],"text-offset":["get","offsetdate"]},paint:{"text-color":"#fff","text-halo-color":"#00296b","text-halo-width":4}}))};var _=o(94),f=o(4845),x=o(2285),h=o(6847),b=o(9895),S=o(2302),T=o(3750),O=o(7394),k=o(8222),L=o(9613);const Z=(0,o(3914).Z)({table:{minWidth:100}}),I={root:{position:"fixed",width:"100%",height:"100%",zIndex:2},modal:{width:"20%",height:100,position:"fixed",zIndex:3,top:0,background:"",left:"40%",right:"40%"}},C=({setFeatureSelected:e,featureSelected:t,map:o})=>{const{type:i}=t;switch(i){case"Stock":const{nameStock:i,idLayer:c,idSource:l,volumeStock:d,altitudeStock:p}=t,u=Z();function s(e,t){return{name:e,valor:t}}const g=[s("Altitud",p),s("Volumen",d)];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{onClick:function(){e(void 0),o.removeLayer(c),o.removeSource(l)},style:I.root},void 0),(0,a.jsx)(x.Z,Object.assign({direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsx)("div",Object.assign({style:I.modal},{children:(0,a.jsx)(h.Z,Object.assign({component:b.Z},{children:(0,a.jsxs)(S.Z,Object.assign({className:u.table,size:"small","aria-label":"a dense table"},{children:[(0,a.jsx)(T.Z,{children:(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(k.Z,{children:"Nombre"},void 0),(0,a.jsx)(k.Z,Object.assign({align:"center"},{children:i}),void 0)]},void 0)},void 0),(0,a.jsx)(L.Z,{children:g.map((e=>(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(k.Z,Object.assign({component:"th",scope:"row"},{children:e.name}),void 0),(0,a.jsx)(k.Z,Object.assign({align:"center"},{children:e.valor}),void 0)]},e.name)))},void 0)]}),void 0)}),void 0)}),void 0)}),void 0)]},void 0);case"dme":const{nameDme:y,idLayerDme:m,idSourceDme:v,tonnesDme:j,volumeDme:_}=t;function n(e,t){return{name:e,valor:t}}const f=[n("Toneladas",j),n("Volumen",_)];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{onClick:function(){e(void 0),o.removeLayer(m),o.removeSource(v)},style:I.root},void 0),(0,a.jsx)(x.Z,Object.assign({direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsx)("div",Object.assign({style:I.modal},{children:(0,a.jsx)(h.Z,Object.assign({component:b.Z},{children:(0,a.jsxs)(S.Z,Object.assign({className:"styles.table",size:"small","aria-label":"a dense table"},{children:[(0,a.jsx)(T.Z,{children:(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(k.Z,{children:"Nombre"},void 0),(0,a.jsx)(k.Z,Object.assign({align:"center"},{children:y}),void 0)]},void 0)},void 0),(0,a.jsx)(L.Z,{children:f.map((e=>(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(k.Z,Object.assign({component:"th",scope:"row"},{children:e.name}),void 0),(0,a.jsx)(k.Z,Object.assign({align:"center"},{children:e.valor}),void 0)]},e.name)))},void 0)]}),void 0)}),void 0)}),void 0)}),void 0)]},void 0);case"tajo":const{namePolTajo:C,idLayerTajo:E,idSourceTajo:F,agTajo:w,agcnTajo:A,aliasTajo:P,alteTajo:$,asTajo:z,auTajo:D,auchTajo:M,altitudeTajo:R,descripcionTajo:N,heightTajo:U,litoTajo:B,materialTajo:J,nameProjectTajo:V,onzasTajo:X,orezonetTajo:H,ptaucnTajo:Y,sTajo:q,tonnesTajo:G,volumeTajo:W}=t;function r(e,t){return{name:e,valor:t}}const K=[r("Proyecto",V),r("Material",J),r("Ag",w),r("Onzas",X),r("Altitud",R),r("Toneladas",G),r("Volumen",W)];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{onClick:function(){e(void 0),o.removeLayer(E),o.removeSource(F)},style:I.root},void 0),(0,a.jsx)(x.Z,Object.assign({direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsx)("div",Object.assign({style:I.modal},{children:(0,a.jsx)(h.Z,Object.assign({component:b.Z},{children:(0,a.jsxs)(S.Z,Object.assign({className:I.table,size:"small","aria-label":"a dense table"},{children:[(0,a.jsx)(T.Z,{children:(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(k.Z,{children:"Polígono"},void 0),(0,a.jsx)(k.Z,Object.assign({align:"center"},{children:C}),void 0)]},void 0)},void 0),(0,a.jsx)(L.Z,{children:K.map((e=>(0,a.jsxs)(O.Z,{children:[(0,a.jsx)(k.Z,Object.assign({component:"th",scope:"row"},{children:e.name}),void 0),(0,a.jsx)(k.Z,Object.assign({align:"center"},{children:e.valor}),void 0)]},e.name)))},void 0)]}),void 0)}),void 0)}),void 0)}),void 0)]},void 0);default:return(0,a.jsx)(a.Fragment,{},void 0)}};var E=o(9038),F=o(1120),w=o(998),A=o(5757),P=o(2318),$=o(2822),z=o(6037),D=o(5517),M=o(7812),R=o(3681),N=o(3765),U=o(4562),B=o(573),J=o(6320),V=o(4880),X=o(3584),H=o(5090);o(4686);const Y=o(6046),q=o(5413),G=(0,F.Z)((e=>({nested:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1),paddingTop:e.spacing(.5),paddingBottom:e.spacing(1)}}))),W=({data:e,selected:t,setSelected:o,map:r,iconImage:c})=>{const l=G(),{datetime:d}=e.sensor,[p,u]=(0,n.useState)(!1),[g,y]=(0,n.useState)(""),[m,v]=(0,n.useState)(!1),j=t&&t.deviceId===e.deviceId;(0,n.useEffect)((()=>{const e=new Date,t=()=>{const{stringValue:t,value:o}=(0,J.dj)(e);y(t),v(o>=V.qi)};t();const o=setInterval((()=>{t()}),5e3);return()=>{clearInterval(o)}}),[d]),(0,n.useEffect)((()=>(u(!0),setTimeout((()=>{u(!1)}),2e3),()=>{})),[e.sensor.datetime]);const _=e.operationList.length>0?e.operationList[0].truckList.length:0;return(0,a.jsx)(s.Z,Object.assign({container:!0,direction:"column",alignItems:"center"},{children:(0,a.jsxs)(b.Z,Object.assign({elevation:4,style:{marginBottom:8,width:"100%"}},{children:[(0,a.jsx)(w.Z,Object.assign({dense:!0,disableGutters:!0,button:!0,selected:j,onClick:()=>{t&&e.deviceId===t.deviceId?o(null):o(e)},style:{paddingLeft:4}},{children:(0,a.jsx)(s.Z,Object.assign({item:!0},{children:(0,a.jsx)(A.Z,{primary:e.deviceAlias,secondary:`Trucks[${_}]`},void 0)}),void 0)}),void 0),(0,a.jsx)(z.Z,Object.assign({in:j,timeout:"auto",unmountOnExit:!0,className:l.nested},{children:(0,a.jsxs)($.Z,Object.assign({dense:!0,disablePadding:!0},{children:[(0,a.jsx)(w.Z,Object.assign({style:{padding:4},dense:!0},{children:(0,a.jsx)(A.Z,{primary:(0,a.jsx)(i.ZP,Object.assign({title:`Última comunicación, i. real: ${e.realInterval} seg`,"aria-label":"add"},{children:(0,a.jsxs)("div",Object.assign({style:{display:"flex"}},{children:[(0,a.jsx)(N.Z,{color:"action",fontSize:"small"},void 0),(0,a.jsx)(P.Z,Object.assign({variant:"body1",style:{marginLeft:4},color:"initial"},{children:g}),void 0)]}),void 0)}),void 0)},void 0)}),void 0),(0,a.jsx)(D.Z,{},void 0),(0,a.jsxs)(w.Z,Object.assign({style:{padding:4},dense:!0},{children:[(0,a.jsx)("img",{width:24,src:Y},void 0),(0,a.jsx)(A.Z,{style:{marginLeft:4},primary:`${_} Activos`},void 0)]}),void 0),(0,a.jsxs)(w.Z,Object.assign({style:{padding:4},dense:!0},{children:[(0,a.jsx)("img",{width:24,src:q},void 0),(0,a.jsx)(A.Z,{style:{marginLeft:4},primary:"[num] cola"},void 0)]}),void 0)]}),void 0)}),void 0),(0,a.jsxs)(s.Z,Object.assign({container:!0,style:{padding:"0px 4px"},alignItems:"center"},{children:[(0,a.jsx)(s.Z,Object.assign({item:!0},{children:(0,a.jsx)(i.ZP,Object.assign({title:"Ubicar",style:{textAlign:"center",flex:1}},{children:(0,a.jsx)(M.Z,Object.assign({onClick:()=>{const{sensor:t}=e;r.getSource(e.deviceId)&&(r.removeLayer(e.deviceId+""),r.removeSource(e.deviceId+""));const{longitude:o,latitude:a,direction:i}=t;setTimeout((()=>{const t={geometry:{type:"Point",coordinates:[o,a]},type:"Feature",properties:{rotate:i-360,fuel1:"Hydro"}};r.addSource(e.deviceId+"",{type:"geojson",data:t}),r.addLayer({id:e.deviceId+"",type:"symbol",source:e.deviceId+"",layout:{"icon-image":c,"icon-size":.08,"icon-ignore-placement":!0,"icon-allow-overlap":!0,"icon-rotate":["get","rotate"]}})}),500);const s=[o,a];r.setCenter(s)},size:"small"},{children:(0,a.jsx)(U.Z,{fontSize:"small"},void 0)}),void 0)}),void 0)}),void 0),(0,a.jsx)(s.Z,Object.assign({item:!0},{children:(0,a.jsxs)(s.Z,Object.assign({container:!0,alignItems:"center"},{children:[(0,a.jsx)(B.Z,{style:{color:m?X.J$:X.sb},fontSize:"small"},void 0),(0,a.jsx)(P.Z,Object.assign({style:{fontSize:8,color:"rgba(0, 0, 0, 0.54)"}},{children:m?"Sin conex":H.l[e.state]}),void 0)]}),void 0)}),void 0)]}),void 0),p&&(0,a.jsx)(R.Z,{color:"primary"},void 0)]}),void 0)}),void 0)},K=o(6593),Q=(0,F.Z)((e=>({root:{},nested:{paddingLeft:e.spacing(1),paddingTop:e.spacing(.5),paddingBottom:e.spacing(1)},root_noFixed:{width:150,paddingRight:8,paddingLeft:8,backgroundColor:"#fbfeffbf",overflowY:"scroll",height:"100vh",zIndex:3}}))),ee=({excavators:e,setSelectedEM:t,selectedExcavatorMap:o,selected:i,setSelected:n,setSelectedAssigment:r,map:c,pinHook:l})=>{const d=Q(),[p,u]=l,g=e.map((function(e,t){return e.sensor?!(o&&o.deviceId===e.deviceId)&&(0,a.jsx)(W,Object.assign({},{key:e.deviceId,data:e,selected:i,setSelected:n,setSelectedAssigment:r,setPin:u,map:c,iconImage:"excavator_nav"}),void 0):(0,a.jsx)(s.Z,Object.assign({item:!0,md:12,style:{padding:"4px 0"},onClick:()=>n(e)},{children:(0,a.jsx)(b.Z,Object.assign({elevation:4},{children:(0,a.jsx)(w.Z,Object.assign({button:!0,style:{padding:4}},{children:(0,a.jsx)(A.Z,{primary:(0,a.jsx)(P.Z,Object.assign({variant:"body2"},{children:e.deviceAlias}),void 0),secondary:(0,a.jsx)("span",Object.assign({style:{fontSize:11,fontWeight:"bold",color:"grey"}},{children:"Sin Conexión..."}),void 0)},void 0)}),void 0)}),void 0)}),e.deviceId)}));return(0,a.jsxs)($.Z,Object.assign({className:d.root,disablePadding:!0},{children:[(0,a.jsxs)(w.Z,Object.assign({dense:!0},{children:[(0,a.jsx)("div",Object.assign({style:{marginRight:8}},{children:(0,a.jsx)("img",{alt:"Excavator",width:24,src:K},void 0)}),void 0),(0,a.jsx)(A.Z,{primary:"Excavators"},void 0)]}),void 0),(0,a.jsx)(x.Z,Object.assign({direction:"left",in:!!o,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsx)(s.Z,Object.assign({container:!0},{children:o&&(0,a.jsx)(W,Object.assign({},{data:o,selected:i,setSelected:n,setSelectedAssigment:r,setPin:u,map:c,iconImage:K}),void 0)}),void 0)}),void 0),(0,a.jsx)(s.Z,Object.assign({container:!0},{children:g}),void 0)]}),void 0)},te=(0,F.Z)((e=>({root:{width:150,display:"flex",position:"absolute",paddingRight:8,paddingLeft:8,backgroundColor:"#fbfeffbf",boxShadow:"0px 0px 10px #b5aeae",overflowY:"scroll",height:"100vh",left:0,zIndex:3},root_noFixed:{width:150,paddingRight:8,paddingLeft:8,backgroundColor:"#fbfeffbf",overflowY:"scroll",height:"100vh",zIndex:3},nested:{paddingLeft:e.spacing(1),paddingTop:e.spacing(.5),paddingBottom:e.spacing(1)}}))),oe=e=>{const{excavators:t,selectedExcavatorMap:o,setSelectedEM:i,selected:s,setSelected:n,setSelectedAssigment:r,map:c,pinHook:l}=e,d=te();return(0,a.jsx)("div",Object.assign({className:d.root},{children:(0,a.jsx)(ee,Object.assign({},{excavators:t,selectedExcavatorMap:o,setSelectedEM:i,selected:s,setSelected:n,setSelectedAssigment:r,map:c,pinHook:l}),void 0)}),void 0)},ae=(0,n.createContext)(null),ie=(e,t)=>{const{sensor:o}=e;o&&o.latitude&&o.longitude&&t((t=>{const o=t.findIndex((t=>e.deviceId===t.deviceId));return o>=0?t[o]=Object.assign({},e):t.push(e),JSON.parse(JSON.stringify(t))}))};function se(e){const{children:t,open:o,value:s}=e;return(0,a.jsx)(i.ZP,Object.assign({arrow:!0,color:"#075fcc",open:o,enterTouchDelay:0,placement:"bottom",title:s},{children:t}),void 0)}const ne=({gpsTruck:e,gpsExcavator:t,benchs:i,padCells:l,dmeCells:p,stockCells:g,curves:y,geofences:x,polygons_actives:h,polygons:b,routes:S})=>{const T=(0,n.useRef)(null),O=(0,n.useRef)(null),[k,L]=(0,n.useState)(-78.196),[Z,I]=(0,v._)("bearing_map_dispatch",0),[F,w]=(0,n.useState)(-7.6163),[A,P]=(0,n.useState)(14.81),[$,z]=(0,n.useState)(!1),[D,M]=(0,n.useState)(!1),[R,N]=(0,n.useState)([]),[U,B]=(0,n.useState)([]),[J,V]=(0,n.useState)(),[X,H]=(0,v._)("keys_highlights_units",[]),[Y,q]=(0,n.useState)([]),[G,W]=(0,n.useState)({deviceId:"",cycleNumber:0,id:"",deviceAlias:"",realInterval:0,state:-1,sensor:{altitude:0,latitude:0,datetime:"",direction:0,longitude:0,speed:0},operationList:[]}),[K,Q]=(0,n.useState)(),[ee,te]=(0,n.useState)(),[ne,re]=(0,n.useState)(-1),[ce,le]=(0,n.useState)(void 0);(0,n.useEffect)((()=>{(e=>{(0,_.r)().then((t=>{e(t)})).catch((t=>{e([]),console.log(t)}))})(N),(e=>{(0,E.X)().then((t=>{e(t)})).catch((t=>{e([]),console.log("Error al obtener las Excavadoras: ",t)}))})(B)}),[]),(0,n.useEffect)((()=>{D&&(O.current.loadImage(o(9091),(function(e,t){if(e)throw e;O.current.addImage("truck_nav",t)})),O.current.loadImage(o(2499),(function(e,t){if(console.log("error",e),e)throw e;O.current.addImage("excavator_nav",t)})),O.current.loadImage(o(7126),(function(e,t){if(console.log("error",e),e)throw e;O.current.addImage("pickup_nav",t)})))}),[D]),(0,n.useEffect)((()=>{const e=R.filter((e=>X.findIndex((t=>t===e.deviceId))>=0));q(e)}),[R,X]),(0,n.useEffect)((()=>{if(t){if(ie(t,B),K&&K.deviceId===t.deviceId&&Q(t),G&&G.deviceId===t.deviceId)if(G.operationList.length>0&&t.operationList.length>0){const e=G.operationList[0],o=t.operationList[0];e.truckList.length!==o.truckList.length&&W(t)}else W(t);q((e=>{const o=e.findIndex((e=>e.deviceId===t.deviceId));return o>=0&&(e[o]=t),JSON.parse(JSON.stringify(e))}))}}),[t]),(0,n.useEffect)((()=>{t&&ie(t,B)}),[t]),(0,n.useEffect)((()=>{e&&(ie(e,N),J&&J.deviceId===e.deviceId&&V(e),ee&&ee.deviceId===e.deviceId&&te(e),q((t=>{const o=t.findIndex((t=>t.deviceId===e.deviceId));return o>=0&&(t[o]=e),JSON.parse(JSON.stringify(t))})))}),[e]),(0,n.useEffect)((()=>{D&&$&&j(O.current,R,"ID_SOURCE_ALIAS_TRUCKS","ID_LAYER_ALIAS_TRUCKS",-2.1,12)}),[R,D,$]),(0,n.useEffect)((()=>{$&&j(O.current,U,"ID_SOURCE_ALIAS_EXCAVATORS","ID_LAYER_ALIAS_EXCAVATORS",-3.2,12)}),[U,$]);const de=D&&Y.map(((e,t)=>e.sensor&&(0,a.jsx)(u,{id:e.deviceId,points:[e.sensor.longitude,e.sensor.latitude],opacity:1,color:"orange",direction:e.sensor.direction,map:O.current,iconImage:e.deviceAlias.includes("CM-")?"pickup_nav":"truck_nav"},t))),pe=$&&D&&R.concat(U).map(((e,t)=>e.sensor?(0,a.jsx)(d,{setSelectExcavator:Q,setSelectTruck:te,data:e,map:O.current,pin:J},t):null)),ue=D&&(0,a.jsx)(m,Object.assign({},{polygons_actives:h,polygons:b,curves:y,routes:S,geofences:x,padCells:l,dmeCells:p,stockCells:g,setIsPaintPolygons:z,setFeatureSelected:le},{map:O.current}),void 0);return(0,a.jsx)(ae.Provider,Object.assign({value:O.current},{children:(0,a.jsxs)("div",Object.assign({style:{display:"flex",width:"100%",height:"100vh",position:"relative",overflowY:"scroll"}},{children:[(0,a.jsx)(s.Z,Object.assign({container:!0,style:{maxWidth:"33%",position:"fixed",top:0,zIndex:1,left:"33%"}},{children:(0,a.jsx)(f.Z,{defaultValue:0,ValueLabelComponent:se,getAriaValueText:function(e){return`${e}º`},"aria-labelledby":"discrete-slider-small-steps",valueLabelDisplay:"auto",step:5,marks:!0,min:0,value:Z,max:360,onChange:(e,t)=>{I(Number(t))}},void 0)}),void 0),(0,a.jsx)(oe,{excavators:U,selected:G,setSelected:W,setSelectedAssigment:re,selectedExcavatorMap:K,setSelectedEM:Q,map:O.current,pinHook:[J,V]},void 0),(0,a.jsx)(r.Z,Object.assign({map:O,dragRotate:!1,style:"mapbox://styles/dispatchgat/ckqqsfc2y46bo17sf1y29zwnj",mapContainer:T,bearing:Number(Z),pitch:15},{lat:F,lng:k,zoom:A,setLat:w,setLng:L,setZoom:P,setLoad:M}),"map2"),de,pe,ue,(0,a.jsx)(c.q,Object.assign({trucks:R},{selectedTruckMap:ee,setSelectedTM:te},{excavator:G,highlights:X,setHighlights:H,pinHook:[J,V],map:O.current,setSelecteEx:W}),void 0),ce&&O.current&&(0,a.jsx)(C,Object.assign({},{setFeatureSelected:le,featureSelected:ce,map:O.current}),void 0)]}),void 0)}),void 0)};var re=o(3513);const ce=()=>(0,a.jsx)(re.a.Consumer,{children:e=>(0,a.jsx)(ne,{gpsExcavator:e.streamExcavator,gpsTruck:e.streamTruck,benchs:e.benchs,polygons:e.polygons,routes:e.routes,curves:e.curves,polygons_actives:e.polygons_actives,geofences:e.geofences,padCells:e.padCells,dmeCells:e.dmeCells,stockCells:e.stockCells},void 0)},void 0)}}]);