(self.webpackChunkdts_hytera=self.webpackChunkdts_hytera||[]).push([[288],{2499:(e,t,o)=>{e.exports=o.p+"1e3ed9ad1c8b76c4f73b1017e93702f8.png"},7126:(e,t,o)=>{e.exports=o.p+"89f059a2790e391b484a369a3b9f92fb.png"},6593:(e,t,o)=>{e.exports=o.p+"ab5c4ca57e81aaf21cb330668efbde4f.svg"},4686:(e,t,o)=>{e.exports=o.p+"36756eca8dc098cf7103be69319d1de6.svg"},5413:(e,t,o)=>{e.exports=o.p+"f7bda309f804ba7abdd57c3272cae75b.svg"},6046:(e,t,o)=>{e.exports=o.p+"6349bce6aa562fa9a965484651c725c9.svg"},9091:(e,t,o)=>{e.exports=o.p+"20557549695e4a02b8f5e299c9687642.png"},5288:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>Y});var a=o(5893),r=o(868),s=o(1749),i=o(7294),n=o(3534),c=o(998),l=o(5757),d=o(9895),p=o(2318),u=o(3681),y=o(6037),g=o(2822),_=o(5517),m=o(573),f=o(3765),v=o(1120),b=o(6320),h=o(4880),x=o(3584),S=o(5090);const j=o(4686),L=o(6046),$=o(5413),C=(0,v.Z)((e=>({nested:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1),paddingTop:e.spacing(.5),paddingBottom:e.spacing(1)}}))),k=({data:e,selected:t,setSelected:o})=>{const n=C(),[v,k]=(0,i.useState)(!1),[O,E]=(0,i.useState)(""),[F,I]=(0,i.useState)(!1),w=t&&t.deviceId===e.deviceId,{datetime:P}=e.sensor;return(0,i.useEffect)((()=>{const e=new Date,t=()=>{const{stringValue:t,value:o}=(0,b.dj)(e);E(t),I(o>=h.qi)};t();const o=setInterval((()=>{t()}),5e3);return()=>{clearInterval(o)}}),[P]),(0,i.useEffect)((()=>(k(!0),setTimeout((()=>{k(!1)}),2e3),()=>{})),[e.sensor.datetime]),(0,a.jsxs)(d.Z,Object.assign({elevation:4,style:{marginBottom:8}},{children:[(0,a.jsxs)(c.Z,Object.assign({button:!0,selected:w,onClick:()=>{t&&e.deviceId===t.deviceId?o(null):o(e)}},{children:[(0,a.jsx)(l.Z,{primary:e.deviceAlias,secondary:"[num] trucks"},void 0),(0,a.jsxs)(s.Z,Object.assign({container:!0,style:{width:"2rem"}},{children:[(0,a.jsx)(m.Z,{style:{color:F?x.J$:x.sb},fontSize:"small"},void 0),(0,a.jsx)(p.Z,Object.assign({style:{fontSize:8,color:"rgba(0, 0, 0, 0.54)"}},{children:F?"Sin conex":S.l[e.state]}),void 0)]}),void 0)]}),void 0),v&&(0,a.jsx)(u.Z,{color:"primary"},void 0),(0,a.jsx)(y.Z,Object.assign({in:w,timeout:"auto",unmountOnExit:!0,className:n.nested},{children:(0,a.jsxs)(g.Z,Object.assign({dense:!0,disablePadding:!0},{children:[(0,a.jsx)(c.Z,Object.assign({style:{padding:4},dense:!0},{children:(0,a.jsx)(l.Z,{primary:(0,a.jsx)(r.ZP,Object.assign({title:`Última comunicación, i. real: ${e.realInterval} seg`,"aria-label":"add"},{children:(0,a.jsxs)("div",Object.assign({style:{display:"flex"}},{children:[(0,a.jsx)(f.Z,{color:"action",fontSize:"small"},void 0),(0,a.jsx)(p.Z,Object.assign({variant:"body1",style:{marginLeft:4},color:"initial"},{children:O}),void 0)]}),void 0)}),void 0)},void 0)}),void 0),(0,a.jsx)(_.Z,{},void 0),(0,a.jsxs)(c.Z,Object.assign({style:{padding:4},dense:!0},{children:[(0,a.jsx)("img",{width:24,src:j},void 0),(0,a.jsx)(l.Z,{style:{marginLeft:4},primary:"[num] inactivos"},void 0)]}),void 0),(0,a.jsxs)(c.Z,Object.assign({style:{padding:4},dense:!0},{children:[(0,a.jsx)("img",{width:24,src:L},void 0),(0,a.jsx)(l.Z,{style:{marginLeft:4},primary:"[num] tránsito"},void 0)]}),void 0),(0,a.jsxs)(c.Z,Object.assign({style:{padding:4},dense:!0},{children:[(0,a.jsx)("img",{width:24,src:$},void 0),(0,a.jsx)(l.Z,{style:{marginLeft:4},primary:"[num] cola"},void 0)]}),void 0)]}),void 0)}),void 0)]}),void 0)};var O=o(2285);const E=o(6593),F=(0,v.Z)((e=>({root:{width:150,paddingRight:8,paddingLeft:8,backgroundColor:"#fbfeffbf",boxShadow:"0px 0px 10px #b5aeae",overflowY:"scroll",height:"100vh",position:"absolute",left:0,zIndex:3},root_noFixed:{width:150,paddingRight:8,paddingLeft:8,backgroundColor:"#fbfeffbf",overflowY:"scroll",height:"100vh",zIndex:3},nested:{paddingLeft:e.spacing(1),paddingTop:e.spacing(.5),paddingBottom:e.spacing(1)}}))),I=({excavators:e,setSelectedEM:t,selectedExcavatorMap:o,selected:r,setSelected:i,isNewAssigment:n,setSelectedAssigment:d})=>{const p=F();return(0,a.jsxs)(g.Z,Object.assign({className:n?p.root_noFixed:p.root,disablePadding:!0},{children:[(0,a.jsxs)(c.Z,Object.assign({dense:!0},{children:[(0,a.jsx)("div",Object.assign({style:{marginRight:8}},{children:(0,a.jsx)("img",{alt:"Placa",width:32,src:E},void 0)}),void 0),(0,a.jsx)(l.Z,{primary:"Excavators"},void 0)]}),void 0),(0,a.jsx)(O.Z,Object.assign({direction:"left",in:!!o,mountOnEnter:!0,unmountOnExit:!0},{children:(0,a.jsx)(s.Z,Object.assign({container:!0},{children:o&&(0,a.jsx)(k,Object.assign({},{data:o,selected:o,setSelected:t,setSelectedAssigment:()=>{}}),void 0)}),void 0)}),void 0),e.map(((e,t)=>!(o&&o.deviceId===e.deviceId)&&(0,a.jsx)(k,Object.assign({},{key:t,data:e,selected:r,setSelected:i,setSelectedAssigment:d}),void 0)))]}),void 0)};var w=o(6383),P=o(7348);const A=({data:e,map:t,pin:o,setSelectExcavator:r,setSelectTruck:s})=>{const{deviceId:n,sensor:c,deviceAlias:l,id:d}=e,{latitude:p,longitude:u,direction:y}=c,g=t.getSource(n),_={geometry:{type:"Point",coordinates:[u,p]},type:"Feature",properties:{rotate:y-360,pin:o&&o.deviceId===e.deviceId}},m=!`${l}`.includes("EX-"),f=`${l}`.includes("CM-");return(0,i.useEffect)((()=>{if(`${l}`.includes("EX-")){const e=`excavator_feature_${n}`,o={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:[{geometry:{type:"Point",coordinates:[u,p]},type:"Feature",properties:{}}]};t.getSource(e)?t.getSource(e).setData(o):t.addSource(e,{type:"geojson",cluster:!0,data:(0,P._X)([u,p])}),t.getLayer(e)||t.addLayer({id:e,type:"circle",source:e,paint:{"circle-color":"Red","circle-radius":10,"circle-stroke-width":25,"circle-stroke-color":"rgba(0, 128, 157,0.54)"}})}}),[c]),(0,i.useEffect)((()=>{if(g){if(g._data&&g._data.geometry&&Array.isArray(g._data.geometry.coordinates)){_.geometry.coordinates=[u,p],g.setData(_);const e=`${n}_pin_point`,o=t.getSource(e);if(o){const e=(0,P.X3)([u,p]);o.setData(e)}}}else t.getSource(n)||(t.addSource(`${n}`,{type:"geojson",data:_}),t.addLayer({id:`${n}`,type:"symbol",source:`${n}`,layout:{"icon-image":f?"pickup_nav":m?"truck_nav":"excavator_nav","icon-size":.08,"icon-ignore-placement":!0,"icon-allow-overlap":!0,"icon-rotate":["get","rotate"]}}),t.on("click",`${n}`,(function(t){console.log("dataclick",e),e.deviceAlias.includes("EX")?(r(void 0),setTimeout((()=>{r(e)}),500)):(s(void 0),setTimeout((()=>{s(e)}),500))})),t.on("mouseenter",`${n}`,(function(){t.getCanvas().style.cursor="pointer"})),t.on("mouseleave",`${n}`,(function(){t.getCanvas().style.cursor=""})))}),[e.sensor.latitude,e.sensor.longitude,e.sensor.direction]),(0,a.jsx)(a.Fragment,{},void 0)};var Z=o(4376);const T=({map:e,id:t,color:o,points:r,opacity:s,direction:n,iconImage:c})=>{const l={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:[{geometry:{type:"Point",coordinates:r},type:"Feature",properties:{}}]};return(0,i.useEffect)((()=>{const a=`${t}_point`,s=e.getSource(a);if(e&&!s)e.getSource(t)&&(e.removeLayer(t+""),e.removeSource(t+"")),setTimeout((()=>{const s={geometry:{type:"Point",coordinates:r},type:"Feature",properties:{rotate:n-360,fuel1:"Hydro"}};e.getSource(a)||e.addSource(a,{type:"geojson",cluster:!0,clusterMaxZoom:14,clusterRadius:50,data:(0,P._X)(r)}),e.getLayer(a)||e.addLayer({id:a,type:"circle",source:a,filter:["!has","point_count"],paint:{"circle-color":o,"circle-radius":20,"circle-stroke-width":15,"circle-stroke-color":"rgba(243, 93, 93, .4)"}}),e.getSource(t)||e.addSource(t+"",{type:"geojson",data:s}),e.getLayer(t)||e.addLayer({id:t+"",type:"symbol",source:t+"",layout:{"icon-image":c,"icon-size":.08,"icon-ignore-placement":!0,"icon-allow-overlap":!0,"icon-rotate":["get","rotate"]}})}),1e3);else if(s._data&&s._data.features[0].geometry&&Array.isArray(s._data.features[0].geometry.coordinates)){const e=s._data.features[0].geometry.coordinates,t=r,o=(0,Z.TuJ)([e,t]),a=Math.floor((0,Z.kE)(o,{units:"meters"})),n=[];for(var i=0;i<a;i++){const e=(0,Z.$1t)(o,i,{units:"meters"});n.push(e.geometry.coordinates)}s.setData(l)}return()=>{}}),[e,r]),(0,a.jsx)(a.Fragment,{},void 0)};var z=o(6158),M=o.n(z);const N=({map:e,padCells:t,stockCells:o,dmeCells:r,polygons:s,polygons_actives:n,geofences:c,routes:l,setIsPaintPolygons:d,curves:p})=>((0,i.useEffect)((()=>{if(e&&n.length>0){const t=[],o=n.map((e=>{var o,a;const{latitude:r,longitude:s}=e.centroid;return t.push({type:"Feature",geometry:{type:"Point",coordinates:[s,r]},properties:{name:`${e.name}${e.material?`-${e.material.type}`:""}`,name_polygon:e.name,name_material:null===(o=e.material)||void 0===o?void 0:o.type,points_polygon:e.points,id_polygon:e.id,ag:e.ag,agcn:e.agcn,alias:e.alias,alte:e.alte,as:e.as,au:e.au,auch:e.auch,centroid:e.centroid,color:e.color,altitude:e.altitude,descripcion:e.descripcion,height:e.height,id:e.id,lito:e.lito,material:null===(a=e.material)||void 0===a?void 0:a.type,namePol:e.name,nameProject:e.nameProject,onzas:e.onzas,orezonet:e.orezonet,ptaucn:e.ptaucn,s:e.s,tonnes:e.tonnes,volume:e.volume}}),{type:"Feature",properties:{color:e.color,out_color:"blue",opacity:1,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_actives_2d")||e.addSource("polygons_actives_2d",{type:"geojson",data:{type:"FeatureCollection",features:o}}),e.getSource("centroid_actives")||e.addSource("centroid_actives",{type:"geojson",data:{type:"FeatureCollection",features:t}}),setTimeout((()=>{e.getLayer("polygons_actives_2d_layer")||e.addLayer({id:"polygons_actives_2d_layer",type:"fill",source:"polygons_actives_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":1}}),e.getLayer("polygons_lineborder_actives_2d_layer")||e.addLayer({id:"polygons_lineborder_actives_2d_layer",type:"line",source:"polygons_actives_2d",paint:{"line-color":["get","out_color"],"line-width":2,"line-opacity":1},filter:["==","$type","Polygon"]}),e.getLayer("centroid_plygons_actives_layer")||e.addLayer({id:"centroid_plygons_actives_layer",type:"symbol",source:"centroid_actives",layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),200),e.on("click","centroid_plygons_actives_layer",(function(t){const{points_polygon:o,id_polygon:a,ag:r,agcn:s,alias:i,alte:n,as:c,au:l,auch:d,centroid:p,color:u,altitude:y,descripcion:g,height:_,lito:m,material:f,namePol:v,nameProject:b,onzas:h,orezonet:x,ptaucn:S,s:j,tonnes:L,volume:$}=t.features[0].properties,C=`source_polygon_select_${a}`,k=`layer_polygon_select_${a}`;e.addSource(C,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:JSON.parse(o)}}}),e.addLayer({id:k,type:"line",source:C,layout:{},paint:{"line-color":"#ECFE03","line-width":5}});const O=new(M().Popup)({closeOnClick:!0,offset:[0,-10],anchor:"bottom"});O.setLngLat(t.lngLat).setHTML(`<h4>\n            Nombre Polígono: ${v}   <br/> \n            Proyecto: ${b} <br/> \n            Material : ${f} <br/> \n            au : ${l||"No Establecido"} <br/> \n            onzas : ${h} <br/> \n            ag : ${r} <br/> \n            agcn : ${s} <br/> \n            as : ${c} <br/> \n            alias : ${i||"No asignado"} <br/> \n            auch : ${d} <br/>\n            altitude : ${y} <br/> \n            descripcion : ${g||"No asignado"} <br/> \n            height : ${_} <br/> \n            lito : ${m} <br/> \n            orezonet : ${x} <br/> \n            s : ${j} <br/> \n            tonnes : ${L} <br/> \n            volume : ${$} <br/>                   \n            </h4>`).addTo(e),O.on("close",(t=>{e.removeLayer(k),e.removeSource(C)}))}))}}),[e,n]),(0,i.useEffect)((()=>{if(s.length>0&&l.length>0){const t=[],o=[];s.forEach((e=>{const{latitude:a,longitude:r}=e.centroid;o.push({type:"Feature",geometry:{type:"Point",coordinates:[r,a]},properties:{name:`${e.name}${e.material?`-${e.material.type}`:" "}`}}),t.push({type:"Feature",properties:{color:"orange",out_color:"grey",opacity:.1,name:e.name,opacity_border:0},geometry:{type:"Polygon",coordinates:[e.points]}})})),l.forEach((e=>{t.push({type:"Feature",properties:{color:e.color,out_color:"red",opacity:.9,opacity_border:0},geometry:{type:"LineString",coordinates:e.points}})})),e.getSource("polygons_routes_2d")||e.addSource("polygons_routes_2d",{type:"geojson",data:{type:"FeatureCollection",features:t}}),e.getLayer("polygons_2d_layer")||e.addLayer({id:"polygons_2d_layer",type:"fill",source:"polygons_routes_2d",layout:{},paint:{"fill-color":["get","color"],"fill-opacity":["get","opacity"]},filter:["==","$type","Polygon"]}),e.getSource("centroid_no_actives")||e.addSource("centroid_no_actives",{type:"geojson",data:{type:"FeatureCollection",features:o}}),setTimeout((()=>{e.getLayer("routes_2d_layer")||e.addLayer({id:"routes_2d_layer",type:"line",source:"polygons_routes_2d",paint:{"line-width":6,"line-color":["get","color"],"line-opacity":.5},layout:{"line-join":"round","line-cap":"round"},filter:["==","$type","LineString"]}),d(!0)}),500)}return()=>{}}),[s,l]),(0,i.useEffect)((()=>{if(p.length>0){const t=p.map((e=>({type:"Feature",properties:{color:e.color,out_color:"red",opacity:.9,opacity_border:0},geometry:{type:"LineString",coordinates:e.points}})));e.getSource("curves_nivels_2d")||e.addSource("curves_nivels_2d",{type:"geojson",data:{type:"FeatureCollection",features:t}}),e.getLayer("curves_nivels_2d_layer")||e.addLayer({id:"curves_nivels_2d_layer",type:"line",source:"curves_nivels_2d",paint:{"line-width":1,"line-color":"#E6966E","line-opacity":.81},layout:{"line-join":"round","line-cap":"round"}})}return()=>{}}),[p]),(0,i.useEffect)((()=>{if(e&&c.length>0){const t=c.map((e=>({type:"Feature",properties:{color:e.color,out_color:"blue",opacity:.2,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}})));e.getSource("polygons_geofences_2d")||e.addSource("polygons_geofences_2d",{type:"geojson",data:{type:"FeatureCollection",features:t}}),e.getLayer("polygons_geofences_2d")||e.addLayer({id:"polygons_geofences_2d_layer",type:"fill",source:"polygons_geofences_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}})}}),[e,c]),(0,i.useEffect)((()=>{if(e&&t.length>0){const o=[],a=t.map((e=>{const{longitude:t,latitude:a}=e.centroid;return o.push({type:"Feature",geometry:{type:"Point",coordinates:[t,a]},properties:{name:`${e.name}`}}),{type:"Feature",properties:{color:"#80b918",out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_cells_2d")||e.addSource("polygons_cells_2d",{type:"geojson",data:{type:"FeatureCollection",features:a}}),e.getSource("centroid_actives_pad")||e.addSource("centroid_actives_pad",{type:"geojson",data:{type:"FeatureCollection",features:o}}),setTimeout((()=>{e.getLayer("polygons_cells_2d_layer")||e.addLayer({id:"polygons_cells_2d_layer",type:"fill",source:"polygons_cells_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}}),e.getLayer("centroid_pad_layer")||e.addLayer({id:"centroid_pad_layer",type:"symbol",source:"centroid_actives_pad",layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),100)}}),[e,t]),(0,i.useEffect)((()=>{if(e&&r.length>0){const t=[],o=r.map((e=>{const{longitude:o,latitude:a}=e.centroid,r=(0,Z.MqI)({type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}},{properties:{name:`${e.name}`,points_polygon:e.points,id_polygon:e.id,tonnes:e.tonnes,volume:e.volume}});return t.push(r),{type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_dmecells_2d")||e.addSource("polygons_dmecells_2d",{type:"geojson",data:{type:"FeatureCollection",features:o}}),e.getSource("centroid_actives_dme")||e.addSource("centroid_actives_dme",{type:"geojson",data:{type:"FeatureCollection",features:t}}),setTimeout((()=>{e.getLayer("polygons_dmecells_2d_layer")||e.addLayer({id:"polygons_dmecells_2d_layer",type:"fill",source:"polygons_dmecells_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}}),e.getLayer("centroid_dme_layer")||e.addLayer({id:"centroid_dme_layer",type:"symbol",source:"centroid_actives_dme",layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),100),e.on("click","centroid_dme_layer",(t=>{const{id_polygon:o,name:a,points_polygon:r,tonnes:s,volume:i}=t.features[0].properties,n=`source_polygon_select_dme_${o}`,c=`layer_polygon_select_dme_${o}`;e.addSource(n,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:JSON.parse(r)}}}),e.addLayer({id:c,type:"line",source:n,layout:{visibility:"visible"},paint:{"line-color":"#69FE06","line-width":4}});const l=new(M().Popup)({closeOnClick:!0,offset:[0,-10],anchor:"bottom"});l.setLngLat(t.lngLat).setHTML(`<h4>\n            Nombre: ${a}   <br/> \n            Toneladas : ${s||""}<br/> \n            Volumen : ${i} <br/>        \n            </h4>`).addTo(e),l.on("close",(t=>{e.removeLayer(c),e.removeSource(n)}))}))}}),[e,r]),(0,i.useEffect)((()=>{if(e&&o.length>0){const t=[],a=o.map((e=>{var o;const{longitude:a,latitude:r}=e.centroid,s=(0,Z.beQ)({type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}},{properties:{name:`${e.name}`,id_polygon:e.id,material:null===(o=e.material)||void 0===o?void 0:o.type,points_polygon:e.points,altitude:e.altitude,volume:e.volume}});return t.push(s),{type:"Feature",properties:{color:e.color,out_color:"#43aa8b",opacity:.8,opacity_border:1},geometry:{type:"Polygon",coordinates:[e.points]}}}));e.getSource("polygons_stockcells_2d")||e.addSource("polygons_stockcells_2d",{type:"geojson",data:{type:"FeatureCollection",features:a}}),e.getSource("centroid_actives_stock")||e.addSource("centroid_actives_stock",{type:"geojson",data:{type:"FeatureCollection",features:t}}),setTimeout((()=>{e.getLayer("polygons_stockcells_2d_layer")||e.addLayer({id:"polygons_stockcells_2d_layer",type:"fill",source:"polygons_stockcells_2d",layout:{},paint:{"fill-color":["get","color"],"fill-outline-color":["get","out_color"],"fill-opacity":["get","opacity"]}}),e.getLayer("centroid_stock_layer")||e.addLayer({id:"centroid_stock_layer",type:"symbol",source:"centroid_actives_stock",layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#00296b","text-halo-color":"#f8f7ff","text-halo-width":2}})}),100),e.on("click","centroid_stock_layer",(t=>{const{id_polygon:o,name:a,points_polygon:r,altitude:s,volume:i}=t.features[0].properties,n=`source_polygon_select_stock_${o}`,c=`layer_polygon_select_Stock_${o}`;e.addSource(n,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:JSON.parse(r)}}}),e.addLayer({id:c,type:"line",source:n,layout:{visibility:"visible"},paint:{"line-color":"#C6FF00","line-width":4}});const l=new(M().Popup)({closeOnClick:!0,offset:[0,-10],anchor:"bottom"});l.setLngLat(t.lngLat).setHTML(`<h4>\n            Nombre: ${a}   <br/> \n            Altitud: ${s}   <br/> \n            Volumen: ${i}   <br/> \n            </h4>`).addTo(e),l.on("close",(t=>{e.removeLayer(c),e.removeSource(n)}))}))}}),[e,o]),(0,a.jsx)(a.Fragment,{},void 0));var R=o(8479);const D=(e,t,o,a,r,s)=>{const i=t.map((e=>{if(!e.sensor)return{type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{name:"",rotation:-180,offsetdate:[0,0]}};const{latitude:t,longitude:o,direction:a}=e.sensor,s=e.deviceAlias.split("-");return{type:"Feature",geometry:{type:"Point",coordinates:[o,t]},properties:{name:`${s.length>1&&""!==s[1].trim()?`${s[0].substr(0,1)}${s[1].substr(-2)}`:e.deviceAlias}`,rotation:-180+a,offsetdate:[0,r]}}})),n=e.getSource(o);n?n.setData({type:"FeatureCollection",features:i}):(e.addSource(o,{type:"geojson",data:{type:"FeatureCollection",features:i}}),e.addLayer({id:a,type:"symbol",source:o,layout:{"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":s,"text-rotate":["get","rotation"],"text-offset":["get","offsetdate"]},paint:{"text-color":"#fff","text-halo-color":"#00296b","text-halo-width":4}}))};var J=o(94),U=o(4845);const B=(0,i.createContext)(null),V=(e,t)=>{const{sensor:o}=e;o&&o.latitude&&o.longitude&&t((t=>{const o=t.findIndex((t=>e.deviceId===t.deviceId));return o>=0?t[o]=Object.assign({},e):t.push(e),JSON.parse(JSON.stringify(t))}))};function X(e){const{children:t,open:o,value:s}=e;return(0,a.jsx)(r.ZP,Object.assign({arrow:!0,color:"#075fcc",open:o,enterTouchDelay:0,placement:"bottom",title:s},{children:t}),void 0)}const H=({gpsTruck:e,gpsExcavator:t,benchs:r,padCells:c,dmeCells:l,stockCells:d,curves:p,geofences:u,polygons_actives:y,polygons:g,routes:_})=>{const m=(0,i.useRef)(null),f=(0,i.useRef)(null),[v,b]=(0,i.useState)(-78.196),[h,x]=(0,R._)("bearing_map_dispatch",0),[S,j]=(0,i.useState)(-7.6163),[L,$]=(0,i.useState)(14.81),[C,k]=(0,i.useState)(!1),[O,E]=(0,i.useState)(!1),[F,P]=(0,i.useState)([]),[Z,z]=(0,i.useState)([]),[M,H]=(0,i.useState)(),[q,Y]=(0,R._)("keys_highlights_units",[]),[G,K]=(0,i.useState)([]),[Q,W]=(0,i.useState)(Z[0]),[ee,te]=(0,i.useState)(),[oe,ae]=(0,i.useState)(),[re,se]=(0,i.useState)(-1);(0,i.useEffect)((()=>{(e=>{(0,J.r)().then((t=>{e(t)})).catch((t=>{e([]),console.log(t)}))})(P)}),[]),(0,i.useEffect)((()=>{O&&(f.current.loadImage(o(9091),(function(e,t){if(e)throw e;f.current.addImage("truck_nav",t)})),f.current.loadImage(o(2499),(function(e,t){if(console.log("error",e),e)throw e;f.current.addImage("excavator_nav",t)})),f.current.loadImage(o(7126),(function(e,t){if(console.log("error",e),e)throw e;f.current.addImage("pickup_nav",t)})))}),[O]),(0,i.useEffect)((()=>{const e=F.filter((e=>q.findIndex((t=>t===e.deviceId))>=0));K(e)}),[F,q]),(0,i.useEffect)((()=>{e&&(V(e,P),M&&M.deviceId===e.deviceId&&H(e),oe&&oe.deviceId===e.deviceId&&ae(e),K((t=>{const o=t.findIndex((t=>t.deviceId===e.deviceId));return o>=0&&(t[o]=e),JSON.parse(JSON.stringify(t))})))}),[e]),(0,i.useEffect)((()=>{t&&V(t,z)}),[t]),(0,i.useEffect)((()=>{O&&C&&D(f.current,F,"ID_SOURCE_ALIAS_TRUCKS","ID_LAYER_ALIAS_TRUCKS",-2.1,12)}),[F,O,C]),(0,i.useEffect)((()=>{C&&D(f.current,Z,"ID_SOURCE_ALIAS_EXCAVATORS","ID_LAYER_ALIAS_EXCAVATORS",-3.2,12)}),[Z,C]);const ie=!!re&&-1!==re,ne=!ie&&O&&G.map(((e,t)=>(0,a.jsx)(T,{id:e.deviceId,points:[e.sensor.longitude,e.sensor.latitude],opacity:1,color:"orange",direction:e.sensor.direction,map:f.current,iconImage:e.deviceAlias.includes("CM-")?"pickup_nav":"truck_nav"},t))),ce=!ie&&C&&O&&F.concat(Z).map(((e,t)=>e.sensor?(0,a.jsx)(A,{setSelectExcavator:te,setSelectTruck:ae,data:e,map:f.current,pin:M},t):null)),le=!ie&&O&&(0,a.jsx)(N,Object.assign({},{polygons_actives:y,polygons:g,curves:p,routes:_,geofences:u,padCells:c,dmeCells:l,stockCells:d,setIsPaintPolygons:k},{map:f.current}),void 0);return(0,a.jsx)(B.Provider,Object.assign({value:f.current},{children:(0,a.jsxs)("div",Object.assign({style:{display:"flex",width:"100%",height:"100vh",position:"relative",overflowY:"scroll"}},{children:[(0,a.jsx)(s.Z,Object.assign({container:!0,style:{maxWidth:"33%",position:"fixed",top:0,zIndex:1,left:"33%"}},{children:(0,a.jsx)(U.Z,{defaultValue:0,ValueLabelComponent:X,getAriaValueText:function(e){return`${e}º`},"aria-labelledby":"discrete-slider-small-steps",valueLabelDisplay:"auto",step:5,marks:!0,min:0,value:h,max:360,onChange:(e,t)=>{x(Number(t))}},void 0)}),void 0),(0,a.jsx)(I,Object.assign({},{excavators:Z,selectedExcavatorMap:ee,setSelectedEM:te,selected:Q,setSelected:W,isNewAssigment:ie,setSelectedAssigment:se}),void 0),(0,a.jsx)(n.Z,Object.assign({map:f,dragRotate:!1,style:"mapbox://styles/dispatchgat/ckqqsfc2y46bo17sf1y29zwnj",mapContainer:m,bearing:Number(h),pitch:15},{lat:S,lng:v,zoom:L,setLat:j,setLng:b,setZoom:$,setLoad:E}),"map2"),ne,ce,le,!ie&&(0,a.jsx)(w.q,Object.assign({trucks:F},{selectedTruckMap:oe,setSelectedTM:ae},{excavator:Q,highlights:q,setHighlights:Y,pinHook:[M,H],map:f.current}),void 0)]}),void 0)}),void 0)};var q=o(3513);const Y=()=>(0,a.jsx)(q.a.Consumer,{children:e=>(0,a.jsx)(H,{gpsExcavator:e.streamExcavator,gpsTruck:e.streamTruck,benchs:e.benchs,polygons:e.polygons,routes:e.routes,curves:e.curves,polygons_actives:e.polygons_actives,geofences:e.geofences,padCells:e.padCells,dmeCells:e.dmeCells,stockCells:e.stockCells},void 0)},void 0)}}]);